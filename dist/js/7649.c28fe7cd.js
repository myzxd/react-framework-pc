"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[7649],{37636:function(e,t,n){n.d(t,{Z:function(){return v}});var r=n(87462),a=n(4942),o=n(67294),i=n(94184),c=n.n(i),s=n(7085),l=n(65632),u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},p=function(e){var t,n,i=e.prefixCls,s=e.className,p=e.color,d=void 0===p?"blue":p,f=e.dot,m=e.pending,v=void 0!==m&&m,g=(e.position,e.label),y=e.children,h=u(e,["prefixCls","className","color","dot","pending","position","label","children"]),b=(0,o.useContext(l.E_).getPrefixCls)("timeline",i),C=c()((t={},(0,a.Z)(t,"".concat(b,"-item"),!0),(0,a.Z)(t,"".concat(b,"-item-pending"),v),t),s),Z=c()((n={},(0,a.Z)(n,"".concat(b,"-item-head"),!0),(0,a.Z)(n,"".concat(b,"-item-head-custom"),!!f),(0,a.Z)(n,"".concat(b,"-item-head-").concat(d),!0),n));return o.createElement("li",(0,r.Z)({},h,{className:C}),g&&o.createElement("div",{className:"".concat(b,"-item-label")},g),o.createElement("div",{className:"".concat(b,"-item-tail")}),o.createElement("div",{className:Z,style:{borderColor:/blue|red|green|gray/.test(d||"")?void 0:d}},f),o.createElement("div",{className:"".concat(b,"-item-content")},y))},d=n(96159),f=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},m=function(e){var t,n=o.useContext(l.E_),i=n.getPrefixCls,u=n.direction,m=e.prefixCls,v=e.pending,g=void 0===v?null:v,y=e.pendingDot,h=e.children,b=e.className,C=e.reverse,Z=void 0!==C&&C,_=e.mode,k=void 0===_?"":_,D=f(e,["prefixCls","pending","pendingDot","children","className","reverse","mode"]),E=i("timeline",m),I="boolean"==typeof g?null:g,O=g?o.createElement(p,{pending:!!g,dot:y||o.createElement(s.Z,null)},I):null,S=o.Children.toArray(h);S.push(O),Z&&S.reverse();var w=function(e,t){return"alternate"===k?"right"===e.props.position?"".concat(E,"-item-right"):"left"===e.props.position?"".concat(E,"-item-left"):"".concat(E,t%2==0?"-item-left":"-item-right"):"left"===k?"".concat(E,"-item-left"):"right"===k||"right"===e.props.position?"".concat(E,"-item-right"):""},P=S.filter((function(e){return!!e})),x=o.Children.count(P),j="".concat(E,"-item-last"),z=o.Children.map(P,(function(e,t){var n=t===x-2?j:"",r=t===x-1?j:"";return(0,d.Tm)(e,{className:c()([e.props.className,!Z&&g?n:r,w(e,t)])})})),T=S.some((function(e){var t;return!!(null===(t=null==e?void 0:e.props)||void 0===t?void 0:t.label)})),R=c()(E,(t={},(0,a.Z)(t,"".concat(E,"-pending"),!!g),(0,a.Z)(t,"".concat(E,"-reverse"),!!Z),(0,a.Z)(t,"".concat(E,"-").concat(k),!!k&&!T),(0,a.Z)(t,"".concat(E,"-label"),T),(0,a.Z)(t,"".concat(E,"-rtl"),"rtl"===u),t),b);return o.createElement("ul",(0,r.Z)({},D,{className:R}),z)};m.Item=p;var v=m},61605:function(e,t,n){n(97564)},27649:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ia}});n(13062);var r=n(71230),a=(n(89032),n(15746)),o=n(15671),i=n(43144),c=n(97326),s=n(60136),l=n(82963),u=n(61120),p=n(4942),d=n(94315),f=n.n(d),m=n(67294),v=(n(52560),n(71577)),g=(n(51838),n(48086)),y=(n(9070),n(20924)),h=n(93517),b=n.n(h),C=n(55609),Z=n(49101),_=n(96036),k=n(93433),D=(n(38252),n(91665)),E=n(45697),I=n.n(E);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var S=D.Z.TreeNode,w=function(e){(0,s.Z)(n,e);var t=O(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"componentWillUnmount",(function(){var e=r.props.namespace,t=void 0===e?"organization":e;r.props.dispatch({type:"applicationCommon/resetDepartments",payload:{namespace:t}})})),(0,p.Z)((0,c.Z)(r),"onSelect",(function(e,t){var n=t.node,a=void 0===n?{}:n;if(!f().empty(e)){var o=r.props.onSelect,i=b().get(a,"node.name",void 0);o&&o(e,i),r.setState({selectedIds:e})}})),(0,p.Z)((0,c.Z)(r),"onExpand",(function(e){Array.isArray(e)&&0===e.length?r.setState({expandedKeys:[]}):r.setState({expandedKeys:(0,k.Z)(e)})})),(0,p.Z)((0,c.Z)(r),"isDisplayOnFilter",(function(e){var t=r.state.searchValue;if(f().empty(t)||f().not.existy(t))return!0;var n=!1;return e.indexOf(t)>-1&&(n=!0),n})),(0,p.Z)((0,c.Z)(r),"iterativeNodesKeys",(function(e){if(!(f().empty(e)||f().not.existy(e)||f().not.array(e))){var t=[];return e.forEach((function(e){var n=e.node,a=e.leaf,o=void 0===a?[]:a;(t=t.concat(r.iterativeNodesKeys(o))).push(n._id)})),t.filter((function(e){return!1==!e}))}})),(0,p.Z)((0,c.Z)(r),"iterativeDefaultNodesKeys",(function(e){if(!(f().empty(e)||f().not.existy(e)||f().not.array(e))){var t=[];return e.forEach((function(e){var n=e.node;t[t.length]=n._id})),t.filter((function(e){return!1==!e}))}})),(0,p.Z)((0,c.Z)(r),"iterativeNodes",(function(e){return f().empty(e)||f().not.existy(e)||f().not.array(e)?[]:e.map((function(e){var t=e.node,n=e.leaf,a=void 0===n?[]:n,o={node:t,disabled:!1};return!1===r.isDisplayOnFilter(t.name)&&(o.disabled=!0),f().not.empty(a)&&f().array(a)?o.leaf=r.iterativeNodes(a):o.leaf=[],o})).filter((function(e){return!f().empty(e.leaf)||!0!==e.disabled}))})),(0,p.Z)((0,c.Z)(r),"renderNodes",(function(e){var t=r.state.searchValue;if(!(f().empty(e)||f().not.existy(e)||f().not.array(e)))return e.map((function(e){var n=e.node,a=e.leaf,o=void 0===a?[]:a,i=n.name.indexOf(t),c=n.name.substr(0,i),s=n.name.substr(i+t.length),l=i>-1?m.createElement("span",null,c,m.createElement("span",{style:{color:"#f50"}},t),s,"(",n.count?n.count:0,"人)"):m.createElement("span",null,n.name,"(",n.count?n.count:0,"人)");return f().empty(o)||f().not.existy(o)||f().not.array(o)?m.createElement(S,{title:l,key:"".concat(n._id),node:n,switcherIcon:m.createElement("span",{style:{fontSize:"16px",marginLeft:"2px"}},"·")},r.renderNodes(o)):m.createElement(S,{title:l,key:"".concat(n._id),node:n},r.renderNodes(o))}))})),(0,p.Z)((0,c.Z)(r),"render",(function(){var e=r.state,t=e.selectedIds,n=void 0===t?[]:t,a=e.expandedKeys,o=void 0===a?[]:a,i=r.props,c=i.departments,s=void 0===c?{}:c,l=i.namespace,u=void 0===l?"organization":l;if(f().empty(s)||f().empty(s[u]))return m.createElement("div",null);var p=s[u],d=r.iterativeNodes(p);return f().empty(d)?m.createElement("div",null):m.createElement(D.Z,{onSelect:r.onSelect,onExpand:r.onExpand,showLine:!0,showIcon:!0,selectedKeys:n,expandedKeys:o},r.renderNodes(d))})),r.state={searchValue:[],selectedIds:[],expandedKeys:[]},r}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.props.dispatch({type:"applicationCommon/fetchDepartments",payload:{isAuthorized:!0,namespace:"organization"}})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.selectedIds,r=t.searchValue,a=void 0===r?[]:r,o=t.expandedKeys,i=e.namespace,c=void 0===i?"organization":i,s=e.departments,l=void 0===s?{}:s,u=e.onSelect,p=e.selectedIds,d=void 0===p?[]:p,m=e.searchValue,v=void 0===m?[]:m,g=e.isJump,y=void 0!==g&&g,h=e.flatDepartment,C=void 0===h?[]:h;if((f().empty(n)||!f().existy(n))&&f().not.empty(l[c])){var Z=b().get(l[c],"0.node",{}),_=b().get(Z,"_id",void 0),D=_&&l[c].map((function(e){return e.node._id}));return _?(u&&u([_],b().get(Z,"name",void 0)),{selectedIds:[_],expandedKeys:D}):null}if(b().get(n,"0",void 0)!==b().get(d,"0",void 0)){if(y){var E=function(e,t){if(!t)return[];var n=[],r=t;return function t(a){var o=e.find((function(e){return e._id===a}));f().not.empty(o)&&f().existy(o)&&(b().get(o,"_id",void 0)&&(n[n.length]=b().get(o,"_id")),(r=b().get(o,"pid",void 0))&&t(r))}(t),n}(C,n[0]);return{selectedIds:d,expandedKeys:[].concat((0,k.Z)(E),(0,k.Z)(o))}}return{selectedIds:d}}return b().get(a,"0",void 0)!==b().get(v,"0",void 0)?{searchValue:v}:null}}]),n}(m.Component);w.protoTypes={namespace:I().string,departments:I().object,flatDepartment:I().array,selectedIds:I().array,searchValue:I().array,isJump:I().bool,onSelect:I().func},w.defaultProps={namespace:"organization",departments:{},flatDepartment:[],selectedIds:[],searchValue:[],isJump:!1,onSelect:function(){}};var P=(0,C.connect)((function(e){var t=e.applicationCommon;return{departments:t.departments,flatDepartment:t.flatDepartment}}))(w),x=n(45430),j=(n(75310),n(76772)),z=n(87462),T=(n(35668),n(86585)),R=n(15861),F=n(87757),A=n.n(F),U=(n(98703),n(1825)),L=(n(29093),n(16317));function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var V=L.Z.Option,B=function(e){(0,s.Z)(n,e);var t=M(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"onChange",(function(t,n){var r=e.props.onChangePid;r&&r(t,n)})),e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)({type:"department/getDepartmentTree",payload:{isAuthorized:!0}})}},{key:"render",value:function(){var e=this.props,t=e.departmentTree,n=void 0===t?[]:t,r=e.value,a=e.disabled,o=e.curDepId,i=e.otherChild,c=(0,k.Z)(n).filter((function(e){return e._id!==o}));"0"!==r&&c.shift();return m.createElement(L.Z,{style:{width:"100%"},placeholder:"请选择上级部门",onChange:this.onChange,value:r,disabled:a,allowClear:!0,showSearch:!0,optionFilterProp:"children"},!i._id||c.some((function(e){return e._id===i._id}))?c.map((function(e){return m.createElement(V,{key:e._id,value:e._id},e.code?"".concat(e.name,"（").concat(e.code,"）"):e.name)})):[].concat((0,k.Z)(c),[i]).map((function(e){return e._id===i._id?m.createElement(V,{disabled:!0,key:e._id,value:e._id},e.code?"".concat(e.name,"（").concat(e.code,"）"):e.name):m.createElement(V,{key:e._id,value:e._id},e.code?"".concat(e.name,"（").concat(e.code,"）"):e.name)})))}}]),n}(m.Component);B.protoType={departmentTree:I().array,onChangePid:I().func,value:I().string,disabled:I().bool,otherChild:I().object},B.defaultProps={departmentTree:[],onChangePid:function(){},value:void 0,disabled:!1,otherChild:{}};var N=(0,C.connect)((function(e){return{departmentTree:e.department.departmentTree}}))(B),Y=n(8240);function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var J={labelCol:{span:6},wrapperCol:{span:18}},$="create",G="update",W=function(e){(0,s.Z)(n,e);var t=q(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onChangePid",(function(t,n){var r=e.props.detail,a=b().get(n,"children",void 0),o=r.pid,i=void 0===o?void 0:o;(0,e.formRef.current.setFieldsValue)({superior:t}),i&&i!==t?e.setState({isShowPidPrompt:!0,curPid:a}):e.setState({isShowPidPrompt:!1})})),(0,p.Z)((0,c.Z)(e),"onSubmit",(0,R.Z)(A().mark((function t(){var n,r,a,o,i,c,s,l,u,p,d;return A().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props,r=n.type,a=n.dispatch,o=n.detail,i=n.onSuccessCallback,c=n.onFailureCallback,s=b().get(o,"parent_info.name",void 0),l=o._id,u=void 0===l?void 0:l,t.next=5,e.formRef.current.validateFields();case 5:p=t.sent,d=H(H({id:u},p),{},{onSuccessCallback:function(t){return i(H(H({},t),{},{originalPidName:s,curPidName:e.state.curPid}))},onFailureCallback:c,onChangeIsSubmit:function(){e.private.isSubmit=!0}}),e.private.isSubmit&&(r===G&&a({type:"department/updateDepartment",payload:d}),r===$&&a({type:"department/createDepartment",payload:d})),e.private.isSubmit=!1;case 9:case"end":return t.stop()}}),t)})))),(0,p.Z)((0,c.Z)(e),"onVerify",(function(e,t,n){if(t){/^[0-9a-zA-Z-]{1,}$/.test(t)?n():n("请输入数字、字母和中横线")}else n("请输入部门编号")})),(0,p.Z)((0,c.Z)(e),"onCancel",(function(){var t=e.props.onCancel;t&&t()})),(0,p.Z)((0,c.Z)(e),"onChangeName",(function(t){var n=e.props.detail,r=(void 0===n?{}:n).name,a=void 0===r?void 0:r;a&&a!==t.target.value?e.setState({isShowNamePrompt:!0}):e.setState({isShowNamePrompt:!1})})),(0,p.Z)((0,c.Z)(e),"renderForm",(function(){var t=e.props,n=t.detail,r=void 0===n?{}:n,a=t.isUpperDepartmentApprove,o=r.name,i=void 0===o?void 0:o,c=r.code,s=void 0===c?void 0:c,l=r.pid,u=void 0===l?"0":l,p=[m.createElement(T.Z.Item,{label:"部门名称",name:"name",initialValue:i,rules:[{required:!0,message:"请输入部门名称"},{min:2,message:"部门名称必须超过2个字"},{max:32,message:"部门名称必须小于32个字"},{pattern:/^\S+$/,message:"部门名称不能包含空格"}]},m.createElement(y.Z,{placeholder:"请输入部门名称",onChange:e.onChangeName})),m.createElement(T.Z.Item,{label:"上级部门",name:"superior",initialValue:u||"0",rules:[{required:!0,message:"请选择上级部门"}]},m.createElement(N,{onChangePid:e.onChangePid,disabled:!u||"0"===u||a,curDepId:b().get(r,"_id",void 0),otherChild:(0,Y.Cg)(r,"parent_info",{})})),m.createElement(T.Z.Item,{label:"部门编号",name:"code",initialValue:s,rules:[{required:!0,message:"请输入部门编号"},function(){return{validator:function(e,t){return!t||/^[0-9a-zA-Z-]{1,}$/.test(t)?Promise.resolve():Promise.reject("请输入数字、字母或中横线")}}}]},m.createElement(y.Z,{placeholder:"请输入部门编号"}))];return m.createElement(T.Z,(0,z.Z)({ref:e.formRef},J),m.createElement(_.Fp,{className:"affairs-flow-basic",items:p,cols:1}))})),(0,p.Z)((0,c.Z)(e),"renderMadal",(function(){var t=e.props,n=t.visible,r=t.title,a=t.type,o=e.state,i=o.isShowNamePrompt,c=o.isShowPidPrompt;return m.createElement(U.Z,{title:r,width:400,onClose:e.onCancel,visible:n,bodyStyle:{paddingBottom:80},footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:e.onCancel,style:{marginRight:8}},"取消"),m.createElement(v.Z,{onClick:e.onSubmit,type:"primary"},"提交"))},i&&a===G?m.createElement(j.Z,{message:"部门名称已经修改，请及时修改部门编号",type:"info",showIcon:!0,banner:!0,style:{marginBottom:10}}):null,c&&a===G?m.createElement(j.Z,{message:"上级部门已经修改，请及时修改部门编号",type:"info",showIcon:!0,banner:!0,style:{marginBottom:10}}):null,e.renderForm())})),e.state={isShowNamePrompt:!1,isShowPidPrompt:!1,curPid:void 0},e.private={isSubmit:!0},e.formRef=m.createRef(),e}return(0,i.Z)(n,[{key:"render",value:function(){return this.renderMadal()}}]),n}(m.Component);W.propTypes={type:I().string,title:I().string,visible:I().bool,dispatch:I().func,onCancel:I().func,detail:I().object,onSuccessCallback:I().func,onFailureCallback:I().func,isUpperDepartmentApprove:I().bool},W.defaultProps={type:G,title:void 0,visible:!1,dispatch:function(){},onCancel:function(){},detail:{},onSuccessCallback:function(){},onFailureCallback:function(){},isUpperDepartmentApprove:!1};var Q=W,X="cAjNo6RIfTA4GBTmQInA",ee="owlG_MIqcV8OFdUZX1zz",te="SPSWd71UwFjnqsXCuswk",ne="XUb78rRgjKB_1iVlnDRw",re="XPMM20lwomIDuVWfnEDg";function ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var oe=y.Z.Search,ie="create",ce=function(e){(0,s.Z)(n,e);var t=ae(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"onSelect",(function(e,t){var n=b().get(e,"0");r.props.onSelectOrganization&&r.props.onSelectOrganization(n,t)})),(0,p.Z)((0,c.Z)(r),"onSearch",(function(e){var t=e.target.value;r.setState({searchValue:t})})),(0,p.Z)((0,c.Z)(r),"onCancel",(function(){r.setState({visible:!1})})),(0,p.Z)((0,c.Z)(r),"onCreateFailureCallback",(function(e){e.zh_message&&g.ZP.error(e.zh_message)})),(0,p.Z)((0,c.Z)(r),"onCreateSuccessCallback",(function(){r.props.dispatch({type:"applicationCommon/fetchDepartments",payload:{isAuthorized:!0}}),r.onCancel()})),(0,p.Z)((0,c.Z)(r),"renderModal",(function(){var e=r.state.visible;if(e){var t=r.props.dispatch;return m.createElement(Q,{type:ie,title:"新建部门",visible:e,dispatch:t,onCancel:r.onCancel,onSuccessCallback:r.onCreateSuccessCallback,onFailureCallback:r.onCreateFailureCallback})}})),r.state={searchValue:[],selectedIds:[],visible:!1},r}return(0,i.Z)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.searchValue,r=t.selectedIds,a=this.props.isJump;return m.createElement(_.IT,{title:"组织结构",style:{height:"86vh"}},m.createElement(oe,{style:{marginBottom:8},placeholder:"Search",onChange:this.onSearch}),x.ZP.canOperateOrganizationManageDepartmentCreate()?m.createElement("div",{className:ne},m.createElement(v.Z,{onClick:function(){return e.setState({visible:!0})},icon:m.createElement(Z.Z,null),className:re,type:"primary"},"新建部门")):null,this.renderModal(),m.createElement("div",{style:{height:"68vh",overflowY:"scroll"}},m.createElement(P,{selectedIds:r,searchValue:n,onSelect:this.onSelect,isJump:a}),m.createElement("div",{style:{textAlign:"center",color:"bisque",marginTop:"10px"}},"-- END --")))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.selectedIds,r=e.selectedIds;return b().get(n,"0",void 0)!==b().get(r,"0",void 0)?{selectedIds:r}:null}}]),n}(m.Component),se=(0,C.connect)()(ce),le=(n(9523),n(51752));function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var pe="create",de=function(e){(0,s.Z)(n,e);var t=ue(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onCancel",(function(){e.setState({visible:!1})})),(0,p.Z)((0,c.Z)(e),"onSuccessCallback",(function(t){var n;e.onCancel(),t.record&&(n=t.record._id),window.location.href="/#/Organization/Manage/Department?id=".concat(n)})),(0,p.Z)((0,c.Z)(e),"onFailureCallback",(function(t){e.onCancel(),t.zh_message&&g.ZP.error(t.zh_message)})),(0,p.Z)((0,c.Z)(e),"renderModal",(function(){var t=e.state.visible,n=e.props.dispatch;if(t)return m.createElement(Q,{title:"创建岗位",visible:t,type:pe,dispatch:n,onCancel:e.onCancel,onSuccessCallback:e.onSuccessCallback,onFailureCallback:e.onFailureCallback})})),e.state={visable:!1},e}return(0,i.Z)(n,[{key:"render",value:function(){var e=this;return m.createElement(_.IT,{style:{minHeight:"400px",lineHeight:"400px",textAlign:"center"}},m.createElement(v.Z,{onClick:function(){return e.setState({visible:!0})}},"创建部门"),this.renderModal())}}]),n}(m.Component),fe=(0,C.connect)()(de),me=n(30381),ve=n.n(me),ge=n(80385),ye=n(66939);function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var be=L.Z.Option,Ce=function(e){(0,s.Z)(n,e);var t=he(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onSubmit",(function(){var t=e.props,n=t.form,r=t.dispatch,a=t.departmentId,o=t.onSuccessCallback,i=t.onFailureCallback;n.validateFields((function(t,n){if(!t){var c=n.administratorId,s={id:a,administratorId:c||"remove",onSuccessCallback:o,onFailureCallback:i};e.private.isSubmit&&a&&r({type:"department/updateDepartment",payload:s}),e.private.isSubmit=!1}}))})),(0,p.Z)((0,c.Z)(e),"onCancel",(function(){var t=e.props.onCancel;t&&t()})),(0,p.Z)((0,c.Z)(e),"renderForm",(function(){var t=e.props,n=t.form,r=t.principal,a=t.departmentMember,o=(void 0===a?{}:a).data,i=void 0===o?[]:o,c=[{label:"负责人",form:(0,n.getFieldDecorator)("administratorId",{initialValue:r})(m.createElement(L.Z,{allowClear:!0,style:{width:"100%"},placeholder:"请选择负责人",showSearch:!0,optionFilterProp:"children"},i.map((function(e){return m.createElement(be,{key:e._id,value:e._id},e.name)}))))}];return m.createElement(_.KP,{items:c,cols:1,layout:{labelCol:{span:5},wrapperCol:{span:16}}})})),(0,p.Z)((0,c.Z)(e),"renderMadal",(function(){var t=e.props,n=t.visible,r=t.departmentMember,a=(void 0===r?{}:r).data,o=0===(void 0===a?[]:a).length;return m.createElement(U.Z,{title:"设置部门负责人",width:400,onClose:e.onCancel,visible:n,bodyStyle:{paddingBottom:80},footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:e.onCancel,style:{marginRight:8}},"取消"),m.createElement(v.Z,{disabled:o,onClick:e.onSubmit,type:"primary"},"提交"))},e.renderForm())})),e.state={},e.private={isSubmit:!0},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,n=e.departmentId,r=void 0===n?void 0:n;r&&t({type:"department/getDepartmentMember",payload:{id:r,limit:9999,page:1}})}},{key:"render",value:function(){return this.renderMadal()}}]),n}(m.Component);Ce.propTypes={departmentId:I().string,principal:I().string,visible:I().bool,form:I().object,dispatch:I().func,onCancel:I().func,onSuccessCallback:I().func,onFailureCallback:I().func,departmentMember:I().object},Ce.defaultProps={departmentId:void 0,principal:void 0,visible:!1,form:{},dispatch:function(){},onCancel:function(){},onSuccessCallback:function(){},onFailureCallback:function(){},departmentMember:{}};var Ze=ye.Z.create()((0,C.connect)((function(e){return{departmentMember:e.department.departmentMember}}))(Ce)),_e=(n(52466),n(10642)),ke="JnbjDo8fN8HsEg7CIWfM",De="KauOzKnIMVQSu9Wh6qkn",Ee="AKxuhME4HF73Jz4t0cot",Ie="HWquFDem9iDOzt_3rrsC",Oe="XHsBVGLfWW4CC_pCtH8w",Se="mR4rqMFVPLA2EeA5sdY5",we=function(e){var t=e.visible,n=e.message,r=void 0===n?{}:n,a=e.onCancelErrorModal,o="请求异常";if(r&&r.zh_message&&(o=r.zh_message),r&&r.record){var i=r.originalPidName,c=void 0===i?"无":i,s=r.curPidName,l=void 0===s?"无":s;o=m.createElement("span",null,"".concat(b().get(r,"record.name","--"),"    调整上级部门成功"),m.createElement("br",null),m.createElement("span",{className:Se},"调整前上级部门：","".concat(c)),m.createElement("br",null),m.createElement("span",{className:Se},"调整后上级部门：","".concat(l)))}return m.createElement(_e.Z,{visible:t,footer:null,onCancel:function(){return a()}},m.createElement("div",{className:Ie},o),m.createElement("div",{className:Oe},m.createElement(v.Z,{type:"primary",onClick:function(){return a()}},"知道了")))},Pe=(n(54071),n(14072)),xe=n(29439),je=(n(48659),n(86221)),ze=n(88144),Te=n(97116),Re=(n(61605),n(37636)),Fe={labelCol:{span:6},wrapperCol:{span:18}},Ae=(0,C.connect)((function(e){return{examineFlowInfo:e.oaCommon.examineFlowInfo}}))((function(e){var t=e.dispatch,n=e.examineFlowInfo,r=void 0===n?[]:n,a=e.departmentId,o=e.specialDepartmentId,i=e.accountId,c=e.flowId;if((0,m.useEffect)((function(){return c&&t({type:"oaCommon/getExamineFlowInfo",payload:{flowId:c,specialDepartmentId:o,departmentId:a,accountId:i}}),function(){return t({type:"oaCommon/resetExamineFlowInfo"})}}),[t,c,o,a,i]),!r||!Array.isArray(r)||r.length<1)return m.createElement("div",null);return m.createElement(m.Fragment,null,m.createElement(T.Z,(0,z.Z)({},Fe,{className:"organization-flow-preview"}),m.createElement(T.Z.Item,{label:"审批流预览",key:"flow_preview"},m.createElement(Re.Z,null,r.map((function(e,t){return m.createElement(Re.Z.Item,{key:t},e.name,"(",e.accounts_name?e.accounts_name:"无",")")}))))))}));function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Me={labelCol:{span:6},wrapperCol:{span:18}},Ve=y.Z.TextArea,Be=function(){};function Ne(e){var t=e.onChangeCheckResult,n=e.onChangeUpperDepartmentVisable,r=e.departmentDetail,a=e.createOaUpperDepartment,o=e.updateOaUpperDepartment,i=e.checkDepartmentUpdate,c=e.isUpdate,s=e.upperDepartmentFlowId,l=e.submitOrder,u=e.onSuccess,p=T.Z.useForm(),d=(0,xe.Z)(p,1)[0],f=(0,m.useState)(!1),h=(0,xe.Z)(f,2),b=h[0],C=h[1],Z=(0,m.useState)(!1),k=(0,xe.Z)(Z,2),D=k[0],E=k[1];(0,m.useEffect)((function(){I()}),[r]);var I=function(){c?d.setFieldsValue({superior:(0,Y.Cg)(r,"update_parent_department_info._id","0"),code:(0,Y.Cg)(r,"department_info.code",void 0),effectiveDate:(0,Y.Cg)(r,"take_effect_date",void 0)?ve()("".concat((0,Y.Cg)(r,"take_effect_date"))):void 0,reason:(0,Y.Cg)(r,"note",void 0),assetKeys:je.uA.getInitialValue(r,"asset_infos",{})}):d.setFieldsValue({superior:(0,Y.Cg)(r,"pid","0"),code:(0,Y.Cg)(r,"code",void 0),effectiveDate:ve()(),reason:void 0,assetKeys:[]})},O=function(){var e=(0,R.Z)(A().mark((function e(){var t,i,p;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.getFieldsValue();case 2:if(t=e.sent,i={updateParentDepartmentId:(0,Y.Cg)(t,"superior",void 0),code:(0,Y.Cg)(t,"code",void 0),effectiveDate:(0,Y.Cg)(t,"effectiveDate",void 0)&&Number(t.effectiveDate.format("YYYYMMDD")),reason:(0,Y.Cg)(t,"reason",void 0),assetKeys:(0,Y.Cg)(t,"assetKeys",void 0)},!c){e.next=10;break}return e.next=7,o(Le(Le({},i),{},{oaOrganizationOrderId:(0,Y.Cg)(r,"_id",void 0)}));case 7:p=e.sent,e.next=13;break;case 10:return e.next=12,a(Le(Le({},i),{},{upperDepartmentFlowId:s,departmentId:(0,Y.Cg)(r,"_id",void 0)}));case 12:p=e.sent;case 13:if(!p){e.next=27;break}return e.next=16,l({id:p.oa_application_order_id,copyGive:t.copyGive});case 16:if(!e.sent){e.next=25;break}return g.ZP.success("请求成功"),n(!1),C(!1),c||d.setFieldsValue({superior:(0,Y.Cg)(r,"pid","0"),code:(0,Y.Cg)(r,"code",void 0),effectiveDate:ve()(),reason:void 0,assetKeys:[]}),E(!1),u(),e.abrupt("return",!0);case 25:case 27:return E(!1),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,R.Z)(A().mark((function e(){var n,a,o;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.validateFields();case 2:return n=e.sent,E(!0),a={organizationSubType:ge.H_0.change,departmentId:(0,Y.Cg)(r,"_id",void 0),updateParentDepartmentId:(0,Y.Cg)(n,"superior",void 0)},c&&(a.oaApplicationOrderId=(0,Y.Cg)(r,"oa_application_order_info._id",void 0)),e.next=8,i(a);case 8:if(!(o=e.sent)){e.next=20;break}if(!o.ok){e.next=16;break}return e.next=13,O();case 13:return e.abrupt("return");case 16:E(!0),t(!0,O,o.hint_list,"调整类型：组织架构-调整部门(".concat(c?(0,Y.Cg)(r,"department_info.name","--"):(0,Y.Cg)(r,"name","--"),")"));case 18:return E(!1),e.abrupt("return");case 20:E(!1);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(e){d.setFieldsValue({superior:e}),(0,Y.Cg)(r,"pid")!==e?C(!0):C(!1)},P=(0,Y.CE)(["dispatch","onChangeCheckResult","onChangeUpperDepartmentVisable","departmentDetail","createOaUpperDepartment","updateOaUpperDepartment","checkDepartmentUpdate","isUpdate","upperDepartmentFlowId","submitOrder","onSuccess"],e),x={flowId:s||(0,Y.Cg)(r,"oa_application_flow_id",void 0),departmentId:c?(0,Y.Cg)(r,"department_info._id",void 0):(0,Y.Cg)(r,"_id",void 0),specialDepartmentId:c?(0,Y.Cg)(r,"department_info._id",void 0):(0,Y.Cg)(r,"_id",void 0),accountId:Te.Iq.account.id};return m.createElement(U.Z,(0,z.Z)({title:"调整上级部门",width:"400",onClose:function(){I(),n(!1)},footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:function(){I(),n(!1)}},"取消"),m.createElement(v.Z,{onClick:function(){S()},type:"primary",loading:D,style:{marginLeft:10}},"提交"))},P),b?m.createElement(j.Z,{message:"上级部门已经修改，请及时修改部门编号",type:"info",showIcon:!0,banner:!0,style:{marginBottom:10}}):null,m.createElement(T.Z,(0,z.Z)({form:d},Me),function(){var e=[m.createElement(T.Z.Item,{label:"部门名称",name:"name"},c?(0,Y.Cg)(r,"department_info.name","--"):(0,Y.Cg)(r,"name","--")),m.createElement(T.Z.Item,{label:"上级部门",name:"superior",rules:[{required:!0,message:"请选择上级部门"}]},m.createElement(N,{onChangePid:w,disabled:c,curDepId:c?(0,Y.Cg)(r,"department_info._id",void 0):(0,Y.Cg)(r,"_id",void 0),otherChild:c?(0,Y.Cg)(r,"department_info.parent_info",{}):(0,Y.Cg)(r,"parent_info",{})})),m.createElement(T.Z.Item,{label:"部门编号",name:"code",rules:[{required:!0,message:"请输入部门编号"},function(){return{validator:function(e,t){return!t||/^[0-9a-zA-Z-]{1,}$/.test(t)?Promise.resolve():Promise.reject("请输入数字、字母或中横线")}}}]},m.createElement(y.Z,{placeholder:"请输入部门编号"})),m.createElement(T.Z.Item,{label:"生效日期",name:"effectiveDate",rules:[{required:!0,message:"请选择生效日期"}]},m.createElement(Pe.Z,{disabledDate:function(e){return e&&e<ve()().endOf("day").subtract(1,"days")}})),m.createElement(T.Z.Item,{label:"调整原因",name:"reason",rules:[{required:!0,message:"请输入调整原因"}]},m.createElement(Ve,{placeholder:"请输入调整原因",rows:4})),m.createElement(T.Z.Item,{label:"附件",name:"assetKeys"},m.createElement(je.uA,{domain:je.uA.UploadDomains.OAUploadDomain}))];if(!c){var t=s||(0,Y.Cg)(r,"oa_application_flow_id",void 0);e.push(m.createElement(T.Z.Item,{label:"固定抄送"},m.createElement(ze.ir,{flowId:t})),m.createElement(T.Z.Item,{label:"抄送",name:"copyGive"},m.createElement(ze.t2,{flowId:t})))}return m.createElement(_.Fp,{className:"affairs-flow-basic",items:e,cols:1})}()),P.visible?m.createElement(Ae,x):null)}Ne.propTypes={onChangeCheckResult:I().func,onChangeUpperDepartmentVisable:I().func,departmentDetail:I().object,isUpdate:I().bool,upperDepartmentFlowId:I().string,onSuccess:I().func},Ne.defaultProps={onChangeCheckResult:Be,onChangeUpperDepartmentVisable:Be,onSuccess:Be,departmentDetail:{},isUpdate:!1};var Ye=(0,C.connect)((function(){return{}}),(function(e){return{createOaUpperDepartment:function(t){return e({type:"department/createOaUpperDepartment",payload:t})},updateOaUpperDepartment:function(t){return e({type:"department/updateOaUpperDepartment",payload:t})},checkDepartmentUpdate:function(t){return e({type:"department/checkDepartmentUpdate",payload:t})},submitOrder:function(t){return e({type:"oaCommon/submitOrder",payload:t})}}}))(Ne);function Ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var He=function(e){(0,s.Z)(n,e);var t=Ke(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onCancelUpdate",(function(){e.setState({updateVisible:!1})})),(0,p.Z)((0,c.Z)(e),"onCancelPrincipal",(function(){e.setState({principalVisible:!1})})),(0,p.Z)((0,c.Z)(e),"onCancelErrorModal",(function(){e.setState({errPromptVisible:!1})})),(0,p.Z)((0,c.Z)(e),"onChangeUpperDepartmentVisable",(function(t){e.setState({upperDepartmentVisible:t||!1})})),(0,p.Z)((0,c.Z)(e),"onUpdateDepCallBack",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.props,r=n.departmentDetail,a=void 0===r?{}:r,o=n.onSelectDepartment,i=(0,Y.Cg)(a,"parent_info._id",void 0);if(e.setState({updateVisible:!1,principalVisible:!1}),t&&t.ok){o((0,Y.Cg)(t,"record._id"),(0,Y.Cg)(t,"record.name")),e.getDepartmentTree(),e.getDepartmentDetail();var c=(0,Y.Cg)(t,"record.pid",void 0);i!==c&&c&&i?e.setState({errPromptVisible:!0,errorMessage:t}):g.ZP.success("请求成功")}else e.setState({errPromptVisible:!0,errorMessage:t})})),(0,p.Z)((0,c.Z)(e),"onSuccessCallback",(function(){g.ZP.success("操作成功"),e.getDepartmentDetail(),e.getDepartmentTree(),e.setState({updateVisible:!1,principalVisible:!1})})),(0,p.Z)((0,c.Z)(e),"onFailureCallback",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.zh_message&&g.ZP.error(t.zh_message),e.setState({updateVisible:!1,principalVisible:!1})})),(0,p.Z)((0,c.Z)(e),"getDepartmentDetail",(function(){var t=e.props,n=t.dispatch,r=t.departmentId;r&&n({type:"department/getDepartmentDetail",payload:{id:r}})})),(0,p.Z)((0,c.Z)(e),"getDepartmentTree",(function(){(0,e.props.dispatch)({type:"applicationCommon/fetchDepartments",payload:{isAuthorized:!0,namespace:"organization"}})})),(0,p.Z)((0,c.Z)(e),"renderBasic",(function(){var t=e.props,n=t.departmentDetail,r=void 0===n?{}:n,a=t.departmentId,o=t.isUpperDepartmentApprove,i=r.name,c=void 0===i?void 0:i,s=r.code,l=void 0===s?void 0:s,u=r.created_at,p=void 0===u?void 0:u,d=(0,Y.Cg)(r,"administrator_info.name",void 0),f=d?"修改":"设置",v=m.createElement("div",null,d||"--",x.ZP.canOperateOrganizationManageDepartmentManager()?m.createElement("a",{onClick:function(){return e.setState({principalVisible:!0})},className:ke},f):null),y=[m.createElement(T.Z.Item,{label:"部门名称"},c||"--"),m.createElement(T.Z.Item,{label:"上级部门"},(0,Y.Cg)(r,"parent_info.name","无")),m.createElement(T.Z.Item,{label:"部门编号"},l||"--"),m.createElement(T.Z.Item,{label:"编制数"},(0,Y.Cg)(r,"organization_num","--")),m.createElement(T.Z.Item,{label:"占编人数"},(0,Y.Cg)(r,"organization_count","--")),m.createElement(T.Z.Item,{label:"创建者"},(0,Y.Cg)(r,"creator_info.name","--")),m.createElement(T.Z.Item,{label:"创建时间"},p?ve()(String(p)).format("YYYY-MM-DD"):"--"),m.createElement(T.Z.Item,{label:"部门负责人"},v),m.createElement(T.Z.Item,{label:"状态"},(0,Y.Cg)(r,"state",void 0)?r.state===ge.f$m.enable?"正常":ge.f$m.description(r.state):"--"),m.createElement(T.Z.Item,{label:"生效日期"},(0,Y.Cg)(r,"take_effect_date",void 0)?ve()(String(r.take_effect_date)).format("YYYY-MM-DD"):"--"),m.createElement(T.Z.Item,{label:"来源"},(0,Y.Cg)(r,"source",void 0)?ge.Nfd.description(r.source):"--")],h=m.createElement("div",null,(0,Y.Cg)(r,"pid",void 0)&&o&&x.ZP.canOperateOrganizationManageDepartmentCreate()?m.createElement("a",{href:"#!",style:{marginRight:10},onClick:function(){var t=(0,R.Z)(A().mark((function t(n){var r;return A().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,e.props.dispatch({type:"department/getOrganizationFlowList",payload:{departmentId:a,organizationSubType:ge.H_0.change}});case 3:if(!(r=t.sent)||!r.data){t.next=10;break}if(!(0,Y.Cg)(r,"data.0.flow_template_records.0._id","")){t.next=9;break}e.setState({upperDepartmentFlowId:(0,Y.Cg)(r,"data.0.flow_template_records.0._id"),upperDepartmentVisible:!0}),t.next=10;break;case 9:return t.abrupt("return",g.ZP.error("提示：无适用审批流，请联系流程管理员"));case 10:if(!r||!r.zh_message){t.next=12;break}return t.abrupt("return",g.ZP.error(r.zh_message));case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},"调整上级部门"):null,x.ZP.canOperateOrganizationManageDepartmentUpdate()?m.createElement("a",{href:"#!",onClick:function(t){t.preventDefault(),e.setState({updateVisible:!0})}},"编辑"):null);return m.createElement(_.IT,{title:"基本信息",titleExt:h},m.createElement(T.Z,null,m.createElement(_.Fp,{className:"affairs-flow-basic",items:y,cols:3,layout:{labelCol:{span:8},wrapperCol:{span:16}}})))})),(0,p.Z)((0,c.Z)(e),"renderUpdateModal",(function(){var t=e.state.updateVisible,n=e.props.isUpperDepartmentApprove,r=e.props,a=r.departmentDetail,o=void 0===a?{}:a,i=r.dispatch;if(t)return m.createElement(Q,{title:"编辑部门",visible:t,detail:o,dispatch:i,onCancel:e.onCancelUpdate,onSuccessCallback:e.onUpdateDepCallBack,onFailureCallback:e.onUpdateDepCallBack,isUpperDepartmentApprove:n})})),(0,p.Z)((0,c.Z)(e),"renderPrincipalModal",(function(){var t=e.state.principalVisible;if(t){var n=e.props.departmentDetail,r=void 0===n?{}:n,a=r._id,o=void 0===a?void 0:a,i=(0,Y.Cg)(r,"administrator_info._id",void 0);return m.createElement(Ze,{visible:t,departmentId:o,principal:i,onCancel:e.onCancelPrincipal,onSuccessCallback:e.onSuccessCallback,onFailureCallback:e.onFailureCallback})}})),(0,p.Z)((0,c.Z)(e),"renderErrorModal",(function(){var t=e.props.departmentDetail,n=void 0===t?{}:t;return m.createElement(we,{visible:e.state.errPromptVisible,message:e.state.errorMessage,departmentDetail:n,onCancelErrorModal:e.onCancelErrorModal})})),e.state={updateVisible:!1,principalVisible:!1,errPromptVisible:!1,upperDepartmentVisible:!1,upperDepartmentFlowId:""},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.getDepartmentDetail()}},{key:"componentDidUpdate",value:function(e){(0,Y.Cg)(e,"departmentId",void 0)!==(0,Y.Cg)(this.props,"departmentId",void 0)&&this.getDepartmentDetail()}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"department/resetDepartmentDetail",payload:{}})}},{key:"render",value:function(){var e=this,t=this.state,n=t.upperDepartmentVisible,r=t.upperDepartmentFlowId,a=this.props,o=a.departmentDetail,i=a.onChangeCheckResult,c=a.departmentId;return m.createElement("div",null,this.renderBasic(),this.renderUpdateModal(),this.renderPrincipalModal(),this.renderErrorModal(),m.createElement(Ye,{departmentDetail:o,onChangeUpperDepartmentVisable:function(t){e.onChangeUpperDepartmentVisable(t)},visible:n,onChangeCheckResult:i,upperDepartmentFlowId:r,onSuccess:function(){e.getDepartmentTree(),e.getDepartmentDetail(),e.props.dispatch({type:"department/getChildDepartmentList",payload:{id:c}}),e.props.dispatch({type:"department/findDepartmentOrderList",payload:{targetParentDepartmentId:c,orderNameSpace:"department-tab2",state:ge.UYH.effectBefore,organizationSubTypes:[ge.H_0.create,ge.H_0.change,ge.H_0.revoke]}}),e.props.dispatch({type:"department/findDepartmentOrderList",payload:{targetParentDepartmentId:c,orderNameSpace:"department-tab2",state:ge.UYH.close,organizationSubTypes:[ge.H_0.create,ge.H_0.change,ge.H_0.revoke]}})}}))}}]),n}(m.Component);He.propTypes={departmentId:I().string,dispatch:I().func,onSelectDepartment:I().func,departmentDetail:I().object,onChangeCheckResult:I().func,isUpperDepartmentApprove:I().bool},He.defaultProps={departmentId:"",dispatch:function(){},departmentDetail:{},childDepartmentList:{},departmentMember:{},onChangeCheckResult:function(){},onSelectDepartment:function(){},isUpperDepartmentApprove:!1};var qe=(0,C.connect)((function(e){var t=e.department;return{departmentDetail:t.departmentDetail,childDepartmentList:t.childDepartmentList,departmentMember:t.departmentMember}}))(He),Je=(n(21316),n(75443)),$e=(n(20186),n(75385)),Ge="create",We="update",Qe=function(){};function Xe(e){var t=e.dispatch,n=e.tabKey,r=e.tableLoading,a=e.childDepartmentData,o=e.onSelectDepartment,i=e.onShowSizeChange,c=e.onChangePage,s=e.breakDepartmentList,l=e.getDepartmentTree,u=e.setCurrentDepartmentDetail,p=e.onChangeUpperDepartmentVisable,d=e.onChangeAddSubVisible,f=e.onChangeRevokeDepartmentVisable,v=e.setIsUpperDepartmentUpdate,y=e.setIsAddSubUpdate,h=e.setIsRevokeDepartmentUpdate,b=e.closeOaOrganizationOrder,C=e.checkDepartmentUpdate,Z=e.deleteDepartment,_=e.onChangeCheckResult,k=e.getOrganizationFlowList,D=e.setRevokeDepartmentFlowId,E=e.setUpperDepartmentFlowId,I=e.breakDepartmentAllList,O=e.isUpperDepartmentApprove,S=e.isRevokeDepartmentApprove,w=(0,m.useState)(!1),P=(0,xe.Z)(w,2),j=P[0],z=P[1],T=(0,m.useState)(void 0),F=(0,xe.Z)(T,2),U=F[0],L=F[1],M=(0,m.useState)({}),V=(0,xe.Z)(M,2),B=V[0],N=V[1],K=function(){var e=(0,R.Z)(A().mark((function e(t){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z({id:t});case 2:if(!e.sent){e.next=8;break}return g.ZP.success("请求成功"),s(),l({isAuthorized:!0,namespace:"organization"}),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=(0,R.Z)(A().mark((function e(t){var n,r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={organizationSubType:ge.H_0.revoke,departmentId:t._id},e.next=3,C(n);case 3:if(!(r=e.sent)){e.next=11;break}if(!r.ok){e.next=10;break}return e.next=8,K(t._id);case 8:e.next=11;break;case 10:_(!0,(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t._id);case 2:case"end":return e.stop()}}),e)}))),r.hint_list,"调整类型：组织架构-裁撤部门");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){g.ZP.success("操作成功"),I(),l({isAuthorized:!0,namespace:"organization"}),z(!1)},J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.zh_message&&g.ZP.error(e.zh_message)};return m.createElement("div",null,function(){var e,t=a.data,s=void 0===t?[]:t,l=a._meta,C=(void 0===l?{}:l).result_count,Z=void 0===C?0:C;"tab1"===n&&(e=[{title:"部门名称",dataIndex:"name",key:"name",width:100,fixed:"left",render:function(e,t){return e?m.createElement("a",{href:"#!",className:De,onClick:function(e){var n;e.preventDefault(),n=t,o&&o(n._id,n.name,!0)}},e):"--"}},{title:"上级部门",dataIndex:["parent_info","name"],key:"parent_info.name",render:function(e){return e||"--"}},{title:"部门编号",dataIndex:"code",key:"code"},{title:"是否审批",dataIndex:"source",key:"source",render:function(e){return e?e===ge.Nfd.approval?"是":"否":"--"}},{title:"创建者",dataIndex:["creator_info","name"],key:"creator_info",render:function(e){return e||"--"}},{title:"生效日期",dataIndex:"take_effect_date",key:"take_effect_date",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}},{title:"最新操作人",dataIndex:["operator_info","name"],key:"operator_info_name",render:function(e){return e||"--"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}}]),"tab2"===n&&(e=[{title:"部门名称",dataIndex:["department_info","name"],key:"department_info_name",width:100,fixed:"left",render:function(e){return e||"--"}},{title:"上级部门",dataIndex:["target_parent_department_info","name"],key:"target_parent_department_info_name",render:function(e,t){return(0,Y.Cg)(t,"organization_sub_type",void 0)===ge.H_0.change?(0,Y.Cg)(t,"update_parent_department_info.name","--"):(0,Y.Cg)(t,"target_parent_department_info.name","--")}},{title:"部门编号",dataIndex:["department_info","code"],key:"department_info_code",render:function(e){return e||"--"}},{title:"是否审批",dataIndex:"source",key:"source",render:function(){return"是"}},{title:"调整类型",dataIndex:"organization_sub_type",key:"organization_sub_type",render:function(e){return e?ge.H_0.description(e):"--"}},{title:"审批单状态",dataIndex:["oa_application_order_info","state"],key:"oa_application_order_info_state",render:function(e){return e?ge.DU5.description(e):"--"}},{title:"部门调整状态",dataIndex:"take_effect_state",key:"take_effect_state",render:function(e){return e?ge.UYH.description(e):"--"}},{title:"创建者",dataIndex:["creator_info","name"],key:"creator_info",render:function(e){return e||"--"}},{title:"生效日期",dataIndex:"take_effect_date",key:"take_effect_date",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}},{title:"BOSS单号",dataIndex:["oa_application_order_info","_id"],key:"oa_application_order_info_id",render:function(e,t){return e?t.can_view?m.createElement("a",{rel:"noopener noreferrer",href:"javascript:void(window.open('/#/Expense/Manage/ExamineOrder/Detail?orderId=".concat(e,"'))"),className:De},e):e:"--"}}]),"tab3"===n&&(e=[{title:"部门名称",dataIndex:["department_info","name"],key:"department_info_name",width:100,fixed:"left",render:function(e){return e||"--"}},{title:"上级部门",dataIndex:["target_parent_department_info","name"],key:"target_parent_department_info_name",render:function(e,t){return(0,Y.Cg)(t,"organization_sub_type",void 0)===ge.H_0.change?(0,Y.Cg)(t,"update_parent_department_info.name","--"):(0,Y.Cg)(t,"target_parent_department_info.name","--")}},{title:"部门编号",dataIndex:["department_info","code"],key:"department_info_code",render:function(e){return e||"--"}},{title:"调整类型",dataIndex:"organization_sub_type",key:"organization_sub_type",render:function(e){return e?ge.H_0.description(e):"--"}},{title:"审批单状态",dataIndex:["oa_application_order_info","state"],key:"oa_application_order_info_state",render:function(e){return e?ge.DU5.description(e):"--"}},{title:"部门调整状态",dataIndex:"take_effect_state",key:"take_effect_state",render:function(e){return e?ge.UYH.description(e):"--"}},{title:"创建者",dataIndex:["creator_info","name"],key:"creator_info",render:function(e){return e||"--"}},{title:"生效日期",dataIndex:"take_effect_date",key:"take_effect_date",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}},{title:"BOSS单号",dataIndex:["oa_application_order_info","_id"],key:"oa_application_order_info_id",render:function(e,t){return e?t.can_view?m.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"#/Expense/Manage/ExamineOrder/Detail?orderId=".concat(e),className:De},e):e:"--"}}]),"tab3"!==n&&e.push({title:"操作",dataIndex:"_id",key:"operate",width:200,fixed:"right",render:function(e,t){var r="tab1"===n&&O&&x.ZP.canOperateOrganizationManageDepartmentCreate()?m.createElement("a",{href:"#!",style:{marginRight:10,whiteSpace:"nowrap"},onClick:function(){var e=(0,R.Z)(A().mark((function e(n){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,k({departmentId:t._id,organizationSubType:ge.H_0.change});case 3:if(!(r=e.sent)||!r.data){e.next=12;break}if(!(0,Y.Cg)(r,"data.0.flow_template_records.0._id","")){e.next=11;break}E((0,Y.Cg)(r,"data.0.flow_template_records.0._id")),u(t),p(!0),e.next=12;break;case 11:return e.abrupt("return",g.ZP.error("提示：无适用审批流，请联系流程管理员"));case 12:if(!r||!r.zh_message){e.next=14;break}return e.abrupt("return",g.ZP.error(r.zh_message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"调整上级部门"):null,a="tab1"===n&&x.ZP.canOperateOrganizationManageDepartmentDelete()?S?m.createElement("a",{href:"#!",style:{marginRight:10,whiteSpace:"nowrap"},onClick:function(){var e=(0,R.Z)(A().mark((function e(n){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,k({departmentId:t._id,organizationSubType:ge.H_0.revoke});case 3:if(!(r=e.sent)||!r.data){e.next=12;break}if(!(0,Y.Cg)(r,"data.0.flow_template_records.0._id","")){e.next=11;break}D((0,Y.Cg)(r,"data.0.flow_template_records.0._id")),u(t),f(!0),e.next=12;break;case 11:return e.abrupt("return",g.ZP.error("提示：无适用审批流，请联系流程管理员"));case 12:if(!r||!r.zh_message){e.next=14;break}return e.abrupt("return",g.ZP.error(r.zh_message));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},"裁撤部门"):m.createElement(Je.Z,{title:"部门裁撤之后，将不能对该部门进行任何操作，请确认是否继续裁撤",onConfirm:function(){H(t)},okText:"确认",cancelText:"再想想"},m.createElement("a",{href:"#!",style:{marginRight:10,whiteSpace:"nowrap"},onClick:function(e){e.preventDefault()}},"裁撤部门")):null,i="tab1"===n&&x.ZP.canOperateOrganizationManageDepartmentUpdate()?m.createElement("a",{href:"#!",style:{marginRight:10,whiteSpace:"nowrap"},onClick:function(e){e.preventDefault(),function(e,t,n){n&&n.stopPropagation(),L(e),z(!0),N(t)}(We,t,e)}},"编辑"):null,c=(0,Y.Cg)(t,"can_edit",!1)&&"tab1"!==n?m.createElement("a",{href:"#!",style:{marginRight:10,whiteSpace:"nowrap"},onClick:function(e){e.preventDefault(),u(t),(0,Y.Cg)(t,"organization_sub_type",void 0)===ge.H_0.create&&(y(!0),d(!0)),(0,Y.Cg)(t,"organization_sub_type",void 0)===ge.H_0.change&&(v(!0),p(!0)),(0,Y.Cg)(t,"organization_sub_type",void 0)===ge.H_0.revoke&&(h(!0),f(!0))}},"编辑"):null,s="tab1"===n?m.createElement("a",{href:"#!",style:{whiteSpace:"nowrap"},onClick:function(e){var n;e.preventDefault(),n=t,o&&o(n._id,n.name,!0)}},"查看详情"):null,l=(0,Y.Cg)(t,"can_close",!1)?m.createElement(Je.Z,{title:"系统将会对该条审批单进行关闭处理，新增的申请将会被终止，请确定是否要继续",onConfirm:(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b({oaOrganizationOrderId:(0,Y.Cg)(t,"_id",void 0)});case 2:e.sent&&(g.ZP.success("请求成功"),I());case 4:case"end":return e.stop()}}),e)}))),okText:"确认",cancelText:"再想想"},m.createElement("a",{href:"#!",style:{whiteSpace:"nowrap"},onClick:function(e){e.preventDefault()}},"关闭")):null;return m.createElement("div",null,r,a,i,c,s,l,!r&&!a&&!i&&!c&&!s&&!l&&"--")}});var _={defaultPageSize:30,onChange:c,total:Z,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],showQuickJumper:!0,showSizeChanger:!0,onShowSizeChange:i};return m.createElement($e.Z,{rowKey:function(e,t){return e.id||t},dataSource:s,columns:e,pagination:_,loading:r,scroll:{x:1300}})}(),function(){if(j){var e=U===Ge?"添加子部门":"编辑部门";return m.createElement(Q,{type:U,title:e,visible:j,dispatch:t,codeDisabled:U===We,detail:B,onCancel:function(){z(!1)},onSuccessCallback:q,onFailureCallback:J,isUpperDepartmentApprove:O})}}())}Xe.propTypes={tabKey:I().string,tableLoading:I().bool,childDepartmentData:I().object,onSelectDepartment:I().func,onShowSizeChange:I().func,onChangePage:I().func,breakDepartmentList:I().func,setCurrentDepartmentDetail:I().func,onChangeUpperDepartmentVisable:I().func,onChangeAddSubVisible:I().func,onChangeRevokeDepartmentVisable:I().func,setIsUpperDepartmentUpdate:I().func,setIsAddSubUpdate:I().func,setIsRevokeDepartmentUpdate:I().func,onChangeCheckResult:I().func,setRevokeDepartmentFlowId:I().func,setUpperDepartmentFlowId:I().func,breakDepartmentAllList:I().func,isUpperDepartmentApprove:I().bool,isRevokeDepartmentApprove:I().bool},Xe.defaultProps={childDepartmentData:{},onSelectDepartment:Qe,onShowSizeChange:Qe,onChangePage:Qe,breakDepartmentList:Qe,setCurrentDepartmentDetail:Qe,onChangeUpperDepartmentVisable:Qe,onChangeAddSubVisible:Qe,onChangeRevokeDepartmentVisable:Qe,setIsUpperDepartmentUpdate:Qe,setIsAddSubUpdate:Qe,setIsRevokeDepartmentUpdate:Qe,onChangeCheckResult:Qe,setRevokeDepartmentFlowId:Qe,setUpperDepartmentFlowId:Qe,breakDepartmentAllList:Qe,isUpperDepartmentApprove:!1,isRevokeDepartmentApprove:!1};var et=(0,C.connect)((function(){return{}}),(function(e){return{getDepartmentTree:function(t){return e({type:"applicationCommon/fetchDepartments",payload:t})},closeOaOrganizationOrder:function(t){return e({type:"department/closeOaOrganizationOrder",payload:t})},checkDepartmentUpdate:function(t){return e({type:"department/checkDepartmentUpdate",payload:t})},deleteDepartment:function(t){return e({type:"department/deleteDepartment",payload:t})},getOrganizationFlowList:function(t){return e({type:"department/getOrganizationFlowList",payload:t})},dispatch:e}}))(Xe);function tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tt(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rt=function(){};function at(e){var t=e.Ref,n=e.tabKey,r=e.departmentId,a=e.onSelectDepartment,o=e.getChildDepartmentList,i=e.findDepartmentOrderList,c=e.departmentOrderList,s=e.childDepartmentList,l=e.setCurrentDepartmentDetail,u=e.onChangeUpperDepartmentVisable,p=e.onChangeAddSubVisible,d=e.onChangeRevokeDepartmentVisable,f=e.setIsUpperDepartmentUpdate,v=e.setIsAddSubUpdate,g=e.setIsRevokeDepartmentUpdate,y=e.onChangeCheckResult,h=e.setRevokeDepartmentFlowId,b=e.setUpperDepartmentFlowId,C=e.isUpperDepartmentApprove,Z=e.isRevokeDepartmentApprove,_=e.breakDepartmentAllList,k={};switch(n){case"tab1":break;case"tab2":k.state=ge.UYH.effectBefore,k.organizationSubTypes=[ge.H_0.create,ge.H_0.change,ge.H_0.revoke],k.orderNameSpace="department-".concat(n);break;case"tab3":k.state=ge.UYH.close,k.organizationSubTypes=[ge.H_0.create,ge.H_0.change,ge.H_0.revoke],k.orderNameSpace="department-".concat(n)}var D=(0,m.useRef)(nt({_meta:{page:1,limit:30}},k)),E=(0,m.useState)(!0),I=(0,xe.Z)(E,2),O=I[0],S=I[1];(0,m.useEffect)((function(){(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"tab1"===n?D.current.id=r:D.current.targetParentDepartmentId=r,e.next=3,w();case 3:S(!1);case 4:case"end":return e.stop()}}),e)})))()}),[r]),(0,m.useImperativeHandle)(t,(function(){return{breakDepartmentList:function(){j()}}}));var w=function(){var e=(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("tab1"!==n){e.next=5;break}return e.next=3,o(nt({},D.current));case 3:e.next=7;break;case 5:return e.next=7,i(nt({},D.current));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=(0,R.Z)(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!0),D.current=nt(nt({},D.current),{},{_meta:{page:t,limit:n}}),e.next=4,w();case 4:S(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=(0,R.Z)(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!0),D.current=nt(nt({},D.current),{},{_meta:{page:t,limit:n}}),e.next=4,w();case 4:S(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!0),e.next=3,w();case 3:S(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return m.createElement("div",null,m.createElement(et,{tabKey:n,tableLoading:O,onSelectDepartment:a,onChangePage:P,onShowSizeChange:x,childDepartmentData:"tab1"===n?s:c["department-".concat(n)],breakDepartmentList:j,setCurrentDepartmentDetail:l,onChangeUpperDepartmentVisable:u,setIsUpperDepartmentUpdate:f,setIsAddSubUpdate:v,onChangeAddSubVisible:p,onChangeRevokeDepartmentVisable:d,setIsRevokeDepartmentUpdate:g,onChangeCheckResult:y,setRevokeDepartmentFlowId:h,setUpperDepartmentFlowId:b,isUpperDepartmentApprove:C,isRevokeDepartmentApprove:Z,breakDepartmentAllList:_}))}at.propTypes={tabKey:I().string,departmentId:I().string,onSelectDepartment:I().func,childDepartmentList:I().object,departmentOrderList:I().object,setCurrentDepartmentDetail:I().func,onChangeUpperDepartmentVisable:I().func,onChangeAddSubVisible:I().func,onChangeRevokeDepartmentVisable:I().func,setIsUpperDepartmentUpdate:I().func,setIsAddSubUpdate:I().func,setIsRevokeDepartmentUpdate:I().func,onChangeCheckResult:I().func,setRevokeDepartmentFlowId:I().func,setUpperDepartmentFlowId:I().func,breakDepartmentAllList:I().func,isUpperDepartmentApprove:I().bool,isRevokeDepartmentApprove:I().bool},at.defaultProps={onSelectDepartment:rt,setCurrentDepartmentDetail:rt,onChangeUpperDepartmentVisable:rt,onChangeAddSubVisible:rt,onChangeRevokeDepartmentVisable:rt,setIsUpperDepartmentUpdate:rt,setIsAddSubUpdate:rt,setIsRevokeDepartmentUpdate:rt,onChangeCheckResult:rt,setRevokeDepartmentFlowId:rt,setUpperDepartmentFlowId:rt,breakDepartmentAllList:rt,childDepartmentList:{},departmentOrderList:{},isUpperDepartmentApprove:!1,isRevokeDepartmentApprove:!1};var ot=(0,C.connect)((function(e){var t=e.department;return{childDepartmentList:t.childDepartmentList,departmentOrderList:t.departmentOrderList}}),(function(e){return{getChildDepartmentList:function(t){return e({type:"department/getChildDepartmentList",payload:t})},findDepartmentOrderList:function(t){return e({type:"department/findDepartmentOrderList",payload:t})}}}))(at),it=(0,m.forwardRef)((function(e,t){return m.createElement(ot,(0,z.Z)({},e,{Ref:t}))})),ct=(n(1868),n(12028)),st=(n(36616),n(51368)),lt=n(44925),ut=n(1058),pt=L.Z.Option;function dt(e){var t=e.isFetchData,n=e.clearnOptionList,r=e.staffList,a=e.getStaffList;if((0,m.useEffect)((function(){!t||Array.isArray(r.data)&&r.data.length>0||a({page:1,limit:9999})}),[]),(0,Y.Cg)(r,"data",[]).length<1)return m.createElement(L.Z,{placeholder:"请选择"});var o=(0,Y.CE)(["dispatch","isFetchData","clearnOptionList","staffList","getStaffList"],e),i=(0,Y.Cg)(r,"data",[]).filter((function(e){return n.length<=0||n.every((function(t){return t.jobId!==e._id}))})).map((function(e){return m.createElement(pt,{value:e._id,key:e._id,info:e},(0,Y.Cg)(e,"code",void 0)?"".concat(e.name,"(").concat(e.code,")"):e.name)}));return m.createElement(L.Z,(0,z.Z)({showSearch:!0,optionFilterProp:"children"},o),i)}dt.propTypes={isFetchData:I().bool,clearnOptionList:I().array,staffList:I().object},dt.defaultProps={isFetchData:!0,clearnOptionList:[],staffList:{}};var ft=(0,C.connect)((function(e){return{staffList:e.organizationStaff.staffList}}),(function(e){return{getStaffList:function(t){return e({type:"organizationStaff/getStaffList",payload:t})}}}))(dt),mt="PmFnIEAl0fO91hDpxKzV",vt="VdlAOZatw2sfkYgMwlMD",gt="UVZ5ISeOTnrG5tXeq1zg",yt=["key","name","fieldKey"],ht=y.Z.TextArea;function bt(e){var t=e.staffList,n=e.formName,o=e.form,i=e.isApprove,c=void 0!==i&&i;return m.createElement(T.Z.List,{name:n},(function(e,i){var s=i.add,l=i.remove;return m.createElement(m.Fragment,null,e.map((function(i){var s=i.key,u=i.name,p=i.fieldKey,d=(0,lt.Z)(i,yt);return m.createElement(m.Fragment,{key:s},m.createElement(r.Z,{className:mt},m.createElement(a.Z,{span:21},m.createElement(T.Z.Item,(0,z.Z)({},d,{label:"岗位名称",name:[u,"jobId"],fieldKey:[p,"jobId"],rules:[{required:!0,message:"请选择岗位名称"}]}),m.createElement(ft,{isFetchData:(0,Y.Cg)(t,"data",[]).length<=0,clearnOptionList:o.getFieldValue(n).filter((function(e){return e&&e.jobId!==(0,Y.Cg)(o.getFieldValue(n),"".concat(u,".jobId"))})),placeholder:"请选择"})),m.createElement(T.Z.Item,(0,z.Z)({},d,{label:"岗位编制数",name:[u,"organizationCount"],fieldKey:[p,"organizationCount"],rules:[{required:!0,message:"请输入"}]}),m.createElement(st.Z,{min:0,max:100,disabled:c,style:{width:"100%"},formatter:function(e){return ge.fbc.limitMaxZeroIntegerNumber(e,100)},parser:function(e){return ge.fbc.limitMaxZeroIntegerNumber(e,100)},placeholder:"请输入岗位编制数量"})),m.createElement(T.Z.Item,(0,z.Z)({},d,{label:"岗位描述",name:[u,"description"],fieldKey:[p,"description"]}),m.createElement(ht,{rows:3,placeholder:"请输入"})),m.createElement(T.Z.Item,{noStyle:!0,shouldUpdate:function(e,t){return(0,Y.Cg)(e,"jobList.".concat(u,".jobId"))!==(0,Y.Cg)(t,"jobList.".concat(u,".jobId"))}},(function(e){var r=e.getFieldValue,a=(0,Y.Cg)(t,"data",[]).find((function(e){return e._id===(0,Y.Cg)(r(n),"".concat(u,".jobId"))}))||{};return m.createElement(T.Z.Item,{label:"岗位职级"},m.createElement("span",null,(0,Y.Cg)(a,"rank","--")))}))),m.createElement(a.Z,{span:3,className:vt},e.length>1?m.createElement(v.Z,{shape:"circle",size:"small",onClick:function(){l(u)}},m.createElement(ut.Z,null)):null)))})),m.createElement(T.Z.Item,{noStyle:!0},m.createElement(v.Z,{className:gt,type:"dashed",block:!0,onClick:function(){s({organizationCount:c?0:void 0})}},m.createElement(Z.Z,null),m.createElement("span",null,"添加下一个岗位"))))}))}bt.propTypes={staffList:I().object,formName:I().string,form:I().object};var Ct=(0,C.connect)((function(e){return{staffList:e.organizationStaff.staffList}}))(bt);function Zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kt={labelCol:{span:7},wrapperCol:{span:17}},Dt=y.Z.TextArea,Et=function(){};function It(e){var t=e.onChangeCheckResult,n=e.onChangeAddSubVisable,r=e.departmentDetail,a=e.isUpdate,o=e.checkDepartmentUpdate,i=e.createOaSubDepartment,c=e.updateOaSubDepartment,s=e.createDepartment,l=e.isAddSubDepartmentApprove,u=e.addSubDepartmentFlowId,p=e.submitOrder,d=e.setAddSubDepartmentFlowId,h=e.getOrganizationFlowList,b=e.onSuccess,C=T.Z.useForm(),Z=(0,xe.Z)(C,1)[0],k=(0,m.useState)(!1),D=(0,xe.Z)(k,2),E=D[0],I=D[1],O=(0,m.useState)(!1),S=(0,xe.Z)(O,2),w=S[0],P=S[1],x=(0,m.useState)(!1),F=(0,xe.Z)(x,2),L=F[0],M=F[1],V=(0,m.useState)(!1),B=(0,xe.Z)(V,2),K=B[0],H=B[1],q=(0,m.useState)(!1),J=(0,xe.Z)(q,2),$=J[0],G=J[1],W=l||a;(0,m.useEffect)((function(){Q()}),[r,W]);var Q=function(){var e=[{organizationCount:W?0:void 0}];f().existy(r.job_list)&&Array.isArray(r.job_list)&&f().existy(r.job_list)&&Array.isArray(r.job_list).length>0&&(e=(0,Y.Cg)(r,"job_list",[{}]).map((function(e){return{jobId:e.job_id,organizationCount:e.organization_count,description:e.description}}))),a?Z.setFieldsValue({name:(0,Y.Cg)(r,"department_info.name",void 0),superior:(0,Y.Cg)(r,"target_parent_department_info._id","0"),code:(0,Y.Cg)(r,"department_info.code",void 0),effectiveDate:(0,Y.Cg)(r,"take_effect_date",void 0)?ve()("".concat((0,Y.Cg)(r,"take_effect_date"))):void 0,reason:(0,Y.Cg)(r,"note",void 0),isAddPost:(0,Y.Cg)(r,"job_list",[]).length>0,jobList:e,assetKeys:je.uA.getInitialValue(r,"asset_infos",{})}):Z.setFieldsValue({superior:(0,Y.Cg)(r,"_id","0"),code:(0,Y.Cg)(r,"code",void 0),name:void 0,isAddPost:!0,jobList:[{organizationCount:W?0:void 0}],effectiveDate:ve()(),reason:void 0,assetKeys:[]})},X=function(e){g.ZP.success("请求成功"),I(!1),H(!1),P(!1),e||n(!1),a||Z.setFieldsValue({name:void 0,isAddPost:!0,jobList:[{organizationCount:W?0:void 0}],effectiveDate:ve()(),reason:void 0,superior:(0,Y.Cg)(r,"_id","0"),code:(0,Y.Cg)(r,"code",void 0),assetKeys:[]}),b()},ee=function(){var e=(0,R.Z)(A().mark((function e(t){var n,o,d;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.getFieldsValue();case 2:if(n=e.sent,o={name:(0,Y.Cg)(n,"name",void 0),code:(0,Y.Cg)(n,"code",void 0),jobList:(0,Y.Cg)(n,"jobList",void 0)},!a){e.next=10;break}return e.next=7,c(_t(_t({},o),{},{oaOrganizationOrderId:(0,Y.Cg)(r,"_id",void 0),targetParentDepartmentId:(0,Y.Cg)(n,"superior",void 0),effectiveDate:(0,Y.Cg)(n,"effectiveDate",void 0)&&Number(n.effectiveDate.format("YYYYMMDD")),reason:(0,Y.Cg)(n,"reason",void 0),assetKeys:(0,Y.Cg)(n,"assetKeys",void 0)}));case 7:d=e.sent,e.next=19;break;case 10:if(!l){e.next=16;break}return e.next=13,i(_t(_t({},o),{},{addSubDepartmentFlowId:u,targetParentDepartmentId:(0,Y.Cg)(n,"superior",void 0),effectiveDate:(0,Y.Cg)(n,"effectiveDate",void 0)&&Number(n.effectiveDate.format("YYYYMMDD")),reason:(0,Y.Cg)(n,"reason",void 0),assetKeys:(0,Y.Cg)(n,"assetKeys",void 0)}));case 13:d=e.sent,e.next=19;break;case 16:return e.next=18,s(_t(_t({},o),{},{superior:(0,Y.Cg)(n,"superior",void 0)}));case 18:d=e.sent;case 19:if(!d){e.next=36;break}if(!a&&!l){e.next=31;break}return e.next=23,p({id:d.oa_application_order_id,copyGive:n.copyGive});case 23:if(!e.sent){e.next=27;break}return X(t),e.abrupt("return",!0);case 27:return I(!1),P(!1),H(!1),e.abrupt("return",!1);case 31:return I(!1),P(!1),H(!1),X(t),e.abrupt("return",!0);case 36:return I(!1),P(!1),H(!1),e.abrupt("return",!1);case 40:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=(0,R.Z)(A().mark((function e(){var n,i,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.validateFields();case 2:return n=e.sent,I(!0),H(!0),i={organizationSubType:ge.H_0.create,targetParentDepartmentId:(0,Y.Cg)(n,"superior",void 0)},a&&(i.oaApplicationOrderId=(0,Y.Cg)(r,"oa_application_order_info._id",void 0)),e.next=9,o(i);case 9:if(!(c=e.sent)){e.next=22;break}if(!c.ok){e.next=17;break}return e.next=14,ee();case 14:return e.abrupt("return");case 17:t(!0,ee,c.hint_list,"新增部门申请(".concat((0,Y.Cg)(n,"name","--"),")"));case 18:return I(!1),P(!1),H(!1),e.abrupt("return");case 22:I(!1),P(!1),H(!1);case 25:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=(0,R.Z)(A().mark((function e(){var n,r,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.validateFields();case 2:return n=e.sent,M(!0),P(!0),r={organizationSubType:ge.H_0.create,targetParentDepartmentId:(0,Y.Cg)(n,"superior",void 0)},e.next=8,o(r);case 8:if(!(a=e.sent)){e.next=19;break}if(!a.ok){e.next=15;break}return e.next=13,ee(!0);case 13:e.next=16;break;case 15:t(!0,(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(!0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),a.hint_list,"新增部门申请(".concat((0,Y.Cg)(n,"name","--"),")"));case 16:return M(!1),P(!1),e.abrupt("return");case 19:M(!1),P(!1);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=(0,R.Z)(A().mark((function e(t){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.setFieldsValue({superior:t}),!l){e.next=24;break}if(t){e.next=7;break}return P(!1),H(!1),G(!1),e.abrupt("return");case 7:return e.next=9,h({departmentId:t,organizationSubType:ge.H_0.create});case 9:if(!(n=e.sent)||!n.data){e.next=22;break}if(!(0,Y.Cg)(n,"data.0.flow_template_records.0._id","")){e.next=18;break}d((0,Y.Cg)(n,"data.0.flow_template_records.0._id")),P(!1),H(!1),G(!1),e.next=22;break;case 18:return P(!0),H(!0),G(!0),e.abrupt("return");case 22:if(!n||!n.zh_message){e.next=24;break}return e.abrupt("return",g.ZP.error(n.zh_message));case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=(0,Y.CE)(["dispatch","departmentDetail","onChangeCheckResult","onChangeAddSubVisable","isUpdate","checkDepartmentUpdate","createOaSubDepartment","updateOaSubDepartment","createDepartment","isAddSubDepartmentApprove","addSubDepartmentFlowId","submitOrder","onSuccess"],e),oe={flowId:u||(0,Y.Cg)(r,"oa_application_flow_id",void 0),departmentId:a?(0,Y.Cg)(r,"department_info._id",void 0):(0,Y.Cg)(r,"_id",void 0),specialDepartmentId:a?(0,Y.Cg)(r,"department_info._id",void 0):(0,Y.Cg)(r,"_id",void 0),accountId:Te.Iq.account.id};return m.createElement(U.Z,(0,z.Z)({title:"新增子部门",width:"400",onClose:function(){Q(),n(!1)},footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:function(){Q(),n(!1)}},"取消"),m.createElement(v.Z,{onClick:te,type:"primary",loading:E,disabled:w,style:{marginLeft:10}},"提交"),a?null:m.createElement(v.Z,{onClick:ne,type:"primary",loading:L,disabled:K,style:{marginLeft:10}},"提交并继续添加"))},ae),$?m.createElement(j.Z,{message:"当前上级部门无适用审批流，请联系流程管理员",type:"info",showIcon:!0,banner:!0,style:{marginBottom:10}}):null,m.createElement(T.Z,(0,z.Z)({form:Z,initialValues:{isAddPost:!0}},kt),function(){var e=[m.createElement(T.Z.Item,{label:"部门名称",name:"name",rules:[{required:!0,message:"请输入部门名称"},{min:2,message:"部门名称必须超过2个字"},{max:32,message:"部门名称必须小于32个字"},{pattern:/^\S+$/,message:"部门名称不能包含空格"}]},m.createElement(y.Z,{placeholder:"请输入部门名称"})),m.createElement(T.Z.Item,{label:"上级部门",name:"superior",rules:[{required:!0,message:"请选择上级部门"}]},m.createElement(N,{onChangePid:re,disabled:a})),m.createElement(T.Z.Item,{label:"部门编号",name:"code",rules:[{required:!0,message:"请输入部门编号"},function(){return{validator:function(e,t){return!t||/^[0-9a-zA-Z-]{1,}$/.test(t)?Promise.resolve():Promise.reject("请输入数字、字母或中横线")}}}]},m.createElement(y.Z,{placeholder:"请输入部门编号"})),m.createElement(T.Z.Item,{label:"是否添加岗位",name:"isAddPost",valuePropName:"checked"},m.createElement(ct.Z,{checkedChildren:"是",unCheckedChildren:"否"})),m.createElement(T.Z.Item,{noStyle:!0,shouldUpdate:function(e,t){return e.isAddPost!==t.isAddPost}},(function(e){return(0,e.getFieldValue)("isAddPost")?m.createElement(Ct,{form:Z,formName:"jobList",isApprove:W}):null}))];if(W&&(e.splice(3,0,m.createElement(T.Z.Item,{label:"生效日期",name:"effectiveDate",rules:[{required:!0,message:"请选择生效日期"}]},m.createElement(Pe.Z,{disabledDate:function(e){return e&&e<ve()().endOf("day").subtract(1,"days")}}))),e.push(m.createElement(T.Z.Item,{label:"新增原因",name:"reason",rules:[{required:!0,message:"请输入调整原因"}]},m.createElement(Dt,{placeholder:"请输入新增原因",rows:4})),m.createElement(T.Z.Item,{label:"附件",name:"assetKeys"},m.createElement(je.uA,{domain:je.uA.UploadDomains.OAUploadDomain}))),!a)){var t=u||(0,Y.Cg)(r,"oa_application_flow_id",void 0);e.push(m.createElement(T.Z.Item,{label:"固定抄送"},m.createElement(ze.ir,{flowId:t})),m.createElement(T.Z.Item,{label:"抄送",name:"copyGive"},m.createElement(ze.t2,{flowId:t})))}return m.createElement(_.Fp,{className:"affairs-flow-basic",items:e,cols:1})}()),ae.visible?m.createElement(Ae,oe):null)}It.propTypes={onChangeCheckResult:I().func,onChangeAddSubVisable:I().func,departmentDetail:I().object,isUpdate:I().bool,isAddSubDepartmentApprove:I().bool,addSubDepartmentFlowId:I().string,setAddSubDepartmentFlowId:I().func,onSuccess:I().func},It.defaultProps={onChangeCheckResult:Et,onChangeAddSubVisable:Et,setAddSubDepartmentFlowId:Et,onSuccess:Et,departmentDetail:{},isUpdate:!1,isAddSubDepartmentApprove:!1,addSubDepartmentFlowId:""};var Ot=(0,C.connect)((function(){return{}}),(function(e){return{createOaSubDepartment:function(t){return e({type:"department/createOaSubDepartment",payload:t})},createDepartment:function(t){return e({type:"department/createDepartment",payload:t})},updateOaSubDepartment:function(t){return e({type:"department/updateOaSubDepartment",payload:t})},checkDepartmentUpdate:function(t){return e({type:"department/checkDepartmentUpdate",payload:t})},submitOrder:function(t){return e({type:"oaCommon/submitOrder",payload:t})},getOrganizationFlowList:function(t){return e({type:"department/getOrganizationFlowList",payload:t})}}}))(It);function St(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):St(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pt={labelCol:{span:6},wrapperCol:{span:18}},xt=y.Z.TextArea,jt=function(){};function zt(e){var t=e.onChangeCheckResult,n=e.onChangeRevokeDepartmentVisable,r=e.departmentDetail,a=e.createRevokeDepartment,o=e.updateRevokeDepartment,i=e.checkDepartmentUpdate,c=e.isUpdate,s=e.revokeDepartmentFlowId,l=e.submitOrder,u=e.onSuccess,p=T.Z.useForm(),d=(0,xe.Z)(p,1)[0],f=(0,m.useState)(!1),y=(0,xe.Z)(f,2),h=y[0],b=y[1];(0,m.useEffect)((function(){C()}),[r]);var C=function(){c?d.setFieldsValue({reason:(0,Y.Cg)(r,"note",void 0),assetKeys:je.uA.getInitialValue(r,"asset_infos",{})}):d.setFieldsValue({reason:void 0,assetKeys:void 0})},Z=function(){var e=(0,R.Z)(A().mark((function e(){var t,i,p;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.getFieldsValue();case 2:if(t=e.sent,i={reason:(0,Y.Cg)(t,"reason",void 0),assetKeys:(0,Y.Cg)(t,"assetKeys",void 0)},!c){e.next=10;break}return e.next=7,o(wt(wt({},i),{},{oaOrganizationOrderId:(0,Y.Cg)(r,"_id",void 0)}));case 7:p=e.sent,e.next=13;break;case 10:return e.next=12,a(wt(wt({},i),{},{revokeDepartmentFlowId:s,departmentId:(0,Y.Cg)(r,"_id",void 0)}));case 12:p=e.sent;case 13:if(!p){e.next=26;break}return e.next=16,l({id:p.oa_application_order_id,copyGive:t.copyGive});case 16:if(!e.sent){e.next=24;break}return g.ZP.success("请求成功"),n(!1),c||d.setFieldsValue({reason:void 0,assetKeys:[]}),b(!1),u(),e.abrupt("return",!0);case 24:case 26:return b(!1),e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=(0,R.Z)(A().mark((function e(){var n,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.validateFields();case 2:return b(!0),n={organizationSubType:ge.H_0.revoke,departmentId:(0,Y.Cg)(r,"_id",void 0)},c&&(n.oaApplicationOrderId=(0,Y.Cg)(r,"oa_application_order_info._id",void 0)),e.next=7,i(n);case 7:if(!(a=e.sent)){e.next=19;break}if(!a.ok){e.next=15;break}return e.next=12,Z();case 12:return e.abrupt("return");case 15:b(!0),t(!0,Z,a.hint_list,"调整类型：组织架构-裁撤部门(".concat(c?(0,Y.Cg)(r,"department_info.name","--"):(0,Y.Cg)(r,"name","--"),")"));case 17:return b(!1),e.abrupt("return");case 19:b(!1);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=(0,Y.CE)(["dispatch","onChangeCheckResult","isUpdate","onChangeRevokeDepartmentVisable","departmentDetail","createRevokeDepartment","updateRevokeDepartment","checkDepartmentUpdate","isRevokeDepartmentApprove","submitOrder","onSuccess","revokeDepartmentFlowId"],e),E={flowId:s||(0,Y.Cg)(r,"oa_application_flow_id",void 0),departmentId:c?(0,Y.Cg)(r,"department_info._id",void 0):(0,Y.Cg)(r,"_id",void 0),specialDepartmentId:c?(0,Y.Cg)(r,"department_info._id",void 0):(0,Y.Cg)(r,"_id",void 0),accountId:Te.Iq.account.id};return m.createElement(U.Z,(0,z.Z)({title:"裁撤部门",width:"400",onClose:function(){C(),n(!1)},footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:function(){C(),n(!1)}},"取消"),m.createElement(v.Z,{onClick:function(){k()},type:"primary",loading:h,style:{marginLeft:10}},"提交"))},D),m.createElement(T.Z,(0,z.Z)({form:d},Pt),function(){var e=[m.createElement(T.Z.Item,{label:"部门名称",name:"name"},c?(0,Y.Cg)(r,"department_info.name","--"):(0,Y.Cg)(r,"name","--")),m.createElement(T.Z.Item,{label:"部门编号",name:"code"},c?(0,Y.Cg)(r,"department_info.code","--"):(0,Y.Cg)(r,"code","--")),m.createElement(T.Z.Item,{label:"裁撤原因",name:"reason",rules:[{required:!0,message:"请输入裁撤原因"}]},m.createElement(xt,{placeholder:"请输入裁撤原因",rows:4})),m.createElement(T.Z.Item,{label:"附件",name:"assetKeys"},m.createElement(je.uA,{domain:je.uA.UploadDomains.OAUploadDomain}))];if(!c){var t=s||(0,Y.Cg)(r,"oa_application_flow_id",void 0);e.push(m.createElement(T.Z.Item,{label:"固定抄送"},m.createElement(ze.ir,{flowId:t})),m.createElement(T.Z.Item,{label:"抄送",name:"copyGive"},m.createElement(ze.t2,{flowId:t})))}return m.createElement(_.Fp,{className:"affairs-flow-basic",items:e,cols:1})}()),D.visible?m.createElement(Ae,E):null)}zt.propTypes={onChangeCheckResult:I().func,onChangeRevokeDepartmentVisable:I().func,departmentDetail:I().object,isUpdate:I().bool,revokeDepartmentFlowId:I().string,onSuccess:I().func},zt.defaultProps={onChangeCheckResult:jt,onChangeRevokeDepartmentVisable:jt,onSuccess:jt,departmentDetail:{},isUpdate:!1,revokeDepartmentFlowId:""};var Tt=(0,C.connect)((function(){return{}}),(function(e){return{createRevokeDepartment:function(t){return e({type:"department/createRevokeDepartment",payload:t})},updateRevokeDepartment:function(t){return e({type:"department/updateRevokeDepartment",payload:t})},checkDepartmentUpdate:function(t){return e({type:"department/checkDepartmentUpdate",payload:t})},submitOrder:function(t){return e({type:"oaCommon/submitOrder",payload:t})}}}))(zt),Rt=le.Z.TabPane,Ft=function(){};function At(e){var t=e.departmentId,n=e.onSelectDepartment,r=e.onChangeCheckResult,a=e.departmentDetail,o=e.getOrganizationFlowList,i=e.isUpperDepartmentApprove,c=e.isAddSubDepartmentApprove,s=e.isRevokeDepartmentApprove,l=e.getDepartmentTree,u=e.exportDepartment,p=(0,m.useState)(!1),d=(0,xe.Z)(p,2),f=d[0],y=d[1],h=(0,m.useState)(!1),b=(0,xe.Z)(h,2),C=b[0],Z=b[1],k=(0,m.useState)(!1),D=(0,xe.Z)(k,2),E=D[0],I=D[1],O=(0,m.useState)(!1),S=(0,xe.Z)(O,2),w=S[0],P=S[1],j=(0,m.useState)(!1),z=(0,xe.Z)(j,2),T=z[0],F=z[1],U=(0,m.useState)(!1),L=(0,xe.Z)(U,2),M=L[0],V=L[1],B=(0,m.useState)({}),N=(0,xe.Z)(B,2),K=N[0],H=N[1],q=(0,m.useState)(""),J=(0,xe.Z)(q,2),$=J[0],G=J[1],W=(0,m.useState)(""),Q=(0,xe.Z)(W,2),X=Q[0],ee=Q[1],te=(0,m.useState)(""),ne=(0,xe.Z)(te,2),re=ne[0],ae=ne[1],oe=(0,m.useRef)(null),ie=(0,m.useRef)(null),ce=(0,m.useRef)(null),se=function(){l({isAuthorized:!0,namespace:"organization"}),oe.current&&oe.current.breakDepartmentList(),ie.current&&ie.current.breakDepartmentList(),ce.current&&ce.current.breakDepartmentList()},ue=x.ZP.canOperateOrganizationManageDepartmentCreate()?m.createElement(v.Z,{type:"primary",onClick:(0,R.Z)(A().mark((function e(){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=16;break}return e.next=3,o({departmentId:t,organizationSubType:ge.H_0.create});case 3:if(!(n=e.sent)||!n.data){e.next=12;break}if(!(0,Y.Cg)(n,"data.0.flow_template_records.0._id","")){e.next=11;break}ee((0,Y.Cg)(n,"data.0.flow_template_records.0._id")),y(!0),Z(!1),e.next=12;break;case 11:return e.abrupt("return",g.ZP.error("提示：无适用审批流，请联系流程管理员"));case 12:if(!n||!n.zh_message){e.next=14;break}return e.abrupt("return",g.ZP.error(n.zh_message));case 14:e.next=18;break;case 16:y(!0),Z(!1);case 18:case"end":return e.stop()}}),e)}))),className:ke},"添加子部门"):null,pe=x.ZP.canOperateOrganizationManageDepartmentExport()?m.createElement(Je.Z,{title:"创建下载任务？",onConfirm:function(){u({id:t})},okText:"确认",cancelText:"取消"},m.createElement(v.Z,null,"导出EXCEL")):null,de=m.createElement("div",null,pe,ue);return m.createElement("div",null,m.createElement(_.IT,{title:"下级部门",titleExt:de},m.createElement(le.Z,{defaultActiveKey:"tab1",type:"card",onChange:function(){P(!1),Z(!1),V(!1)}},m.createElement(Rt,{tab:"正常",key:"tab1"},m.createElement(it,{ref:oe,tabKey:"tab1",departmentId:t,onSelectDepartment:n,setCurrentDepartmentDetail:function(e){H(e||{})},onChangeUpperDepartmentVisable:function(e){I(e||!1)},onChangeRevokeDepartmentVisable:function(e){F(e||!1)},onChangeCheckResult:r,setRevokeDepartmentFlowId:ae,setUpperDepartmentFlowId:G,isUpperDepartmentApprove:i,isRevokeDepartmentApprove:s,breakDepartmentAllList:se})),m.createElement(Rt,{tab:"待生效",key:"tab2"},m.createElement(it,{ref:ie,tabKey:"tab2",departmentId:t,onSelectDepartment:n,setCurrentDepartmentDetail:function(e){H(e||{})},onChangeUpperDepartmentVisable:function(e){I(e||!1)},onChangeAddSubVisible:function(e){y(e||!1)},onChangeRevokeDepartmentVisable:function(e){F(e||!1)},setIsUpperDepartmentUpdate:P,setIsAddSubUpdate:Z,setIsRevokeDepartmentUpdate:V,breakDepartmentAllList:se})),m.createElement(Rt,{tab:"已关闭",key:"tab3"},m.createElement(it,{ref:ce,tabKey:"tab3",departmentId:t,onSelectDepartment:n})))),m.createElement(Ot,{visible:f,onChangeCheckResult:r,onChangeAddSubVisable:function(e){y(e||!1)},departmentDetail:C?K:a,isUpdate:C,isAddSubDepartmentApprove:c,setAddSubDepartmentFlowId:ee,addSubDepartmentFlowId:X,onSuccess:function(){se()}}),m.createElement(Ye,{departmentDetail:K,onChangeUpperDepartmentVisable:function(e){I(e||!1)},visible:E,onChangeCheckResult:r,isUpdate:w,upperDepartmentFlowId:$,onSuccess:function(){se()}}),m.createElement(Tt,{departmentDetail:K,onChangeRevokeDepartmentVisable:function(e){F(e||!1)},visible:T,onChangeCheckResult:r,isUpdate:M,upperDepartmentId:t,revokeDepartmentFlowId:re,onSuccess:function(){se()}}))}At.propTypes={departmentId:I().string,onSelectDepartment:I().func,onChangeCheckResult:I().func,departmentDetail:I().object,isUpperDepartmentApprove:I().bool,isAddSubDepartmentApprove:I().bool,isRevokeDepartmentApprove:I().bool},At.defaultProps={onSelectDepartment:Ft,onChangeCheckResult:Ft,departmentDetail:{},isUpperDepartmentApprove:!1,isAddSubDepartmentApprove:!1,isRevokeDepartmentApprove:!1};var Ut=(0,C.connect)((function(e){return{departmentDetail:e.department.departmentDetail}}),(function(e){return{getOrganizationFlowList:function(t){return e({type:"department/getOrganizationFlowList",payload:t})},getDepartmentTree:function(t){return e({type:"applicationCommon/fetchDepartments",payload:t})},exportDepartment:function(t){return e({type:"department/exportDepartment",payload:t})}}}))(At),Lt=(n(55295),n(69713));function Mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mt(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Nt=function(e){(0,s.Z)(n,e);var t=Bt(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onChangePage",(function(t,n){e.getDepartmentMember({page:t,limit:n})})),(0,p.Z)((0,c.Z)(e),"onCreateMember",(function(){var t=e.props,n=t.departmentId,r=t.departmentName;window.open("/#/Employee/Create?fileType=staff&departmentId=".concat(n,"&departmentName=").concat(r))})),(0,p.Z)((0,c.Z)(e),"onUpdateMember",(function(t){var n=e.props,r=n.departmentId,a=n.departmentName;window.open("/#/Employee/Update?id=".concat(t,"&fileType=staff&departmentId=").concat(r,"&departmentName=").concat(a))})),(0,p.Z)((0,c.Z)(e),"onCreateExportTask",(function(){var t=e.props,n=t.dispatch,r=t.departmentId,a=e.getChildDepartment(),o={id:(0,k.Z)(a)};r&&n({type:"department/exportMember",payload:o})})),(0,p.Z)((0,c.Z)(e),"getDepartmentMember",(function(t){var n=e.props,r=n.dispatch,a=n.departmentId,o=void 0===a?void 0:a;o&&r({type:"department/getDepartmentMember",payload:Vt({id:o},t)})})),(0,p.Z)((0,c.Z)(e),"getDepartment",(function(){(0,e.props.dispatch)({type:"department/getDepartmentTree",payload:{}})})),(0,p.Z)((0,c.Z)(e),"getChildDepartment",(function(){var t=e.props,n=t.departmentId,r=t.departmentTree,a=[n];return function e(t){var n=r.filter((function(e){return e.pid===t}));if(!(n.length<1)){var o=n.map((function(e){return e._id}));a=[].concat((0,k.Z)(a),(0,k.Z)(o)),o.forEach((function(t){return e(t)}))}}(n),a})),(0,p.Z)((0,c.Z)(e),"renderStaffName",(function(t,n){var r=e.props.departmentId,a=n.pluralism_department_job_relation_list;if(!t||!a)return"--";var o=[],i=t.department_id,c=void 0===i?void 0:i,s=t.job_info,l=(void 0===s?{}:s).name,u=void 0===l?void 0:l;r===c&&u&&(o[o.length]=u);var p=n.pluralism_department_job_relation_list,d=(void 0===p?[]:p).filter((function(e){return e.department_id===r})).map((function(e){if(Object.keys(e).length>0&&Object.keys(e.job_info).length>0&&e.job_info.name)return e.job_info.name}));return(o=o.concat(d)).length>3?m.createElement(Lt.Z,{title:o.map((function(e){return e})).join(" 、 ")},m.createElement("div",{className:Ee},b().get(t,"0"),"、",b().get(t,"1"),"、",b().get(t,"2"),"...")):o.length>0&&o.length<=3?m.createElement("div",{className:Ee},o.map((function(e){return e})).join("、")):"--"})),(0,p.Z)((0,c.Z)(e),"renderContent",(function(){var t=e.props,n=t.departmentMember,r=void 0===n?{}:n,a=t.departmentId,o=r.data,i=void 0===o?[]:o,c=r._meta,s=(void 0===c?{}:c).result_count,l=void 0===s?0:s,u=[{title:"姓名",dataIndex:"name",key:"name"},{title:"手机号",dataIndex:"phone",key:"phone",render:function(e){return e||"--"}},{title:"部门名称",dataIndex:"department_info_list",key:"department_info_list",render:function(e){if(Array.isArray(e)&&e.length>0){var t=e.find((function(e){return e._id===a}));return t?t.name:"--"}return"--"}},{title:"岗位",dataIndex:"department_job_relation_info",key:"department_job_relation_info",render:function(t,n){return e.renderStaffName(t,n)}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",width:100,render:function(e){return e?ve()(String(e)).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"操作",dataIndex:"_id",key:"operate",render:function(t){var n=[];return x.ZP.canOperateOrganizationManageDepartmentEmployeeUpdate()&&n.push(m.createElement("a",{onClick:function(){return e.onUpdateMember(t)},className:ke},"编辑")),x.ZP.canOperateOrganizationManageDepartmentEmployeeDetail()&&n.push(m.createElement("a",{href:"/#/Employee/Detail?id=".concat(t,"&fileType=staff"),target:"_blank",rel:"noopener noreferrer",className:ke},"查看")),m.createElement("div",null,0===n.length?"--":n)}}],p={defaultPageSize:30,onChange:e.onChangePage,total:l,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],showQuickJumper:!0,showSizeChanger:!0,onShowSizeChange:e.onChangePage},d=m.createElement("div",null,x.ZP.canOperateOrganizationManageDepartmentEmployeeExport()?m.createElement(Je.Z,{title:"创建下载任务？",onConfirm:e.onCreateExportTask,okText:"确认",cancelText:"取消"},m.createElement(v.Z,null,"批量导出")):null,x.ZP.canOperateOrganizationManageDepartmentEmployeeCreate()?m.createElement(v.Z,{type:"primary",onClick:e.onCreateMember,className:ke},"添加成员"):null);return m.createElement(_.IT,{title:"部门成员",titleExt:d},m.createElement($e.Z,{rowKey:function(e,t){return e.id||t},dataSource:i,columns:u,pagination:p}))})),e.state={},e.private={searchParams:{limit:30,page:1}},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.getDepartmentMember(this.private.searchParams),this.getDepartment()}},{key:"componentDidUpdate",value:function(e){b().get(e,"departmentId",void 0)!==b().get(this.props,"departmentId",void 0)&&this.getDepartmentMember(this.private.searchParams)}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"department/resetDepartmentMember",payload:{}})}},{key:"render",value:function(){return m.createElement("div",null,this.renderContent())}}]),n}(m.Component);Nt.propTypes={departmentMember:I().object,departmentId:I().string,departmentName:I().string,departmentTree:I().array},Nt.defaultProps={departmentMember:{},departmentId:"",departmentName:"",departmentTree:{}};var Yt=(0,C.connect)((function(e){var t=e.department;return{departmentMember:t.departmentMember,departmentTree:t.departmentTree}}))(Nt);function Kt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ht=function(e){(0,s.Z)(n,e);var t=Kt(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"getOrganizationConfig",(0,R.Z)(A().mark((function t(){var n,r;return A().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.props.dispatch,t.next=3,n({type:"department/getOrganizationConfig",payload:{}});case 3:(r=t.sent)&&e.setState({isUpperDepartmentApprove:(0,Y.Cg)(r,"0.config_info.adjust_department",!1),isAddSubDepartmentApprove:(0,Y.Cg)(r,"0.config_info.add_sub_department",!1),isRevokeDepartmentApprove:(0,Y.Cg)(r,"0.config_info.cut_department",!1)});case 5:case"end":return t.stop()}}),t)})))),e.state={isUpperDepartmentApprove:!1,isAddSubDepartmentApprove:!1,isRevokeDepartmentApprove:!1},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.getOrganizationConfig()}},{key:"componentDidUpdate",value:function(e){(0,Y.Cg)(e,"departmentId",void 0)!==(0,Y.Cg)(this.props,"departmentId",void 0)&&this.getOrganizationConfig()}},{key:"render",value:function(){var e=this.state,t=e.isUpperDepartmentApprove,n=e.isAddSubDepartmentApprove,r=e.isRevokeDepartmentApprove,a=this.props,o=a.departmentId,i=a.departmentName,c=a.onSelectDepartment,s=a.onChangeCheckResult;return o&&"undefined"!==o?m.createElement("div",null,m.createElement(qe,{departmentId:o,onChangeCheckResult:s,onSelectDepartment:c,isUpperDepartmentApprove:t}),m.createElement(Ut,{departmentId:o,onSelectDepartment:c,onChangeCheckResult:s,isUpperDepartmentApprove:t,isAddSubDepartmentApprove:n,isRevokeDepartmentApprove:r}),m.createElement(Yt,{departmentId:o,departmentName:i})):m.createElement(fe,null)}}]),n}(m.Component);Ht.propTypes={departmentId:I().string,departmentName:I().string,onSelectDepartment:I().func,onChangeCheckResult:I().func},Ht.defaultProps={departmentId:"",departmentName:"",onSelectDepartment:function(){},onChangeCheckResult:function(){}};var qt=(0,C.connect)()(Ht),Jt=["value","onChange","dispatch","staffList","departmentId"],$t=L.Z.Option,Gt=(0,C.connect)((function(e){return{staffList:e.organizationStaffs.staffList}}))((function(e){var t=e.value,n=e.onChange,r=e.dispatch,a=e.staffList,o=void 0===a?{}:a,i=e.departmentId,c=(0,lt.Z)(e,Jt);(0,m.useEffect)((function(){r({type:"organizationStaffs/getDepartmentStaffs",payload:{departmentId:i}})}),[r,i]);var s=o.data,l=void 0===s?[]:s;return!l||l.length<1||!i?m.createElement(L.Z,(0,z.Z)({placeholder:"请选择"},c)):m.createElement(L.Z,(0,z.Z)({value:t,onChange:n},c),l.map((function(e){var t=Te.P6.dotOptimal(e,"job_info",{});return m.createElement($t,{value:t._id,key:t._id,info:e},t.name)})))})),Wt={"app-organization-update-select":"J4O6EiYQye4xKoxTGMeS"},Qt=function(){};function Xt(e){var t=e.onChangeCheckResult,n=e.onSubmitDepartment,r=e.checkMessage,a=e.messageTitle,o=(0,m.useState)(!1),i=(0,xe.Z)(o,2),c=i[0],s=i[1],l=(0,Y.CE)(["dispatch","onChangeCheckResult","onSubmitDepartment","checkMessage","messageTitle"],e),u=function(){var e=(0,R.Z)(A().mark((function e(){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(!0),e.next=3,n();case 3:r=e.sent,s(!1),r&&t(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return m.createElement(_e.Z,(0,z.Z)({zIndex:1009,title:"确认提交",onOk:u,okText:"继续提交",confirmLoading:c,onCancel:function(){t(!1)}},l),m.createElement("h4",{className:Wt["CheckResultModal-messageTitle"]},a),r.map((function(e){return m.createElement("p",{dangerouslySetInnerHTML:{__html:"".concat(e.replace(/\n/g,"<br/>"))},className:Wt["CheckResultModal-message"]})})))}Xt.propTypes={onChangeCheckResult:I().func,onSubmitDepartment:I().func,checkMessage:I().array,messageTitle:I().string},Xt.defaultProps={onChangeCheckResult:Qt,onSubmitDepartment:Qt,checkMessage:[],messageTitle:""};var en=Xt;function tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rn={labelCol:{span:6},wrapperCol:{span:18}},an=y.Z.TextArea,on="save",cn="saveAndCarryOn",sn=function(e){var t=e.dispatch,n=e.visible,r=e.onClose,a=e.flowId,o=e.isApprove,i=void 0!==o&&o,c=e.departmentDetail,s=void 0===c?{}:c,l=e.countPostList,u=void 0===l?[]:l,p=e.organizationSubType,d=e.isUpdate,f=void 0!==d&&d,y=e.updateInitValue,h=void 0===y?{}:y,b=e.breakDepartmentList,C=T.Z.useForm(),Z=(0,xe.Z)(C,1)[0],k=(0,m.useRef)(on),D=(0,m.useState)(!1),E=(0,xe.Z)(D,2),I=E[0],O=E[1],S=(0,m.useState)(!1),w=(0,xe.Z)(S,2),P=w[0],x=w[1],j=(0,m.useState)(!1),F=(0,xe.Z)(j,2),L=F[0],M=F[1],V=(0,m.useState)([]),B=(0,xe.Z)(V,2),N=B[0],Y=B[1],K=(0,m.useState)(f?Te.P6.dotOptimal(h):Te.P6.dotOptimal(u,"0",{})),H=(0,xe.Z)(K,2),q=H[0],J=H[1],$=(0,m.useState)(!1),G=(0,xe.Z)($,2),W=G[0],Q=G[1],X=(0,m.useState)(!1),ee=(0,xe.Z)(X,2),te=ee[0],ne=ee[1],re=s._id,ae="",oe="岗位编制数";p===ge.H_0.add&&(ae="增编",oe="增编数"),p===ge.H_0.remove&&(ae="减编",oe="减编数");var ie=function(e,t){e===on&&(O(t),ne(t)),e===cn&&(x(t),Q(t))},ce=function(){var e=(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.ZP.success("请求成功"),k.current!==cn||i){e.next=4;break}return e.next=4,t({type:"organizationStaffs/resetDepartmentStaffs"});case 4:b&&b(i,ge.UYH.effectBefore),ie(k.current,!1),k.current===on&&r(),k.current===cn&&(J({}),Z.setFieldsValue({jobId:void 0,peopleNum:void 0,takeEffectDate:ve()(),note:void 0,assetKeys:void 0}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=(0,R.Z)(A().mark((function e(){var n,r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.validateFields();case 2:return n=e.sent,e.next=5,t({type:"organizationStaffs/setOrganizationCount",payload:nn({departmentId:re,organizationSubType:p},n)});case 5:if(!(r=e.sent)||!r.zh_message){e.next=10;break}return ie(k.current,!1),g.ZP.error(r.zh_message),e.abrupt("return",!1);case 10:if(!r||!r._id){e.next=13;break}return ce(),e.abrupt("return",!0);case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=(0,R.Z)(A().mark((function e(){var n,r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.validateFields();case 2:return n=e.sent,e.next=5,t({type:"organizationStaffs/setApproveOrganizationCount",payload:nn({isUpdate:f,departmentId:re,oaFlowId:a,organizationSubType:p,applicationId:Te.P6.dotOptimal(h,"_id",void 0)},n)});case 5:if(!(r=e.sent)||!r.zh_message){e.next=10;break}return ie(k.current,!1),g.ZP.error(r.zh_message),e.abrupt("return",!1);case 10:if(!r||!r._id){e.next=18;break}return e.next=13,t({type:"oaCommon/submitOrder",payload:{id:r.oa_application_order_id,copyGive:n.copyGive,onSuccessCallback:ce}});case 13:if(e.sent){e.next=17;break}return ie(k.current,!1),e.abrupt("return",!1);case 17:case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=(0,R.Z)(A().mark((function e(n){var r,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.validateFields();case 2:return r=e.sent,k.current=n,ie(n,!0),e.next=7,t({type:"department/checkDepartmentUpdate",payload:{departmentId:re,organizationSubType:p,jobId:Te.P6.dotOptimal(r,"jobId",void 0),oaApplicationOrderId:Te.P6.dotOptimal(h,"oa_application_order_id",void 0)}});case 7:if(!(a=e.sent)||!a.zh_message){e.next=12;break}return ie(n,!1),g.ZP.error(a.zh_message),e.abrupt("return");case 12:a&&!1===a.ok&&(Y(a.hint_list),M(!0)),a&&a.ok&&(i&&le(),!i&&se());case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pe={flowId:a,departmentId:re,specialDepartmentId:re,accountId:Te.Iq.account.id},de=f?{jobId:Te.P6.dotOptimal(h,"job_list.0.job_id",void 0),peopleNum:Te.P6.dotOptimal(h,"job_list.0.people_num",0),takeEffectDate:Te.P6.dotOptimal(h,"take_effect_date",void 0)?ve()(String(Te.P6.dotOptimal(h,"take_effect_date"))):ve()(),note:Te.P6.dotOptimal(h,"note",void 0),assetKeys:je.uA.getInitialValue(h,"asset_infos",{})}:{jobId:Te.P6.dotOptimal(u,"0.job_info._id",void 0),takeEffectDate:ve()()};return m.createElement(U.Z,{title:ae,visible:n,onClose:r,width:400,footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:function(){return r()}},"取消"),m.createElement(v.Z,{onClick:function(){return ue(on)},type:"primary",loading:I,disabled:W,style:{marginLeft:10}},"提交"),!f&&m.createElement(v.Z,{onClick:function(){return ue(cn)},type:"primary",loading:P,disabled:te,style:{marginLeft:10}},"提交并继续添加"))},m.createElement(T.Z,(0,z.Z)({form:Z,className:"affairs-flow-node",initialValues:de},rn),function(){var e=p===ge.H_0.remove?Te.P6.dotOptimal(q,"organization_count",100)||Te.P6.dotOptimal(q,".job_list.0.people_num",100):100,t=[m.createElement(T.Z.Item,{label:"岗位名称",name:"jobId",rules:[{required:!0,message:"请选择"}]},m.createElement(Gt,{placeholder:"请选择",allowClear:!0,showSearch:!0,optionFilterProp:"children",departmentId:re,disabled:f,onChange:function(e,t){return J(Te.P6.dotOptimal(t,"info",{}))}})),m.createElement(T.Z.Item,{label:oe,name:"peopleNum",rules:[{required:!0,message:"请选择"}]},m.createElement(st.Z,{min:1,max:e,formatter:function(t){return ge.fbc.limitMaxPositiveIntegerNumber(t,e)},parser:function(t){return ge.fbc.limitMaxPositiveIntegerNumber(t,e)},placeholder:"请选择"}))],n=[m.createElement(T.Z.Item,{label:"生效日期",name:"takeEffectDate",rules:[{required:!0,message:"请选择"}]},m.createElement(Pe.Z,{disabledDate:function(e){return e&&e<ve()().endOf("day").subtract(1,"days")}})),m.createElement(T.Z.Item,{label:"申请原因",name:"note",rules:[{required:!0,message:"请输入"}]},m.createElement(an,{placeholder:"请输入",rows:4})),m.createElement(T.Z.Item,{label:"附件",name:"assetKeys"},m.createElement(je.uA,{domain:je.uA.UploadDomains.OAUploadDomain}))],r=[m.createElement(T.Z.Item,{label:"所属部门",key:"department_name"},Te.P6.dotOptimal(s,"name","--")),m.createElement(T.Z.Item,{label:"岗位占编数",key:"organization_num"},Te.P6.dotOptimal(q,"organization_num","--")),m.createElement(T.Z.Item,{label:"现岗位编制数",key:"organization_num_detail"},Te.P6.dotOptimal(q,"organization_count","--"))],o=[m.createElement(T.Z.Item,{label:"固定抄送"},m.createElement(ze.ir,{flowId:a})),m.createElement(T.Z.Item,{label:"抄送",name:"copyGive"},m.createElement(ze.t2,{flowId:a}))],c=[].concat(t,n,r);f||c.push.apply(c,o);var l=i?c:[].concat(t,r);return m.createElement(_.Fp,{items:l,cols:1})}()),n&&i&&a?m.createElement(Ae,pe):"",function(){if(L){var e=Te.P6.dotOptimal(s,"name",void 0),t=Te.P6.dotOptimal(q,"job_info.name",void 0)||Te.P6.dotOptimal(q,"job_data_list.0.job_info.name",void 0),n="组织管理 - ".concat(ge.H_0.description(p)),r=e&&t?"".concat(n,"（").concat(e," - ").concat(t,"）"):n;return m.createElement(en,{visible:L,onChangeCheckResult:function(e){return function(e){ie(k.current,!1),M(e)}(e)},checkMessage:N,messageTitle:r,onSubmitDepartment:i?le:se})}}())},ln=(0,C.connect)((function(e){return{departmentOrderList:e.department.departmentOrderList}}))((function(e){var t=e.dispatch,n=e.departmentDetail,r=void 0===n?{}:n,a=e.postList,o=void 0===a?[]:a,i=e.organizationSubType,c=e.title,s=e.isUpdate,l=e.updateInitValue,u=void 0===l?{}:l,p=e.breakDepartmentList,d=(0,m.useState)(!1),f=(0,xe.Z)(d,2),y=f[0],h=f[1],b=(0,m.useState)(!1),C=(0,xe.Z)(b,2),Z=C[0],_=C[1],k=(0,m.useState)(void 0),D=(0,xe.Z)(k,2),E=D[0],I=D[1],O=(0,m.useState)(!1),S=(0,xe.Z)(O,2),w=S[0],P=S[1],x=r._id,j=function(){I(void 0),P(!1),_(!1)},z=function(){I(Te.P6.dotOptimal(u,"oa_application_flow_id",void 0)),P(!0),_(!0)},T=function(){var e=(0,R.Z)(A().mark((function e(){var n,r,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(!0);case 2:return e.next=4,t({type:"department/getOrganizationConfig",payload:{}});case 4:if(!(n=e.sent)||!n.zh_message){e.next=9;break}return h(!1),g.ZP.error(n.zh_message),e.abrupt("return");case 9:if(!n||!Array.isArray(n)){e.next=37;break}return r=!1,a=!1,i===ge.H_0.add&&(a=Te.P6.dotOptimal(n,"0.config_info.add_authorized_strength")),i===ge.H_0.remove&&(a=Te.P6.dotOptimal(n,"0.config_info.reduce_authorized_strength")),n.length>0&&n.find((function(e){return 20===e.config_type}))&&a&&(r=!0),e.next=17,P(r);case 17:if(r||(h(!1),_(!0)),!r){e.next=37;break}return e.next=21,t({type:"department/getOrganizationFlowList",payload:{departmentId:x,organizationSubType:i}});case 21:if(!(o=e.sent)||!o.zh_message){e.next=26;break}return h(!1),g.ZP.error(o.zh_message),e.abrupt("return");case 26:if(!o||!Array.isArray(o.data)){e.next=37;break}if(c=Te.P6.dotOptimal(o,"data.0.flow_template_records.0._id",void 0)){e.next=33;break}h(!1),g.ZP.error("提示：无适用审批流，请联系流程管理员"),e.next=37;break;case 33:return e.next=35,I(c);case 35:h(!1),_(!0);case 37:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return m.createElement(m.Fragment,null,s?m.createElement("a",{onClick:z,style:{margin:10}},"编辑"):"增编"===c?m.createElement(Lt.Z,{title:"「正常」分类下未找到对应的岗位，请先点击「添加岗位」按钮去添加岗位"},m.createElement(v.Z,{type:"primary",loading:y,onClick:T,style:{marginLeft:10}},c)):m.createElement(v.Z,{type:"primary",loading:y,onClick:T,style:{marginLeft:10}},c),function(){if(Z){var e=o.filter((function(e){return Te.P6.dotOptimal(e,"organization_count",0)===Te.P6.dotOptimal(e,"organization_num",0)})),n=s||i!==ge.H_0.add?[]:e.length>0?e:o,a={dispatch:t,visible:Z,flowId:E,isApprove:w,departmentDetail:r,countPostList:n,organizationSubType:i,isUpdate:s,updateInitValue:u,onClose:j,breakDepartmentList:p};return m.createElement(sn,a)}}())}));function un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?un(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):un(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dn=y.Z.TextArea,fn={labelCol:{span:6},wrapperCol:{span:18}},mn="save",vn="saveAndCarryOn",gn=function(e){var t,n,r=e.dispatch,a=e.visible,o=e.onClose,i=e.tabKey,c=e.flowId,s=e.isApprove,l=void 0!==s&&s,u=e.departmentDetail,p=void 0===u?{}:u,d=e.isUpdate,f=e.updateInitValue,y=void 0===f?{}:f,h=e.breakDepartmentList,b=T.Z.useForm(),C=(0,xe.Z)(b,1)[0],Z=(0,m.useRef)(mn),k=(0,m.useState)(!1),D=(0,xe.Z)(k,2),E=D[0],I=D[1],O=(0,m.useState)(!1),S=(0,xe.Z)(O,2),w=S[0],P=S[1],x=(0,m.useState)(!1),j=(0,xe.Z)(x,2),F=j[0],L=j[1],M=(0,m.useState)(!1),V=(0,xe.Z)(M,2),B=V[0],N=V[1],Y=(0,m.useState)(!1),K=(0,xe.Z)(Y,2),H=K[0],q=K[1],J=(0,m.useState)([]),$=(0,xe.Z)(J,2),G=$[0],W=$[1],Q=(0,m.useState)(d?Te.P6.dotOptimal(y):{}),X=(0,xe.Z)(Q,2),ee=X[0],te=X[1],ne=p._id,re=function(e,t){e===mn&&(I(t),N(t)),e===vn&&(P(t),L(t))},ae=function(){var e=(0,R.Z)(A().mark((function e(){var t;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g.ZP.success("请求成功"),re(Z.current,!1),t=i?ge.UYH.descriptionTabKey(i):ge.UYH.effectBefore,h&&h(l,t),Z.current===mn&&o(),Z.current===vn&&(te({}),C.setFieldsValue({jobId:void 0,peopleNum:l?0:void 0,takeEffectDate:ve()(),note:void 0,assetKeys:void 0,description:void 0}));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=(0,R.Z)(A().mark((function e(){var t,n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.validateFields();case 2:return t=e.sent,e.next=5,r({type:"organizationStaffs/createOrganizationPost",payload:pn({departmentId:ne},t)});case 5:if(!(n=e.sent)||!n.zh_message){e.next=10;break}return re(Z.current,!1),g.ZP.error(n.zh_message),e.abrupt("return",!1);case 10:if(!n||!n.ok){e.next=13;break}return ae(),e.abrupt("return",!0);case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=(0,R.Z)(A().mark((function e(){var t,n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.validateFields();case 2:return t=e.sent,e.next=5,r({type:"organizationStaffs/setApproveOrganizationPost",payload:pn({isUpdate:d,departmentId:ne,oaFlowId:c,applicationId:Te.P6.dotOptimal(y,"_id",void 0)},t)});case 5:if(!(n=e.sent)||!n.zh_message){e.next=10;break}return re(Z.current,!1),g.ZP.error(n.zh_message),e.abrupt("return",!1);case 10:if(!n||!n._id){e.next=18;break}return e.next=13,r({type:"oaCommon/submitOrder",payload:{id:n.oa_application_order_id,copyGive:t.copyGive,onSuccessCallback:ae}});case 13:if(e.sent){e.next=17;break}return re(Z.current,!1),e.abrupt("return",!1);case 17:case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ce=function(){var e=(0,R.Z)(A().mark((function e(t){var n,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.validateFields();case 2:return n=e.sent,Z.current=t,re(t,!0),e.next=7,r({type:"department/checkDepartmentUpdate",payload:{departmentId:ne,organizationSubType:40,oaApplicationOrderId:Te.P6.dotOptimal(y,"oa_application_order_id",void 0),jobId:Te.P6.dotOptimal(n,"jobId",void 0)}});case 7:if(!(a=e.sent)||!a.zh_message){e.next=12;break}return re(t,!1),g.ZP.error(a.zh_message),e.abrupt("return");case 12:a&&!1===a.ok&&(W(a.hint_list),q(!0)),a&&a.ok&&(l&&ie(),!l&&oe());case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se={flowId:c,departmentId:ne,specialDepartmentId:ne,accountId:Te.Iq.account.id},le=d?{jobId:Te.P6.dotOptimal(y,"job_list.0.job_id",void 0),peopleNum:Te.P6.dotOptimal(y,"job_data_list.0.organization_count",void 0),takeEffectDate:Te.P6.dotOptimal(y,"take_effect_date",void 0)?ve()(String(Te.P6.dotOptimal(y,"take_effect_date"))):ve()(),note:Te.P6.dotOptimal(y,"note",void 0),assetKeys:je.uA.getInitialValue(y,"asset_infos",{}),description:Te.P6.dotOptimal(y,"job_data_list.0.description",void 0)}:{takeEffectDate:ve()(),peopleNum:l?0:void 0};return m.createElement(U.Z,{title:d?"编辑岗位":"添加岗位",visible:a,onClose:o,width:400,footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:function(){return o()}},"取消"),m.createElement(v.Z,{onClick:function(){return ce(mn)},type:"primary",loading:E,disabled:F,style:{marginLeft:10}},"提交"),!d&&m.createElement(v.Z,{onClick:function(){return ce(vn)},type:"primary",loading:w,disabled:B,style:{marginLeft:10}},"提交并继续添加"))},m.createElement(T.Z,(0,z.Z)({form:C,className:"affairs-flow-node",initialValues:le},fn),(t=[m.createElement(T.Z.Item,{label:"岗位名称",name:"jobId",rules:[{required:!0,message:"请选择"}]},m.createElement(ft,{placeholder:"请选择",allowClear:!0,showSearch:!0,optionFilterProp:"children",departmentId:ne,disabled:d,onChange:function(e,t){return te(Te.P6.dotOptimal(t,"info",{}))}})),m.createElement(T.Z.Item,{label:"岗位编制数",name:"peopleNum",rules:[{required:!0,message:"请选择"}]},m.createElement(st.Z,{min:0,max:100,formatter:function(e){return ge.fbc.limitMaxZeroIntegerNumber(e,100)},parser:function(e){return ge.fbc.limitMaxZeroIntegerNumber(e,100)},placeholder:"请选择"})),m.createElement(T.Z.Item,{label:"岗位描述",name:"description"},m.createElement(dn,{placeholder:"请输入",rows:4})),m.createElement(T.Z.Item,{label:"岗位职级",key:"rank"},Te.P6.dotOptimal(ee,"rank",void 0)||Te.P6.dotOptimal(ee,"job_data_list.0.job_info.rank","--")),m.createElement(T.Z.Item,{label:"所属部门",key:"department_name"},Te.P6.dotOptimal(p,"name","--"))],n=[m.createElement(T.Z.Item,{label:"岗位名称",name:"jobId",rules:[{required:!0,message:"请选择"}]},m.createElement(ft,{placeholder:"请选择",allowClear:!0,showSearch:!0,optionFilterProp:"children",departmentId:ne,disabled:d,onChange:function(e,t){return te(Te.P6.dotOptimal(t,"info",{}))}})),m.createElement(T.Z.Item,{label:"岗位编制数",name:"peopleNum",rules:[{required:!0,message:"请选择"}]},m.createElement(st.Z,{min:0,max:100,disabled:!0,formatter:function(e){return ge.fbc.limitMaxZeroIntegerNumber(e,100)},parser:function(e){return ge.fbc.limitMaxZeroIntegerNumber(e,100)},placeholder:"请选择"})),m.createElement(T.Z.Item,{label:"生效日期",name:"takeEffectDate",rules:[{required:!0,message:"请选择"}]},m.createElement(Pe.Z,{disabledDate:function(e){return e&&e<ve()().endOf("day").subtract(1,"days")}})),m.createElement(T.Z.Item,{label:"申请原因",name:"note",rules:[{required:!0,message:"请输入"}]},m.createElement(dn,{placeholder:"请输入",rows:4})),m.createElement(T.Z.Item,{label:"岗位描述",name:"description"},m.createElement(dn,{placeholder:"请输入",rows:4})),m.createElement(T.Z.Item,{label:"岗位职级",key:"rank"},Te.P6.dotOptimal(ee,"rank",void 0)||Te.P6.dotOptimal(ee,"job_data_list.0.job_info.rank","--")),m.createElement(T.Z.Item,{label:"所属部门",key:"department_name"},Te.P6.dotOptimal(p,"name","--")),m.createElement(T.Z.Item,{label:"附件",name:"assetKeys"},m.createElement(je.uA,{domain:je.uA.UploadDomains.OAUploadDomain}))],d||n.push(m.createElement(T.Z.Item,{label:"固定抄送"},m.createElement(ze.ir,{flowId:c})),m.createElement(T.Z.Item,{label:"抄送",name:"copyGive"},m.createElement(ze.t2,{flowId:c}))),m.createElement(_.Fp,{items:l?n:t,cols:1}))),a&&l&&c?m.createElement(Ae,se):"",function(){if(H){var e=Te.P6.dotOptimal(p,"name",void 0),t=Te.P6.dotOptimal(ee,"name",void 0)||Te.P6.dotOptimal(ee,"job_data_list.0.job_info.name",void 0),n="组织管理 - 添加岗位",r=e&&t?"".concat(n,"（").concat(e," - ").concat(t,"）"):n;return m.createElement(en,{visible:H,onChangeCheckResult:function(e){return function(e){re(Z.current,!1),q(e)}(e)},checkMessage:G,onSubmitDepartment:l?ie:oe,messageTitle:r})}}())},yn=(0,C.connect)()((function(e){var t=e.dispatch,n=e.tabKey,r=e.departmentDetail,a=void 0===r?{}:r,o=e.isUpdate,i=e.updateInitValue,c=void 0===i?{}:i,s=e.breakDepartmentList,l=(0,m.useState)(!1),u=(0,xe.Z)(l,2),p=u[0],d=u[1],f=(0,m.useState)(!1),y=(0,xe.Z)(f,2),h=y[0],b=y[1],C=(0,m.useState)(void 0),Z=(0,xe.Z)(C,2),_=Z[0],k=Z[1],D=(0,m.useState)(!1),E=(0,xe.Z)(D,2),I=E[0],O=E[1],S=a._id,w=function(){k(void 0),O(!1),b(!1)},P=function(){var e=(0,R.Z)(A().mark((function e(){var n,r,a,o;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(!0);case 2:return e.next=4,t({type:"department/getOrganizationConfig",payload:{}});case 4:if(!(n=e.sent)||!n.zh_message){e.next=9;break}return d(!1),g.ZP.error(n.zh_message),e.abrupt("return");case 9:if(!n||!Array.isArray(n)){e.next=34;break}return r=!1,n.length>0&&n.find((function(e){return 20===e.config_type}))&&Te.P6.dotOptimal(n,"0.config_info.add_job")&&(r=!0),e.next=14,O(r);case 14:if(r||(d(!1),b(!0)),!r){e.next=34;break}return e.next=18,t({type:"department/getOrganizationFlowList",payload:{departmentId:S,organizationSubType:40}});case 18:if(!(a=e.sent)||!a.zh_message){e.next=23;break}return d(!1),g.ZP.error(a.zh_message),e.abrupt("return");case 23:if(!a||!Array.isArray(a.data)){e.next=34;break}if(o=Te.P6.dotOptimal(a,"data.0.flow_template_records.0._id",void 0)){e.next=30;break}d(!1),g.ZP.error("提示：无适用审批流，请联系流程管理员"),e.next=34;break;case 30:return e.next=32,k(o);case 32:d(!1),b(!0);case 34:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){k(Te.P6.dotOptimal(c,"oa_application_flow_id",void 0)),O(!0),b(!0)};return m.createElement(m.Fragment,null,o?m.createElement("a",{onClick:x,style:{marginLeft:10}},"编辑"):m.createElement(v.Z,{type:"primary",loading:p,onClick:P,style:{marginLeft:10}},"添加岗位"),function(){if(h){var e={dispatch:t,tabKey:n,visible:h,flowId:_,isApprove:I,departmentDetail:a,onClose:w,isUpdate:o,updateInitValue:c,breakDepartmentList:s};return m.createElement(gn,e)}}())})),hn=(0,C.connect)()((function(e){var t=e.dispatch,n=e.breakDepartmentList,r=e.postInfo,a=void 0===r?{}:r,o=e.departmentDetail,i=(void 0===o?{}:o)._id,c=(0,m.useState)(!1),s=(0,xe.Z)(c,2),l=s[0],u=s[1],p=(0,m.useState)([]),d=(0,xe.Z)(p,2),f=d[0],v=d[1],y=function(){var e=(0,R.Z)(A().mark((function e(){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({type:"department/checkDepartmentUpdate",payload:{departmentId:i,organizationSubType:70,jobId:Te.P6.dotOptimal(a,"job_id",void 0)}});case 2:if(!(n=e.sent)||!n.zh_message){e.next=6;break}return g.ZP.error(n.zh_message),e.abrupt("return");case 6:n&&!1===n.ok&&(v(n.hint_list),u(!0)),n&&n.ok&&h();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,R.Z)(A().mark((function e(){var r,o,i;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Te.P6.dotOptimal(a,"organization_num",0),o=Te.P6.dotOptimal(a,"_id",void 0),!(r>0)){e.next=5;break}return g.ZP.error("请先移出该岗位下成员，再执行删除操作"),e.abrupt("return",!1);case 5:return e.next=7,t({type:"organizationStaffs/onDeletePost",payload:{relaId:o}});case 7:if(!(i=e.sent)||!i.zh_message){e.next=11;break}return g.ZP.error(i.zh_message),e.abrupt("return",!1);case 11:if(!i||!i.ok){e.next=15;break}return g.ZP.success("请求成功"),n&&n(),e.abrupt("return",!0);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return m.createElement(m.Fragment,null,m.createElement(Je.Z,{title:"您是否确认删除该岗位",okText:"确认",cancelText:"取消",onConfirm:y},m.createElement("a",null,"删除")),function(){if(l)return m.createElement(en,{visible:l,onChangeCheckResult:function(e){return u(e)},checkMessage:f,messageTitle:"调整类型：组织架构-删除岗位(".concat(Te.P6.dotOptimal(a,"job_info.name","--"),")"),onSubmitDepartment:h})}())})),bn="t2JX3xOWtN0otEm5py6h",Cn="Pj5OVh2S9GWtUuNBBzkC";function Zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var _n="detail",kn=function(e){(0,s.Z)(n,e);var t=Zn(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"onClose",function(){var e=(0,R.Z)(A().mark((function e(t){var n,a,o,i;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props,a=n.dispatch,o=n.breakDepartmentList,e.next=3,a({type:"organizationStaffs/onCloseApproveOrder",payload:{oaOrganizationOrderId:t}});case 3:(i=e.sent)&&i.zh_message&&g.ZP.error(i.zh_message),i&&i._id&&(g.ZP.success("请求成功"),o&&o(!0,ge.UYH.close));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,p.Z)((0,c.Z)(r),"onDetail",(function(e){var t=r.props.onChangePageType;t&&t(_n,e)})),(0,p.Z)((0,c.Z)(r),"renderOption",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.props,a=n.tabKey,o=n.departmentDetail,i=void 0===o?{}:o,c=n.breakDepartmentList,s=t.organization_sub_type,l=x.ZP.canOperateOrganizationManageStaffsDelete()?m.createElement(hn,{departmentDetail:i,postInfo:t,breakDepartmentList:c}):null,u=x.ZP.canOperateOrganizationManageStaffsDelete()&&t.can_close?m.createElement(Je.Z,{title:"系统将会对该条审批单进行关闭处理，新增的申请将会被终止，请确定是否要继续",okText:"确认",cancelText:"再想想",onConfirm:function(){return r.onClose(e)}},m.createElement("a",{className:bn},"关闭")):null,p=s!==ge.H_0.add&&s!==ge.H_0.remove||!t.can_edit?null:m.createElement(ln,{departmentDetail:i,updateInitValue:t,organizationSubType:Te.P6.dotOptimal(t,"organization_sub_type",ge.H_0.add),title:"编辑",isUpdate:!0,breakDepartmentList:c}),d=s===ge.H_0.addPost&&t.can_edit?m.createElement(yn,{departmentDetail:i,updateInitValue:t,isUpdate:!0,title:"编辑",breakDepartmentList:c}):null;return"tab1"===a?m.createElement(m.Fragment,null,m.createElement("a",{onClick:function(){return r.onDetail(e)},style:{marginRight:10}},"查看详情"),l):"tab2"===a?m.createElement(m.Fragment,null,t.can_edit||t.can_close?m.createElement(m.Fragment,null,d,p,u):"--"):void 0})),(0,p.Z)((0,c.Z)(r),"renderContent",(function(){var e,t=r.props,n=t.tabKey,a=t.data,o=void 0===a?{}:a,i=t.onChangePage,c=t.onShowSizeChange,s=t.tableLoading,l=t.departmentDetail,u=void 0===l?{}:l,p=t.breakDepartmentList,d=o.data,f=void 0===d?[]:d,v=o._meta,g=(void 0===v?{}:v).result_count,y=void 0===g?0:g;"tab1"===n&&(e=[{title:"岗位名称",dataIndex:["job_info","name"],key:"job_info_name",render:function(e){return e||"--"}},{title:"职级",dataIndex:["job_info","rank"],key:"job_info_rank",render:function(e){return e||"--"}},{title:"岗位编制数",dataIndex:"organization_count",key:"organization_count",render:function(e){return e||0===e?e:"--"}},{title:"占编人数",dataIndex:"organization_num",key:"organization_num",render:function(e){return e||0===e?e:"--"}},{title:"是否审批",dataIndex:"source",key:"source",render:function(e){return e?e===ge.Nfd.approval?"是":"否":"--"}},{title:"创建者",dataIndex:["creator_info","name"],key:"creator_info_name",render:function(e){return e||"--"}},{title:"生效日期",dataIndex:"take_effect_date",key:"take_effect_date",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}},{title:"最新操作人",dataIndex:["operator_info","name"],key:"operator_info_name",render:function(e){return e||"--"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}}]),"tab2"===n&&(e=[{title:"岗位名称",dataIndex:"job_info_name",key:"job_info_name",width:100,fixed:"left",render:function(e,t){return Te.P6.dotOptimal(t,"job_data_list.0.job_info.name","--")}},{title:"编制人数",dataIndex:"job_data_list_count",key:"job_data_list_count",width:100,fixed:"left",render:function(e,t){return Te.P6.dotOptimal(t,"organization_sub_type",void 0)===ge.H_0.addPost?Te.P6.dotOptimal(t,"job_data_list.0.organization_count","--"):Te.P6.dotOptimal(t,"job_data_list.0.people_num","--")}},{title:"是否审批",dataIndex:"source",key:"source",render:function(){return"是"}},{title:"调整类型",dataIndex:"organization_sub_type",key:"organization_sub_type",render:function(e){return e?ge.H_0.description(e):"--"}},{title:"审批单状态",dataIndex:["oa_application_order_info","state"],key:"oa_application_order_info_state",render:function(e){return e?ge.DU5.description(e):"--"}},{title:"岗位调整状态",dataIndex:"take_effect_state",key:"take_effect_state",render:function(e){return e?ge.UYH.description(e):"--"}},{title:"创建者",dataIndex:["creator_info","name"],key:"creator_info",render:function(e){return e||"--"}},{title:"生效日期",dataIndex:"take_effect_date",key:"take_effect_date",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}},{title:"BOSS单号",dataIndex:["oa_application_order_info","_id"],key:"oa_application_order_info_id",render:function(e,t){return e?t.can_view?m.createElement("a",{rel:"noopener noreferrer",href:"javascript:void(window.open('/#/Expense/Manage/ExamineOrder/Detail?orderId=".concat(e,"'))"),className:Cn},e):e:"--"}}]),"tab3"===n&&(e=[{title:"岗位名称",dataIndex:"job_info_name",key:"job_info_name",width:100,fixed:"left",render:function(e,t){return Te.P6.dotOptimal(t,"job_data_list.0.job_info.name","--")}},{title:"编制人数",dataIndex:"job_data_list_count",key:"job_data_list_count",width:100,fixed:"left",render:function(e,t){return Te.P6.dotOptimal(t,"organization_sub_type",void 0)===ge.H_0.addPost?Te.P6.dotOptimal(t,"job_data_list.0.organization_count","--"):Te.P6.dotOptimal(t,"job_data_list.0.people_num","--")}},{title:"调整类型",dataIndex:"organization_sub_type",key:"organization_sub_type",render:function(e){return e?ge.H_0.description(e):"--"}},{title:"审批单状态",dataIndex:["oa_application_order_info","state"],key:"oa_application_order_info_state",render:function(e){return e?ge.DU5.description(e):"--"}},{title:"岗位调整状态",dataIndex:"take_effect_state",key:"take_effect_state",render:function(e){return e?ge.UYH.description(e):"--"}},{title:"创建者",dataIndex:["creator_info","name"],key:"creator_info",render:function(e){return e||"--"}},{title:"生效日期",dataIndex:"take_effect_date",key:"take_effect_date",render:function(e){return e?ve()("".concat(e)).format("YYYY-MM-DD"):"--"}},{title:"BOSS单号",dataIndex:["oa_application_order_info","_id"],key:"oa_application_order_info_id",render:function(e,t){return e?t.can_view?m.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"#/Expense/Manage/ExamineOrder/Detail?orderId=".concat(e),className:Cn},e):e:"--"}}]),"tab3"!==n&&e.push({title:"操作",dataIndex:"_id",key:"operate",width:200,fixed:"right",render:function(e,t){return r.renderOption(e,t)}});var h={defaultPageSize:30,onChange:i,total:y,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],showQuickJumper:!0,showSizeChanger:!0,onShowSizeChange:c},b="tab1"===n?m.createElement(m.Fragment,null,x.ZP.canOperateOrganizationManageStaffsCreate()&&m.createElement(yn,{tabKey:n,departmentDetail:u,title:"添加岗位",breakDepartmentList:p}),x.ZP.canOperateOrganizationManageStaffsAddendum()&&m.createElement(ln,{departmentDetail:u,postList:f,organizationSubType:ge.H_0.add,title:"增编",breakDepartmentList:p}),x.ZP.canOperateOrganizationManageStaffsReduction()&&m.createElement(ln,{departmentDetail:u,postList:f,organizationSubType:ge.H_0.remove,breakDepartmentList:p,title:"减编"})):null;return m.createElement(_.IT,{title:"岗位列表",titleExt:b},m.createElement($e.Z,{rowKey:function(e,t){return e.id||t},dataSource:f,columns:e,pagination:h,loading:s,scroll:"tab2"===n?{x:1300}:void 0}))})),r.state={},r}return(0,i.Z)(n,[{key:"render",value:function(){return m.createElement("div",null,this.renderContent())}}]),n}(m.Component),Dn=function(){};kn.propTypes={tabKey:I().string,departmentDetail:I().object,data:I().object,onChangePage:I().func,dispatch:I().func,onChangePageType:I().func,onShowSizeChange:I().func,tableLoading:I().bool,breakDepartmentList:I().func},kn.defaultProps={departmentDetail:{},data:{},onChangePage:Dn,dispatch:Dn,onChangePageType:Dn,onShowSizeChange:Dn,tableLoading:I().bool,breakDepartmentList:Dn};var En=(0,C.connect)()(kn);function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function On(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sn(e){var t=e.tabKey,n=e.departmentId,r=e.getDepartmentDetail,a=e.getDepartmentStaffs,o=e.findDepartmentOrderList,i=e.staffList,c=e.departmentOrderList,s=e.departmentDetail,l=e.onChangePageType,u={};switch(t){case"tab1":break;case"tab2":u.state=ge.UYH.effectBefore,u.organizationSubTypes=[ge.H_0.addPost,ge.H_0.add,ge.H_0.remove],u.orderNameSpace=t;break;case"tab3":u.state=ge.UYH.close,u.organizationSubTypes=[ge.H_0.addPost,ge.H_0.add,ge.H_0.remove],u.orderNameSpace=t}var p=(0,m.useRef)(On({_meta:{page:1,limit:30},organizationSubTypes:[ge.H_0.addPost,ge.H_0.add,ge.H_0.remove]},u)),d=(0,m.useState)(!0),f=(0,xe.Z)(d,2),v=f[0],g=f[1];(0,m.useEffect)((function(){(0,R.Z)(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.current.departmentId=n,e.next=3,Promise.all([y(),r({id:n})]);case 3:g(!1);case 4:case"end":return e.stop()}}),e)})))()}),[n,t]);var y=function(){var e=(0,R.Z)(A().mark((function e(){var n,r,i=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.length>0&&void 0!==i[0]&&i[0],n=i.length>1?i[1]:void 0,"tab1"!==t){e.next=7;break}return e.next=5,a(On({},p.current));case 5:e.next=20;break;case 7:if(n){e.next=10;break}return e.next=10,o(On({},p.current));case 10:if(r={organizationSubTypes:[ge.H_0.addPost,ge.H_0.add,ge.H_0.remove]},n!==ge.UYH.effectBefore){e.next=15;break}return r={orderNameSpace:"tab2",state:ge.UYH.effectBefore},e.next=15,o(On(On({},p.current),r));case 15:if(n!==ge.UYH.close){e.next=20;break}return e.next=18,o(On(On(On({},p.current),r),{},{orderNameSpace:"tab2",state:ge.UYH.effectBefore}));case 18:return e.next=20,o(On(On(On({},p.current),r),{},{orderNameSpace:"tab3",state:ge.UYH.close}));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,R.Z)(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),p.current=On(On({},p.current),{},{_meta:{page:t,limit:n}}),e.next=4,y();case 4:g(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),b=function(){var e=(0,R.Z)(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),p.current=On(On({},p.current),{},{_meta:{page:t,limit:n}}),e.next=4,y();case 4:g(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return m.createElement("div",null,m.createElement(En,{tabKey:t,tableLoading:v,onChangePage:h,onShowSizeChange:b,data:"tab1"===t?i:c[t],departmentDetail:s,onChangePageType:l,breakDepartmentList:function(){var e=(0,R.Z)(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),e.next=3,y(t,n);case 3:g(!1);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}))}Sn.propTypes={tabKey:I().string,departmentId:I().string,staffList:I().object,departmentOrderList:I().object,departmentDetail:I().object,onChangePageType:I().func},Sn.defaultProps={staffList:{},departmentOrderList:{},departmentDetail:{},onChangePageType:function(){}};var wn=(0,C.connect)((function(e){var t=e.department,n=t.departmentDetail,r=t.departmentOrderList;return{departmentDetail:n,staffList:e.organizationStaffs.staffList,departmentOrderList:r}}),(function(e){return{getDepartmentStaffs:function(t){return e({type:"organizationStaffs/getDepartmentStaffs",payload:t})},findDepartmentOrderList:function(t){return e({type:"department/findDepartmentOrderList",payload:t})},getDepartmentDetail:function(t){return e({type:"department/getDepartmentDetail",payload:t})}}}))(Sn),Pn=le.Z.TabPane,xn=function(){};function jn(e){var t=e.departmentId,n=e.onChangePageType,r=e.onChangeCheckResult,a=(0,m.useState)("tab1"),o=(0,xe.Z)(a,2),i=o[0],c=o[1];(0,m.useEffect)((function(){c("tab1")}),[t]);return m.createElement("div",null,m.createElement(le.Z,{activeKey:i,onChange:function(e){c(e)},type:"card"},m.createElement(Pn,{tab:"正常",key:"tab1"},m.createElement(wn,{tabKey:i,departmentId:t,onChangePageType:n,onChangeCheckResult:r})),m.createElement(Pn,{tab:"待生效",key:"tab2"},m.createElement(wn,{tabKey:i,departmentId:t,onChangePageType:n,onChangeCheckResult:r})),m.createElement(Pn,{tab:"已关闭",key:"tab3"},m.createElement(wn,{tabKey:i,departmentId:t,onChangePageType:n,onChangeCheckResult:r}))))}jn.propTypes={departmentId:I().string,onChangePageType:I().func,onChangeCheckResult:I().func},jn.defaultProps={onChangePageType:xn,onChangeCheckResult:xn};var zn=jn;function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Rn=function(e){(0,s.Z)(n,e);var t=Tn(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"renderBasic",(function(){var t=e.props.staffDetail,n=t.job_info,r=(n=void 0===n?{}:n).name,a=void 0===r?void 0:r,o=n.rank,i=void 0===o?void 0:o,c=t.department_info,s=(c=void 0===c?{}:c).name,l=void 0===s?void 0:s,u=t.description,p=[m.createElement(T.Z.Item,{label:"岗位名称"},a||"--"),m.createElement(T.Z.Item,{label:"部门"},l||"--"),m.createElement(T.Z.Item,{label:"岗位职级"},i||"--"),m.createElement(T.Z.Item,{label:"占编人数"},(0,Y.Cg)(t,"organization_num","--")),m.createElement(T.Z.Item,{label:"编制数"},(0,Y.Cg)(t,"organization_count","--")),m.createElement(T.Z.Item,{label:"创建者"},(0,Y.Cg)(t,"creator_info.name","--")),m.createElement(T.Z.Item,{label:"创建时间"},t.created_at?ve()(t.created_at).format("YYYY-MM-DD"):"--"),m.createElement(T.Z.Item,{label:"生效日期"},t.take_effect_date?ve()(String(t.take_effect_date)).format("YYYY-MM-DD"):"--"),{key:"description",span:24,render:m.createElement(T.Z.Item,{label:"岗位描述"},u||"--")}];return m.createElement(_.IT,{title:"基本信息",className:"affairs-flow-basic"},m.createElement(T.Z,null,m.createElement(_.Fp,{items:p,cols:4,layout:{labelCol:{span:8},wrapperCol:{span:16}}})))})),e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,n=e.staffId;n&&t({type:"organizationStaffs/getStaffDetail",payload:{staffId:n}})}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"organizationStaffs/resetStaffDetail",payload:{}})}},{key:"render",value:function(){return this.renderBasic()}}]),n}(m.Component);Rn.propTypes={staffId:I().string,staffDetail:I().object,dispatch:I().func},Rn.defaultProps={staffId:"",staffDetail:{},dispatch:function(){}};var Fn=(0,C.connect)((function(e){return{staffDetail:e.organizationStaffs.staffDetail}}))(Rn),An=(n(56022),n(60331)),Un=(n(438),n(14277)),Ln="mn26EDuVQBKatPjwqov_",Mn="U47ABBGz9OpZnSU_cn5g";function Vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Bn=An.Z.CheckableTag,Nn={"全选":"全选"},Yn=10,Kn=20,Hn=function(e){(0,s.Z)(n,e);var t=Vn(n);function n(e){var r;(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"onChange",(function(e,t,n){var a=r.state,o=a.selectPlatformTags,i=a.selectSupplierTags,c=a.selectCityTags,s=r.props.businessTag,l=((void 0===s?{}:s).biz_data_business_info||{}).city_list,u=(void 0===l?[]:l).map((function(e){return Object.keys(e)[0]})),p=[];if("platform"===n&&(p=t?[].concat((0,k.Z)(o),[e]):o.filter((function(t){return t!==e})))&&r.setState({selectPlatformTags:p}),"supplier"===n&&(p=t?[].concat((0,k.Z)(i),[e]):i.filter((function(t){return t!==e})))&&r.setState({selectSupplierTags:p}),"city"===n&&e===Object.keys(Nn)[0])t?r.setState({selectCityTags:(0,k.Z)(u)}):r.setState({selectCityTags:[]});else if("city"===n&&e!==Object.keys(Nn)[0])if(t){var d=[].concat((0,k.Z)(c),[e]);d.length===u.length-1&&d.push(Object.keys(Nn)[0]),r.setState({selectCityTags:d})}else{var f=c.filter((function(t){return t!==e&&t!==Object.keys(Nn)[0]}));r.setState({selectCityTags:f})}})),(0,p.Z)((0,c.Z)(r),"onSubmit",(function(){var e=r.props,t=e.dispatch,n=e.staffId,a=e.onSuccessCallback,o=e.onFailureCallback,i=e.operateType,c=r.state,s=c.selectPlatformTags,l=c.selectSupplierTags,u=c.selectCityTags,p={staffId:n,type:ge.TIo.four,platformCodes:s,supplierIds:l,cityCodes:u.filter((function(e){return e!==Object.keys(Nn)[0]})),onSuccessCallback:a,onFailureCallback:o};r.private.isSubmit&&(i===Yn&&t({type:"organizationBusiness/createBusinessTag",payload:p}),i===Kn&&t({type:"organizationBusiness/updateBusinessTag",payload:p})),r.private.isSubmit=!1})),(0,p.Z)((0,c.Z)(r),"onCancel",(function(){var e=r.props.onCancel;r.private={isSubmit:!0,isInitial:!0},e&&e()})),(0,p.Z)((0,c.Z)(r),"renderSystemTag",(function(e,t,n){var a=r.state,o=a.selectPlatformTags,i=a.selectCityTags,c=a.selectSupplierTags,s=[];return"platform"===n&&(s=o),"supplier"===n&&(s=c),"city"===n&&(s=i),m.createElement(Bn,{key:e,value:e,checked:s.indexOf(e)>-1,onChange:function(t){return r.onChange(e,t,n)},style:s.indexOf(e)>-1?null:{border:"1px solid #d9d9d9",backgroundColor:"#fafafa"}},t)})),(0,p.Z)((0,c.Z)(r),"renderEmpty",(function(){return m.createElement(Un.Z,null)})),(0,p.Z)((0,c.Z)(r),"renderSystemAttributes",(function(){var e=r.props.businessTag,t=(void 0===e?{}:e).biz_data_business_info||{},n=t.platform_list,a=void 0===n?[]:n,o=t.supplier_list,i=void 0===o?[]:o,c=t.city_list,s=void 0===c?[]:c;r.private.isInitial&&f().existy(s)&&f().not.empty(s)&&(!1===s.map((function(e){return Object.keys(e)[0]})).includes(Object.keys(Nn)[0])&&s.unshift(Nn));var l=[{label:"平台",form:m.createElement("div",null,a.map((function(e){var t=Object.values(e)[0],n=Object.keys(e)[0];return r.renderSystemTag(n,t,"platform")})))},{label:"供应商",form:m.createElement("div",null,i.map((function(e){var t=Object.values(e)[0],n=Object.keys(e)[0],a=Te.P6.dotOptimal(e,"platform_info.platform_name",void 0),o=a?"".concat(t,"（").concat(a,"）"):t;return r.renderSystemTag(n,o,"supplier")})))||"--"},{label:"城市",form:m.createElement("div",null,s.map((function(e){var t=Object.values(e)[0],n=Object.keys(e)[0];return r.renderSystemTag(n,t,"city")})))}];return m.createElement("div",{className:Mn},m.createElement(_.KP,{items:l,cols:1,layout:{labelCol:{span:3},wrapperCol:{span:21}}}))})),(0,p.Z)((0,c.Z)(r),"renderMadal",(function(){var e=r.props,t=e.visible,n=e.businessTag,a=(void 0===n?{}:n).biz_data_business||{},o=Object.keys(a).length>0,i=o;return m.createElement(U.Z,{title:"岗位数据权限范围信息",visible:t,onClose:r.onCancel,width:700,footer:m.createElement("div",{style:{textAlign:"right"}},m.createElement(v.Z,{onClick:r.onCancel,style:{marginRight:8}},"取消"),m.createElement(v.Z,{disabled:!i,onClick:r.onSubmit,type:"primary"},"提交"))},o?r.renderSystemAttributes():r.renderEmpty())}));var a=b().get(e,"staffBusinessTag",{}),i=e.businessTag,s=void 0===i?{}:i,l=a.biz_data_business||{},u=s.biz_data_business_info||{},d=l.city_codes||[],g=d,y=u.city_list,h=(void 0===y?[]:y).map((function(e){return Object.keys(e)[0]})).filter((function(e){return e!==Object.keys(Nn)[0]}));return d.length===h.length&&(g=[Object.keys(Nn)[0]].concat((0,k.Z)(d))),r.state={selectPlatformTags:l.platform_codes||[],selectSupplierTags:l.supplier_ids||[],selectCityTags:g,organStaffTag:l||{}},r.private={isSubmit:!0,isInitial:!0},r}return(0,i.Z)(n,[{key:"render",value:function(){return this.renderMadal()}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.staffBusinessTag,r=void 0===n?{}:n,a=t.organStaffTag,o=e.businessTag,i=void 0===o?{}:o,c=r.biz_data_business||{},s=i.biz_data_business_info||{},l=c.platform_codes,u=void 0===l?[]:l,p=c.supplier_ids,d=void 0===p?[]:p,f=c.city_codes,m=void 0===f?[]:f,v=s.city_list,g=(void 0===v?[]:v).map((function(e){return Object.keys(e)[0]}));if(Object.keys(a).length!==Object.keys(c).length){var y=m;return m.length===g.length&&(y=[Object.keys(Nn)[0]].concat((0,k.Z)(m))),{selectPlatformTags:u,selectSupplierTags:d,selectCityTags:y,organStaffTag:c}}return null}}]),n}(m.Component);Hn.propTypes={staffId:I().string,visible:I().bool,dispatch:I().func,operateType:I().number,onCancel:I().func,businessTag:I().object,onSuccessCallback:I().func,onFailureCallback:I().func},Hn.defaultProps={staffId:"",visible:!1,dispatch:function(){},onCancel:function(){},businessTag:{},staffBusinessTag:{},operateType:10,onSuccessCallback:function(){},onFailureCallback:function(){}};var qn=Hn;function Jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var $n=10,Gn=20,Wn=function(e){(0,s.Z)(n,e);var t=Jn(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onCancel",(function(){e.setState({visible:!1})})),(0,p.Z)((0,c.Z)(e),"onSuccessCallback",(function(){var t=e.props;(0,t.dispatch)({type:"organizationBusiness/getStaffBusiness",payload:{staffId:t.staffId}}),e.onCancel()})),(0,p.Z)((0,c.Z)(e),"onFailureCallback",(function(t){t.zh_message&&g.ZP.error(t.zh_message),e.onCancel()})),(0,p.Z)((0,c.Z)(e),"renderContent",(function(){var t=x.ZP.canOperateOrganizationManageDataPermissionUpdate()?m.createElement("a",{onClick:function(){return e.setState({visible:!0,operateType:Gn})}},"编辑"):null;return m.createElement(_.IT,{title:"数据权限信息",titleExt:t},e.renderSystemAttributes())})),(0,p.Z)((0,c.Z)(e),"renderEmpty",(function(){var t=x.ZP.canOperateOrganizationManageDataPermissionCreate()?m.createElement("a",{onClick:function(){return e.setState({visible:!0,operateType:$n})}},"岗位数据权限设置"):null;return m.createElement(_.IT,{title:"数据权限信息",titleExt:t},m.createElement(Un.Z,null))})),(0,p.Z)((0,c.Z)(e),"renderModal",(function(){var t=e.state,n=t.visible,r=t.operateType;if(n){var a=e.props,o=a.staffBusinessTag,i=a.businessTag,c=a.staffId,s=a.dispatch;return m.createElement(qn,{staffId:c,visible:n,operateType:r,dispatch:s,staffBusinessTag:o,businessTag:i,onCancel:e.onCancel,onSuccessCallback:e.onSuccessCallback,onFailureCallback:e.onFailureCallback})}})),(0,p.Z)((0,c.Z)(e),"renderSystemAttributes",(function(){var t=e.props.staffBusinessTag,n=(void 0===t?{}:t).biz_data_business_info||{},r=n.platform_list,a=void 0===r?[]:r,o=n.supplier_list,i=void 0===o?[]:o,c=n.city_list,s=void 0===c?[]:c,l=[{label:"平台",form:m.createElement("div",null,a.map((function(e,t){var n=Object.values(e)[0];return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},n)})))},{label:"供应商",form:m.createElement("div",null,i.map((function(e,t){var n=Object.values(e)[0],r=Te.P6.dotOptimal(e,"platform_info.platform_name",void 0);return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},r?"".concat(n,"（").concat(r,"）"):n)})))||"--"},{label:"城市",form:m.createElement("div",null,s.map((function(e,t){var n=Object.values(e)[0];return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},n)})))}];return m.createElement("div",{className:Ln},m.createElement(_.KP,{items:l,cols:1,layout:{labelCol:{span:2},wrapperCol:{span:22}}}))})),e.state={visible:!1,operateType:10},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,n=e.staffId;t({type:"organizationBusiness/getBusiness",payload:{departmentId:e.id}}),t({type:"organizationBusiness/getStaffBusiness",payload:{staffId:n}})}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"organizationBusiness/resetStaffBusiness",payload:{}})}},{key:"render",value:function(){var e=this.props.staffBusinessTag,t=(void 0===e?{}:e).biz_data_business_info||{};return m.createElement("div",null,Object.keys(t).length>0?this.renderContent():this.renderEmpty(),this.renderModal())}}]),n}(m.Component);Wn.propTypes={id:I().string,staffId:I().string,staffBusinessTag:I().object,businessTag:I().object},Wn.defaultProps={id:"",staffId:"",staffBusinessTag:{},businessTag:{}};var Qn=(0,C.connect)((function(e){var t=e.organizationBusiness;return{businessTag:t.businessTag,staffBusinessTag:t.staffBusinessTag}}))(Wn);function Xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xn(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var nr=function(e){(0,s.Z)(n,e);var t=tr(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onChangePage",(function(t,n){e.getStaffMember({page:t,limit:n})})),(0,p.Z)((0,c.Z)(e),"getStaffMember",(function(t){var n=e.props,r=n.dispatch,a=n.staffId,o=void 0===a?"":a;o&&r({type:"organizationStaffs/getStaffMember",payload:er({staffId:o},t)})})),(0,p.Z)((0,c.Z)(e),"renderContent",(function(){var t=e.props,n=t.staffMember,r=void 0===n?{}:n,a=t.departmentId,o=r.data,i=void 0===o?[]:o,c=r._meta,s=(void 0===c?{}:c).result_count,l=void 0===s?0:s,u=[{title:"姓名",dataIndex:"name",key:"name"},{title:"手机号",dataIndex:"phone",key:"phone",render:function(e){return e||"--"}},{title:"部门",dataIndex:"department_info_list",key:"department_info_list",render:function(e){if(Array.isArray(e)&&e.length>0){var t=e.find((function(e){return e._id===a}));return t?t.name:"--"}return"--"}},{title:"岗位",dataIndex:["major_job_info","name"],key:"major_job_info",render:function(e){return e||"--"}},{title:"更新时间",dataIndex:"updated_at",key:"updated_at",width:100,render:function(e){return e?ve()(String(e)).format("YYYY-MM-DD HH:mm:ss"):"--"}}],p={defaultPageSize:30,onChange:e.onChangePage,total:l,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],showQuickJumper:!0,showSizeChanger:!0,onShowSizeChange:e.onChangePage};return m.createElement(_.IT,{title:"岗位成员"},m.createElement($e.Z,{rowKey:function(e,t){return e._id||t},dataSource:i,columns:u,pagination:p}))})),e.state={},e.private={searchParams:{limit:30,page:1}},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.getStaffMember(this.private.searchParams)}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"organizationStaffs/resetStaffMember",payload:{}})}},{key:"render",value:function(){return m.createElement("div",null,this.renderContent())}}]),n}(m.Component);nr.propTypes={staffMember:I().object,staffId:I().string,departmentId:I().string},nr.defaultProps={staffMember:{},staffId:"",departmentId:""};var rr=(0,C.connect)((function(e){return{staffMember:e.organizationStaffs.staffMember}}))(nr);function ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var or=function(e){(0,s.Z)(n,e);var t=ar(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.staffId;return m.createElement("div",null,m.createElement(Fn,{staffId:n}),m.createElement(Qn,{staffId:n,id:t}),m.createElement(rr,{staffId:n,departmentId:t}))}}]),n}(m.Component);or.propTypes={staffId:I().string,id:I().string},or.defaultProps={staffId:"",id:""};var ir=or;function cr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var sr="list",lr="detail",ur=function(e){(0,s.Z)(n,e);var t=cr(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"onChangePageType",(function(e,t){r.setState({pageType:e,staffId:t})})),r.state={pageType:sr,staffId:"",activeKey:e.activeKey,departmentId:e.departmentId},r}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.state,t=e.pageType,n=e.staffId,r=this.props,a=r.departmentId,o=r.onChangeCheckResult;return a&&"undefined"!==a?t===sr?m.createElement(zn,{onChangePageType:this.onChangePageType,departmentId:a,onChangeCheckResult:o}):t===lr?m.createElement(ir,{id:a,staffId:n}):void 0:m.createElement(fe,null)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.activeKey,r=t.departmentId,a=e.activeKey,o=e.departmentId;return n!==a?{pageType:sr}:r!==o?{pageType:sr,departmentId:o}:null}}]),n}(m.Component);ur.propTypes={departmentId:I().string,activeKey:I().string,onChangeCheckResult:I().func},ur.defaultProps={departmentId:"",activeKey:"1",onChangeCheckResult:function(){}};var pr=ur,dr=(n(19597),n(27279)),fr="dtUH7AWR5QSA7ZySSfKN",mr="Y_QxLRVm9cAPPz8z1hUc",vr="j6Llf8oF0VoKF2LFq4Hp",gr="MlEHySf2az2ZdgPROGOV",yr="my2oJrkyCsTnkSqRJm5A";function hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var br=dr.Z.Panel,Cr=20,Zr=20,_r=function(e){(0,s.Z)(n,e);var t=hr(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"onUpdate",(function(){var t=e.props.onChangeType;t&&t(Cr,Zr)})),(0,p.Z)((0,c.Z)(e),"renderSystemAttributes",(function(){var t=e.props.data,n=void 0===t?{}:t,r=n.platform_names,a=void 0===r?[]:r,o=n.supplier_list,i=void 0===o?[]:o,c=n.city_names,s=void 0===c?[]:c,l=n.cost_center_type,u=void 0===l?void 0:l,p=m.createElement("div",null,a.map((function(e,t){return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},e)}))),d=m.createElement("div",null,i.map((function(e,t){var n=Object.values(e)[0],r=Te.P6.dotOptimal(e,"platform_info.platform_name",void 0);return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},r?"".concat(n,"（").concat(r,"）"):n)}))),f=m.createElement("div",null,s.map((function(e,t){return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},e)})));return m.createElement(_.IT,{title:"部门成本中心",style:{backgroundColor:"white"}},m.createElement(dr.Z,{bordered:!1,expandIconPosition:"right",className:fr,activeKey:["1","2","3","4"]},m.createElement(br,{key:"4",header:"成本类型",className:yr,showArrow:!1},m.createElement("div",null,u?m.createElement(An.Z,{style:{margin:"4px",background:"#F5F5F5"}},ge.F$Y.description(u)):null)),m.createElement(br,{key:"1",header:"平台",className:yr,showArrow:!1},p),m.createElement(br,{key:"2",header:"供应商",className:yr,showArrow:!1},d),m.createElement(br,{key:"3",header:"城市",className:yr,showArrow:!1},f)))})),(0,p.Z)((0,c.Z)(e),"renderTeamAttributes",(function(){var t=e.props.data,n=(void 0===t?{}:t).team_attrs,r=void 0===n?[]:n;return m.createElement(_.IT,{title:"团队类型属性",style:{backgroundColor:"white"}},r.map((function(e,t){return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},ge.vtJ.description(e))})))})),(0,p.Z)((0,c.Z)(e),"renderCustomizeAttributes",(function(){var t=e.props.data,n=(void 0===t?{}:t).custom_attrs,r=void 0===n?[]:n;return m.createElement(_.IT,{title:"自定义属性标签",style:{backgroundColor:"white"}},r&&r.length>0?r.map((function(e,t){return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},e)})):null)})),(0,p.Z)((0,c.Z)(e),"renderContent",(function(){var t=x.ZP.canOperateOrganizationManageAttributesUpdate()?m.createElement("a",{type:"primary",onClick:e.onUpdate},"编辑"):null;return m.createElement(_.IT,{title:"业务信息列表",titleExt:t},e.renderSystemAttributes(),e.renderTeamAttributes(),e.renderCustomizeAttributes())})),e}return(0,i.Z)(n,[{key:"render",value:function(){return this.renderContent()}}]),n}(m.Component);_r.propTypes={data:I().object,onChangeType:I().func},_r.defaultProps={data:{},onChangeType:function(){}};var kr=_r,Dr=n(96486),Er=n.n(Dr);function Ir(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Or=L.Z.Option,Sr=function(e){(0,s.Z)(n,e);var t=Ir(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"onChange",(function(t){var n=e.props.onChange;n&&n(t)})),e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,n=e.scense;t({type:"organizationBusiness/getPlatformList",payload:{scense:void 0===n?[]:n}})}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.scense,r=t.dispatch;!Er().isEqual(n,e.scense)&&r({type:"organizationBusiness/getPlatformList",payload:{scense:n}})}},{key:"render",value:function(){var e=this.props,t=e.platformList,n=void 0===t?{}:t,r=e.value,a=e.initValues,o=void 0===a?[]:a,i=n.data,c=void 0===i?[]:i,s=Er().uniqWith([].concat((0,k.Z)(c),(0,k.Z)(o)),(function(e,t){return e.platform_code===t.platform_code})),l=c.map((function(e){return e.platform_code})),u=(0,Y.CE)(["dispatch","value","platformList"],this.props);return m.createElement(L.Z,(0,z.Z)({placeholder:"请选择平台",onChange:this.onChange,value:r},u,{className:Wt["app-organization-update-select"]}),s.map((function(e){return m.createElement(Or,{key:e.platform_code,disabled:!l.includes(e.platform_code)},e.name)})))}}]),n}(m.Component);Sr.propTypes={platformList:I().object,dispatch:I().func,onChange:I().func},Sr.defaultProps={platformList:{},dispatch:function(){},onChange:function(){}};var wr=(0,C.connect)((function(e){return{platformList:e.organizationBusiness.platformList}}))(Sr);function Pr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var xr=L.Z.Option,jr=function(e){(0,s.Z)(n,e);var t=Pr(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"onChange",(function(t){var n=e.props.onChange;n&&n(t)})),e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)({type:"organizationBusiness/getSupplierList",payload:{}})}},{key:"render",value:function(){var e=this.props,t=e.supplierList,n=void 0===t?{}:t,r=e.value,a=e.mode,o=void 0===a?void 0:a,i=n.supplier_list,c=void 0===i?[]:i,s=(0,Y.CE)(["dispatch","value","supplierList"],this.props);return m.createElement(L.Z,(0,z.Z)({allowClear:!0,mode:o,placeholder:"请选择供应商",onChange:this.onChange,value:r},s,{className:Wt["app-organization-update-select"]}),c.map((function(e){var t=Te.P6.dotOptimal(e,"platform_info.platform_name",void 0);return m.createElement(xr,{key:e.supplier_id},t?"".concat(e.supplier_name,"（").concat(t,"）"):e.supplier_name)})))}}]),n}(m.Component);jr.propTypes={supplierList:I().object,dispatch:I().func,onChange:I().func},jr.defaultProps={supplierList:{},dispatch:function(){},onChange:function(){}};var zr=(0,C.connect)((function(e){return{supplierList:e.organizationBusiness.supplierList}}))(jr);function Tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Rr=_.Hr.Option,Fr=function(e){(0,s.Z)(n,e);var t=Tr(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"onChange",(function(t){var n=e.props.onChange;n&&n(t)})),e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)({type:"organizationBusiness/getCityList",payload:{}})}},{key:"render",value:function(){var e=this.props,t=e.cityList,n=void 0===t?[]:t,r=e.value,a=e.mode,o=void 0===a?void 0:a,i=Er().uniqWith(n,(function(e,t){return e.city_code===t.city_code})),c=(0,Y.CE)(["dispatch","value","cityList"],this.props);return m.createElement(_.Hr,(0,z.Z)({allowClear:!0,mode:o,placeholder:"请选择城市",onChange:this.onChange,value:Array.isArray(r)?(0,k.Z)(new Set(r)):r},c,{className:Wt["app-organization-update-select"]}),i.map((function(e){return m.createElement(Rr,{key:e.city_code,value:e.city_code},e.city_name)})))}}]),n}(m.Component);Fr.propTypes={cityList:I().array,dispatch:I().func,onChange:I().func},Fr.defaultProps={cityList:[],dispatch:function(){},onChange:function(){}};var Ar=(0,C.connect)((function(e){return{cityList:e.organizationBusiness.cityList}}))(Fr);function Ur(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ur(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ur(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Vr=L.Z.Option,Br=10,Nr=10,Yr=20,Kr=function(e){(0,s.Z)(n,e);var t=Mr(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"onSubmit",(function(){var e=r.props,t=e.form,n=e.dispatch,a=e.departmentId,o=e.operateType;t.validateFields((function(e,t){if(!e){var i=Lr(Lr({departmentId:a,type:ge.TIo.three},t),{},{onSuccessCallback:r.onSuccessCallback,onFailureCallback:r.onFailureCallback});o===Nr&&n({type:"organizationBusiness/createBusinessTag",payload:i}),o===Yr&&n({type:"organizationBusiness/updateBusinessTag",payload:i})}}))})),(0,p.Z)((0,c.Z)(r),"onSuccessCallback",(function(){var e=r.props,t=e.onChangeType,n=e.getBusinessTag;t&&t(Br),n&&n()})),(0,p.Z)((0,c.Z)(r),"onFailureCallback",(function(e){e.zh_message&&g.ZP.error(e.zh_message);var t=r.props.onChangeType;t&&t(Br)})),(0,p.Z)((0,c.Z)(r),"onChangeCostCenter",(function(e){var t=r.props,n=t.form,a=t.data,o=void 0===a?{}:a,i=o.platform_codes,c=void 0===i?void 0:i,s=o.supplier_ids,l=void 0===s?void 0:s,u=o.city_codes,p=void 0===u?void 0:u,d=c?c[0]:void 0,f=l?l[0]:void 0,m=p?p[0]:void 0;e===b().get(r.props,"data.cost_center_type",void 0)?(r.setState({costCenterCheck:e,isEmpty:!0}),n.setFieldsValue({platformCodes:d,supplierIds:f,cityCodes:m})):r.setState({costCenterCheck:e,isEmpty:!1})})),(0,p.Z)((0,c.Z)(r),"onChangePlatfrom",(function(e){var t=r.props.form;(0,t.setFieldsValue)({platformCodes:e}),t.setFieldsValue({supplierIds:void 0,cityCodes:void 0})})),(0,p.Z)((0,c.Z)(r),"onChangeSupplier",(function(e){var t=r.props.form;(0,t.setFieldsValue)({supplierIds:e}),t.setFieldsValue({cityCodes:void 0})})),(0,p.Z)((0,c.Z)(r),"onChangeCity",(function(e){(0,r.props.form.setFieldsValue)({cityCodes:e})})),(0,p.Z)((0,c.Z)(r),"renderSystemForm",(function(){var e=r.props,t=e.data,n=void 0===t?{}:t,a=e.form.getFieldDecorator,o=r.state,i=o.costCenterCheck,c=o.isEmpty,s=n.platform_codes,l=void 0===s?void 0:s,u=n.supplier_ids,p=void 0===u?void 0:u,d=n.city_codes,f=void 0===d?void 0:d,v=l?l[0]:void 0,g=p?p[0]:void 0,y=f?f[0]:void 0,h=[{label:"成本类型",form:a("costCenter",{initialValue:b().get(r.props,"data.cost_center_type")||void 0,rules:[{required:!1,message:"请选择成本类型"}]})(m.createElement(L.Z,{allowClear:!0,placeholder:"请选择成本中心",style:{width:"50%"},onChange:r.onChangeCostCenter},m.createElement(Vr,{key:ge.F$Y.group,value:ge.F$Y.group},ge.F$Y.description(ge.F$Y.group)),m.createElement(Vr,{key:ge.F$Y.project,value:ge.F$Y.project},ge.F$Y.description(ge.F$Y.project)),m.createElement(Vr,{key:ge.F$Y.headquarter,value:ge.F$Y.headquarter},ge.F$Y.description(ge.F$Y.headquarter)),m.createElement(Vr,{key:ge.F$Y.city,value:ge.F$Y.city},ge.F$Y.description(ge.F$Y.city))))}];i&&i<=ge.F$Y.project&&h.push({label:"平台",form:a("platformCodes",{initialValue:c?v:void 0,rules:[{required:!!(i&&i<=ge.F$Y.project),message:"请选择平台"}]})(m.createElement(wr,{showSearch:!0,allowClear:!0,optionFilterProp:"children",onChange:r.onChangePlatfrom}))}),i&&i<=ge.F$Y.headquarter&&h.push({label:"供应商",form:a("supplierIds",{initialValue:c?g:void 0,rules:[{required:!!(i&&i<=ge.F$Y.headquarter),message:"请选择供应商"}]})(m.createElement(zr,{showSearch:!0,allowClear:!0,optionFilterProp:"children",onChange:r.onChangeSupplier}))}),i&&i<=ge.F$Y.city&&h.push({label:"城市",form:a("cityCodes",{initialValue:c?y:void 0,rules:[{required:!!(i&&i<=ge.F$Y.city),message:"请选择城市"}]})(m.createElement(Ar,{showSearch:!0,enableSelectAll:!0,allowClear:!0,optionFilterProp:"children",onChange:r.onChangeCity}))});return m.createElement(_.IT,{title:"部门成本中心",style:{backgroundColor:"white"}},m.createElement(_.KP,{items:h,cols:1,layout:{labelCol:{span:2},wrapperCol:{span:16}}}))})),(0,p.Z)((0,c.Z)(r),"renderTeamForm",(function(){var e=r.props,t=e.data,n=void 0===t?{}:t,a=e.form.getFieldDecorator,o=n.team_attrs,i=void 0===o?[]:o,c=[{label:"",form:a("teamAttrs",{initialValue:i.length>0?i[0]:void 0})(m.createElement(L.Z,{allowClear:!0,placeholder:"请选择团队类型属性",className:vr},m.createElement(Vr,{key:ge.vtJ.division,value:ge.vtJ.division},ge.vtJ.description(ge.vtJ.division)),m.createElement(Vr,{key:ge.vtJ.subDivision,value:ge.vtJ.subDivision},ge.vtJ.description(ge.vtJ.subDivision)),m.createElement(Vr,{key:ge.vtJ.region,value:ge.vtJ.region},ge.vtJ.description(ge.vtJ.region)),m.createElement(Vr,{key:ge.vtJ.personal,value:ge.vtJ.personal},ge.vtJ.description(ge.vtJ.personal))))}];return m.createElement(_.IT,{title:"团队类型属性",style:{backgroundColor:"white"}},m.createElement(_.KP,{items:c,cols:1,layout:{labelCol:{span:0},wrapperCol:{span:6}}}))})),(0,p.Z)((0,c.Z)(r),"renderCustomizeForm",(function(){var e=r.props,t=e.data,n=void 0===t?{}:t,a=e.form.getFieldDecorator,o=n.custom_attrs,i=void 0===o?[]:o;return i=null===i?[]:i,m.createElement(_.IT,{title:"自定义属性标签",style:{backgroundColor:"white"}},a("customAttrs",{initialValue:i})(m.createElement(L.Z,{mode:"tags",placeholder:"请输入自定义属性标签",style:{width:"75%"},tokenSeparators:[",","，"]},i.map((function(e){return m.createElement(Vr,{key:e},e)})))))})),(0,p.Z)((0,c.Z)(r),"renderOperate",(function(){return m.createElement("div",{className:gr},m.createElement(v.Z,{type:"primary",onClick:r.onSubmit},"提交"))})),r.state={customTags:[],isEmpty:!0,costCenterCheck:b().get(r.props,"data.cost_center_type")||void 0},r}return(0,i.Z)(n,[{key:"render",value:function(){return m.createElement(_.IT,{title:"业务信息列表"},this.renderSystemForm(),this.renderTeamForm(),this.renderCustomizeForm(),this.renderOperate())}}]),n}(m.Component);Kr.propTypes={data:I().object,departmentId:I().string,onChangeType:I().func,dispatch:I().func,operateType:I().number,getBusinessTag:I().func},Kr.defaultProps={data:{},departmentId:"",onChangeType:function(){},dispatch:function(){},operateType:10,getBusinessTag:function(){}};var Hr=ye.Z.create()(Kr);function qr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Jr=10,$r=20,Gr=10,Wr=function(e){(0,s.Z)(n,e);var t=qr(n);function n(){var e;return(0,o.Z)(this,n),e=t.call(this),(0,p.Z)((0,c.Z)(e),"onChangeType",(function(t,n){e.setState({pageType:t,operateType:n})})),(0,p.Z)((0,c.Z)(e),"getBusinessTag",(function(){var t=e.props;(0,t.dispatch)({type:"organizationBusiness/getBusiness",payload:{departmentId:t.departmentId}}),e.setState({pageType:10,operateType:10})})),(0,p.Z)((0,c.Z)(e),"renderContent",(function(){var t=e.props,n=t.businessTag,r=void 0===n?{}:n,a=t.activeKey;return m.createElement(kr,{data:r,activeKey:a,onChangeType:e.onChangeType})})),(0,p.Z)((0,c.Z)(e),"renderEmpty",(function(){return m.createElement(_.IT,{title:"业务信息列表"},m.createElement("div",{className:mr},x.ZP.canOperateOrganizationManageAttributesCreate()?m.createElement(v.Z,{type:"primary",onClick:function(){return e.onChangeType($r,Gr)}},"新增业务信息"):m.createElement(Un.Z,null)))})),(0,p.Z)((0,c.Z)(e),"renderDetail",(function(){var t=e.props.businessTag;return Object.keys(t).length<=0?e.renderEmpty():e.renderContent()})),(0,p.Z)((0,c.Z)(e),"renderUpdate",(function(){var t=e.props,n=t.businessTag,r=t.dispatch,a=t.departmentId,o=e.state.operateType;return m.createElement(Hr,{data:n,dispatch:r,operateType:o,departmentId:a,onChangeType:function(){return e.onChangeType(Jr)},getBusinessTag:e.getBusinessTag})})),e.state={pageType:10,operateType:10},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.getBusinessTag()}},{key:"componentDidUpdate",value:function(e){var t=b().get(e,"departmentId",void 0),n=b().get(this.props,"departmentId",void 0),r=b().get(e,"activeKey",void 0),a=b().get(this.props,"activeKey",void 0);t===n&&r===a||this.getBusinessTag()}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"organizationBusiness/resetBusiness",payload:{}})}},{key:"render",value:function(){var e=this.state.pageType,t=this.props.departmentId;return t&&"undefined"!==t?e===Jr?this.renderDetail():e===$r?this.renderUpdate():m.createElement(fe,null):m.createElement(fe,null)}}]),n}(m.Component);Wr.propTypes={businessTag:I().object,dispatch:I().func,departmentId:I().string},Wr.defaultProps={businessTag:{},dispatch:function(){},departmentId:""};var Qr=(0,C.connect)((function(e){return{businessTag:e.organizationBusiness.businessTag}}))(Wr),Xr="Rqd4ezjFdApNUHliFZxK",ea="FqqVWQ94hkyQvohatz1R",ta="RS3Rk2eJNhM_OiZ4_d_t",na="cyVHpBzM2Yk25krbZQvI";function ra(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var aa=dr.Z.Panel,oa=20,ia=20,ca=function(e){(0,s.Z)(n,e);var t=ra(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"onUpdate",(function(){var t=e.props.onChangeType;t&&t(oa,ia)})),(0,p.Z)((0,c.Z)(e),"renderSystemAttributes",(function(){var t=e.props.data,n=void 0===t?{}:t,r=n.platform_list,a=void 0===r?[]:r,o=n.suppliers_with_platform,i=void 0===o?[]:o,c=n.city_list,s=void 0===c?[]:c,l=n.industry_list,u=void 0===l?[]:l,p=m.createElement("div",null,a.map((function(e,t){var n=Object.values(e)[0];return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},n)}))),d=m.createElement("div",null,i.map((function(e,t){var n=Object.values(e)[0],r=Te.P6.dotOptimal(e,"platform_info.platform_name",void 0);return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},r?"".concat(n,"（").concat(r,"）"):n)}))),f=m.createElement("div",null,s.map((function(e,t){var n=Object.values(e)[0];return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},n)}))),v=m.createElement("div",null,u.map((function(e,t){var n=Object.values(e)[0];return m.createElement(An.Z,{key:t,style:{margin:"4px",background:"#F5F5F5"}},n)})));return m.createElement(dr.Z,{bordered:!1,expandIconPosition:"right",className:Xr,activeKey:["1","2","3","4"]},m.createElement(aa,{key:"4",header:"场景",className:na,showArrow:!1},v),m.createElement(aa,{key:"1",header:"平台",className:na,showArrow:!1},p),m.createElement(aa,{key:"2",header:"供应商",className:na,showArrow:!1},d),m.createElement(aa,{key:"3",header:"城市",className:na,showArrow:!1},f))})),(0,p.Z)((0,c.Z)(e),"renderContent",(function(){var t=x.ZP.canOperateOrganizationManageDataPermissionUpdate()?m.createElement("a",{type:"primary",onClick:e.onUpdate},"编辑"):null;return m.createElement(_.IT,{title:"数据权限范围",titleExt:t},e.renderSystemAttributes())})),e}return(0,i.Z)(n,[{key:"render",value:function(){return this.renderContent()}}]),n}(m.Component);ca.propTypes={data:I().object,onChangeType:I().func},ca.defaultProps={data:{},onChangeType:function(){}};var sa=ca;function la(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?la(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):la(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pa=10,da=10,fa=20;var ma=(0,C.connect)((function(e){return{allPlatformList:e.organizationBusiness.allPlatformList}}))((function(e){var t=T.Z.useForm(),n=(0,xe.Z)(t,1)[0],r=(0,m.useState)(!1),a=(0,xe.Z)(r,2),o=a[0],i=a[1],c=(0,m.useState)(!1),s=(0,xe.Z)(c,2),l=s[0],u=s[1],p=(0,m.useState)(!1),d=(0,xe.Z)(p,2),y=d[0],h=d[1],b=(0,m.useState)(!1),C=(0,xe.Z)(b,2),Z=C[0],k=C[1],D=e.data,E=void 0===D?{}:D,I=e.allPlatformList,O=void 0===I?{}:I,S=e.dispatch,w=e.initPlatformList,P=void 0===w?[]:w,x=E.platform_codes,j=void 0===x?[]:x,F=E.supplier_ids,U=void 0===F?[]:F,L=E.city_codes,M=void 0===L?[]:L,V=E.industry_codes,B=void 0===V?[]:V,N=(0,m.useState)(B),Y=(0,xe.Z)(N,2),K=Y[0],H=Y[1];(0,m.useEffect)((function(){S({type:"organizationBusiness/getAllPlatformList",payload:{}})}),[S]),(0,m.useEffect)((function(){n.validateFields(["platformCodes","supplierIds","cityCodes"])}),[n,o]),(0,m.useEffect)((function(){var e=function(){var e=(0,R.Z)(A().mark((function e(){var t;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S({type:"organizationBusiness/gainDataPermissionValidator"});case 2:t=e.sent,k(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var q,J,$,G,W,Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=O.data,r=void 0===t?[]:t;H(e);var a=[];if(Array.isArray(e)&&e.length>0){var o=n.getFieldValue("platformCodes"),i=r.filter((function(t){return e.includes(t.industry_code)}));a=o.filter((function(e){return i.find((function(t){return t.platform_code===e}))}))}n.setFieldsValue({platformCodes:a})},X=function(e){if(e&&Array.isArray(e)&&1===e.length&&e.filter((function(e){return"zongbu"===e})).length>0||e&&"zongbu"===e)return u(!0),h(!0),i(!1),void n.setFieldsValue({supplierIds:void 0,cityCodes:void 0});h(!1),u(!1);var t=n.getFieldValue("cityCodes"),r=n.getFieldValue("supplierIds");f().existy(e)&&f().not.empty(e)||f().existy(t)&&f().not.empty(t)||f().existy(r)&&f().not.empty(r)?i(!0):i(!1)},ee=function(e){if(l)i(!1);else{var t=n.getFieldValue("platformCodes"),r=n.getFieldValue("cityCodes");f().existy(e)&&f().not.empty(e)||f().existy(t)&&f().not.empty(t)||f().existy(r)&&f().not.empty(r)?i(!0):i(!1)}},te=function(e){if(l)i(!1);else{var t=n.getFieldValue("platformCodes"),r=n.getFieldValue("supplierIds");f().existy(e)&&f().not.empty(e)||f().existy(t)&&f().not.empty(t)||f().existy(r)&&f().not.empty(r)?i(!0):i(!1)}},ne=function(e){e.zh_message&&g.ZP.error(e.zh_message)},re=function(){var t=e.onChangeType;t&&t(pa),e.onSuccessCallback&&e.onSuccessCallback()},ae=function(){var t=e.onChangeType;t&&t(pa)};return m.createElement(T.Z,{form:n,initialValues:{platformCodes:j,supplierIds:U,cityCodes:M,scense:B},onFinish:function(t){var n=e.departmentId,r=e.operateType,a=ua(ua({departmentId:n,type:ge.TIo.four},t),{},{onSuccessCallback:re,onFailureCallback:ne});r===da&&S({type:"organizationBusiness/createBusinessTag",payload:a}),r===fa&&S({type:"organizationBusiness/updateBusinessTag",payload:a})}},m.createElement(_.IT,{title:"数据权限范围"},(q=e.teamAttrs,J=Boolean("".concat(q[0])==="".concat(ge.TDR.departmentCoach)),$={labelCol:{span:2},wrapperCol:{span:16}},G=Array.isArray(P)&&P.length>0?P.map((function(e){var t=Object.keys(e),n=Object.values(e);return{platform_code:t[0],name:n[0]}})):[],W=[m.createElement(T.Z.Item,(0,z.Z)({name:"scense",label:"场景"},$,{dependencies:["platformCodes"],rules:[function(e){var t=e.getFieldValue;return{validator:function(e,n){return!n&&t("platformCodes")?Promise.reject("请选择场景"):Promise.resolve()}}}]}),m.createElement(ze.UU,{mode:"multiple",showArrow:!0,disabled:y,enumeratedType:"subjectScense",onChange:Q,style:{width:"50%"}})),m.createElement(T.Z.Item,(0,z.Z)({name:"platformCodes",label:"平台"},$,{rules:[{required:o,message:"请选择平台"}]}),m.createElement(wr,{showSearch:!0,allowClear:!(Z&&J),mode:J&&Z?"":"multiple",optionFilterProp:"children",onChange:X,scense:K,initValues:G})),m.createElement(T.Z.Item,(0,z.Z)({name:"supplierIds",label:"供应商"},$,{rules:[{required:o,message:"请选择供应商"}]}),m.createElement(zr,{showSearch:!0,allowClear:!(Z&&J),mode:J&&Z?"":"multiple",optionFilterProp:"children",onChange:ee,disabled:y})),m.createElement(T.Z.Item,(0,z.Z)({name:"cityCodes",label:"城市"},$,{rules:[{required:o,message:"请选择城市"}]}),m.createElement(Ar,{showSearch:!0,enableSelectAll:!0,allowClear:!0,mode:"multiple",showArrow:!0,optionFilterProp:"children",onChange:te,disabled:y}))],m.createElement(_.Fp,{items:W,cols:1})),m.createElement("div",{className:ta},m.createElement(v.Z,{style:{marginRight:20},onClick:ae},"取消"),m.createElement(v.Z,{type:"primary",htmlType:"submit"},"提交"))))})),va=10,ga=20,ya=10;var ha=(0,C.connect)((function(e){return{businessTag:e.organizationBusiness.businessTag}}))((function(e){var t=(0,m.useState)(va),n=(0,xe.Z)(t,2),r=n[0],a=n[1],o=(0,m.useState)(ya),i=(0,xe.Z)(o,2),c=i[0],s=i[1],l=e.dispatch,u=e.departmentId,p=e.activeKey,d=function(){a(va),s(ya)};(0,m.useEffect)((function(){return d(),l({type:"organizationBusiness/getBusiness",payload:{departmentId:u}}),function(){d(),l({type:"organizationBusiness/resetBusiness",payload:{}})}}),[l,u,p]);var f=function(e,t){a(e),s(t)},g=function(){l({type:"organizationBusiness/getBusiness",payload:{departmentId:u}})};return u&&"undefined"!==u?r===va?function(){var t=e.businessTag.biz_data_business_info||{};return Object.keys(t).length<=0?m.createElement(_.IT,{title:"数据权限范围"},m.createElement("div",{className:ea},x.ZP.canOperateOrganizationManageDataPermissionCreate()?m.createElement(v.Z,{type:"primary",onClick:function(){return f(ga,ya)}},"新增数据权限范围"):m.createElement(Un.Z,null))):function(){var t=e.businessTag,n=(void 0===t?{}:t).biz_data_business_info||{};return m.createElement(sa,{data:n,onChangeType:f})}()}():r===ga?function(){var t=e.businessTag,n=t.biz_data_business||{},r=t.team_attrs||[],a=Te.P6.dotOptimal(t,"biz_data_business_info.platform_list",[]);return m.createElement(ma,{data:n,teamAttrs:r,dispatch:l,operateType:c,departmentId:u,initPlatformList:a,onChangeType:function(){return f(va)},onSuccessCallback:g})}():m.createElement(fe,null):m.createElement(fe,null)}));function ba(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ca=le.Z.TabPane,Za={department:"".concat(ge.TIo.one),staffs:"".concat(ge.TIo.two),attributes:"".concat(ge.TIo.three),dataPermission:"".concat(ge.TIo.four)},_a=function(e){(0,s.Z)(n,e);var t=ba(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"onSelectDepartment",(function(e,t,n){var a=r.props.onSelectDepartment;a&&a(e,t,n)})),(0,p.Z)((0,c.Z)(r),"onChange",(function(e){r.setState({activeKey:e})})),(0,p.Z)((0,c.Z)(r),"onChangeCheckResult",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0;r.setState({isCheckResultVisible:e||!1,checkMessage:n,messageTitle:a}),r.onSubmitDepartment=t})),r.state={activeKey:Za.department,departmentId:e.departmentId,isCheckResultVisible:!1,checkMessage:[],messageTitle:""},r.onSubmitDepartment=void 0,r}return(0,i.Z)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.activeKey,r=t.isCheckResultVisible,a=t.checkMessage,o=t.messageTitle,i=this.props,c=i.departmentName,s=i.departmentId;return m.createElement("div",null,c&&"undefined"!==c?m.createElement("div",{style:{fontSize:"24px",fontWeight:"bold"}},c):null,s&&"undefined"!==s?m.createElement(le.Z,{activeKey:n,onChange:this.onChange},m.createElement(Ca,{tab:"部门信息",key:Za.department},m.createElement(qt,{departmentId:s,departmentName:c,onSelectDepartment:this.onSelectDepartment,onChangeCheckResult:this.onChangeCheckResult})),m.createElement(Ca,{tab:"岗位编制",key:Za.staffs},m.createElement(pr,{departmentId:s,activeKey:n,onChangeCheckResult:this.onChangeCheckResult})),x.ZP.canOperateOrganizationManageDepartmentBusiness()&&m.createElement(Ca,{tab:"业务信息",key:Za.attributes},m.createElement(Qr,{departmentId:s,activeKey:n})),x.ZP.canOperateOrganizationManageDepartmentBusiness()&&m.createElement(Ca,{tab:"数据权限范围",key:Za.dataPermission},m.createElement(ha,{departmentId:s,activeKey:n}))):m.createElement(fe,null),m.createElement(en,{visible:r,onChangeCheckResult:this.onChangeCheckResult,onSubmitDepartment:(0,R.Z)(A().mark((function t(){return A().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onSubmitDepartment();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),checkMessage:a,messageTitle:o}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.departmentId,r=e.departmentId;return n!==r?{activeKey:Za.department,departmentId:r}:null}}]),n}(m.Component);_a.protoTypes={departmentId:I().string,departmentName:I().string},_a.defaultProps={departmentId:"",departmentName:""};var ka=_a;function Da(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var a=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var Ea=function(e){(0,s.Z)(n,e);var t=Da(n);function n(e){var r;return(0,o.Z)(this,n),r=t.call(this,e),(0,p.Z)((0,c.Z)(r),"onSelectDepartment",(function(e,t,n){r.setState({id:e,departmentName:t,isJump:n})})),r.state={id:void 0,departmentName:void 0,isJump:!1},r}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.state,t=e.id,n=e.departmentName,o=e.isJump,i=[];return f().existy(t)&&f().not.empty(t)&&(i=[t]),m.createElement(r.Z,{gutter:[16,16],className:X,style:{overflow:"auto"}},m.createElement(a.Z,{span:6,className:ee},m.createElement(se,{onSelectOrganization:this.onSelectDepartment,selectedIds:i,isJump:o})),t?m.createElement(a.Z,{span:18,className:te},m.createElement(ka,{departmentName:n,onSelectDepartment:this.onSelectDepartment,departmentId:t})):null)}}]),n}(m.Component),Ia=Ea}}]);