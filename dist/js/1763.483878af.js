"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[1763],{81763:function(e,t,n){n.r(t),n.d(t,{default:function(){return V}});n(20186);var a=n(75385),r=n(71002),o=(n(55295),n(69713)),c=n(93433),i=(n(21316),n(75443)),s=n(15671),l=n(43144),p=n(97326),u=n(60136),d=n(82963),m=n(61120),f=n(4942),h=n(94315),y=n.n(h),v=n(93517),g=n.n(v),b=n(30381),E=n.n(b),O=n(55609),D=n(45697),P=n.n(D),x=n(67294),Z=n(96036),I=n(80385),S=n(97116),w=n(23217),A=(n(9070),n(20924)),k=(n(54071),n(14072)),T=(n(29093),n(16317)),C=n(88144),U=n(97418);function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,m.Z)(e);if(t){var r=(0,m.Z)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,d.Z)(this,n)}}var M=T.Z.Option,N=k.Z.RangePicker,W=function(e){(0,u.Z)(n,e);var t=F(n);function n(){var e;(0,s.Z)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r)),(0,f.Z)((0,p.Z)(e),"onHookForm",(function(t){e.form=t})),(0,f.Z)((0,p.Z)(e),"onReset",(function(){var t=e.props.onSearch;t&&t({page:1,limit:30})})),(0,f.Z)((0,p.Z)(e),"onNormalizeThemeTags",(function(e){var t=e,n=t.length,a=n>=1?t[n-1].replace(/\s+/g,""):"";return""===a?t.pop():t[n-1]=a,t})),(0,f.Z)((0,p.Z)(e),"onSearch",(function(t){var n=e.props.onSearch,a=t.state,r=t.examineFlowId,o=t.applyAccountId,c=t.orderId,i=t.paidState,s=t.submitAt,l=t.paymentAt,p=t.approvalType,u=t.themeTags,d=t.actualApplyAccountId,m=g().has(s,"0")?E()(s[0]).format("YYYYMMDD"):"",f=g().has(s,"0")?E()(s[1]).format("YYYYMMDD"):"",h=g().has(l,"0")?E()(l[0]).format("YYYYMMDD"):"",y=g().has(l,"0")?E()(l[1]).format("YYYYMMDD"):"",v={state:a,examineFlowId:r,applyAccountId:o,orderId:c?c.replace(/\s+/g,""):"",paidState:i,submitStartAt:m,submitEndAt:f,paidStartAt:h,paidEndAt:y,approvalType:p,themeTags:u,page:1,limit:30,actualApplyAccountId:d};n&&n(v)})),(0,f.Z)((0,p.Z)(e),"render",(function(){var t=[{label:"提报日期",form:function(e){return e.getFieldDecorator("submitAt",{initialValue:null})(x.createElement(N,{format:"YYYY-MM-DD",disabledDate:function(e){return e&&e>new Date}}))}},{label:"审批类型",form:function(e){return e.getFieldDecorator("approvalType",{initialValue:void 0})(x.createElement(T.Z,{optionFilterProp:"children",showSearch:!0,placeholder:"请选择审批类型",allowClear:!0},U.fe.map((function(e){return x.createElement(M,{value:e.key},e.title)}))))}},{label:"主题标签",form:function(t){return t.getFieldDecorator("themeTags",{initialValue:[],normalize:e.onNormalizeThemeTags})(x.createElement(T.Z,{placeholder:"请输入主题标签",mode:"tags",notFoundContent:"",tokenSeparators:[",","，"],allowClear:!0}))}},{label:"审批流",form:function(t){return t.getFieldDecorator("examineFlowId",{initialValue:void 0})(x.createElement(C.G0,{showSearch:!0,allowClear:!0,selectedTabKey:e.props.selectedTabKey,placeholder:"请选择审批流"}))}},{label:"审批单号",form:function(e){return e.getFieldDecorator("orderId",{initialValue:void 0})(x.createElement(A.Z,{placeholder:"请输入审批单号"}))}},{label:"流程状态",form:function(e){return e.getFieldDecorator("state",{initialValue:void 0})(x.createElement(T.Z,{allowClear:!0,placeholder:"请选择流程状态"},x.createElement(M,{value:"".concat(I.DU5.processing)},I.DU5.description(I.DU5.processing)),x.createElement(M,{value:"".concat(I.DU5.finish)},I.DU5.description(I.DU5.finish)),x.createElement(M,{value:"".concat(I.DU5.close)},I.DU5.description(I.DU5.close))))}},{label:"实际申请人",form:function(e){return e.getFieldDecorator("actualApplyAccountId",{initialValue:void 0})(x.createElement(C.Di,{allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"请选择申请人"}))}}];Number(e.props.selectedTabKey)!==I.WPs.penddingSubmit&&t.unshift({label:"申请人",form:function(e){return e.getFieldDecorator("applyAccountId",{initialValue:void 0})(x.createElement(C.Di,{allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"请选择申请人"}))}});var n={items:t,onReset:e.onReset,onSearch:e.onSearch,onHookForm:e.onHookForm};return x.createElement(Z.IT,null,x.createElement(Z.yL,n))})),e}return(0,l.Z)(n,[{key:"componentDidUpdate",value:function(e){e.selectedTabKey!==this.props.selectedTabKey&&this.form&&this.form.resetFields()}}]),n}(x.Component);(0,f.Z)(W,"propTypes",{onSearch:P().func.isRequired,selectedTabKey:P().string}),(0,f.Z)(W,"defaultProps",{onSearch:function(){},selectedTabKey:""});var Y=W,R="LXspCRT0kubl7rbP9Hb9",K="MBZRV8SSjmDvWIEGLQ3p",q="b7kyEt4k9IvIzvgMFk_S",j="LGlgmoky_t4pORrEOA2w";function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,m.Z)(e);if(t){var r=(0,m.Z)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,d.Z)(this,n)}}var L=function(e){(0,u.Z)(n,e);var t=_(n);function n(e){var l;(0,s.Z)(this,n),l=t.call(this),(0,f.Z)((0,p.Z)(l),"onSearch",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=l.state.selectedTabKey;l.private.searchParams=z({type:I.z_o.transactional},e),(y().not.existy(l.private.searchParams.page)||y().empty(l.private.searchParams.page))&&(l.private.searchParams.page=1),(y().not.existy(l.private.searchParams.limit)||y().empty(l.private.searchParams.limit))&&(l.private.searchParams.limit=30),Number(t)===I.WPs.penddingSubmit&&(l.private.searchParams.applyAccountId=S.Iq.account.id,l.private.searchParams.flag=void 0,l.private.searchParams.state=[I.DU5.pendding]),Number(t)===I.WPs.penddingVerify&&(l.private.searchParams.currentPendingAccount=S.Iq.account.id,l.private.searchParams.flag=void 0,l.private.searchParams.state=[I.DU5.processing]),Number(t)===I.WPs.submit&&(l.private.searchParams.applyAccountId=S.Iq.account.id,l.private.searchParams.flag=void 0,(y().not.existy(e.state)||y().empty(e.state))&&(l.private.searchParams.state=[I.DU5.processing,I.DU5.finish,I.DU5.close])),Number(t)===I.WPs.verify&&(l.private.searchParams.flowAccountId=S.Iq.account.id,l.private.searchParams.flag=void 0,(y().not.existy(e.state)||y().empty(e.state))&&(l.private.searchParams.state=[I.DU5.processing,I.DU5.finish,I.DU5.close])),Number(t)===I.WPs.copyGive&&(l.private.searchParams.cc_accounts=[S.Iq.account.id],l.private.searchParams.flag=void 0,(y().not.existy(e.state)||y().empty(e.state))&&(l.private.searchParams.state=[I.DU5.processing,I.DU5.finish,I.DU5.close])),Number(t)===I.WPs.all&&(l.private.searchParams.flag=!0,(y().not.existy(e.state)||y().empty(e.state))&&(l.private.searchParams.state=[I.DU5.processing,I.DU5.finish,I.DU5.close])),l.setState({loading:!0}),l.props.dispatch({type:"expenseExamineOrder/fetchExamineOrders",payload:z(z({},l.private.searchParams),{},{setLoading:function(){return l.setState({loading:!1})}})})})),(0,f.Z)((0,p.Z)(l),"onShowSizeChange",(function(e,t){var n=l.private.searchParams;n.page=e,n.limit=t,l.onSearch(n,!0)})),(0,f.Z)((0,p.Z)(l),"onChangePage",(function(e,t){var n=l.private.searchParams;n.page=e,n.limit=t,l.onSearch(n,!0)})),(0,f.Z)((0,p.Z)(l),"onDelete",(function(e){var t=l.private.searchParams;l.props.dispatch({type:"expenseExamineOrder/deleteExamineOrder",payload:{id:e,onSuccessCallback:function(){l.onSearch(t)}}})})),(0,f.Z)((0,p.Z)(l),"onRecall",(function(e){var t=l.private.searchParams;l.props.dispatch({type:"expenseExamineOrder/recallExamineOrder",payload:{id:e,onSuccessCallback:function(){l.onSearch(t)}}})})),(0,f.Z)((0,p.Z)(l),"onClose",(function(e){var t=l.private.searchParams;l.props.dispatch({type:"expenseExamineOrder/closeExamineOrder",payload:{id:e,onSuccessCallback:function(){l.onSearch(t)}}})})),(0,f.Z)((0,p.Z)(l),"onSelectTab",(function(e){l.props.dispatch({type:"expenseExamineOrder/resetExamineOrders"}),l.setState({selectedTabKey:e},(function(){return l.onSearch()}))})),(0,f.Z)((0,p.Z)(l),"renderTabs",(function(){var e=l.props.location.query.selectedTabKey,t=[];S.Iq.canOperate(w.Z.OperateExpenseManageOAOrderReported)&&t.push({title:"待提报",content:l.renderTabContent(I.WPs.penddingSubmit),key:I.WPs.penddingSubmit}),S.Iq.canOperate(w.Z.OperateExpenseManageOAOrderStayDo)&&t.push({title:"我待办的",content:l.renderTabContent(I.WPs.penddingVerify),key:I.WPs.penddingVerify}),S.Iq.canOperate(w.Z.OperateExpenseManageOAOrderSubmission)&&t.push({title:"我提报的",content:l.renderTabContent(I.WPs.submit),key:I.WPs.submit}),S.Iq.canOperate(w.Z.OperateExpenseManageOAOrderHandle)&&t.push({title:"我经手的",content:l.renderTabContent(I.WPs.verify),key:I.WPs.verify}),S.Iq.canOperate(w.Z.OperateExpenseManageOAOrderCopyGive)&&t.push({title:"抄送我的",content:l.renderTabContent(I.WPs.copyGive),key:I.WPs.copyGive}),S.Iq.canOperate(w.Z.OperateExpenseManageOAOrderAll)&&t.push({title:"全部",content:l.renderTabContent(I.WPs.all),key:I.WPs.all});var n=e||"".concat(I.WPs.penddingSubmit);return x.createElement(Z.DF,{items:t,defaultActiveKey:n,onChange:l.onSelectTab})})),(0,f.Z)((0,p.Z)(l),"renderTabContent",(function(e){return x.createElement("div",null,x.createElement(Y,{onRef:l.onRef,selectedTabKey:l.state.selectedTabKey,onSearch:l.onSearch}),l.renderContent(e))})),(0,f.Z)((0,p.Z)(l),"renderOperation",(function(e,t,n){var a="/Code/Manage/OAOrder"===g().get(l.props,"location.privateLocation.pathname",void 0),r=n.id,o=n.applyAccountInfo.id,c=n.paidState,s=n.currentFlowNode,p=n.applicationOrderType,u=[],d=!1,m=!1,f=!1,h=!1;if(n.state===I.DU5.pendding&&o===S.Iq.account.id&&(d=!0,m=!0),n.state!==I.DU5.pendding&&n.state!==I.DU5.processing||void 0!==n.currentFlowNodeInfo.id||o!==S.Iq.account.id||(d=!0),n.state===I.DU5.processing&&o===S.Iq.account.id&&c===I.$ym.waiting&&void 0!==s&&(f=!0),n.bizState!==I.iH$.reject&&n.bizState!==I.iH$.recall||n.state!==I.DU5.processing||o!==S.Iq.account.id||void 0!==s||p===I.ZBL.externalApproval||(h=!0),!0===d&&S.Iq.canOperate(w.Z.OperateExpenseManageOAOrderEditButton)){if(p!==U.z0.getDepartmentPostKey()){var y="/#/Expense/Manage/ExamineOrder/Form?orderId=".concat(r,"&approvalKey=").concat(t,"&isShowCode=").concat(a);u.push(x.createElement("a",{key:"update",href:y,target:"_blank",rel:"noopener noreferrer",className:R},"编辑"))}}else u.push(x.createElement("a",{key:"detail",href:"javascript:void(window.open('/#/Expense/Manage/ExamineOrder/Detail?orderId=".concat(r,"&approvalKey=").concat(t,"'));"),rel:"noopener noreferrer",className:R},"查看"));if(m){u.push(x.createElement(i.Z,{key:"delete",title:"确认删除？",onConfirm:function(){l.onDelete(r)}},x.createElement("a",{className:R},"删除")))}return f&&u.push(x.createElement(i.Z,{key:"recall",title:"是否确认撤回审批单",onConfirm:function(){l.onRecall(r)}},x.createElement("a",{className:R},"撤回"))),h&&u.push(x.createElement(i.Z,{key:"close",title:"是否确认关闭审批单",onConfirm:function(){l.onClose(r)}},x.createElement("a",{className:R},"关闭"))),u})),(0,f.Z)((0,p.Z)(l),"renderContent",(function(e){var t=l.props.examineOrdersData,n=g().get(t,"meta.count",0),i=g().get(t,"data",[]),s=l.state,p=s.loading,u=s.selectedTabKey,d=[{title:"审批单号",dataIndex:"id",key:"id",width:100,fixed:"left",render:function(e){return x.createElement("div",{className:K},e)}},{title:"主题标签",dataIndex:"themeLabelList",width:100,fixed:"left",render:function(e,t){var n=e||[],a=g().get(t,"pluginExtraMeta.theme_label_list",[]),r=[].concat((0,c.Z)(n),(0,c.Z)(a));return y().not.empty(r)&&r.length>3?x.createElement(o.Z,{title:r.map((function(e){return e})).join(" 、 ")},x.createElement("div",{className:K},g().get(r,"0"),"、",g().get(r,"1"),"、",g().get(r,"2"),"...")):y().not.empty(r)&&r.length<=3?x.createElement("div",{className:K},r.map((function(e){return e})).join("、")):"--"}},{title:"申请人",dataIndex:"applyAccountInfo",key:"applyAccountInfo",width:100,render:function(e){return y().existy(e)&&y().not.empty(e)?e.state===I.m3m.off?e.name?"".concat(e.name,"(").concat(I.m3m.description(e.state),")"):"--":e.name?e.name:"--":"--"}},{title:"实际申请人",dataIndex:"actualApplyAccountInfo",key:"actualApplyAccountInfo",width:100,render:function(e){return y().existy(e)&&y().not.empty(e)?e.state===I.m3m.off?e.name?"".concat(e.name,"(").concat(I.m3m.description(e.state),")"):"--":e.name?e.name:"--":"--"}},{title:"实际申请部门",dataIndex:["actualApplyAccountDepartmentInfo","name"],key:"actualApplyAccountDepartmentInfo.name",width:100,render:function(e){return e||"--"}},{title:"提报日期",dataIndex:"submitAt",key:"submitAt",width:150,render:function(e){return e?E()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"审批流",dataIndex:"flowInfo",key:"flowInfo",width:100,render:function(e){return e?x.createElement("div",{className:K},e.name):"--"}},{title:"审批类型",dataIndex:"applicationOrderType",key:"applicationOrderType",width:100,render:function(e){return U.z0.titleByKey(e)}},{title:"流程状态",dataIndex:"state",key:"state",width:100,render:function(e){return I.DU5.description(e)}},{title:"当前节点",dataIndex:"currentFlowNodeInfo",key:"currentFlowNodeInfo",width:120,render:function(e,t){var n=t.currentPendingAccountList,a=t.state,c=t.currentFlowNode,i=t.applyAccountInfo;if(e&&e.name&&y().existy(c)){var s=e.postList,l=void 0===s?[]:s,p=e.accountList,u=void 0===p?[]:p,d=[],m=[],f=[];n.forEach((function(e){var t=e;void 0!==n.find((function(t){return t.id===e.id}))?t.isHeight=!0:t.isHeight=!1,f[f.length]=t})),u.forEach((function(e){var t=e;void 0!==n.find((function(t){return t.id===e.id}))?t.isHeight=!0:t.isHeight=!1,d.push(t)})),l&&"object"===(0,r.Z)(l)&&Array===l.constructor&&l.forEach((function(e){var t=e;n.some((function(e){return(t.account_info_list||[]).some((function(t){return t._id===e.id||e._id}))}))?t.isHeight=!0:t.isHeight=!1,m.push(t)}));var h=x.createElement("span",null,e.name,"(",x.createElement("span",null,m.map((function(e,t){var n=e.account_info_list||[];return x.createElement("span",{className:!0===e.isHeight?j:"",key:"postData".concat(t)},e.post_name,"(",n.reduce((function(e,t,n){return 0===n?t.name:"".concat(e,", ").concat(t.name)}),""),")",t!==m.length-1?" , ":null)}))),m&&d&&m.length>0&&d.length>0?", ":"",x.createElement("span",null,d.map((function(e,t){return x.createElement("span",{className:!0===e.isHeight?j:"",key:"accountData".concat(t)},e.name,t!==d.length-1?" , ":null)}))),x.createElement("span",null,d.length<1&&m.length<1?f.map((function(e,t){return x.createElement("span",null,e.name,t!==f.length-1?" , ":null)})):""),")");return x.createElement(o.Z,{title:h},x.createElement("div",{className:"".concat(K," ").concat(q)},"".concat(e.name,"(").concat(y().not.empty(n)?n.reduce((function(e,t,n){return 0===n?t.name:"".concat(e,", ").concat(t.name)}),""):"",")").length>=10?"".concat("".concat(e.name,"(").concat(y().not.empty(n)?n.reduce((function(e,t,n){return 0===n?t.name:"".concat(e,", ").concat(t.name)}),""):"",")").substring(0,10),"..."):"".concat(e.name,"(").concat(y().not.empty(n)?n.reduce((function(e,t,n){return 0===n?t.name:"".concat(e,", ").concat(t.name)}),""):"",")")))}return y().not.existy(c)&&a===I.DU5.processing?"提报节点(".concat(i.name,")"):"--"}},{title:"操作",dataIndex:"operation",key:"operation",width:120,fixed:"right",render:function(t,n){return l.renderOperation(t,e,n)}}],m=l.private.searchParams,f=m.page,h={pageSize:m.limit||30,onChange:l.onChangePage,total:n,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],showQuickJumper:!0,onShowSizeChange:l.onShowSizeChange};f&&(h.current=f);var v="".concat(u)==="".concat(I.WPs.submit)?x.createElement("div",null,"组织管理申请单，请进入",x.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"#/Organization/Manage/Department"},"组织架构模块"),"修改"):null;return x.createElement(Z.IT,{title:"事务审批列表",titleExt:v},x.createElement(a.Z,{rowKey:function(e){return e.id},dataSource:i,columns:d,pagination:h,bordered:!0,loading:p,scroll:{x:"max-content",y:400}}))}));var u=e.location.query.selectedTabKey;return l.state={selectedTabKey:u||I.WPs.penddingSubmit,loading:!0},l.private={searchParams:{limit:30,page:1,applyAccountId:S.Iq.account.id,state:I.DU5.pendding,type:I.z_o.transactional}},l}return(0,l.Z)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.location.query.selectedTabKey;Number(t)===I.WPs.penddingVerify?this.onSearch():this.props.dispatch({type:"expenseExamineOrder/fetchExamineOrders",payload:z(z({},this.private.searchParams),{},{setLoading:function(){return e.setState({loading:!1})}})})}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"expenseExamineOrder/resetExamineOrders"})}},{key:"render",value:function(){return x.createElement("div",null,this.renderTabs())}}]),n}(x.Component);(0,f.Z)(L,"propTypes",{examineOrdersData:P().object}),(0,f.Z)(L,"defaultProps",{examineOrdersData:{}});var V=(0,O.connect)((function(e){return{examineOrdersData:e.expenseExamineOrder.examineOrdersData}}))(L)}}]);