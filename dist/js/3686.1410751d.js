"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[3686],{83686:function(e,n,t){t.r(n),t.d(n,{default:function(){return H}});t(52560);var i=t(71577),r=(t(13062),t(71230)),o=(t(89032),t(15746)),a=t(29439),c=t(94315),s=t.n(c),u=t(93517),l=t.n(u),d=t(55609),p=t(67294),f=(t(38252),t(91665)),m=(t(55295),t(69713)),h=t(93433),v=t(15671),y=t(43144),g=t(97326),C=t(60136),Z=t(82963),k=t(61120),E=t(4942),b=(t(19597),t(27279)),K=t(96486),P=t.n(K),O=t(45697),A=t.n(O),w=t(12546),M=t(80385),N=t(97116),S="Ikh7gVS_Vf6uAy4FLJKL",x="Ij8HN2MqKqd9OPHESoVb",I="CM45XGuYWQh4tw1qOW0I";function T(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,i=(0,k.Z)(e);if(n){var r=(0,k.Z)(this).constructor;t=Reflect.construct(i,arguments,r)}else t=i.apply(this,arguments);return(0,Z.Z)(this,t)}}var B=b.Z.Panel,R=function(e){(0,C.Z)(t,e);var n=T(t);function t(e){var i;return(0,v.Z)(this,t),i=n.call(this,e),(0,E.Z)((0,g.Z)(i),"onClickNodes",(function(e,n){var t=i.private.dispatch,r=i.state.stateCheckedKeys,o=i.props,c=o.id,s=o.permission,u=i.getModulesKey(n),l=(0,a.Z)(u,2),d=l[0],p=l[1],f=[];n.checked?(f=[].concat((0,h.Z)(r),(0,h.Z)(p)),i.permissionKeys=[].concat((0,h.Z)(i.permissionKeys),(0,h.Z)(d))):(f=r.filter((function(e){return p.every((function(n){return n!==e}))})),i.permissionKeys=i.permissionKeys.filter((function(e){return d.every((function(n){return n!==e}))}))),i.setState({stateCheckedKeys:f});var m={};s.forEach((function(e){m[e.id]=i.permissionKeys.includes(e.id)?1:0})),i.permissionKeys.forEach((function(e){m[e]=1})),t({type:"adminManage/updateSystemPermission",payload:{roleId:c,permission:m}})})),(0,E.Z)((0,g.Z)(i),"onChangeCollapse",(function(e){var n=s().not.empty(e),t=i.props,r=t.id,o=t.onChangePannelActive;o&&o(r,n)})),(0,E.Z)((0,g.Z)(i),"getModulesKey",(function(e){if(!N.P6.dotOptimal(e,"node.children",void 0))return[N.P6.dotOptimal(e,"node.modules",[]),[N.P6.dotOptimal(e,"node.key","")]];var n=N.P6.dotOptimal(e,"node.modules",[]),t=[N.P6.dotOptimal(e,"node.key","")];return e.node.children.forEach((function(e){n=n.concat(i.getChildrenModules(e)),t=t.concat(i.getChildrenKeys(e))})),[n,t]})),(0,E.Z)((0,g.Z)(i),"getChildrenModules",(function(e){var n=N.P6.dotOptimal(e,"modules",[]);if(!N.P6.dotOptimal(e,"children"))return n;var t=n;return e.children.forEach((function(e){t=t.concat(i.getChildrenModules(e))})),t})),(0,E.Z)((0,g.Z)(i),"getChildrenKeys",(function(e){var n=[N.P6.dotOptimal(e,"key","")];if(!N.P6.dotOptimal(e,"children"))return n;var t=n;return e.children.forEach((function(e){t=t.concat(i.getChildrenKeys(e))})),t})),(0,E.Z)((0,g.Z)(i),"getCheckedKeys",(function(){var e=l().get(i.props,"permission",[]).filter((function(e){return e.state===M.s9G.access})).map((function(e){return e.id}))||[],n=[];return Object.values(w.xn).forEach((function(t){var i=l().get(t,"modules",[]).map((function(e){return e.id}));P().intersection(e,i).length===i.length&&s().not.empty(i)&&n.push("".concat(t.key))})),n})),(0,E.Z)((0,g.Z)(i),"renderAuthTree",(function(e){var n=l().get(i.props,"permission",[]).filter((function(e){return e.state===M.s9G.access})).map((function(e){return e.id}))||[];return e.map((function(e){if(!0!==N.By.isDebugMode()&&!0===e.node.onShowOnDebugMode)return"";if(!0===e.node.onShowOnBoss&&!1===M.qrW.isBossSystemIdentifier(N.vc.SystemIdentifier))return"";var t=l().get(e,"node.modules",[]).map((function(e){return e.id})),r=(P().intersection(n,t).length===t.length&&s().not.empty(t),p.createElement("div",null,p.createElement("span",null,e.node.description),p.createElement("br",null),l().get(e,"node.modules",[]).map((function(e){return p.createElement("p",{key:e.key,className:S},e.title)})))),o=l().get(e,"node.title");o=p.createElement(m.Z,{title:r},p.createElement("span",{className:x},o));var a=[];return e.leaf&&(a=i.renderAuthTree(e.leaf)),s().not.empty(a)?p.createElement(f.Z.TreeNode,{title:o,key:e.node.key,modules:t,disableCheckbox:!e.node.isVerifyAuth},a):p.createElement(f.Z.TreeNode,{title:o,key:e.node.key,modules:t,disableCheckbox:!e.node.isVerifyAuth})})).filter((function(e){return""!==e}))})),i.private={dispatch:e.dispatch},i.permissionKeys=N.P6.dotOptimal(e,"permission",[]).map((function(e){return e.id})),i.state={stateCheckedKeys:i.getCheckedKeys()||[]},i}return(0,y.Z)(t,[{key:"render",value:function(){var e=this.onChangeCollapse,n=this.props,t=n.name,i=n.isActive,r=this.state.stateCheckedKeys,o=i?t:null;return p.createElement(b.Z,{defaultActiveKey:o,className:I,onChange:e},p.createElement(B,{header:t,key:t},p.createElement(f.Z,{defaultExpandAll:!0,onCheck:this.onClickNodes,checkable:!0,checkStrictly:!0,checkedKeys:r},this.renderAuthTree(w.GZ))))}}]),t}(p.Component);(0,E.Z)(R,"propTypes",{id:A().number,name:A().string,isActive:A().bool,permission:A().array,onChangePannelActive:A().func}),(0,E.Z)(R,"defaultProps",{permission:[],isActive:!1,onChangePannelActive:function(){}});var V=R,q=t(96036),G=t(23217);var H=(0,d.connect)((function(e){return{permissions:e.adminManage.permissions}}))((function(e){var n=(0,p.useState)([]),t=(0,a.Z)(n,2),c=t[0],u=t[1];(0,p.useEffect)((function(){!function(){var e=[];(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(n){n.available===M.sHN.available&&(e[n.gid]=!1)})),u(e)}(l().get(e,"permissions",[]))}),[]);var d,f,m=function(e,n){s().not.existy(c[e])||(c[e]=n,u(c))};return p.createElement("div",null,p.createElement(q.IT,{title:"功能区",style:{background:"#ECECEC",padding:"30px"}},p.createElement(i.Z,{type:"primary",disabled:0===e.permissions.length,onClick:function(){var n=e.permissions,t=void 0===n?[]:n,i=["占位"],r=["角色"];Object.keys(G.Z).map((function(e){var n=G.Z[e],t="".concat(n.title,"(").concat(n.id,")");r.push(t.replace(/,/g,"/")),i.push(n.id)}));var o=[];t.map((function(e){if(1===e.available){var n=[e.name.replace(/,/g,"/")];i.map((function(t,i){if(0!==i){var r=e.permission_class;if(r&&r.length>0){var o=!0;return r.map((function(e){e.id===t&&(n.push("√"),o=!1)})),!!o&&n.push(void 0)}n.push(void 0)}})),o.push(n)}}));var a="";r.map((function(e,n){if(!e)return a+=",";n!==r.length-1?a+="".concat(e,","):a+=e})),a+="\n",o.map((function(e,n){e.map((function(n,t){if(!n)return a+=",";t!==e.length-1?a+="".concat(n,","):a+=n})),n!==o.length-1&&(a+="\n")}));var c="data:text/csv;charset=utf-8,".concat(encodeURIComponent(a)),s=window.document.createElement("a");s.href=c,s.download="角色与权限对照表.csv",window.document.body.appendChild(s),s.click(),window.document.body.removeChild(s)}},"下载角色与权限对照表")),(d=l().get(e,"permissions",[]).filter((function(e){return e.available===M.sHN.available})),f=e.dispatch,p.createElement(q.IT,{title:"模块权限信息",style:{background:"#ECECEC",padding:"30px"}},p.createElement(r.Z,{gutter:8},d.map((function(e){var n=e.name,t=e.gid,i=e.permission_class,r=s().truthy(c[t]);return p.createElement(o.Z,{span:8,key:t},p.createElement(V,{id:t,name:n,permission:i,dispatch:f,isActive:r,onChangePannelActive:m}))}))))))}))}}]);