"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[8819],{8819:function(e,t,n){n.r(t),n.d(t,{default:function(){return Y}});n(20186);var a=n(75385),o=(n(21316),n(75443)),r=(n(55295),n(69713)),c=(n(52560),n(71577)),i=(n(51838),n(48086)),l=n(15861),u=n(4942),s=(n(35668),n(86585)),d=n(29439),p=n(87757),f=n.n(p),m=n(67294),h=n(45697),v=n.n(h),y=n(93517),b=n.n(y),E=n(55609),Z=(n(98703),n(30381)),g=n.n(Z),A=n(96036),w=n(80385),k=n(45430),S=(n(29093),n(16317)),O=[S.Z.Option][0],P=function(e){var t=e.operations,n=e.allAccounts,a=e.onSearch,o=void 0===a?function(){}:a,r=(0,m.useState)(""),c=(0,d.Z)(r,2),i=c[0],l=c[1],u=[];n.forEach((function(e,t){var n=e.id+t;u.push(m.createElement(O,{value:e.id,key:n},e.phone,"(",e.name,")"))}));var p={items:[m.createElement(s.Z.Item,{label:"手机号",name:"account_id"},m.createElement(S.Z,{allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"请输入手机号",onChange:function(e){l(e)}},u))],operations:t,onReset:function(){l(""),o({account_id:void 0})},onSearch:function(){o({account_id:i})}};return m.createElement(A.IT,null,m.createElement(A.j6,p))};P.propTypes={allAccounts:v().array,operations:v().any},P.defaultProps={allAccounts:[],operations:void 0};var C=(0,E.connect)((function(e){return{allAccounts:e.system.allAccounts}}))(P),x=(n(52466),n(10642)),j=n(87462),_=n(96486),F=n.n(_),I=S.Z.Option,H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.visible,n=e.allAccounts,a=e.onSubmit,o=e.onHideModal,r=s.Z.useForm(),c=(0,d.Z)(r,1),i=c[0],u=(0,m.useState)([]),p=(0,d.Z)(u,2),h=p[0],v=p[1],y=function(){var e=(0,l.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.validateFields();case 2:t=e.sent,a(t.addPhone);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){o("add"),i.resetFields()},E=function(e){var t=n.filter((function(t){return t.phone===e})),a=h.concat(t),o=F().uniqWith(a,F().isEqual);v(o)},Z=function(){var e=[m.createElement(s.Z.Item,(0,j.Z)({label:"关联账号",name:"addPhone",rules:[{required:!0,message:"请输入关联账号"}]},{labelCol:{span:6},wrapperCol:{span:10}}),m.createElement(S.Z,{style:{width:"100%"},placeholder:"请输入关联账号",allowClear:!0,showSearch:!0,optionFilterProp:"children",filterOption:!1,mode:"multiple",showArrow:!0,onSearch:E},h.map((function(e,t){return m.createElement(I,{value:e.id,key:t},e.phone,"(",e.name,")")}))))];return m.createElement(x.Z,{title:"添加关联账号",visible:t,onOk:y,onCancel:b},m.createElement(s.Z,{layout:"horizontal",form:i},m.createElement(A.Fp,{items:e,cols:1})))};return m.createElement("div",null,Z())};H.propTypes={visible:v().bool,allAccounts:v().any,onSubmit:v().func,onHideModal:v().func},H.defaultProps={visible:!1,allAccounts:[],onSubmit:function(){},onHideModal:function(){}};var M=(0,E.connect)((function(e){return{allAccounts:e.system.allAccounts}}))(H),T=S.Z.Option,D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.visible,n=e.allAccounts,a=e.onSubmit,o=e.onHideModal,r=e.optionIds,c=s.Z.useForm(),i=(0,d.Z)(c,1),u=i[0],p=(0,m.useState)([]),h=(0,d.Z)(p,2),v=h[0],y=h[1],E=function(e){var t=n.filter((function(t){return t.phone===e})),a=v.concat(t);y(a)},Z=function(){var e=(0,l.Z)(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.validateFields();case 2:t=e.sent,a(t.addPhone);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){o("edit"),u.resetFields()},w=function(){var e=[],a=[];n.forEach((function(t){for(var n=b().get(r,"account_ids",[]),o=0;o<n.length;o+=1)n[o]===t.id&&(a.push(t.id),e.push(t))}));var o=F().uniqWith(e.concat(v),F().isEqual),c=[m.createElement(s.Z.Item,(0,j.Z)({label:"关联账号",name:"addPhone",rules:[{required:!0,message:"请输入关联账号"}],initialValue:a},{labelCol:{span:6},wrapperCol:{span:10}}),m.createElement(S.Z,{placeholder:"请输入关联账号",allowClear:!0,showSearch:!0,optionFilterProp:"children",mode:"multiple",showArrow:!0,onSearch:E},(v.length>0?o:e).map((function(e,t){var n=e.id+t;return m.createElement(T,{value:e.id,key:n},e.phone,"(",e.name,")")}))))];return m.createElement(x.Z,{title:"编辑关联账号",visible:t,onOk:Z,onCancel:g},m.createElement(s.Z,{layout:"horizontal",form:u},m.createElement(A.Fp,{items:c,cols:1})))};return m.createElement("div",null,w())};D.propTypes={allAccounts:v().any,visible:v().bool,optionIds:v().any},D.defaultProps={visible:!1,allAccounts:[],optionIds:void 0};var q=(0,E.connect)((function(e){return{allAccounts:e.system.allAccounts}}))(D),z="lvY35aj5fO5HgvMPNv9J";function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,u.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.allAccounts,n=e.accountsList,u=e.dispatch,p=s.Z.useForm(),h=(0,d.Z)(p,1),v=h[0],y=(0,m.useState)(""),E=(0,d.Z)(y,2),Z=E[0],S=E[1],O=(0,m.useState)({}),P=(0,d.Z)(O,2),x=P[0],j=P[1],_=(0,m.useState)(!1),F=(0,d.Z)(_,2),I=F[0],H=F[1],T=(0,m.useState)({page:1,limit:10}),D=(0,d.Z)(T,2),L=D[0],B=D[1];(0,m.useEffect)((function(){u({type:"system/getAccountsListE",payload:R({},L)})}),[L]),(0,m.useEffect)((function(){u({type:"system/getAllAccountsE",payload:{state:w.m3m.on}})}),[]);var Y=function(e,t){B(R(R({},L),{},{page:e,limit:t}))},N=function(e,t){B(R(R({},L),{},{page:e,limit:t}))},V=function(e){B(R(R({},e),{},{page:1,limit:10}))},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];S(e),H(!0),j(t)},U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];S(e),H(!1),j(t)},W=function(){var e=(0,l.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("add"===Z&&t.length<=0)){e.next=2;break}return e.abrupt("return",i.ZP.info("请选择关联手机号",3));case 2:if("add"!==Z){e.next=8;break}return e.next=5,u({type:"system/addRelatedAccountsE",payload:{account_ids:t,errCallBack:G}});case 5:if(!e.sent){e.next=8;break}v.setFieldsValue({addPhone:[]}),H(!1);case 8:if("edit"!==Z){e.next=14;break}return e.next=11,u({type:"system/editRelatedAccountsE",payload:{id:x._id,account_ids:t,onFailureCallBack:Q}});case 11:if(!e.sent){e.next=14;break}v.setFieldsValue({editPhone:[]}),H(!1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(e){u({type:"system/editRelatedAccountsE",payload:{id:e,account_ids:[],state:w.m3m.off,onFailureCallBack:Q}})},Q=function(e){return i.ZP.error(e)},G=function(e){return i.ZP.error(e)},X=function(){var e="";!0===k.ZP.canOperateSystemAccountReleatedUpdate()&&(e=m.createElement(c.Z,{onClick:function(){J("add",!0)}},"添加账号关联"));var n={operations:e,allAccounts:t,onSearch:V};return m.createElement(C,n)},$=function(){if("add"===Z){var e={visible:I,allAccounts:t,onHideModal:U,onSubmit:W};return m.createElement(M,e)}var n={visible:I,allAccounts:t,optionIds:x,onHideModal:U,onSubmit:W};return m.createElement(q,n)},ee=function(){var e=L.page,t=L.limit,c=[{title:"ID",dataIndex:"_id",key:"_id"},{title:"关联账号",dataIndex:"phones",key:"phones",render:function(e){if(e.length>0){var t=e.map((function(e){return e.phone}));return e.length>3?m.createElement(r.Z,{title:t.join(",")},t.slice(0,3).join(",")):t.join(",")}return"--"}},{title:"最新修改时间",dataIndex:"updated_at",key:"updated_at",render:function(e){return g()(e).format("YYYY-MM-DD HH:mm")}},{title:"最新操作人",dataIndex:"operator_info",key:"operator_info",render:function(e){return e?e.name:"--"}},{title:"操作",dataIndex:"_id",key:"option",render:function(e,t){return!1===k.ZP.canOperateSystemAccountReleatedUpdate()?"":m.createElement("span",null,m.createElement("a",{onClick:function(){J("edit",t)},className:z},"编辑"),m.createElement(o.Z,{title:"你确定要将该账号关联全部解除？",onConfirm:function(){return K(e)},okText:"确认",cancelText:"取消"},m.createElement("a",{onClick:function(){U("cancel",t)},className:z},"全部解除关联")))}}],i=b().get(n,"data"),l={current:e,pageSize:t||30,onShowSizeChange:N,onChange:Y,total:b().get(n,"_meta.result_count",0),showQuickJumper:!0,showSizeChanger:!0,showTotal:function(e){return"共 ".concat(e," 条")},pageSizeOptions:["10","20","30","40"]};return m.createElement(A.IT,null,m.createElement(a.Z,{rowKey:function(e,t){return 10*t+1},dataSource:i,columns:c,pagination:l}))};return m.createElement("div",null,X(),ee(),I&&$())};B.propTypes={accountsList:v().object,allAccounts:v().array},B.defaultProps={allAccounts:[],accountsList:{}};var Y=(0,E.connect)((function(e){var t=e.system;return{accountsList:t.accountsList,allAccounts:t.allAccounts}}))(B)}}]);