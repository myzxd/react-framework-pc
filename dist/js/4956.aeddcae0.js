"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[4956],{34956:function(e,t,r){r.r(t);r(62004);var n=r(11382),o=(r(75310),r(76772)),i=(r(52560),r(71577)),a=r(93433),l=r(15861),c=(r(51838),r(48086)),d=r(29439),u=r(87757),s=r.n(u),f=r(94315),m=r.n(f),p=r(93517),y=r.n(p),v=r(55609),h=r(67294),E=r(49101),g=r(80385),Z=r(96036),w=r(45430),k=r(34387),C=r(8793),b=r(10349),S=r(72438),O=r(30117),z=r(61816);t.default=(0,v.connect)((function(e){return{approveOrderDetail:e.codeOrder.approveOrderDetail}}))((function(e){var t=(0,h.useRef)(),r=(0,h.useState)(!1),u=(0,d.Z)(r,2),f=u[0],p=u[1],v=(0,h.useState)([]),I=(0,d.Z)(v,2),x=I[0],D=I[1],K=(0,h.useState)(!1),_=(0,d.Z)(K,2),P=_[0],R=_[1],T=e.location,A=void 0===T?{}:T,B=e.dispatch,F=e.approveOrderDetail,L=F.cost_center_type,N=F.template_type,j=A.query,q=(void 0===j?{}:j).orderId;(0,h.useEffect)((function(){return q&&B({type:"codeOrder/getApproveOrderDetail",payload:{orderId:q}}),function(){B({type:"codeOrder/resetApproveOrderDetail"})}}),[B,q]),(0,h.useEffect)((function(){if(!0===f){var e=t.current.scrollHeight;N===g.fz4.universal&&(t.current.scrollTop=e-600),N===g.fz4.travel&&(t.current.scrollTop=e-900),p(!1)}}),[x,f,N]);var H=function(){q&&B({type:"codeOrder/getApproveOrderDetail",payload:{orderId:q}})};(0,h.useEffect)((function(){if(N===g.fz4.universal){var e=y().get(F,"biz_order_ids",[]).map((function(e,t){return{_id:e,isShowEdit:!0,formKey:t+1}}));D(e)}if(N===g.fz4.travel){var t=y().get(F,"biz_order_ids",[]),r=t.map((function(e,t){return{_id:e,isShowEdit:!0,formKey:t+1}}));m().existy(t)&&m().not.empty(t)&&D(r)}}),[F,N]);var M,U,Y,$=function(){if(R(!1),(0,w.B$)())return c.ZP.success("创建成功"),void(window.location.href="/#/Code/PayOrder");c.ZP.success("创建成功"),c.ZP.error("你没有付款审批列表权限，请联系管理进行添加"),window.location.href="/#/Code/Document"},G=function(){var e;return N===g.fz4.universal&&(e=x.some((function(e){return!0!==e.isShowEdit}))),N===g.fz4.travel&&(e=x.some((function(e){return!0!==e.isShowEdit}))),e},J=function(){var e=(0,l.Z)(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=G(),N===g.fz4.universal&&(r=0===x.length),N===g.fz4.travel&&(r=0===x.length),!0!==r){e.next=5;break}return e.abrupt("return",c.ZP.error("请添加数据"));case 5:if(!0!==t){e.next=7;break}return e.abrupt("return",c.ZP.error("请将当前数据保存完成后再提交"));case 7:R(!0),B({type:"codeOrder/createSubmitOrder",payload:{orderId:q,onErrorCallback:function(){R(!1)},onSuccessCallback:$}});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=x.length,t=e-1<0?0:x[e-1].formKey,r=x[e-1]||{};if(0!==t&&!r.isShowEdit)return c.ZP.error("请将所有数据操作成功后，再进行添加");p(!0),D([].concat((0,a.Z)(x),[{formKey:t+1}]))},V=function(e){var t=x.length,r=t-1<0?0:x[t-1].formKey,n=x[t-1]||{};if(0!==r&&!n.isShowEdit)return c.ZP.error("当前存在编辑状态下的费用单，请操作完成后在进行复制");p(!0),D([].concat((0,a.Z)(x),[{formKey:r+1,isShowCopy:!0,_id:e}]))},W=function(e){if(x.some((function(e){return!0!==e.isShowEdit})))return c.ZP.error("当前存在正在编辑的费用单，请操作完成后再进行编辑");x[e].isShowEdit=!x[e].isShowEdit,D((0,a.Z)(x))},X=function(e){var t=x.filter((function(t){return t.formKey!==e}));D((0,a.Z)(t))},ee=function(e){x[e].isShowEdit=!x[e].isShowEdit,D((0,a.Z)(x))},te=function(){return h.createElement("div",null,h.createElement(i.Z,{className:z.Z["code-approveOder-btn"],onClick:Q},h.createElement(E.Z,null),"添加下一个费用单"))},re={approveOrderDetail:F,dispatch:B},ne=y().get(F,"biz_order_ids",[]),oe=G();return N===g.fz4.universal&&(M=0===x.length),N===g.fz4.travel&&(M=0===x.length),h.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},P?h.createElement("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,position:"absolute",top:0,left:0,background:"rgba(0, 0, 0, .1)"}},h.createElement(n.Z,{tip:"Loading..."})):null,h.createElement("div",{className:z.Z["code-approveOder-title"]},F.name),h.createElement("div",{ref:t,style:{overflowY:"scroll",flex:1}},h.createElement(k.Z,re),(U={orderId:q,isUpdate:!0},Y=[{title:"关联审批",content:h.createElement(b.Z,{key:"1",orderId:q,onInterfaceDetail:H}),key:"relateOrder"},{title:"主题标签",content:h.createElement(S.Z,U),key:"themeLabel"}],h.createElement(Z.DF,{items:Y})),N===g.fz4.travel?h.createElement(h.Fragment,null,x.map((function(e,t){return h.createElement(C.Z,{key:e.formKey,formKey:e.formKey,index:t,item:e,orderId:q,costCenterType:L,detail:F,onIsShowEdit:ee,onInterfaceDetail:H,onClickRemoveCost:X})}))):N===g.fz4.universal?h.createElement(h.Fragment,null,h.createElement("div",{style:{margin:"5px 0"}},h.createElement(o.Z,{type:"warning",showIcon:!0,message:"多个费用单时请保持【发票抬头】一致，否则无法提交"})),x.map((function(e,t){return h.createElement(O.Z,{key:e.formKey,formKey:e.formKey,index:t,item:e,orderId:q,costCenterType:L,onCopy:V,onIsShowEdit:W,onClickRemoveCost:X,onInterfaceDetail:H})}))):null,0===x.length?te():null),x.length>0?te():null,h.createElement("div",{style:{textAlign:"right",marginBottom:40}},h.createElement("span",{style:{marginRight:30}},"共 ",ne.length," 张单据  金额合计 ",h.createElement("a",null,g.fbc.exchangePriceCentToMathFormat(y().get(F,"total_money",0)),"元")),h.createElement(i.Z,{onClick:function(){window.location.href="/#/Code/PayOrder"},style:{marginRight:10}},"返回"),h.createElement(i.Z,{disabled:M||oe,type:"primary",onClick:J},"提交")))}))}}]);