"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[9032],{39032:function(e,t,r){r.d(t,{Z:function(){return Ve}});r(61605);var n=r(37636),a=(r(13062),r(71230)),o=(r(55295),r(69713)),c=(r(89032),r(15746)),l=r(93433),i=(r(438),r(14277)),s=r(29439),d=r(93517),u=r.n(d),p=r(55609),m=r(30381),f=r.n(m),v=r(67294),O=r(80385),y=(r(21316),r(75443)),Z=r(15861),g=r(87757),b=r.n(g),E=r(73171),h=r(97116),_=r(85277),w=r(45498),j=(0,p.connect)()((function(e){var t=e.orderId,r=e.dataSource,n=void 0===r?[]:r,a=e.dispatch,o=(0,v.useState)(!1),c=(0,s.Z)(o,2),l=c[0],i=c[1],d=function(){var e=(0,Z.Z)(b().mark((function e(r){var n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a({type:"codeOrder/deleteApproveOrderExtra",payload:{extraId:r}});case 2:(n=e.sent)&&n._id&&a({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:t}});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=n;!1===l&&(p=n.slice(0,3));return v.createElement("div",null,v.createElement("div",{className:w.Z["code-circulation-supplement-title"]},"补充意见"),v.createElement("div",{className:w.Z["code-circulation-supplement-content"]},p.map((function(e,t){return function(e,t){var r=!1;e.creator_id===h.Iq.account.id&&(r=!0);var n=u().get(e,"creator_info.name");return v.createElement("div",{key:t,className:w.Z["code-circulation-supplement-item"]},v.createElement("div",null,v.createElement("div",null,v.createElement("span",{className:w.Z["code-circulation-supplement-creator-name"]},n),e.created_at?v.createElement("span",{className:w.Z["code-circulation-supplement-create-at"]},f()(e.created_at).format("YYYY-MM-DD HH:mm:ss")):""),v.createElement("div",{className:w.Z["code-circulation-supplement-text-wrap"]},v.createElement("p",{className:w.Z["code-circulation-supplement-text"]},e.content)),e.asset_list&&e.asset_list.length>0?v.createElement("div",{className:w.Z["code-circulation-supplement-files"]},"附件：",v.createElement(_.Z,{displayMode:!0,value:_.Z.getInitialValue(e,"asset_list")})):"",!0===r?v.createElement(y.Z,{title:"您是否确定删除该条补充意见",onConfirm:function(){return d(e._id)},okText:"确定",cancelText:"取消"},v.createElement(E.Z,{className:w.Z["code-circulation-supplement-del-icon"]})):""))}(e,t)})),n.length>3?v.createElement("span",{onClick:function(){return i(!l)},className:w.Z["code-circulation-supplement-show-more-btn"]},l?"收起 <<":"查看更多 >>"):""))})),P=r(87462),D=(r(52560),r(71577)),k=(r(52466),r(10642)),C=(r(51838),r(48086)),x=r(4942),I=(r(35668),r(86585)),N=r(8240),F=r(77359),S=r(70270),L=(r(29093),r(16317)),A=L.Z.Option,T=(0,p.connect)((function(e){return{bookMonthList:e.codeOrder.bookMonthList}}))((function e(t){var r=t.value,n=t.onChange,a=t.dispatch,o=t.bookMonthList,c=void 0===o?[]:o,l=t.orderId;return(0,v.useEffect)((function(){return l&&a({type:"codeOrder/getBookMonthList",payload:{orderId:l}}),function(){a({type:"codeOrder/resetBookMonthList",payload:{}})}}),[a,l]),(0,v.useEffect)((function(){Array.isArray(c)&&c.length>0&&!c.find((function(e){return e.value===r}))&&r&&n&&n(0)}),[c,r,n]),e.length<1?v.createElement(L.Z,null):v.createElement(L.Z,{value:r,onChange:n,placeholder:"请选择"},c.map((function(e,t){return v.createElement(A,{value:e.value,key:t},e.label)})))}));function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $={labelCol:{span:6},wrapperCol:{span:16}},R=function(e){var t,r,n,a=e.dispatch,o=e.className,c=e.ccInfo,l=e.approveOrderDetail,i=void 0===l?{}:l,d=e.recordDetail,u=void 0===d?{}:d,p=I.Z.useForm(),m=(0,s.Z)(p,1)[0],f=(0,v.useState)(!1),y=(0,s.Z)(f,2),g=y[0],E=y[1],h=(0,v.useState)(O.tLf.often),_=(0,s.Z)(h,2),w=_[0],j=_[1],x=(0,v.useState)(!1),L=(0,s.Z)(x,2),A=L[0],H=L[1],R=i._id,M=i.isPaymentNode,V=void 0===M||M,Y=i.belong_month,U=u._id,B=u.handle_list,q=void 0===B?[]:B,K=function(){var e=(0,Z.Z)(b().mark((function e(){var t,r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.validateFields();case 2:return t=e.sent,H(!0),e.next=6,a({type:"codeOrder/agreeApproveOrder",payload:z(z({orderId:R,recordId:U},t),{},{flexibleDep:(0,N.Cg)(c,"flexibleDep",void 0),flexibleUser:(0,N.Cg)(c,"flexibleUser",void 0)})});case 6:(r=e.sent)&&r._id?(C.ZP.success("请求成功"),a({type:"codeOrder/getApproveOrderDetail",payload:{orderId:R}}),a({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:R}}),a({type:"codeOrder/getCostOrderList",payload:{orderId:R}}),H(!1),E(!1)):(H(!1),r.zh_message&&C.ZP.error(r.zh_message));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(e){j(e),m.resetFields()};return v.createElement(v.Fragment,null,(t=V?O.tLf.finance:O.tLf.often,r=w||t,n={belongTime:Y||0},v.createElement(k.Z,{title:"同意",visible:g,onOk:K,confirmLoading:A,onCancel:function(){return E(!1)}},v.createElement(S.Z,{activeKey:r,onChange:W}),v.createElement(I.Z,{form:m,initialValues:n,className:"affairs-flow-basic"},v.createElement(I.Z.Item,(0,P.Z)({label:"意见",name:"note",rules:[{max:1e3,message:"意见的最大长度不能超过1000"}]},$),v.createElement(F.Z,{alternatives:O.tLf.conversionData(r),placeholder:"请输入意见",rows:4})),Array.isArray(q)&&q.includes("edit_belong_month")?v.createElement(I.Z.Item,(0,P.Z)({label:"记账月份",name:"belongTime",rules:[{required:!0,message:"请选择记账月份"}]},$),v.createElement(T,{orderId:R})):""))),v.createElement(D.Z,{type:"primary",onClick:function(){return E(!0)},className:o},"同意"))};function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Y=L.Z.Option,U={labelCol:{span:6},wrapperCol:{span:16}},B=[{key:"0",value:"请上传附件。"},{key:"1",value:"文件有误，需要修改。"}],q=(0,p.connect)((function(e){return{rejectNodeList:e.codeOrder.rejectNodeList}}))((function(e){var t=e.rejectNodeList,r=void 0===t?{}:t,n=e.dispatch,a=e.approveOrderDetail,o=void 0===a?{}:a,c=e.recordDetail,l=void 0===c?{}:c,i=e.className,d=I.Z.useForm(),u=(0,s.Z)(d,1)[0],p=(0,v.useState)(!1),m=(0,s.Z)(p,2),f=m[0],O=m[1],y=o._id,g=l._id;(0,v.useEffect)((function(){return f&&y&&g&&n({type:"codeOrder/getRejectNodeList",payload:{orderId:y,recordId:g}}),function(){n({type:"codeOrder/resetRejectNodeList",payload:{}})}}),[n,y,g,f]);var E=function(){var e=(0,Z.Z)(b().mark((function e(){var t,r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.validateFields();case 2:return t=e.sent,e.next=5,n({type:"codeOrder/disallowanceApproveOrder",payload:V({orderId:y,recordId:g},t)});case 5:(r=e.sent)&&r._id?(C.ZP.success("请求成功"),n({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:y}}),O(!1)):r.zh_message&&C.ZP.error(r.zh_message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=r.data,_=void 0===h?[]:h,w=v.createElement(L.Z,{placeholder:"请选择",allowClear:!0,searchValue:!0},v.createElement(Y,{value:"null",key:"none"},"提报节点"),Array.isArray(_)&&_.map((function(e){return v.createElement(Y,{key:e._id,value:e._id},e.name)})));return v.createElement(v.Fragment,null,v.createElement(D.Z,{onClick:function(){return O(!0)},className:i},"驳回"),v.createElement(k.Z,{title:"驳回",visible:f,onOk:E,onCancel:function(){return O(!1)}},v.createElement(I.Z,{form:u,className:"affairs-flow-basic"},v.createElement(I.Z.Item,(0,P.Z)({label:"驳回至节点",name:"rejectNodeId",rules:[{required:!0,message:"请选择驳回节点"}]},U),w),v.createElement(I.Z.Item,(0,P.Z)({label:"意见",name:"note",rules:[{max:1e3,message:"意见的最大长度不能超过1000"}]},U),v.createElement(F.Z,{alternatives:B,placeholder:"请输入意见",rows:4})))))}));function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var G={labelCol:{span:6},wrapperCol:{span:16}},J=function(e){var t,r,n,a=e.dispatch,c=e.className,l=e.approveOrderDetail,i=void 0===l?{}:l,d=e.recordDetail,u=void 0===d?{}:d,p=I.Z.useForm(),m=(0,s.Z)(p,1)[0],f=(0,v.useState)(!1),y=(0,s.Z)(f,2),g=y[0],E=y[1],h=(0,v.useState)(O.tLf.often),j=(0,s.Z)(h,2),C=j[0],x=j[1],N=i._id,L=i.isPaymentNode,A=void 0===L||L,T=u._id,H=function(){E(!1),m.resetFields()},z=function(){H(),a({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:N}})},$=function(){var e=(0,Z.Z)(b().mark((function e(){var t;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.validateFields();case 2:t=e.sent,a({type:"codeOrder/addApproveOrderExtra",payload:W(W({orderId:N,recordId:T},t),{},{onSuccessCallback:z})});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(e){x(e),m.resetFields()};return v.createElement(v.Fragment,null,(t=A?O.tLf.finance:O.tLf.often,r=C||t,n=v.createElement("div",null,v.createElement("span",null,"目前支持的上传格式：- office文件(doc/docx/ppt/pptx/xls/xlsx)"),v.createElement("span",null,"- Rtf文档/- pdf文件/ - 图片文件(jpg/jpeg/png/gif/bmp/tiff/webp)"),v.createElement("span",null,"- txt文件/- csv文件/-eml格式 /- zip格式/- rar格式(不能上传有密码的此类文件)")),v.createElement(k.Z,{title:"补充意见",visible:g,onOk:$,onCancel:H,width:650},v.createElement(S.Z,{activeKey:r,onChange:R}),v.createElement(I.Z,{form:m,className:"affairs-flow-basic"},v.createElement(I.Z.Item,(0,P.Z)({label:"意见",name:"note",rules:[{max:1e3,message:"意见的最大长度不能超过1000"}]},G),v.createElement(F.Z,{alternatives:O.tLf.conversionData(r),placeholder:"请输入意见",rows:4})),v.createElement(I.Z.Item,(0,P.Z)({label:v.createElement("div",null,v.createElement(o.Z,{placement:"top",title:n},v.createElement("span",{className:w.Z["code-order-cost-tooltip-title"]},"!")),v.createElement("span",null,"上传附件")),name:"fileList"},G),v.createElement(_.Z,{domain:_.Z.UploadDomains.OAUploadDomain}))))),v.createElement(D.Z,{type:"primary",onClick:function(){return E(!0)},className:c},"补充意见"))},Q=(r(26574),r(9676));function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?X(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var te=(0,p.connect)((function(e){return{ticketTags:e.ticketTag.ticketTags}}))((function(e){var t=e.dispatch,r=e.ticketTags,n=void 0===r?{}:r,a=e.approveOrderDetail,o=void 0===a?{}:a,c=e.recordDetail,i=void 0===c?{}:c,d=e.className,u=o.inspect_bill_label_ids,p=void 0===u?[]:u,m=o._id,f=o.inspect_bill_label_list,O=void 0===f?[]:f,y=i._id,g=I.Z.useForm(),E=(0,s.Z)(g,1)[0],h=(0,v.useState)(!1),_=(0,s.Z)(h,2),w=_[0],j=_[1];(0,v.useEffect)((function(){w&&t({type:"ticketTag/getTicketTags",payload:{page:1,limit:9999}})}),[t,w]),(0,v.useEffect)((function(){E.setFieldsValue({tags:(0,l.Z)(p)})}),[o,p,E]);var x=n.data,N=void 0===x?[]:x,F=function(){var e=(0,Z.Z)(b().mark((function e(){var r,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.validateFields();case 2:return r=e.sent,e.next=5,t({type:"codeOrder/setOrderTicket",payload:ee(ee({},r),{},{recordId:y,orderId:m})});case 5:(n=e.sent)&&n._id?(C.ZP.success("请求成功"),j(!1),t({type:"codeOrder/getApproveOrderDetail",payload:{orderId:m}}),t({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:m}})):n&&n.zh_message&&C.ZP.error(n.zh_message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return v.createElement(v.Fragment,null,function(){if(w){var e=N.map((function(e){var t=e._id;return{label:e.name,value:t}})),t=N.map((function(e){return e._id})),r=[];O.forEach((function(e){t.includes(e._id)||r.push({value:e._id,label:"".concat(e.name,"(已删除)")})}));var n=[].concat((0,l.Z)(e),r);return v.createElement(k.Z,{title:"打验票标签",visible:w,onOk:F,okText:"保存",onCancel:function(){return j(!1),void E.setFieldsValue({tags:(0,l.Z)(p)})},destroyOnClose:!0},v.createElement(I.Z,(0,P.Z)({},{labelCol:{span:0},wrapperCol:{span:24}},{form:E,initialValues:{tags:(0,l.Z)(p)},className:"affairs-flow-basic"}),v.createElement(I.Z.Item,{name:"tags",label:"",rules:[{required:!0,message:"请选择"}]},v.createElement(Q.Z.Group,{style:{margin:"5px 5px"},options:n}))))}}(),v.createElement(D.Z,{onClick:function(){return j(!0)},className:d},"打验票标签"))})),re=(r(75310),r(76772)),ne=(r(9070),r(20924));function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ce=ne.Z.TextArea,le=function(e){var t=e.dispatch,r=e.className,n=e.approveOrderDetail,a=void 0===n?{}:n,o=e.recordDetail,c=void 0===o?{}:o,l=I.Z.useForm(),i=(0,s.Z)(l,1)[0],d=(0,v.useState)(!1),u=(0,s.Z)(d,2),p=u[0],m=u[1],f=(0,v.useState)({}),O=(0,s.Z)(f,2),y=O[0],g=O[1],E=a._id,h=c._id,_=function(){var e=(0,Z.Z)(b().mark((function e(){var r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({type:"codeOrder/getTicketCheck",payload:{orderId:E,recordId:h}});case 2:(r=e.sent)&&r.err_msg?(g(r.err_msg),m(!0)):r&&r.zh_message&&C.ZP.error(r.zh_message);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=(0,Z.Z)(b().mark((function e(){var r,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.validateFields();case 2:return r=e.sent,e.next=5,t({type:"codeOrder/markCostOrderBillDone",payload:oe(oe({},r),{},{orderId:E,recordId:h})});case 5:(n=e.sent)&&n._id?(C.ZP.success("请求成功"),i.resetFields(),t({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:E}}),t({type:"codeOrder/getCostOrderList",payload:{orderId:E}}),m(!1)):n&&n.zh_message&&C.ZP.error(n.zh_message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return v.createElement(v.Fragment,null,function(){if(p){return v.createElement(k.Z,{title:"完成验票",visible:p,onOk:w,okText:"确认验票",onCancel:function(){return m(!1)}},y.map((function(e,t){return v.createElement(re.Z,{key:t,showIcon:!0,closable:!0,message:e,type:"error",style:{margin:"10px 0"}})})),v.createElement(I.Z,(0,P.Z)({},{labelCol:{span:6},wrapperCol:{span:14}},{form:i,className:"affairs-flow-basic"}),v.createElement(I.Z.Item,{name:"note",label:"验票说明意见"},v.createElement(ce,{rows:6}))))}}(),v.createElement(D.Z,{onClick:function(){return _()},className:r},"完成验票"))};function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var de=ne.Z.TextArea,ue=function(e){var t=e.dispatch,r=e.className,n=e.approveOrderDetail,a=void 0===n?{}:n,o=e.recordDetail,c=void 0===o?{}:o,l=I.Z.useForm(),i=(0,s.Z)(l,1)[0],d=(0,v.useState)(!1),u=(0,s.Z)(d,2),p=u[0],m=u[1],f=a._id,O=c._id,y=function(){var e=(0,Z.Z)(b().mark((function e(){var r,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.validateFields();case 2:return r=e.sent,e.next=5,t({type:"codeOrder/markOrderBillAbnormal",payload:se(se({},r),{},{orderId:f,recordId:O})});case 5:(n=e.sent)&&n._id?(C.ZP.success("请求成功"),m(!1),i.resetFields(),t({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:f}})):n&&n.zh_message&&C.ZP.error(n.zh_message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return v.createElement(v.Fragment,null,function(){if(p){return v.createElement(k.Z,{title:"验票异常",visible:p,onOk:y,onCancel:function(){return m(!1)}},v.createElement(I.Z,(0,P.Z)({},{labelCol:{span:6},wrapperCol:{span:14}},{form:i,className:"affairs-flow-basic"}),v.createElement(I.Z.Item,{name:"state",label:"验票状态"},v.createElement("div",null,"异常")),v.createElement(I.Z.Item,{name:"note",label:"异常说明"},v.createElement(de,{rows:6}))))}}(),v.createElement(D.Z,{onClick:function(){return m(!0)},className:r},"验票异常"))},pe=r(1825),me=(r(48659),L.Z.Option),fe=function(e){var t=e.onChange,r=e.applicantNodeCcInfo;return v.createElement(L.Z,{showSearch:!0,showArrow:!0,optionFilterProp:"children",mode:"multiple",onChange:t,placeholder:"请选择"},[].concat((0,l.Z)((0,N.Cg)(r,"flexible_department_list",[])),(0,l.Z)((0,N.Cg)(r,"flexible_department_job_list",[]))).map((function(e){return e.job_info?v.createElement(me,{value:e._id,key:e._id,"data-isdepartmentjobid":!0},"".concat((0,N.Cg)(e,"department_info.name","--")," - ").concat((0,N.Cg)(e,"job_info.name","--"))):v.createElement(me,{value:e._id,key:e._id},(0,N.Cg)(e,"name","--"))})))},ve=L.Z.Option,Oe=function(e){var t=e.applicantNodeCcInfo,r=e.onChange;return v.createElement(L.Z,{allowClear:!0,showArrow:!0,mode:"multiple",optionFilterProp:"children",placeholder:"请选择",onChange:r},(0,N.Cg)(t,"flexible_account_list",[]).map((function(e){return v.createElement(ve,{value:e._id,key:e._id},(0,N.Cg)(e,"name","--"))})))},ye=(0,p.connect)((function(e){return{applicantNodeCcInfo:e.codeFlow.applicantNodeCcInfo}}))((function(e){var t=e.className,r=e.dispatch,n=e.setCcInfo,a=e.recordDetail,o=e.applicantNodeCcInfo,c=I.Z.useForm(),l=(0,s.Z)(c,1)[0],i=(0,v.useState)(!1),d=(0,s.Z)(i,2),u=d[0],p=d[1];(0,v.useEffect)((function(){r({type:"codeFlow/getApplicantNodeCc",payload:{flowId:(0,N.Cg)(a,"flow_id",void 0),nodeId:(0,N.Cg)(a,"flow_node_id",void 0)}})}),[]);var m=function(){var e=(0,Z.Z)(b().mark((function e(){var t;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.validateFields();case 2:t=e.sent,n(t),C.ZP.success("设置成功"),f();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){p(!1)},O=function(e,t){l.setFieldsValue({flexibleDep:t.map((function(e){return(0,N.Cg)(e,"data-isdepartmentjobid",!1)?{departmentJobid:e.value}:{departmentId:e.value}}))})};return v.createElement(v.Fragment,null,v.createElement(pe.Z,{title:"抄送设置",visible:u,onClose:f,getContainer:!1,width:400,footer:v.createElement("div",{style:{textAlign:"right"}},v.createElement(D.Z,{onClick:function(){return f()}},"取消"),v.createElement(D.Z,{onClick:function(){return m()},type:"primary",style:{marginLeft:10}},"确定"))},v.createElement(I.Z,{form:l,labelAlign:"left",className:"affairs-flow-basic"},v.createElement("span",{style:{fontSize:"14px",fontWeight:500,color:"#282D36"}},"灵活抄送"),v.createElement(I.Z.Item,{label:"可抄送部门/岗位",name:"flexibleDep"},v.createElement(fe,{applicantNodeCcInfo:o,onChange:O})),v.createElement(I.Z.Item,{label:"可抄送成员",name:"flexibleUser"},v.createElement(Oe,{applicantNodeCcInfo:o})))),v.createElement(D.Z,{onClick:function(){return p(!0)},className:t},"选择抄送"))})),Ze=function(e){var t=e.dispatch,r=e.approveOrderDetail,n=void 0===r?{}:r,a=e.recordDetail,o=void 0===a?{}:a,c=(0,v.useState)({}),l=(0,s.Z)(c,2),i=l[0],d=l[1],u={dispatch:t,recordDetail:o,approveOrderDetail:n,className:w.Z["code-circulation-approve-operation"]},p=o.handle_list,m=void 0===p?[]:p;return!Array.isArray(m)||m.length<1?v.createElement("div",null):v.createElement(v.Fragment,null,m.includes("add_extra")&&v.createElement(J,u),m.includes("approved")&&v.createElement(R,(0,P.Z)({},u,{ccInfo:i})),m.includes("reject")&&v.createElement(q,u),m.includes("ticket_tag")&&v.createElement(te,u),m.includes("inspect_ticket")&&v.createElement(le,u),m.includes("abnormal_inspect_ticket")&&v.createElement(ue,u),m.includes("add_flexible_carbon_copy")&&v.createElement(ye,(0,P.Z)({},u,{setCcInfo:d})))};function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ee=ne.Z.TextArea,he={labelCol:{span:6},wrapperCol:{span:16}},_e=function(e){var t=e.dispatch,r=e.approveOrderDetail,n=void 0===r?{}:r,a=e.className,o=I.Z.useForm(),c=(0,s.Z)(o,1)[0],l=(0,v.useState)(!1),i=(0,s.Z)(l,2),d=i[0],u=i[1],p=n._id,m=function(){var e=(0,Z.Z)(b().mark((function e(){var r,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.validateFields();case 2:return r=e.sent,e.next=5,t({type:"codeOrder/markApproveOrderAbnormal",payload:be({orderId:p},r)});case 5:(n=e.sent)&&n._id?(C.ZP.success("请求成功"),t({type:"codeOrder/getApproveOrderDetail",payload:{orderId:p}}),u(!1)):n.zh_message&&C.ZP.error(n.zh_message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return v.createElement(v.Fragment,null,v.createElement(D.Z,{onClick:function(){return u(!0)},className:a},"暂不付款"),v.createElement(k.Z,{title:"暂不付款",visible:d,onOk:m,onCancel:function(){return u(!1)}},v.createElement(I.Z,{form:c,className:"affairs-flow-basic"},v.createElement(I.Z.Item,(0,P.Z)({label:"付款状态"},he),O.rTI.description(O.rTI.abnormal)),v.createElement(I.Z.Item,(0,P.Z)({label:"备注",name:"note",rules:[{max:1e3,message:"备注的最大长度不能超过1000"}]},he),v.createElement(Ee,{placeholder:"请输入备注",rows:4})))))},we=r(2612);function je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?je(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):je(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var De={labelCol:{span:6},wrapperCol:{span:16}},ke=function(e){var t=e.dispatch,r=e.approveOrderDetail,n=void 0===r?{}:r,a=e.className,o=n._id,c=n.payee_list,l=void 0===c?[]:c,i=n.plugin_extra_meta,d=void 0===i?{}:i,p=n.payment_total_money,m=I.Z.useForm(),f=(0,s.Z)(m,1)[0],y=(0,v.useState)(!1),g=(0,s.Z)(y,2),E=g[0],h=g[1],_=(0,v.useState)(O.tLf.finance),w=(0,s.Z)(_,2),j=w[0],x=w[1],N=(0,v.useState)(l),L=(0,s.Z)(N,2),A=L[0],T=L[1],H=(0,v.useState)(!1),z=(0,s.Z)(H,2),$=z[0],R=z[1];(0,v.useEffect)((function(){T(l)}),[l]);var M,V,Y=function(){var e=(0,Z.Z)(b().mark((function e(){var r,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.validateFields();case 2:return r=e.sent,e.next=5,R(!0);case 5:return e.next=7,t({type:"codeOrder/markApproveOrderPayDone",payload:Pe(Pe({orderId:o},r),{},{payeeList:u().get(d,"is_plugin_order",!1)?[]:A})});case 7:(n=e.sent)&&n._id?(C.ZP.success("请求成功"),t({type:"codeOrder/getApproveOrderDetail",payload:{orderId:o}}),h(!1)):n.zh_message&&C.ZP.error(n.zh_message),R(!1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(e){x(e),f.resetFields()},B=function(e,t){var r=A.map((function(r){return r._id===t?Pe(Pe({},r),{},{payee_type:e.target.value}):r}));T(r)};return v.createElement(v.Fragment,null,(M=j||O.tLf.finance,V={dataSource:A,money:p,pluginMoney:p,onChangepayeeList:B,isPaymentNode:!0,isPluginOrder:u().get(d,"is_plugin_order",!1)},v.createElement(k.Z,{title:"标记付款",visible:E,onOk:Y,onCancel:function(){return h(!1)}},v.createElement(S.Z,{activeKey:M,onChange:U}),v.createElement(we.Z,V),v.createElement(I.Z,{form:f,className:"affairs-flow-basic"},v.createElement(I.Z.Item,(0,P.Z)({label:"意见",name:"note",rules:[{max:1e3,message:"意见的最大长度不能超过1000"}]},De),v.createElement(F.Z,{alternatives:O.tLf.conversionData(M),placeholder:"请输入意见",rows:4}))))),v.createElement(D.Z,{loading:$,type:"primary",onClick:function(){return h(!0)},className:a},"标记付款"))};function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ie=ne.Z.TextArea,Ne={labelCol:{span:6},wrapperCol:{span:16}},Fe=function(e){var t=e.dispatch,r=e.approveOrderDetail,n=void 0===r?{}:r,a=e.className,o=I.Z.useForm(),c=(0,s.Z)(o,1)[0],l=(0,v.useState)(!1),i=(0,s.Z)(l,2),d=i[0],u=i[1],p=n._id,m=function(){var e=(0,Z.Z)(b().mark((function e(){var r,n;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.validateFields();case 2:return r=e.sent,e.next=5,t({type:"codeOrder/markApproveOrderPayCancel",payload:xe({orderId:p},r)});case 5:(n=e.sent)&&n._id?(C.ZP.success("请求成功"),t({type:"codeOrder/getApproveOrderDetail",payload:{orderId:p}}),u(!1)):n.zh_message&&C.ZP.error(n.zh_message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return v.createElement(v.Fragment,null,v.createElement(D.Z,{onClick:function(){return u(!0)},className:a},"无需付款"),v.createElement(k.Z,{title:"无需付款",visible:d,onOk:m,onCancel:function(){return u(!1)}},v.createElement(I.Z,{form:c,initialValues:{note:"审批单无需付款，不记账"},className:"affairs-flow-basic"},v.createElement(I.Z.Item,(0,P.Z)({label:"付款状态"},Ne),O.rTI.description(O.rTI.noNeed)),v.createElement(I.Z.Item,(0,P.Z)({label:"备注",name:"note",rules:[{max:1e3,message:"备注的最大长度不能超过1000"}]},Ne),v.createElement(Ie,{placeholder:"请输入备注",rows:4})))))},Se=function(e){var t=e.dispatch,r=e.approveOrderDetail,n=void 0===r?{}:r,o=n.handle_list,l=void 0===o?[]:o,i={approveOrderDetail:n,dispatch:t,className:w.Z["code-circulation-pay-operation"]},s={approveOrderDetail:n,dispatch:t,className:w.Z["code-circulation-pay-operation"]},d={approveOrderDetail:n,dispatch:t,className:w.Z["code-circulation-pay-operation"]};return v.createElement(a.Z,{className:w.Z["code-circulation-pay-row"]},v.createElement(c.Z,{span:15},v.createElement("span",{className:w.Z["code-circulation-pay-title"]},"付款方式")),v.createElement(c.Z,{span:8},l.includes("no_pay")&&v.createElement(_e,i),l.includes("no_need_pay")&&v.createElement(Fe,d),l.includes("pay")&&v.createElement(ke,s)))},Le=(r(18085),r(55241)),Ae=r(68628),Te=(0,p.connect)((function(e){return{flowPreviewList:e.codeFlow.flowPreviewList}}))((function(e){var t=e.dispatch,r=e.flowPreviewList,a=void 0===r?[]:r,o=e.approveOrderDetail,c=o._id;if((0,v.useEffect)((function(){return c&&t({type:"codeFlow/getFlowPreview",payload:{orderId:c}}),function(){return t({type:"codeFlow/resetFlowPreview"})}}),[t,c]),!a||!Array.isArray(a)||a.length<1)return v.createElement("div",null);return v.createElement(v.Fragment,null,v.createElement("span",null,u().get(o,"flow_info.name")),v.createElement(Le.Z,{content:v.createElement(n.Z,null,a.map((function(e,t){return v.createElement(n.Z.Item,{key:t},e.node_name,"(",e.approve_name?e.approve_name:"无",")")})))},v.createElement(Ae.Z,{style:{marginLeft:5}})))})),He=r(32632),ze=r(36556),$e=r(81729),Re=r(45430),Me=r(96036),Ve=(0,p.connect)((function(e){return{flowRecordList:e.codeOrder.flowRecordList}}))((function(e){var t=e.dispatch,r=e.approveOrderDetail,d=void 0===r?{}:r,p=e.flowRecordList,m=void 0===p?{}:p,y=Re.ZP.canOperateModuleCodeOrderDetail(),Z=d.state,g=d._id,b=d.handle_list,E=void 0===b?[]:b,_=(0,v.useState)(!1),P=(0,s.Z)(_,2),D=P[0],k=P[1];(0,v.useEffect)((function(){return g&&t({type:"codeOrder/getOrderFlowRecordList",payload:{orderId:g}}),function(){t({type:"codeOrder/resetOrderFolwRecoedList"})}}),[t,g]);var C=m.data,x=void 0===C?[]:C;if(!Array.isArray(x)||x.length<1)return v.createElement(Me.IT,{title:"审核记录详情"},v.createElement(i.Z,null));var I,N={dispatch:t,approveOrderDetail:d},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.flow_node_id,r=void 0===t?void 0:t,n=e.state;return r||n!==O.iH$.close?r?n===O.iH$.approve?"#29ab58":n===O.iH$.reject||n===O.iH$.close||n===O.iH$.recall?"#d00218":"#F5A623":"#595959":"#d00218"},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e){return e.state})),r=ze;return(t.includes(O.iH$.reject)||t.includes(O.iH$.recall)||t.includes(O.iH$.close))&&(r=He),t.includes(O.iH$.pendding)&&(r=$e),v.createElement("img",{src:r,className:w.Z["code-order-circulation-node-icon"],role:"presentation"})},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.account_info,r=void 0===t?{}:t;return!r||Object.keys(r).length<1?"":u().get(r,"name","")},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.state,r=e.flow_node_id,n=void 0===r?void 0:r,a=e.reject_to_node_id,o=e.reject_to_node_info,c=void 0===o?{}:o;return t===O.iH$.close?"已关闭":n||t!==O.iH$.approve?n||t===O.iH$.approve?t===O.iH$.approve?"已审核":t===O.iH$.reject&&a&&u().get(c,"name")?"驳回至 ".concat(u().get(c,"name")):t!==O.iH$.reject||a?t===O.iH$.recall?"已撤回":"待处理":"驳回至申请人":"待提报":"提报"},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=h.P6.dotOptimal(e,"fixed_account_list",[]).map((function(e){return e.name})),r=h.P6.dotOptimal(e,"fixed_department_job_list",[]).map((function(e){return h.P6.dotOptimal(e,"job_info.name")})),n=h.P6.dotOptimal(e,"fixed_department_list",[]).map((function(e){return e.name})),a=h.P6.dotOptimal(e,"flexible_account_list",[]).map((function(e){return e.name})),o=h.P6.dotOptimal(e,"flexible_department_job_list",[]).map((function(e){return h.P6.dotOptimal(e,"job_info.name")})),i=h.P6.dotOptimal(e,"flexible_department_list",[]).map((function(e){return e.name})),s=[].concat((0,l.Z)(t),(0,l.Z)(r),(0,l.Z)(n)),d=[].concat((0,l.Z)(a),(0,l.Z)(o),(0,l.Z)(i));return v.createElement(v.Fragment,null,s.length>0?v.createElement(c.Z,{span:24},"固定抄送：",s.map((function(e){return e})).join(" 、 ")):"",d.length>0?v.createElement(c.Z,{span:24},"灵活抄送：",d.map((function(e){return e})).join(" 、 ")):"")},H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)&&e.length>0?v.createElement(c.Z,{span:24,className:w.Z["code-circulation-extra-wrap"]},v.createElement(j,{orderId:d._id,dataSource:e})):""},z=function(e){var t=e.state,r=e.account_info,n=void 0===r?{}:r,a=e.enable_account_list,c=void 0===a?[]:a;if(t===O.iH$.pendding){var l="";return Array.isArray(c)&&c.length>3&&(l=v.createElement(o.Z,{title:c.map((function(e){return e.name})).join("、")},v.createElement("span",null,c.slice(0,3).map((function(e){return e.name})).join("、"),"..."))),Array.isArray(c)&&c.length<=3&&(l=c.map((function(e){return e.name})).join("、")),l}return u().get(n,"name")},$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.done_at,r=e.note,n=e.order_flow_extra_list,o=void 0===n?[]:n;return v.createElement(a.Z,null,v.createElement(c.Z,{span:12,className:w.Z["code-order-circulation-rec-approve-name"]},z(e)),v.createElement(c.Z,{span:6,className:w.Z["code-circulation-rec-info"]},t?f()(t).format("YYYY-MM-DD HH:mm:ss"):"--"),v.createElement(c.Z,{span:6,className:w.Z["code-circulation-rec-info"],style:{color:F(e)}},L(e)," ",A(e)),T(e),r?v.createElement(c.Z,{span:24},v.createElement("div",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"}},"意见：".concat(r))):"",H(o))},R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v.createElement(a.Z,{span:24,key:e._id},v.createElement(c.Z,{span:15},$(e)),y&&v.createElement(c.Z,{span:8},v.createElement(Ze,{dispatch:t,approveOrderDetail:d,recordDetail:e})))},M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,r=S(e);return v.createElement(n.Z.Item,{key:t,dot:r},v.createElement(a.Z,{className:w.Z["code-order-circulation-node-name"]},v.createElement(c.Z,null,u().get(e,"0.flow_node_info.name","提报节点"))),e.map((function(e){return R(e)})))},V=Z===O.DU5.pendding||Z===O.DU5.processing?v.createElement(Te,{approveOrderDetail:d}):"";return v.createElement("div",null,v.createElement(Me.IT,{title:"审核记录详情",titleExt:V},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.slice(0,3);D&&(t=e);var r=E.includes("no_pay")||E.includes("no_need_pay")||E.includes("pay"),a=v.createElement(n.Z.Item,{color:"green"},v.createElement("span",{onClick:function(){return k(!D)},className:w.Z["code-order-circulation-node-operate"]},D?"收起 <<":"查看更多 >>"));return v.createElement(n.Z,null,y&&r&&v.createElement(Se,N),t.map((function(e,t){return M(e,t)})),e.length>3&&a)}((I=[],x.reduce((function(e,t){if(e[t.flow_node_id]){var r=e[t.flow_node_id].length;e[t.flow_node_id][r]=t}else(e={})[t.flow_node_id]=[t],I[I.length]=e[t.flow_node_id];return e}),{}),I))))}))}}]);