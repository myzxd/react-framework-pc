"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[3207],{13207:function(e,t,r){r.r(t);r(62004);var n=r(11382),o=(r(75310),r(76772)),a=(r(52560),r(71577)),i=r(93433),l=r(15861),c=(r(51838),r(48086)),d=r(29439),s=r(87757),u=r.n(s),f=r(94315),p=r.n(f),m=r(93517),v=r.n(m),y=r(55609),h=r(67294),E=r(49101),g=r(80385),Z=r(96036),w=r(34387),S=r(8793),b=r(10349),k=r(72438),C=r(30117),O=r(39032),z=r(61816);t.default=(0,y.connect)((function(e){return{approveOrderDetail:e.codeOrder.approveOrderDetail}}))((function(e){var t=(0,h.useRef)(),r=(0,h.useState)(!1),s=(0,d.Z)(r,2),f=s[0],m=s[1],y=(0,h.useState)([]),I=(0,d.Z)(y,2),_=I[0],D=I[1],K=(0,h.useState)(!1),x=(0,d.Z)(K,2),P=x[0],T=x[1],A=e.location,F=void 0===A?{}:A,R=e.dispatch,B=e.approveOrderDetail,N=B.cost_center_type,H=B.template_type,L=B.inspect_bill_state,U=B.paid_state,j=F.query,q=(void 0===j?{}:j).orderId;(0,h.useEffect)((function(){return q&&R({type:"codeOrder/getApproveOrderDetail",payload:{orderId:q}}),function(){R({type:"codeOrder/resetApproveOrderDetail"})}}),[R,q]),(0,h.useEffect)((function(){if(!0===f){var e=t.current.scrollHeight;H===g.fz4.universal&&(t.current.scrollTop=e-600),H===g.fz4.travel&&(t.current.scrollTop=e-900),m(!1)}}),[_,f,H]);var M=function(){q&&R({type:"codeOrder/getApproveOrderDetail",payload:{orderId:q}})};(0,h.useEffect)((function(){if(H===g.fz4.universal){var e=v().get(B,"biz_order_ids",[]).map((function(e,t){return{_id:e,isShowEdit:!0,formKey:t+1}}));D(e)}if(H===g.fz4.travel){var t=v().get(B,"biz_order_ids",[]),r=t.map((function(e,t){return{_id:e,isShowEdit:!0,formKey:t+1}}));p().existy(t)&&p().not.empty(t)&&D(r)}}),[B,H]);var Y,G,J,Q=function(){T(!1),c.ZP.success("创建成功"),window.location.href="/#/Code/PayOrder"},V=function(){var e;return H===g.fz4.universal&&(e=_.some((function(e){return!0!==e.isShowEdit}))),H===g.fz4.travel&&(e=_.some((function(e){return!0!==e.isShowEdit}))),e},W=function(){var e=(0,l.Z)(u().mark((function e(){var t,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=V(),H===g.fz4.universal&&(r=0===_.length),H===g.fz4.travel&&(r=0===_.length),!0!==r){e.next=5;break}return e.abrupt("return",c.ZP.error("请添加数据"));case 5:if(!0!==t){e.next=7;break}return e.abrupt("return",c.ZP.error("请将当前数据保存完成后再提交"));case 7:T(!0),R({type:"codeOrder/createSubmitOrder",payload:{orderId:q,onErrorCallback:function(){T(!1)},onSuccessCallback:Q}});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=_.length,t=e-1<0?0:_[e-1].formKey,r=_[e-1]||{};if(0!==t&&!r.isShowEdit)return c.ZP.error("请将所有数据操作成功后，再进行添加");m(!0),D([].concat((0,i.Z)(_),[{formKey:t+1}]))},$=function(e){var t=_.length,r=t-1<0?0:_[t-1].formKey,n=_[t-1]||{};if(0!==r&&!n.isShowEdit)return c.ZP.error("当前存在编辑状态下的费用单，请操作完成后在进行复制");m(!0),D([].concat((0,i.Z)(_),[{formKey:r+1,isShowCopy:!0,_id:e}]))},ee=function(e){if(_.some((function(e){return!0!==e.isShowEdit})))return c.ZP.error("当前存在正在编辑的费用单，请操作完成后再进行编辑");_[e].isShowEdit=!_[e].isShowEdit,D((0,i.Z)(_))},te=function(e){var t=_.filter((function(t){return t.formKey!==e}));D((0,i.Z)(t))},re={approveOrderDetail:B,dispatch:R},ne={approveOrderDetail:B,dispatch:R},oe=v().get(B,"biz_order_ids",[]),ae=V();return H===g.fz4.universal&&(Y=0===_.length),H===g.fz4.travel&&(Y=0===_.length),h.createElement(h.Fragment,null,P?h.createElement("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999,position:"absolute",top:0,left:0,background:"rgba(0, 0, 0, .1)"}},h.createElement(n.Z,{tip:"Loading..."})):null,h.createElement("div",{className:z.Z["code-approveOder-title"]},B.name),h.createElement("div",{ref:t,style:{overflowY:"scroll",maxHeight:570}},h.createElement(w.Z,re),(G={orderId:q,isUpdate:!0},J=[{title:"关联审批",content:h.createElement(b.Z,{key:"1",orderId:q,onInterfaceDetail:M}),key:"relateOrder"},{title:"主题标签",content:h.createElement(k.Z,G),key:"themeLabel"}],h.createElement(Z.DF,{items:J})),H===g.fz4.travel?h.createElement(h.Fragment,null,_.map((function(e,t){return h.createElement(S.Z,{key:e.formKey,formKey:e.formKey,index:t,item:e,orderId:q,paidState:U,costCenterType:N,inspectBillState:L,detail:B,onIsShowEdit:ee,onInterfaceDetail:M,onClickRemoveCost:te})}))):H===g.fz4.universal?h.createElement(h.Fragment,null,h.createElement("div",{style:{margin:"5px 0"}},h.createElement(o.Z,{type:"warning",showIcon:!0,message:"多个费用单时请保持【发票抬头】一致，否则无法提交"})),_.map((function(e,t){return h.createElement(C.Z,{key:e.formKey,formKey:e.formKey,index:t,item:e,orderId:q,paidState:U,costCenterType:N,inspectBillState:L,onCopy:$,onIsShowEdit:ee,onClickRemoveCost:te,onInterfaceDetail:M})}))):null),U===g.rTI.done||U===g.rTI.noNeed||L===g.A1w.already?null:H===g.fz4.universal||H===g.fz4.travel?h.createElement("div",null,h.createElement(a.Z,{className:z.Z["code-approveOder-btn"],onClick:X},h.createElement(E.Z,null),"添加下一个费用单")):null,h.createElement("div",{style:{textAlign:"right"}},h.createElement("span",{style:{marginRight:30}},"共 ",oe.length," 张单据  金额合计 ",h.createElement("a",null,g.fbc.exchangePriceCentToMathFormat(v().get(B,"total_money",0)),"元")),h.createElement(a.Z,{onClick:function(){window.location.href="/#/Code/PayOrder"},style:{marginRight:10}},"返回"),h.createElement(a.Z,{disabled:Y||ae,type:"primary",onClick:W},"提交")),v().get(B,"state",void 0)!==g.DU5.pendding?h.createElement(O.Z,ne):null)}))}}]);