"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[226],{46776:function(e,t,n){n(52466);var r=n(10642),a=(n(438),n(14277)),o=n(93433),i=n(15671),c=n(43144),s=n(97326),l=n(60136),u=n(82963),d=n(61120),p=n(4942),f=(n(56022),n(60331)),m=n(93517),h=n.n(m),y=n(55609),g=n(67294),v=n(45697),Z=n.n(v);function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var a=(0,d.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var C=f.Z.CheckableTag,S=10,I=20,T=-100,k=function(e){(0,l.Z)(n,e);var t=b(n);function n(e){var c;(0,i.Z)(this,n),c=t.call(this,e),(0,p.Z)((0,s.Z)(c),"onChange",(function(e,t){var n=c.state.selectedTags,r=t?[].concat((0,o.Z)(n),[e]):n.filter((function(t){return t!==e}));c.setState({selectedTags:r})})),(0,p.Z)((0,s.Z)(c),"onSubmit",(function(){var e=c.props,t=e.dispatch,n=e.onSuccessCallback,r=e.onFailureCallback,a=e.operateType,o={districtId:e.districtId,districtIds:e.districtIds,tags:c.state.selectedTags,onSuccessCallback:n,onFailureCallback:r};c.private.isSubmit&&(a===S&&t({type:"districtTag/setDistrictTags",payload:o}),a===I&&t({type:"districtTag/batchSetDistrictTags",payload:o}),a===T&&t({type:"districtTag/batchDeleteDistrictTags",payload:o})),c.private.isSubmit=!1})),(0,p.Z)((0,s.Z)(c),"onCancel",(function(){var e=c.props.onCancel;e&&e()})),(0,p.Z)((0,s.Z)(c),"renderCheckedTag",(function(e){var t=c.state.selectedTags,n=void 0===t?[]:t;return g.createElement(C,{key:e._id,value:e._id,checked:n.indexOf(e._id)>-1,onChange:function(t){return c.onChange(e._id,t)},style:n.indexOf(e._id)>-1?{marginBottom:"10px"}:{border:"1px solid #d9d9d9",backgroundColor:"#fafafa",marginBottom:"20px"}},e.name)})),(0,p.Z)((0,s.Z)(c),"renderEmpty",(function(){return g.createElement(a.Z,null)})),(0,p.Z)((0,s.Z)(c),"renderTags",(function(){var e=c.props.districtTags,t=(void 0===e?{}:e).data,n=void 0===t?[]:t;return g.createElement("div",null,n.map((function(e){return c.renderCheckedTag(e)})))})),(0,p.Z)((0,s.Z)(c),"renderMadal",(function(){var e=c.props,t=e.visible,n=e.districtTags,a=(void 0===n?{}:n).data,o=(void 0===a?[]:a).length>0,i=o;return g.createElement(r.Z,{title:"设置标签",visible:t,onOk:c.onSubmit,onCancel:c.onCancel,okText:"确认",cancelText:"取消",okButtonProps:{disabled:!i},width:700},o?c.renderTags():c.renderEmpty())}));var l=h().get(e,"districtTags.data",[]);return c.state={organTags:l,selectedTags:e.data||[]},c.private={isSubmit:!0},c}return(0,c.Z)(n,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)({type:"districtTag/getDistrictTags",payload:{limit:9999,page:1}})}},{key:"render",value:function(){return this.renderMadal()}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.districtTags,r=void 0===n?{}:n,a=e.data,o=void 0===a?[]:a,i=t.organTags,c=void 0===i?[]:i,s=h().get(r,"data",[]);return c.length!==s.length?{organTags:s,selectedTags:o}:null}}]),n}(g.Component);k.propTypes={visible:Z().bool,dispatch:Z().func,operateType:Z().number,onCancel:Z().func,onSuccessCallback:Z().func,onFailureCallback:Z().func,districtTags:Z().object,data:Z().array,districtId:Z().string,districtIds:Z().array},k.defaultProps={visible:!1,dispatch:function(){},onCancel:function(){},operateType:S,onSuccessCallback:function(){},onFailureCallback:function(){},districtTags:{},data:[],districtId:"",districtIds:[]},t.Z=(0,y.connect)((function(e){return{districtTags:e.districtTag.districtTags}}))(k)},85769:function(e,t,n){var r=n(15671),a=n(43144),o=n(97326),i=n(60136),c=n(82963),s=n(61120),l=n(4942),u=(n(29093),n(16317)),d=n(67294),p=n(55609),f=n(45697),m=n.n(f);function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.Z)(e);if(t){var a=(0,s.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}var y=u.Z.Option,g=10,v=function(e){(0,i.Z)(n,e);var t=h(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,o.Z)(e),"onChange",(function(t){var n=e.props.onChange;n&&n(t)})),e}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)({type:"districtTag/getDistrictTags",payload:{limit:9999,page:1}})}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"districtTag/resetDistrictTags",payload:{}})}},{key:"render",value:function(){var e=this.props,t=e.districtTags,n=void 0===t?{}:t,r=e.value,a=void 0===r?void 0:r,o=e.type,i=n.data,c=void 0===i?[]:i;return d.createElement(u.Z,{allowClear:!0,showSearch:!0,mode:o===g?null:"multiple",placeholder:"请选择标签",onChange:this.onChange,value:a,optionFilterProp:"children"},c.map((function(e){return d.createElement(y,{key:e._id},e.name)})))}}]),n}(d.Component);v.propTypes={districtTags:m().object,dispatch:m().func,onChange:m().func,type:m().number},v.defaultProps={districtTags:{},dispatch:function(){},onChange:function(){},type:g},t.Z=(0,p.connect)((function(e){return{districtTags:e.districtTag.districtTags}}))(v)},10226:function(e,t,n){n.r(t),n.d(t,{default:function(){return U}});n(20186);var r=n(75385),a=(n(55295),n(69713)),o=(n(52560),n(71577)),i=(n(51838),n(48086)),c=n(15671),s=n(43144),l=n(97326),u=n(60136),d=n(82963),p=n(61120),f=n(4942),m=n(94315),h=n.n(m),y=n(93517),g=n.n(y),v=n(67294),Z=n(55609),b=n(30381),C=n.n(b),S=n(45430),I=n(97116),T=n(80385),k=n(96036),O=(n(9070),n(20924)),P=(n(35668),n(86585)),E=(n(29093),n(16317)),w=n(45697),D=n.n(w),R=n(88144),j=n(85769);function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,p.Z)(e);if(t){var a=(0,p.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,d.Z)(this,n)}}var B=E.Z.Option,M=function(e){(0,u.Z)(n,e);var t=F(n);function n(e){var r;return(0,c.Z)(this,n),r=t.call(this,e),(0,f.Z)((0,l.Z)(r),"onSearch",(function(e){var t=r.props.onSearch,n=A(A({},e),{},{meta:{page:1,limit:30}});t&&t(n)})),(0,f.Z)((0,l.Z)(r),"onHookForm",(function(e){r.setState({form:e})})),(0,f.Z)((0,l.Z)(r),"onReset",(function(){var e=r.props.onReset;e&&e()})),(0,f.Z)((0,l.Z)(r),"onChangePlatformCode",(function(e){var t=r.state.form;r.setState({platformCode:e}),t.setFieldsValue({supplierIds:[]}),t.setFieldsValue({cityCodes:[]})})),(0,f.Z)((0,l.Z)(r),"onSupplierChange",(function(e){var t=r.state.form;r.setState({supplier:e}),t.setFieldsValue({cityCodes:[]})})),(0,f.Z)((0,l.Z)(r),"renderSearch",(function(){var e=r.props.operations,t={items:[v.createElement(P.Z.Item,{label:"平台",name:"platformCode"},v.createElement(R.Yg,{enableSelectAll:!0,allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"请选择平台",onChange:r.onChangePlatformCode})),v.createElement(P.Z.Item,{noStyle:!0,key:"supplierIds",shouldUpdate:function(e,t){return e.platformCode!==t.platformCode}},(function(e){var t=e.getFieldValue;return v.createElement(P.Z.Item,{label:"供应商",name:"supplierIds"},v.createElement(R.o2,{enableSelectAll:!0,allowClear:!0,showSearch:!0,showArrow:!0,mode:"multiple",optionFilterProp:"children",placeholder:"请选择供应商",platforms:t("platformCode"),namespace:t("platformCode"),onChange:r.onSupplierChange}))})),v.createElement(P.Z.Item,{noStyle:!0,key:"cityCodes",shouldUpdate:function(e,t){return e.platformCode!==t.platformCode||e.supplierIds!==t.supplierIds}},(function(e){var t=e.getFieldValue;return v.createElement(P.Z.Item,{label:"城市",name:"cityCodes"},v.createElement(R.Wn,{enableSelectAll:!0,allowClear:!0,showSearch:!0,showArrow:!0,mode:"multiple",optionFilterProp:"children",placeholder:"请选择城市",platforms:t("platformCode"),suppliers:t("supplierIds"),namespace:t("platformCode")}))})),v.createElement(P.Z.Item,{label:"商圈名称",name:"name"},v.createElement(O.Z,{placeholder:"请输入商圈名称"})),v.createElement(P.Z.Item,{label:"平台商圈ID",name:"customId"},v.createElement(O.Z,{placeholder:"请输入平台商圈ID"})),v.createElement(P.Z.Item,{label:"状态",name:"state"},v.createElement(E.Z,{allowClear:!0,showArrow:!0,mode:"multiple",placeholder:"请选择状态"},I.P6.transOptions(T.hQm,B))),v.createElement(P.Z.Item,{label:"标签",name:"tag"},v.createElement(j.Z,null)),v.createElement(P.Z.Item,{label:"BOSS商圈ID",name:"bossId"},v.createElement(O.Z,{placeholder:"请输入BOSS商圈ID"}))],operations:e,expand:!0,onReset:r.onReset,onSearch:r.onSearch,onHookForm:r.onHookForm};return v.createElement(k.IT,null,v.createElement(k.j6,t))})),r.state={form:void 0,supplier:"",platformCode:""},r}return(0,s.Z)(n,[{key:"render",value:function(){return v.createElement("div",null,this.renderSearch())}}]),n}(v.Component);(0,f.Z)(M,"propTypes",{onSearch:D().func.isRequired,operations:D().array.isRequired,onReset:D().func.isRequired});var _=M,H=n(46776),Y=n(8260);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,p.Z)(e);if(t){var a=(0,p.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,d.Z)(this,n)}}var Q=10,q=20,K=-100,X=function(e){(0,u.Z)(n,e);var t=N(n);function n(e){var s;return(0,c.Z)(this,n),s=t.call(this,e),(0,f.Z)((0,l.Z)(s),"onSearch",(function(e){var t=V(V({},s.private.searchParams),e);s.private.searchParams=t,s.props.dispatch({type:"districtManage/fetchDistricts",payload:t})})),(0,f.Z)((0,l.Z)(s),"onShowSizeChange",(function(e,t){var n=s.private.searchParams;n.meta.page=e,n.meta.limit=t,s.onSearch(n)})),(0,f.Z)((0,l.Z)(s),"onChangePage",(function(e,t){var n=s.private.searchParams;n.meta.page=e,n.meta.limit=t,s.onSearch(n)})),(0,f.Z)((0,l.Z)(s),"onReset",(function(){var e=s.props.dispatch,t={meta:{limit:30,page:1}};s.private.searchParams=V({},t),e({type:"districtManage/fetchDistricts",payload:t})})),(0,f.Z)((0,l.Z)(s),"onCancel",(function(){s.setState({visible:!1,selectedTags:[]})})),(0,f.Z)((0,l.Z)(s),"onShow",(function(e,t){var n=s.state.districtIds;if((t===q||t===K)&&(void 0===n?[]:n).length<1)return i.ZP.error("请先选择要设置的商圈数据");var r=[];t===Q&&(r=e.labelInfos),s.setState({visible:!0,operateType:t,selectedTags:r,districtId:e.id})})),(0,f.Z)((0,l.Z)(s),"onSuccessCallback",(function(){s.state.operateType!==Q&&s.setState({districtIds:[]});var e=s.props.dispatch;i.ZP.success("操作成功"),e({type:"districtManage/fetchDistricts",payload:s.private.searchParams}),s.onCancel()})),(0,f.Z)((0,l.Z)(s),"onFailureCallback",(function(e){e.zh_message&&i.ZP.error(e.zh_message),s.onCancel()})),(0,f.Z)((0,l.Z)(s),"addDistrict",(function(){window.location.href="#/Assets/District/Create"})),(0,f.Z)((0,l.Z)(s),"renderSearch",(function(){var e=[];return S.ZP.canOperateAssectsAdministrationCreate()&&e.push(v.createElement(o.Z,{key:"addDistrict",type:"primary",onClick:s.addDistrict,className:Y.Z["app-comp-system-district-del-btn"]},"添加商圈")),S.ZP.canOperateAssectsAdministrationTagBatchSet()&&(e[e.length]=v.createElement(o.Z,{key:"addTags",type:"primary",onClick:function(){return s.onShow({},q)},className:Y.Z["app-comp-system-district-del-btn"]},"批量增加标签")),S.ZP.canOperateAssectsAdministrationTagBatchDelete()&&(e[e.length]=v.createElement(o.Z,{key:"deleteTags",type:"primary",onClick:function(){return s.onShow({},K)}},"批量移除标签")),v.createElement(_,{onSearch:s.onSearch,onReset:s.onReset,operations:e})})),(0,f.Z)((0,l.Z)(s),"renderContent",(function(){var e=s.state.districtIds,t=s.props.enumeratedValue,n=(void 0===t?{}:t).industry,o=void 0===n?[]:n,i=s.private.searchParams.meta.page,c=s.props.districts,l=c.data,u=c.meta,d=[{title:"平台商圈ID",dataIndex:"customId",key:"customId",render:function(e,t){if("meituan"!==t.platformCode)return e||"--";var n=[];return e&&n.push("专送平台_".concat(e)),Object.values(T.pat).filter((function(e){return"function"!=typeof e})).forEach((function(e){t[e]&&n.push("".concat(T.pat.description(e),"_").concat(t[e]))})),n.length>0?1===n.length?n:v.createElement(a.Z,{title:n.join(", ")},v.createElement("span",null,n.slice(0,1).join(", ")," 等",n.length,"条")):"--"}},{title:"商圈",dataIndex:"name",key:"name",render:function(e){return e||"--"}},{title:"平台",dataIndex:"platformCode",key:"platformCode",render:function(e){return I.Iq.platformFilter(e)}},{title:"供应商",dataIndex:"supplierInfo",key:"supplierInfo",render:function(e){return e&&e.supplierName?e.supplierName:"--"}},{title:"城市",dataIndex:"cityInfo",key:"cityInfo",render:function(e){return e&&e.cityName?e.cityName:"--"}},{title:"状态",dataIndex:"state",key:"state",render:function(e){return e?T.hQm.description(e):"--"}},{title:"当前标签",dataIndex:"labelInfos",key:"labelInfos",render:function(e){return h().not.existy(e)||h().empty(e)||h().not.array(e)?"--":e.length<=2?e.map((function(e){return e.name})).join("、"):v.createElement(a.Z,{title:e.map((function(e){return e.name})).join("、")},v.createElement("span",null,g().get(e,"0.name"),"、",g().get(e,"1.name"),"..."))}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:function(e){return e?C()(e).format("YYYY-MM-DD HH:mm"):"--"}},{title:"停用时间",dataIndex:"forbiddenAt",key:"forbiddenAt",render:function(e){return e?C()(e).format("YYYY-MM-DD HH:mm"):"--"}},{title:"最新操作人",dataIndex:"operatorInfo",key:"operatorInfo",render:function(e){return e&&e.name?e.phone?"".concat(e.name,"(").concat(e.phone,")"):e.name:"--"}},{title:"所属场景",dataIndex:"industryCode",key:"industryCode",render:function(e){if(!e)return"--";var t=(o.find((function(t){return t.value===e}))||{}).name;return(void 0===t?void 0:t)||"--"}},{title:"操作",dataIndex:"operate",key:"operate",render:function(e,t){var n=S.ZP.canOperateAssectsAdministrationCreate()?v.createElement("a",{href:"#/Assets/District/Detail?id=".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:Y.Z["app-comp-system-district-del-btn"]},"详情"):null,r=S.ZP.canOperateAssectsAdministrationTagSet()&&t.state!==T.hQm.disabled?v.createElement("a",{onClick:function(){return s.onShow(t,Q)}},"设置标签"):null;return v.createElement("div",null,n,r,n||r?null:"--")}}],p={current:i,defaultPageSize:30,onChange:s.onChangePage,showQuickJumper:!0,showSizeChanger:!0,onShowSizeChange:s.onShowSizeChange,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],total:u.count||0},f={selectedRowKeys:e,onChange:function(e){return s.setState({districtIds:e})},getCheckboxProps:function(e){return{disabled:e.state===T.hQm.disabled}}};return v.createElement(k.IT,null,v.createElement(r.Z,{bordered:!0,rowKey:function(e,t){return e.id||t},pagination:p,dataSource:l,columns:d,rowSelection:f}))})),(0,f.Z)((0,l.Z)(s),"renderModal",(function(){var e=s.state,t=e.visible,n=e.operateType,r=e.selectedTags,a=void 0===r?[]:r,o=e.districtId,i=e.districtIds;if(t)return v.createElement(H.Z,{visible:t,operateType:n,districtId:o,districtIds:i,data:a.map((function(e){return e._id})),onCancel:s.onCancel,onSuccessCallback:s.onSuccessCallback,onFailureCallback:s.onFailureCallback})})),s.state={visible:!1,districtIds:[],districtId:void 0,operateType:Q,selectedTags:[]},s.private={searchParams:{meta:{page:1,limit:30}}},s}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var e=this.private.searchParams;this.props.dispatch({type:"districtManage/fetchDistricts",payload:e}),this.props.dispatch({type:"applicationCommon/getEnumeratedValue",payload:{enumeratedType:"industry"}})}},{key:"render",value:function(){return v.createElement("div",null,this.renderSearch(),this.renderContent(),this.renderModal())}}]),n}(v.Component);var U=(0,Z.connect)((function(e){return{districts:e.districtManage.districts,enumeratedValue:e.applicationCommon.enumeratedValue}}))(X)},8260:function(e,t){t.Z={"app-comp-system-district-del-btn":"jwD1LvdcMiOq9ISvTQhf","app-comp-system-detail-btn-wrap":"iMh94cAeGHVtBoIPZXCU","app-comp-detail-submit-btn":"ROgN_HyK56SizprERAwh","app-comp-system-create-btn-wrap":"tfTHSqZExFAOKK9c_zyQ","app-comp-system-create-submit-btn":"q7gunAFgBXHJNXMgYytn","app-comp-system-create-next-btn":"tX1_h7uYFDp29Z41QSe9","app-comp-assets-change-log-p":"H8h1eSai6pXBrOWkco7d"}}}]);