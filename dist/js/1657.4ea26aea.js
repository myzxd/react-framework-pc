"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[1657],{71657:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});n(20186);var a=n(75385),r=(n(21316),n(75443)),i=(n(52560),n(71577)),o=(n(51838),n(48086)),c=n(15671),s=n(43144),l=n(97326),u=n(60136),p=n(82963),d=n(61120),f=n(4942),m=n(93517),h=n.n(m),y=n(45697),v=n.n(y),Z=n(67294),D=n(55609),_=n(30381),w=n.n(_),S=(n(29093),n(16317)),b=(n(54071),n(14072)),g=n(96036),k=n(88144),I=n(80385),x="brO9EeDjsivy3NC_7l4w",P="r28gwSRLRgS8Cj3FzIYg",Y="QI1gQWhAtjeY7CundBEI";function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var r=(0,d.Z)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,p.Z)(this,n)}}var C=b.Z.MonthPicker,U=S.Z.Option,E=function(e){(0,u.Z)(n,e);var t=F(n);function n(e){var a;return(0,c.Z)(this,n),a=t.call(this,e),(0,f.Z)((0,l.Z)(a),"onSearch",(function(e){var t=a.state.onSearch,n=e.platforms,r=e.suppliers,i=e.cities,o=e.districts,c=e.belongTime,s=e.state,l={platforms:n,suppliers:r,cities:i,districts:o,page:1,limit:30,belongTime:c?w()(c).format("YYYYMM"):"",state:s};t&&t(l)})),(0,f.Z)((0,l.Z)(a),"onReset",(function(){var e=a.state.onSearch,t={page:1,limit:30,belongTime:w()(new Date).format("YYYYMM")};e&&e(t)})),(0,f.Z)((0,l.Z)(a),"renderSearch",(function(){var e=w()(new Date,"YYYY-MM"),t={items:[{label:"分发周期",form:function(t){return t.getFieldDecorator("belongTime",{initialValue:e})(Z.createElement(C,{placeholder:"请选择月份",format:"YYYY-MM"}))}},{label:"领用状态",form:function(e){return e.getFieldDecorator("state")(Z.createElement(S.Z,{placeholder:"请选择领用状态"},Z.createElement(U,{value:I.kFc.used},I.kFc.description(I.kFc.used)),Z.createElement(U,{value:I.kFc.toBeUsed},I.kFc.description(I.kFc.toBeUsed)),Z.createElement(U,{value:I.kFc.return},I.kFc.description(I.kFc.return))))}}],onReset:a.onReset,onSearch:a.onSearch};return Z.createElement(g.IT,{className:Y},Z.createElement(k.p8,t))})),(0,f.Z)((0,l.Z)(a),"render",(function(){return a.renderSearch()})),a.state={search:{},onSearch:e.onSearch},a}return n}(Z.Component),M=n(45430);function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,d.Z)(e);if(t){var r=(0,d.Z)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return(0,p.Z)(this,n)}}var R=function(e){(0,u.Z)(n,e);var t=T(n);function n(e){var s;return(0,c.Z)(this,n),s=t.call(this,e),(0,f.Z)((0,l.Z)(s),"onUpdateData",(function(){var e=setInterval((function(){s.props.dispatch({type:"supplyDistribution/fetchSupplyDistributionList"})}),3e4);s.state.interval||window.clearInterval(e),s.setState({interval:e})})),(0,f.Z)((0,l.Z)(s),"onDataUpdateDate",(function(){var e=s.state,t=e.items,n=e.interval,a=t;clearInterval(s.private.timer),s.private.timer=setInterval((function(){a-=1,s.setState({items:a}),0===a&&(s.setState({items:60}),clearInterval(s.private.timer),window.clearInterval(n))}),3e3)})),(0,f.Z)((0,l.Z)(s),"onSearch",(function(e){s.private.searchParams=e,s.private.searchParams.page||(s.private.searchParams.page=1),s.private.searchParams.limit||(s.private.searchParams.limit=30),s.props.dispatch({type:"supplyDistribution/fetchSupplyDistributionList",payload:s.private.searchParams})})),(0,f.Z)((0,l.Z)(s),"onChangePage",(function(e,t){s.private.searchParams.page=e,s.private.searchParams.limit=t,s.onSearch(s.private.searchParams)})),(0,f.Z)((0,l.Z)(s),"onShowSizeChange",(function(e,t){s.private.searchParams.page=e,s.private.searchParams.limit=t,s.onSearch(s.private.searchParams)})),(0,f.Z)((0,l.Z)(s),"onDownloadSuccess",(function(){o.ZP.success("模板下载成功")})),(0,f.Z)((0,l.Z)(s),"onDownloadFailure",(function(){o.ZP.error("模板下载失败")})),(0,f.Z)((0,l.Z)(s),"onDownload",(function(){var e={type:I.O3x.distributionTemplate};s.props.dispatch({type:"supplyProcurement/materialDownloadTemplate",payload:{params:e,onSuccessCallback:s.onDownloadSuccess,onFailureCallback:s.onDownloadFailure}})})),(0,f.Z)((0,l.Z)(s),"onUploadSuccessDistribution",(function(){s.setState({items:60}),s.onUpdateData(),s.onDataUpdateDate(),o.ZP.success("分发明细上传文件成功")})),(0,f.Z)((0,l.Z)(s),"onUploadFailureDistribution",(function(){o.ZP.success("分发明细上传文件失败")})),(0,f.Z)((0,l.Z)(s),"onUploadFailure",(function(){o.ZP.error("上传文件失败")})),(0,f.Z)((0,l.Z)(s),"onUploadSuccess",(function(e){var t={type:I.V$8.distribution,file:e,storage:I.rIf.sevenCattle};s.props.dispatch({type:"supplyProcurement/materialUploadFile",payload:{params:t,onSuccessCallback:s.onUploadSuccessDistribution,onFailureCallback:s.onUploadFailureDistribution}})})),(0,f.Z)((0,l.Z)(s),"renderSearch",(function(){var e=(0,l.Z)(s).onSearch;return Z.createElement(E,{onSearch:e})})),(0,f.Z)((0,l.Z)(s),"renderContent",(function(){var e=s.private.searchParams,t=e.page,n=e.limit,o=s.props,c=o.supplyDistributionData,l=void 0===c?{}:c,u=o.templateDate,p=void 0===u?"":u,d=h().get(l,"data",[]),f=h().get(l,"meta.count",0),m=[{title:"平台",dataIndex:"platform_name",key:"platform_name",fixed:"left",width:70,render:function(e){return e||"--"}},{title:"供应商",dataIndex:"supplier_name",key:"supplier_name",width:140,fixed:"left",render:function(e){return e||"--"}},{title:"城市",dataIndex:"city_name",key:"city_name",fixed:"left",width:70,render:function(e){return e||"--"}},{title:"商圈",dataIndex:"biz_district_name",key:"biz_district_name",fixed:"left",width:145,render:function(e){return e||"--"}},{title:"物资名称",dataIndex:"material_item_info",key:"material_item_info.name",width:100,render:function(e){return e.name||"--"}},{title:"物资编号",dataIndex:"material_item_info",key:"material_item_info.code",width:100,render:function(e){return e.code||"--"}},{title:"采购方式",dataIndex:"aquire_type",width:90,key:"aquire_type",render:function(e){return I.JFv.description(e)||"--"}},{title:"人员身份证号",dataIndex:"staff_info",width:180,key:"staff_info.identity_card_id",render:function(e){return e.identity_card_id||"--"}},{title:"姓名",dataIndex:"staff_info",key:"staff_info.name",width:90,render:function(e){return e.name||"--"}},{title:"数量",dataIndex:"qty",key:"qty",width:90,render:function(e){return e||"--"}},{title:"押金扣款方式",dataIndex:"pledge_money_type",key:"pledge_money_type",width:120,render:function(e){return I.erU.description(e)||"--"}},{title:"押金(元)",dataIndex:"deposit_money",key:"deposit_money",width:130,render:function(e){return I.fbc.exchangePriceToYuan(e)||0}},{title:"使用费扣款方式",dataIndex:"fee_money_deduction_type",key:"fee_money_deduction_type",width:130,render:function(e,t){return e===I.DFN.installment?"".concat(I.DFN.description(e)," (").concat(t.fee_money_cycle,"期)"):I.DFN.description(e)||"--"}},{title:"使用费(元)",dataIndex:"fee_money",key:"fee_money",width:130,render:function(e){return I.fbc.exchangePriceToYuan(e)||0}},{title:"分发周期",dataIndex:"belong_month",key:"belong_month",width:130,render:function(e){return e||"--"}},{title:"分发时间",dataIndex:"created_at",key:"created_at",width:130,render:function(e){return e?w()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"领用时间",dataIndex:"received_at",key:"received_at",width:100,render:function(e){return e?w()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"状态",dataIndex:"current_state",key:"current_state",width:100,render:function(e){return I.kFc.description(e)||"--"}}],y={showSizeChanger:!0,showQuickJumper:!0,pageSize:n||30,onShowSizeChange:s.onShowSizeChange,total:f,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],onChange:s.onChangePage};t&&(y.current=t);var v="";return M.ZP.canOperateSupplyDistributionDownloadAndUpload()&&(v=Z.createElement(Z.Fragment,null,Z.createElement("span",{className:x},"模板更新时间: ",p),Z.createElement(r.Z,{placement:"top",title:"是否下载模板?",okText:"确认",onConfirm:function(){s.onDownload()},cancelText:"取消"},Z.createElement(i.Z,{type:"primary",className:P},"下载模板")),Z.createElement(g.zI,{domain:"payment",namespace:s.private.namespace,onSuccess:s.onUploadSuccess,onFailure:s.onUploadFailure}))),Z.createElement(g.IT,{title:"分发明细列表",titleExt:v},Z.createElement(a.Z,{columns:m,pagination:y,rowKey:function(e,t){return t},scroll:{x:2050,y:400},dataSource:d,bordered:!0}))})),s.state={interval:null,items:60},s.private={searchParams:{},namespace:"namespace".concat(Math.floor(1e5*Math.random()))},s}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var e={type:I.O3x.distributionTemplate};this.props.dispatch({type:"supplyDistribution/fetchSupplyDistributionList",payload:{belongTime:w()(new Date).format("YYYYMM")}}),this.props.dispatch({type:"supplyProcurement/materialTemplateUpdatedDate",payload:e})}},{key:"componentDidUpdate",value:function(e){var t=this.state.interval;h().get(e,"supplyDistributionData.meta.count",0)!==h().get(this.props,"supplyDistributionData.meta.count",0)&&t&&window.clearInterval(t)}},{key:"componentWillUnmount",value:function(){var e=this.state.interval;window.clearInterval(e)}},{key:"render",value:function(){return Z.createElement("div",null,this.renderSearch(),this.renderContent())}}]),n}(Z.Component);(0,f.Z)(R,"propTypes",{supplyDistributionData:v().object,templateDate:v().string}),(0,f.Z)(R,"defaultProps",{supplyDistributionData:{},templateDate:""});var z=(0,D.connect)((function(e){return{supplyDistributionData:e.supplyDistribution.supplyDistributionData,templateDate:e.supplyProcurement.templateDate}}))(R)}}]);