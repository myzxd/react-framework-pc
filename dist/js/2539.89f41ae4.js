"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[2539],{2539:function(e,t,r){r.r(t),r.d(t,{default:function(){return ee}});r(20186);var n=r(75385),a=(r(52560),r(71577)),o=(r(21316),r(75443)),c=r(15671),i=r(43144),l=r(97326),s=r(60136),d=r(82963),p=r(61120),u=r(4942),f=r(93517),m=r.n(f),h=r(55609),v=r(67294),b=r(96036),y=(r(9070),r(20924)),Z=(r(54071),r(14072)),g=r(88144);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,u.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.Z)(e);if(t){var a=(0,p.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.Z)(this,r)}}var R=Z.Z.RangePicker,T=function(e){(0,s.Z)(r,e);var t=k(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,u.Z)((0,l.Z)(n),"onReset",(function(){var e=n.state,t=e.onSearch,r={recordId:e.record.recordId,districts:[],name:"",phone:"",date:void 0};n.setState({search:r}),t&&t(r)})),(0,u.Z)((0,l.Z)(n),"onSearch",(function(e){var t=n.state,r=t.onSearch,a=t.record,o=a.recordId,c=a.supplierId,i=a.platformId,l=a.cityId,s=c?[c]:[],d=i?[i]:[],p=l?[l]:[],u=S(S({},e),{},{recordId:o,suppliers:s,platforms:d,cities:p});u.page=1,u.limit=30,r&&r(u)})),(0,u.Z)((0,l.Z)(n),"onHookForm",(function(e){n.setState({form:e})})),(0,u.Z)((0,l.Z)(n),"render",(function(){var e=n.state.record,t=e.supplierId,r=e.supplierName,a=e.platformId,o=e.platformName,c=e.cityId,i=e.cityName,l=t?[t]:[],s=a?[a]:[],d=c?[c]:[],p={items:[{label:"供应商",form:function(){return r||"--"}},{label:"平台",form:function(){return o||"--"}},{label:"城市",form:function(){return i||"--"}},{label:"商圈",form:function(e){return e.getFieldDecorator("districts")(v.createElement(g.Wc,{allowClear:!0,showSearch:!0,optionFilterProp:"children",showArrow:!0,mode:"multiple",placeholder:"请选择商圈",platforms:s,suppliers:l,cities:d}))}},{label:"姓名",form:function(e){return e.getFieldDecorator("name")(v.createElement(y.Z,{placeholder:"请输入姓名"}))}},{label:"手机号",form:function(e){return e.getFieldDecorator("phone")(v.createElement(y.Z,{placeholder:"请输入手机号"}))}},{label:"所属时间",form:function(e){return e.getFieldDecorator("date",{initialValue:null})(v.createElement(R,null))}}],onReset:n.onReset,onSearch:n.onSearch,onHookForm:n.onHookForm,expand:!0};return v.createElement(b.IT,null,v.createElement(b.yL,p))})),n.state={form:void 0,search:{districts:[],name:"",phone:"",date:void 0},record:e.record||{},onSearch:e.onSearch||void 0},n}return r}(v.Component),I=(r(52466),r(10642)),D=r(94315),P=r.n(D),E=r(30381),O=r.n(E),w=r(66939),_=(r(98703),r(13062),r(71230)),M=(r(89032),r(15746)),F=(r(51838),r(48086));function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.Z)(e);if(t){var a=(0,p.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.Z)(this,r)}}var x=b.Hr.Option,j=function(e){(0,s.Z)(r,e);var t=Y(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,u.Z)((0,l.Z)(n),"UNSAFE_componentWillReceiveProps",(function(e){n.setState({disabled:!!e.disabled&&e.disabled,phone:e.phone?e.phone:"",dataSource:m().get(e,"employeeTransport.transportKnights.result",[]),onChange:e.onChange?e.onChange:void 0})})),(0,u.Z)((0,l.Z)(n),"componentWillUnmount",(function(){n.props.dispatch({type:"employeeTransport/resetTransportKnights"})})),(0,u.Z)((0,l.Z)(n),"onFetchData",(function(){var e=n.state.phone;P().not.empty(e)?n.props.dispatch({type:"employeeTransport/fetchTransportKnights",payload:{phone:e}}):F.ZP.warning("请填写手机号")})),(0,u.Z)((0,l.Z)(n),"onChange",(function(e,t){var r=n.state,a=r.dataSource,o=r.onChange,c={};a.forEach((function(t){t.knight_id===e&&(c.id=t.knight_id,c.name=t.name,c.transportType=t.transport_type)})),o&&o(e,t,c)})),n.state={disabled:!!e.disabled&&e.disabled,phone:e.phone?e.phone:"",dataSource:m().get(e,"employeeTransport.transportKnights.result",[]),onChange:e.onChange?e.onChange:void 0},n}return(0,i.Z)(r,[{key:"render",value:function(){var e=this.state,t=e.dataSource,r=e.disabled,n=t.map((function(e){return v.createElement(x,{key:e.knight_id,value:"".concat(e.knight_id)},e.name)})),o=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){(0,u.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},this.props);return o.onChange=this.onChange,v.createElement(_.Z,null,v.createElement(M.Z,{sm:18},v.createElement(b.Hr,o,n)),v.createElement(M.Z,{sm:1}),v.createElement(M.Z,{sm:4},v.createElement(a.Z,{type:"primary",onClick:this.onFetchData,disabled:r},"查询")))}}]),r}(v.Component);var U=(0,h.connect)((function(e){return{employeeTransport:e.employeeTransport}}))(j),V=r(8240);function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.Z)(e);if(t){var a=(0,p.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.Z)(this,r)}}var K=Z.Z.RangePicker,W=function(e){(0,s.Z)(r,e);var t=B(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,u.Z)((0,l.Z)(n),"UNSAFE_componentWillReceiveProps",(function(e){n.setState({record:e.record||{},visible:e.visible||!1,disabledDate:e.disabledDate||[],onCancle:e.onCancle?e.onCancle:void 0,onSuccessCallback:e.onSuccessCallback?e.onSuccessCallback:void 0}),!1===e.visible&&n.componentReset()})),(0,u.Z)((0,l.Z)(n),"componentWillUnmount",(function(){n.componentReset()})),(0,u.Z)((0,l.Z)(n),"onChangePhone",(function(e){var t=n.state.fields;t.phone=e.target.value,t.knight=[],t.knightName="",t.knightTransportType="",n.setState({fields:t}),n.props.form.setFieldsValue({knight:[]})})),(0,u.Z)((0,l.Z)(n),"onChangeKnight",(function(e,t,r){var a=n.state.fields;a.knight=r.id,a.knightName=r.name,a.knightTransportType=r.transportType,n.setState({fields:a})})),(0,u.Z)((0,l.Z)(n),"onSubmit",(function(e){var t=n.state,r=t.record,a=t.fields,o=r.recordId,c=r.supplierId,i=r.platformId,l=r.cityId,s=a.knight,d=a.knightName,p=a.knightTransportType;e.preventDefault(),n.props.form.validateFieldsAndScroll((function(e,t){if(!e){var r=t.phone,a=t.district,u=t.dateRange,f={recordId:o,name:d,phone:r,transportId:s,supplier:c,platform:i,city:l,district:a,date:u,transportType:p,onSuccessCallback:n.onSuccessCallback};n.private.dispatch({type:"employeeTransport/createTransportRecord",payload:f})}}))})),(0,u.Z)((0,l.Z)(n),"onSuccessCallback",(function(){var e=n.state.onSuccessCallback;e&&e()})),(0,u.Z)((0,l.Z)(n),"onCancel",(function(){var e=n.state.onCancle;e&&e()})),(0,u.Z)((0,l.Z)(n),"isDateDisable",(function(e){var t=n.state.disabledDate;if(e.month()!==O()().month())return!0;if(P().empty(t))return!1;var r=!1;return t.forEach((function(t){var n=O()(t[0],"YYYY-MM-DD"),a=O()(t[1],"YYYY-MM-DD");(e.isBetween(n,a,"day")||e.isSame(n,"day")||e.isSame(a,"day"))&&(r=!0)})),r})),(0,u.Z)((0,l.Z)(n),"componentReset",(function(){n.setState({fields:{district:void 0,name:"",phone:"",date:void 0,knight:[],knightName:""},record:{}}),n.props.form.resetFields()})),(0,u.Z)((0,l.Z)(n),"renderCreateForm",(function(){var e=n.props.form.getFieldDecorator,t=n.state,r=t.record,a=t.fields.phone,o=r.supplierId,c=r.supplierName,i=r.platformId,l=r.platformName,s=r.cityId,d=o?[o]:[],p=i?[i]:[],u=s?[s]:[],f=[{label:"选择骑士信息"},{label:"供应商",form:c||"--"},{label:"平台",form:l||"--"},{label:"城市",form:r.cityName||"--"},{label:"商圈",form:e("district",{rules:[{required:!0,message:"请选择商圈"}],initialValue:void 0})(v.createElement(g.Wc,{allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"请选择商圈",platforms:p,suppliers:d,cities:u}))},{label:"选择时间",form:e("dateRange",{initialValue:null,rules:[{required:!0,message:"请选择时间范围"}]})(v.createElement(K,{disabledDate:n.isDateDisable}))},{label:"手机号",form:e("phone",{rules:[{required:!0,validator:V.PT}],initialValue:void 0})(v.createElement(y.Z,{placeholder:"请输入手机号",onChange:n.onChangePhone}))},{label:"骑士信息确认",form:e("knight")(v.createElement(U,{placeholder:"请选择骑士信息",phone:a,onChange:n.onChangeKnight,disabled:""===a}))}];return v.createElement(b.KP,{items:f,cols:1,layout:{labelCol:{span:6},wrapperCol:{span:18}}})})),(0,u.Z)((0,l.Z)(n),"render",(function(){var e=n.state.visible,t=(0,l.Z)(n),r=t.onSubmit,a=t.onCancel;return v.createElement(I.Z,{title:"新建运力",visible:e,onOk:r,onCancel:a,okText:"确认",cancelText:"取消"},v.createElement(w.Z,null,n.renderCreateForm()))})),n.state={fields:{district:void 0,name:"",phone:"",date:void 0,knight:[],knightName:"",knightTransportType:""},record:e.record||{},visible:e.visible||!1,disabledDate:e.disabledDate||[],onCancle:e.onCancle?e.onCancle:void 0,onSuccessCallback:e.onSuccessCallback?e.onSuccessCallback:void 0},n.private={dispatch:e.dispatch},n}return r}(v.Component),H=w.Z.create()(W);function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.Z)(e);if(t){var a=(0,p.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.Z)(this,r)}}var A=Z.Z.RangePicker,q=function(e){(0,s.Z)(r,e);var t=z(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,u.Z)((0,l.Z)(n),"UNSAFE_componentWillReceiveProps",(function(e){n.setState({editRecordId:e.editRecordId||"",editTimeRange:e.editTimeRange||[],editTransportId:e.editTransportId||"",disabledDate:e.disabledDate||[],visible:e.visible,onCancle:e.onCancle?e.onCancle:void 0,onSuccessCallback:e.onSuccessCallback?e.onSuccessCallback:void 0}),!1===e.visible&&n.componentReset()})),(0,u.Z)((0,l.Z)(n),"componentWillUnmount",(function(){n.componentReset()})),(0,u.Z)((0,l.Z)(n),"onSubmit",(function(e){var t=n.state,r=t.editRecordId,a=t.editTransportId;e.preventDefault(),n.props.form.validateFieldsAndScroll((function(e,t){if(!e){var o=t.dateRange,c={recordId:r,transportId:a,date:o,onSuccessCallback:n.onSuccessCallback};n.private.dispatch({type:"employeeTransport/updateTransportRecord",payload:c})}}))})),(0,u.Z)((0,l.Z)(n),"onSuccessCallback",(function(){var e=n.state.onSuccessCallback;e&&e()})),(0,u.Z)((0,l.Z)(n),"onCancel",(function(){var e=n.state.onCancle;e&&e()})),(0,u.Z)((0,l.Z)(n),"isDateDisable",(function(e){var t=n.state,r=t.disabledDate||[],a=t.editTimeRange;if(r=r.filter((function(e){return"".concat(e[0],"-").concat(e[1])!=="".concat(a[0],"-").concat(a[1])})),e.month()!==O()().month())return!0;if(P().empty(r))return!1;var o=!1;return r.forEach((function(t){var r=O()(t[0],"YYYY-MM-DD"),n=O()(t[1],"YYYY-MM-DD");(e.isBetween(r,n,"day")||e.isSame(r,"day")||e.isSame(n,"day"))&&(o=!0)})),o})),(0,u.Z)((0,l.Z)(n),"componentReset",(function(){n.setState({editRecordId:"",editTimeRange:[],transportId:""}),n.props.form.resetFields()})),(0,u.Z)((0,l.Z)(n),"renderContent",(function(){var e=n.props.form.getFieldDecorator,t=n.state.editTimeRange,r=[{label:"选择时间",form:e("dateRange",{rules:[{required:!0,message:"请选择时间范围"}],initialValue:[O()(t[0],"YYYY-MM-DD"),O()(t[1],"YYYY-MM-DD")]})(v.createElement(A,{disabledDate:n.isDateDisable}))}];return v.createElement(b.KP,{items:r,cols:1,layout:{labelCol:{span:6},wrapperCol:{span:18}}})})),(0,u.Z)((0,l.Z)(n),"render",(function(){var e=n.state.visible,t=(0,l.Z)(n),r=t.onSubmit,a=t.onCancel;return v.createElement(I.Z,{title:"编辑运力",visible:e,onOk:r,onCancel:a,okText:"确认",cancelText:"取消"},v.createElement(w.Z,null,n.renderContent()))})),n.state={editRecordId:e.editRecordId||"",editTimeRange:e.editTimeRange||[],editTransportId:e.editTransportId||"",disabledDate:e.disabledDate||[],visible:e.visible||!1,onCancle:e.onCancle?e.onCancle:void 0,onSuccessCallback:e.onSuccessCallback?e.onSuccessCallback:void 0},n.private={dispatch:e.dispatch},n}return r}(v.Component),G=w.Z.create()(q),J="iGGCWTz126afBJmnWCev",L="UV5_Ax5xsLr_IEb2KKfC",Q="_zNdcKFlubKfgkVePiWQ";function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.Z)(e);if(t){var a=(0,p.Z)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,d.Z)(this,r)}}var $=function(e){(0,s.Z)(r,e);var t=X(r);function r(e){var i;(0,c.Z)(this,r),i=t.call(this,e),(0,u.Z)((0,l.Z)(i),"onShowCreateModal",(function(){i.setState({createVisible:!0})})),(0,u.Z)((0,l.Z)(i),"onHideCreateModal",(function(){i.setState({createVisible:!1})})),(0,u.Z)((0,l.Z)(i),"onShowUpdateModal",(function(e,t,r,n){i.setState({updateVisible:!0,editRecordId:e,editTransportId:t,editTimeRange:[r,n]})})),(0,u.Z)((0,l.Z)(i),"onHideUpdateModal",(function(){i.setState({updateVisible:!1,editRecordId:"",editTransportId:"",editTimeRange:[]})})),(0,u.Z)((0,l.Z)(i),"onCreateSuccessCallback",(function(){i.onHideCreateModal(),i.props.dispatch({type:"employeeTransport/fetchTransportRecords",payload:i.private.searchParams})})),(0,u.Z)((0,l.Z)(i),"onUpdateSuccessCallback",(function(){i.onHideUpdateModal(),i.props.dispatch({type:"employeeTransport/fetchTransportRecords",payload:i.private.searchParams})})),(0,u.Z)((0,l.Z)(i),"onDelete",(function(e,t){var r={recordId:e,transportId:t,onSuccessCallback:i.onUpdateSuccessCallback};i.props.dispatch({type:"employeeTransport/deleteTransportRecord",payload:r})})),(0,u.Z)((0,l.Z)(i),"onDirectToTransport",(function(){window.location.href="/#/Employee/Transport"})),(0,u.Z)((0,l.Z)(i),"onShowSizeChange",(function(e,t){var r=i.private.searchParams;r.page=e,r.limit=t,i.onSearch(r)})),(0,u.Z)((0,l.Z)(i),"onChangePage",(function(e,t){var r=i.private.searchParams;r.page=e,r.limit=t,i.onSearch(r)})),(0,u.Z)((0,l.Z)(i),"onSearch",(function(e){i.private.searchParams=e,i.private.searchParams.page||(i.private.searchParams.page=1),i.private.searchParams.limit||(i.private.searchParams.limit=30),i.props.dispatch({type:"employeeTransport/fetchTransportRecords",payload:i.private.searchParams})})),(0,u.Z)((0,l.Z)(i),"renderSearch",(function(){var e=i.state.record;return v.createElement(T,{onSearch:i.onSearch,record:e})})),(0,u.Z)((0,l.Z)(i),"renderCreateModal",(function(){var e=i.state,t=e.record,r={visible:e.createVisible,record:t,disabledDate:e.disabledDate,dispatch:i.props.dispatch,onCancle:i.onHideCreateModal,onSuccessCallback:i.onCreateSuccessCallback};return v.createElement(H,r)})),(0,u.Z)((0,l.Z)(i),"renderUpdateModal",(function(){var e=i.state,t=e.editRecordId,r=e.editTransportId,n=e.editTimeRange,a=e.disabledDate,o={visible:e.updateVisible,editRecordId:t,editTransportId:r,editTimeRange:n,disabledDate:a,dispatch:i.props.dispatch,onCancle:i.onHideUpdateModal,onSuccessCallback:i.onUpdateSuccessCallback};return v.createElement(G,o)})),(0,u.Z)((0,l.Z)(i),"renderContent",(function(){var e=i.state.dataSource,t=i.private.searchParams.page,r=void 0===t?1:t,c=[{title:"姓名",dataIndex:"name",key:"name"},{title:"手机号",dataIndex:"phone",key:"phone"},{title:"平台",dataIndex:"platform_name",key:"platform_name"},{title:"城市",dataIndex:"city_name",key:"city_name"},{title:"商圈",dataIndex:"biz_district_name",key:"biz_district_name"},{title:"开始时间",dataIndex:"start_date",key:"start_date"},{title:"结束时间",dataIndex:"end_date",key:"end_date"},{title:"操作",dataIndex:"operate",key:"operate",render:function(e,t){return v.createElement("div",null,v.createElement("a",{className:J,onClick:function(){return i.onShowUpdateModal(t._id,t.transport_staff_id,t.start_date,t.end_date)}},"编辑"),v.createElement(o.Z,{title:"是否确认删除?",onConfirm:function(){return i.onDelete(t._id,t.transport_staff_id)},okText:"确认",cancelText:"取消"},v.createElement("a",null,"删除")))}}],l=v.createElement("div",null,v.createElement(a.Z,{onClick:i.onShowCreateModal,type:"primary"},"新建")),s={current:r,defaultPageSize:30,onChange:i.onChangePage,showQuickJumper:!0,showSizeChanger:!0,onShowSizeChange:i.onShowSizeChange,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],total:m().get(e,"meta.result_count",0)};return v.createElement(b.IT,{className:L,title:"列表",titleExt:l},v.createElement(n.Z,{rowKey:function(e,t){return t},pagination:s,columns:c,dataSource:e.result,bordered:!0}))}));var s=e.location.query,d=s.id,p={recordId:d,supplierId:s.supplierId,supplierName:s.supplierName,platformId:s.platformId,platformName:s.platformName,cityId:s.cityId,cityName:s.cityName};return i.state={record:p,dataSource:m().get(e,"employeeTransport.transportRecords",{}),disabledDate:m().get(e,"employeeTransport.transportRecords.date_list",[]),createVisible:!1,updateVisible:!1,editRecordId:"",editTransportId:"",editTimeRange:[]},i.private={searchParams:{recordId:d}},i}return(0,i.Z)(r,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({dataSource:m().get(e,"employeeTransport.transportRecords",{}),disabledDate:m().get(e,"employeeTransport.transportRecords.date_list",[])})}},{key:"render",value:function(){return v.createElement("div",null,this.renderSearch(),this.renderContent(),this.renderCreateModal(),this.renderUpdateModal(),v.createElement(a.Z,{className:Q,onClick:this.onDirectToTransport,type:"primary"},"返回"))}}]),r}(v.Component),ee=(0,h.connect)((function(e){return{employeeTransport:e.employeeTransport}}))($)}}]);