"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[7270],{67270:function(e,t,o){o.r(t);o(13062);var n=o(71230),r=(o(89032),o(15746)),a=(o(52560),o(71577)),i=(o(51838),o(48086)),c=o(15671),s=o(43144),u=o(97326),d=o(60136),l=o(82963),p=o(61120),f=o(4942),v=o(93517),g=o.n(v),h=o(67294),m=o(55609),C=o(45697),y=o.n(C),Z=o(94315),b=o.n(Z),P=o(66939),D=(o(98703),o(97116)),I=o(80385),w=o(62504),j=o(55965),A=o(8926),x=o(25354),E=o(35833),O=o(90963),F=o(2203),R=o(97304),S=o(58410),T=o(8583),k=o(67955);function H(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function M(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?H(Object(o),!0).forEach((function(t){(0,f.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):H(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,n=(0,p.Z)(e);if(t){var r=(0,p.Z)(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return(0,l.Z)(this,o)}}var q=D.Iq.platform(),_=function(e){(0,d.Z)(o,e);var t=z(o);function o(e){var s;return(0,c.Z)(this,o),s=t.call(this,e),(0,f.Z)((0,u.Z)(s),"onSearch",(function(){var e=s.props,t=e.dispatch,o=e.location.query.id;s.private.searchParams.page||(s.private.searchParams.page=1),s.private.searchParams.limit||(s.private.searchParams.limit=30),s.private.searchParams.id||(s.private.searchParams.id=o),t({type:"expenseHouseContract/fetchHouseAccount",payload:s.private.searchParams})})),(0,f.Z)((0,u.Z)(s),"onChangePage",(function(e,t){s.private.searchParams.page=e,s.private.searchParams.limit=t,s.onSearch(s.private.searchParams)})),(0,f.Z)((0,u.Z)(s),"onShowSizeChange",(function(e,t){s.private.searchParams.page=e,s.private.searchParams.limit=t,s.onSearch(s.private.searchParams)})),(0,f.Z)((0,u.Z)(s),"onVerifyExpenseCostItems",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(b().empty(e))return i.ZP.error("分摊数据为空"),!1;if(b().not.array(e))return i.ZP.error("分摊数据格式错误"),!1;var o={vendor:"分摊信息供应商未选择",platform:"分摊信息平台未选择",city:"分摊信息城市未选择",district:"分摊信息商圈未选择",costCount:"分摊金额不能为空"},n=!1;if(e.forEach((function(e,t){!0!==n&&Object.keys(e).forEach((function(r){b().not.existy(o[r])||!0===n||(b().not.existy(e[r])||b().empty(e[r]))&&(n=!0,i.ZP.error("第".concat(t+1,"条分摊明细 : ").concat(o[r])))}))})),Number(t)===I.F$Y.city){var r={};e.forEach((function(e){if(r[e.city])return i.ZP.error("成本分摊对象不能重复"),n=!0,!1;r[e.city]=!0}))}if(Number(t)===I.F$Y.district){var a={};e.forEach((function(e){if(a[e.district])return i.ZP.error("成本分摊对象不能重复"),n=!0,!1;a[e.district]=!0}))}return!0!==n})),(0,f.Z)((0,u.Z)(s),"onSave",(function(){var e=s.props,t=e.form,o=void 0===t?{}:t,n=e.dispatch,r=e.houseContractDetail,a=(void 0===r?{}:r).id,i={},c=function(){window.location.href="/#/Expense/Manage/House"};o.validateFields((function(e,t){!1!==s.onVerifyExpenseCostItems(g().get(t,"expense.costItems"),g().get(t,"costCenterType"))&&(e||(t.invoiceTitle&&(i.rentInvoiceTitle=t.invoiceTitle,i.pledgeInvoiceTitle=t.invoiceTitle,i.agentInvoiceTitle=t.invoiceTitle),n({type:"expenseHouseContract/updateHouseContract",payload:{param:M(M(M({},t),i),{},{id:a}),onSuccessCallback:c}})))}))})),(0,f.Z)((0,u.Z)(s),"onSaveAndCreateRenewOrder",(function(){var e=s.props,t=e.form,o=void 0===t?{}:t,n=e.dispatch,r=e.houseContractDetail,a=(void 0===r?{}:r).id,c=s.props.location.query.isCreateRenew,u=function(e){e.zh_message&&i.ZP.error(e.zh_message)},d={},l=function(){void 0!==a&&(window.location.href="/#/Expense/Manage/House/Apply?id=".concat(a,"&isCreateRenew=").concat(c))};o.validateFields((function(e,t){!1!==s.onVerifyExpenseCostItems(g().get(t,"expense.costItems"))&&(e||(t.invoiceTitle&&(d.rentInvoiceTitle=t.invoiceTitle,d.pledgeInvoiceTitle=t.invoiceTitle,d.agentInvoiceTitle=t.invoiceTitle),""===t.monthMoney||""===t.pledgeMoney||""===t.agentMoney||t.monthMoney+t.pledgeMoney+t.agentMoney!==0?n({type:"expenseHouseContract/updateHouseContract",payload:{param:M(M(M({},t),d),{},{id:a}),onSuccessCallback:l,onFailureCallback:u}}):i.ZP.error("月租金和押金金额和费用金额不能都为0！！！")))}))})),(0,f.Z)((0,u.Z)(s),"onChangeCostCenterType",(function(e){var t=s.state.platform;s.changeSubject(e,t)})),(0,f.Z)((0,u.Z)(s),"onChangePlatform",(function(e){var t=s.state.costCenterType;s.changeSubject(t,e)})),(0,f.Z)((0,u.Z)(s),"onChangeMigrateFlag",(function(e){s.setState({migrateFlag:e})})),(0,f.Z)((0,u.Z)(s),"changeSubject",(function(e,t){var o=s.props,n=o.examineFlowConfig,r=void 0===n?{}:n,a=o.form,i=(void 0===a?{}:a).setFieldsValue;if(t&&e){var c=g().get(r,"".concat(t,".accountings"),{}),u=g().get(c,"rent_accounting_id.".concat(e),""),d=g().get(c,"pledge_accounting_id.".concat(e),""),l=g().get(c,"agent_accounting_id.".concat(e),"");s.setState({subject:{rentAccountingId:u,pledgeAccountingId:d,agentAccountingId:l},costCenterType:e,platform:t}),i({rentAccountingId:u,pledgeAccountingId:d,agentAccountingId:l})}})),(0,f.Z)((0,u.Z)(s),"renderBaseInfo",(function(){var e=s.props.houseContractDetail,t=void 0===e?{}:e;return h.createElement(x.Z,{houseContractDetail:t})})),(0,f.Z)((0,u.Z)(s),"renderHistoryContract",(function(){var e=s.props.houseContractDetail,t=void 0===e?{}:e;return t.fromContractId?h.createElement(R.Z,{houseContractDetail:t}):null})),(0,f.Z)((0,u.Z)(s),"renderAccount",(function(){var e=s.props,t=e.houseContractDetail,o=void 0===t?{}:t,n=e.houseAccout,r=void 0===n?{}:n,a=e.location.query.isCreateRenew;return(void 0===a?void 0:a)||0===Object.keys(r).length?null:h.createElement(S.Z,{houseContractDetail:o,houseAccout:r,onChangePage:s.onChangePage,onShowSizeChange:s.onShowSizeChange})})),(0,f.Z)((0,u.Z)(s),"renderHouseInfo",(function(){var e=s.state.isProcessing,t=s.props,o=t.form,n=void 0===o?{}:o,r=t.houseContractDetail,a=void 0===r?{}:r,i=t.location,c=(i=void 0===i?{}:i).query,u=(void 0===c?{}:c).isCreateRenew,d=void 0===u?void 0:u;return h.createElement(w.Z,{form:n,houseContractDetail:a,disabled:e,isUpdate:!0,isCreateRenew:d})})),(0,f.Z)((0,u.Z)(s),"renderAscriptionInfo",(function(){var e=s.props,t=e.houseContractDetail,o=void 0===t?{}:t,n=e.form,r=void 0===n?{}:n;return h.createElement(O.Z,{editMode:!0,form:r,onChangeCostCenterType:s.onChangeCostCenterType,onChangePlatform:s.onChangePlatform,houseContractDetail:o})})),(0,f.Z)((0,u.Z)(s),"renderPaymentMethod",(function(){var e=s.state.isProcessing,t=s.props,o=t.houseContractDetail,n=void 0===o?{}:o,r=t.form,a=void 0===r?{}:r;return h.createElement(F.Z,{form:a,houseContractDetail:n,disabled:e})})),(0,f.Z)((0,u.Z)(s),"renderContract",(function(){var e=s.state.isProcessing,t=s.props,o=t.houseContractDetail,n=void 0===o?{}:o,r=t.form,a=void 0===r?{}:r,i=t.location,c=(i=void 0===i?{}:i).query,u=(void 0===c?{}:c).isCreateRenew,d=void 0===u?void 0:u;return h.createElement(T.Z,{form:a,houseContractDetail:n,disabled:e,isCreateRenew:d,onChangeMigrateFlag:s.onChangeMigrateFlag})})),(0,f.Z)((0,u.Z)(s),"renderRentInfo",(function(){var e=s.state,t=e.isProcessing,o=e.migrateFlag,n=e.subject,r=(n=void 0===n?{}:n).rentAccountingId,a=s.props,i=a.houseContractDetail,c=void 0===i?{}:i,u=a.form,d=void 0===u?{}:u;return h.createElement(E.Z,{migrateFlag:o,form:d,houseContractDetail:c,subjectId:r,disabled:t})})),(0,f.Z)((0,u.Z)(s),"renderDeposit",(function(){var e=s.state,t=e.isProcessing,o=e.subject,n=(o=void 0===o?{}:o).pledgeAccountingId,r=s.props,a=r.form,i=void 0===a?{}:a,c=r.houseContractDetail,u=void 0===c?{}:c,d=r.location,l=(d=void 0===d?{}:d).query,p=(void 0===l?{}:l).isCreateRenew;return h.createElement(j.Z,{form:i,houseContractDetail:u,subjectId:n,disabled:t,isCreateRenew:p})})),(0,f.Z)((0,u.Z)(s),"renderAgencyFees",(function(){var e=s.props,t=e.form,o=void 0===t?{}:t,n=e.houseContractDetail,r=void 0===n?{}:n,a=s.state,i=a.isProcessing,c=a.subject,u=(c=void 0===c?{}:c).agentAccountingId;return h.createElement(A.Z,{form:o,houseContractDetail:r,subjectId:u,disabled:i})})),(0,f.Z)((0,u.Z)(s),"renderOprations",(function(){var e=s.props,t=e.houseContractDetail,o=void 0===t?{}:t,i=e.location,c=(i=void 0===i?{}:i).query,u=void 0===c?{}:c,d=o.fromContractId,l=o.state,p=u.isCreateRenew,f=void 0===p?void 0:p;return d&&l===I.hRz.pendding||f?null:h.createElement(n.Z,{type:"flex",align:"middle",justify:"space-around",className:k.Z["app-comp-expense-house-contract-update"]},h.createElement(r.Z,null,h.createElement(a.Z,{type:"primary",size:"large",onClick:s.onSave},"保存")))})),(0,f.Z)((0,u.Z)(s),"renderRenewOprations",(function(){var e=s.props.houseContractDetail,t=void 0===e?{}:e,o=t.fromContractId,i=t.state;if(!o||i!==I.hRz.pendding&&o)return null;var c=[h.createElement(r.Z,{key:"save&generateRenew"},h.createElement(a.Z,{type:"primary",size:"large",onClick:s.onSaveAndCreateRenewOrder},"保存并生成费用申请单"))];return h.createElement(n.Z,{type:"flex",align:"middle",justify:"space-around",className:k.Z["app-comp-expense-house-contract-update"]},c)})),(0,f.Z)((0,u.Z)(s),"render",(function(){return h.createElement(P.Z,{layout:"horizontal",onSubmit:s.onSubmit},s.renderBaseInfo(),s.renderHistoryContract(),s.renderAccount(),s.renderHouseInfo(),s.renderAscriptionInfo(),s.renderContract(),s.renderRentInfo(),s.renderDeposit(),s.renderAgencyFees(),s.renderOprations(),s.renderRenewOprations())})),s.state={houseContractDetail:void 0,subject:void 0,migrateFlag:void 0,isProcessing:void 0,platform:void 0,costCenterType:void 0},s.private={searchParams:{page:1,limit:10}},s}return(0,s.Z)(o,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,o=e.location.query.id;t({type:"expenseExamineFlow/fetchExamineFlowConfig",payload:{feature:"house_contract",platforms:q.map((function(e){return e.id}))}}),t({type:"expenseHouseContract/fetchHouseAccount",payload:{id:o}})}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"expenseHouseContract/resetHouseContractDetail"}),this.props.dispatch({type:"expenseCostOrder/resetCostOrders"})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var o=e.houseContractDetail,n=void 0===o?{}:o,r=t.houseContractDetail;if(void 0===(void 0===r?void 0:r)&&Object.keys(n).length>0){var a=n.migrateFlag,i=void 0!==a&&a,c=n.rentAccountingInfo,s=(c=void 0===c?{}:c).id,u=void 0===s?"":s,d=n.pledgeAccountingInfo,l=(d=void 0===d?{}:d).id,p=void 0===l?"":l,f=n.agentAccountingInfo,v=(f=void 0===f?{}:f).id,g=void 0===v?"":v,h=n.state,m=n.costCenterType,C=n.platformCodes,y=void 0===C?[]:C;return{houseContractDetail:n,migrateFlag:Number(i),subject:{rentAccountingId:u,pledgeAccountingId:p,agentAccountingId:g},isProcessing:h===I.hRz.processing,costCenterType:m,platform:y[0]}}return null}}]),o}(h.Component);(0,f.Z)(_,"propTypes",{houseContractDetail:y().object,houseAccout:y().object,examineFlowConfig:y().object,dispatch:y().func,form:y().object}),(0,f.Z)(_,"defaultProps",{houseContractDetail:{},houseAccout:{},examineFlowConfig:{},dispatch:function(){},form:{}}),t.default=(0,m.connect)((function(e){var t=e.expenseHouseContract;return{houseContractDetail:t.houseContractDetail,houseAccout:t.houseAccout,examineFlowConfig:e.expenseExamineFlow.examineFlowConfig}}))(P.Z.create()(_))}}]);