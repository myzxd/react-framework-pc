"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[1077],{19480:function(e,t,n){n(52466);var r=n(10642),a=n(67294),i=n(38819),o=n(24311);t.Z=function(e){var t=e.visible,n=e.title,l=void 0===n?"批量付款":n,c=e.onCancel;return a.createElement(r.Z,{title:l,visible:t,footer:null,onCancel:c},a.createElement("div",{className:o.Z["wallet-paystate-modal-wrap"]},a.createElement(i.Z,{className:o.Z["wallet-paystate-modal-icon"]}),a.createElement("div",{className:o.Z["wallet-paystate-modal-title"]},"付款完成")))}},31077:function(e,t,n){n.r(t),n.d(t,{default:function(){return T}});var r=n(4942),a=n(29439),i=n(55609),o=n(67294),l=n(96036),c=n(80385),d=(n(21316),n(75443)),p=(n(52560),n(71577)),u=(n(9070),n(20924)),s=(n(35668),n(86585)),f=n(15861),m=(n(29093),n(16317)),y=n(87757),_=n.n(y),h=n(45430);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=m.Z.Option,w=function(e){var t=e.onSearch,n=e.onReset,r=e.dispatch,i=e.tabKey,y=e.searchVal,b=(0,o.useState)({}),w=(0,a.Z)(b,2),E=w[0],Z=w[1];(0,o.useEffect)((function(){E&&E.resetFields&&E.resetFields()}),[i,E]);var x=function(){var e=(0,f.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.validateFields();case 2:t=e.sent,r({type:"wallet/onExportBills",payload:g(g(g({},y),t),{},{state:i})});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V={items:[o.createElement(s.Z.Item,{label:"类型",name:"type"},o.createElement(m.Z,{placeholder:"请选择",showSearch:!0,allowClear:!0},o.createElement(v,{value:c.JmV.approval},c.JmV.description(c.JmV.approval)),o.createElement(v,{value:c.JmV.code},c.JmV.description(c.JmV.code)))),o.createElement(s.Z.Item,{label:"提报人",name:"informant",initialValue:void 0},o.createElement(u.Z,{placeholder:"请输入",allowClear:!0}))],onSearch:t,onReset:n,onHookForm:function(e){return Z(e)},operations:h.ZP.canOperateWalletBillsExport()?o.createElement(d.Z,{title:"创建下载任务？",onConfirm:x,okText:"确认",cancelText:"取消"},o.createElement(p.Z,{type:"primary"},"导出报表")):""};return o.createElement(l.IT,null,o.createElement(l.j6,V))},E=(n(20186),n(75385)),Z=(n(55295),n(69713)),x=(n(51838),n(48086)),V=n(93517),O=n.n(V),P=n(30381),I=n.n(P),C=(n(52466),n(10642)),S=n(87462),j={labelCol:{span:8},wrapperCol:{span:16}},B=function(e){var t=e.visible,n=e.onCancel,r=e.data,a=void 0===r?{}:r,i=e.dispatch,l=a._id,d=function(){var e=(0,f.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({type:"wallet/onPayBill",payload:{billIds:[l]}});case 2:(t=e.sent)&&t.ok&&n&&n(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o.createElement(C.Z,{title:"确认付款信息",visible:t,onOk:d,onCancel:n},o.createElement(s.Z,{className:"affairs-flow-node-time-line-form"},o.createElement(s.Z.Item,(0,S.Z)({label:"账单编号"},j),O().get(a,"_id","--")),o.createElement(s.Z.Item,(0,S.Z)({label:"关联审批单号"},j),O().get(a,"ref_id","--")),o.createElement(s.Z.Item,(0,S.Z)({label:"审批单提报人"},j),O().get(a,"order_apply_info.name","--")),o.createElement(s.Z.Item,(0,S.Z)({label:"账单总金额"},j),"￥",c.fbc.exchangePriceCentToMathFormat(O().get(a,"total_money",0))),o.createElement(s.Z.Item,(0,S.Z)({label:"付款金额"},j),"￥",c.fbc.exchangePriceCentToMathFormat(O().get(a,"unpaid_money",0)))))},k=n(24311),K=function(e){var t,n=e.visible,r=e.onCancel,a=e.billIds,i=void 0===a?[]:a,l=e.data,d=void 0===l?[]:l,u=e.dispatch,s=d.filter((function(e){return i.find((function(t){return t===e._id}))})),m=function(){var e=(0,f.Z)(_().mark((function e(){var t;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u({type:"wallet/onPayBill",payload:{billIds:i}});case 2:(t=e.sent)&&t.ok&&r&&r(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=[{title:"账单编号",dataIndex:"_id",width:120},{title:"关联审批单号",dataIndex:"ref_id",width:120,render:function(e){return e||"--"}},{title:"审批单提报人",dataIndex:["order_apply_info","name"],width:100},{title:"账单总金额",dataIndex:"total_money",width:100,render:function(e){return e?c.fbc.exchangePriceCentToMathFormat(e):"0.00"}},{title:"账单待付款金额",dataIndex:"unpaid_money",width:100,render:function(e){return e?o.createElement("div",{className:k.Z["wallet-bill-batch-pay-money"]},c.fbc.exchangePriceCentToMathFormat(e)):o.createElement("div",{className:k.Z["wallet-bill-batch-pay-money"]},"0.00")}},{title:"主题标签",dataIndex:["application_order_info","theme_label_list"],width:100,render:function(e){return t=e,Array.isArray(t)&&t.length>3?o.createElement(Z.Z,{title:t.map((function(e){return e})).join(" 、 ")},o.createElement("div",null,t.slice(0,3).map((function(e){return e})).join(" 、 "))):Array.isArray(t)&&t.length<=3&&t.length>0?o.createElement("div",null,t.map((function(e){return e})).join("、")):"--";var t}}];return o.createElement(C.Z,{title:"确认付款信息",visible:n,onOk:m,onCancel:r,width:710,footer:(t=s.reduce((function(e,t){return e+t.unpaid_money}),0),o.createElement("div",{className:k.Z["wallet-bill-batch-pay-footer"]},o.createElement("div",{className:k.Z["wallet-bill-batch-pay-footer-title"]},"付款合计金额：",o.createElement("span",{className:k.Z["wallet-bill-batch-pay-footer-money"]},"￥",c.fbc.exchangePriceCentToMathFormat(t))),o.createElement("div",null,o.createElement(p.Z,{onClick:function(){return r()}},"取消"),o.createElement(p.Z,{onClick:function(){return m()},type:"primary"},"确定"))))},o.createElement(E.Z,{rowKey:function(e,t){return e._id||t},columns:y,dataSource:s,pagination:!1,bordered:!0,scroll:{y:300}}))},J=n(19480),D=function(e){var t=e.dispatch,n=e.walletBills,r=void 0===n?{}:n,i=e.onShowSizeChange,u=void 0===i?function(){}:i,s=e.onChangePage,m=void 0===s?function(){}:s,y=e.getWalletBills,b=e.loading,g=void 0!==b&&b,v=(0,o.useState)([]),w=(0,a.Z)(v,2),V=w[0],P=w[1],C=(0,o.useState)({}),S=(0,a.Z)(C,2),j=S[0],k=S[1],D=(0,o.useState)(!1),A=(0,a.Z)(D,2),M=A[0],T=A[1],F=(0,o.useState)(!1),W=(0,a.Z)(F,2),Y=W[0],q=W[1],z=(0,o.useState)(!1),N=(0,a.Z)(z,2),H=N[0],U=N[1],L=(0,o.useState)("批量付款"),R=(0,a.Z)(L,2),Q=R[0],X=R[1],G=r.data,$=void 0===G?[]:G,ee=r._meta,te=void 0===ee?{}:ee;(0,o.useEffect)((function(){P([])}),[r]);var ne=function(e){T(!1),e&&e.ok&&(y&&y(),U(!0),X("确认付款信息"))},re=function(e){q(!1),P([]),e&&e.ok&&(y&&y(),U(!0),X("批量付款"))},ae=function(){var e=(0,f.Z)(_().mark((function e(n){var r;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t({type:"wallet/onVoidBill",payload:{billId:n,state:c.EKV.void}});case 2:(r=e.sent)&&r._id?(x.ZP.success("请求成功"),y&&y()):x.ZP.error("请求失败");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(e,t){if(Array.isArray(e)&&e.length>3){var n="inspect"===t?e.map((function(e){return e.name})).join(" 、 "):e.map((function(e){return e})).join(" 、 ");return o.createElement(Z.Z,{title:n},o.createElement("div",null,"inspect"===t?e.slice(0,3).map((function(e){return e.name})).join(" 、 "):e.slice(0,3).map((function(e){return e})).join(" 、 "),"..."))}return Array.isArray(e)&&e.length<=3&&e.length>0?o.createElement("div",null,"inspect"===t?e.map((function(e){return e.name})).join("、"):e.map((function(e){return e})).join("、")):"--"},oe=[{title:"账单编号",dataIndex:"_id",width:120,fixed:"left"},{title:"审批单提报人",dataIndex:["order_apply_info","name"],width:100,fixed:"left",render:function(e){return e||"--"}},{title:"账单生成时间",dataIndex:"created_at",width:120,fixed:"left",render:function(e){return e?I()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"关联审批单号",dataIndex:"ref_id",width:120,fixed:"left",render:function(e){return e||"--"}},{title:"账单总金额",dataIndex:"total_money",render:function(e){return e?c.fbc.exchangePriceCentToMathFormat(e):"0.00"}},{title:"已支付金额",dataIndex:"paid_money",render:function(e){return e?c.fbc.exchangePriceCentToMathFormat(e):"0.00"}},{title:"未支付金额",dataIndex:"unpaid_money",render:function(e){return e?c.fbc.exchangePriceCentToMathFormat(e):"0.00"}},{title:"支付中金额",dataIndex:"paying_money",render:function(e){return e?c.fbc.exchangePriceCentToMathFormat(e):"0.00"}},{title:"主题标签",dataIndex:["application_order_info","theme_label_list"],render:function(e,t){return t.type===c.JmV.approval?ie(e,"theme"):t.type===c.JmV.code?ie(O().get(t,"qoa_order_info.theme_label_list",[]),"theme"):"--"}},{title:"是否有验票标签",dataIndex:["application_order_info","inspect_bill_label_list"],render:function(e,t){if(t.type===c.JmV.approval)return Array.isArray(e)&&e.length>0?"有":"无";if(t.type===c.JmV.code){var n=O().get(t,"qoa_order_info.inspect_bill_label_list",[]);return Array.isArray(n)&&n.length>0?"有":"无"}return"--"}},{title:"验票标签",dataIndex:["application_order_info","inspect_bill_label_list"],render:function(e,t){return t.type===c.JmV.approval?ie(e,"inspect"):t.type===c.JmV.code?ie(O().get(t,"qoa_order_info.inspect_bill_label_list",[]),"inspect"):"--"}},{title:"提报日期",dataIndex:["application_order_info","submit_at"],render:function(e,t){if(t.type===c.JmV.approval)return e?I()(e).format("YYYY-MM-DD HH:mm:ss"):"--";if(t.type===c.JmV.code){var n=O().get(t,"qoa_order_info.submit_at",void 0);return n?I()(n).format("YYYY-MM-DD HH:mm:ss"):"--"}return"--"}},{title:"归属周期",dataIndex:["application_order_info","belong_time"],render:function(e,t){return t.type===c.JmV.approval?e||"--":t.type===c.JmV.code?O().get(t,"qoa_order_info.belong_month","--"):"--"}},{title:"审批流",dataIndex:["application_order_info","flow_info","name"],render:function(e,t){return t.type===c.JmV.approval?e||"--":t.type===c.JmV.code&&O().get(t,"qoa_order_info.flow_info.name",void 0)||"--"}},{title:"审批类型",dataIndex:["application_order_info","application_order_type"],render:function(e,t){return t.type===c.JmV.approval?e?c.ZBL.description(e):"--":t.type===c.JmV.code&&O().get(t,"qoa_order_info.cost_center_type",void 0)?c.Xr3.description(O().get(t,"qoa_order_info.cost_center_type")):"--"}},{title:"流程状态",dataIndex:["application_order_info","state"],render:function(e,t){return t.type===c.JmV.approval?e?c.DU5.description(e):"--":t.type===c.JmV.code&&O().get(t,"qoa_order_info.state",void 0)?c.DU5.description(O().get(t,"qoa_order_info.state")):"--"}},{title:"当前节点",dataIndex:["application_order_info","current_flow_node_info","name"],render:function(e,t){return t.type===c.JmV.approval?e||"--":t.type===c.JmV.code&&O().get(t,"qoa_order_info.current_node.name",void 0)||"--"}},{title:"验票状态",dataIndex:["application_order_info","inspect_bill_state"],render:function(e,t){return t.type===c.JmV.approval?e?c.xTp.description(e):"--":t.type===c.JmV.code&&O().get(t,"qoa_order_info.inspect_bill_state",void 0)?c.A1w.description(O().get(t,"qoa_order_info.inspect_bill_state",void 0)):"--"}},{title:"账单状态",dataIndex:"state",width:80,fixed:"right",render:function(e){return e?c.EKV.description(e):"--"}},{title:"操作",dataIndex:"_id",width:100,fixed:"right",render:function(e,t){var n=t.state,r=t.unpaid_money,a=void 0===r?0:r,i="/#/Wallet/Bills/Detail?id=".concat(e);return o.createElement("div",null,h.ZP.canOperateWalletBillsPay()&&n!==c.EKV.done&&n!==c.EKV.void&&0!==a?o.createElement("a",{onClick:function(){return function(e){k(e),T(!0)}(t)}},"付款"):"",h.ZP.canOperateWalletBillsDetail()?o.createElement("a",{href:i,style:{marginLeft:10},target:"_blank",rel:"noopener noreferrer"},"查看详情"):"",h.ZP.canOperateWalletBillsPay()&&n===c.EKV.toBePaid?o.createElement(d.Z,{title:"确认作废当前账单？",onConfirm:function(){return ae(e)}},o.createElement("a",{style:{marginLeft:10}},"作废")):"")}}],le={current:te.page||1,defaultPageSize:30,pageSize:te.page_size||30,showQuickJumper:!0,showSizeChanger:!0,onChange:m,onShowSizeChange:u,showTotal:function(e){return"总共".concat(e,"条")},total:te.result_count,pageSizeOptions:["10","20","30","40"]},ce={selectedRowKeys:V,onChange:P,columnWidth:50,getCheckboxProps:function(e){var t=e.state,n=e.unpaid_money,r=void 0===n?0:n;return{disabled:t===c.EKV.done||t===c.EKV.void||t===c.EKV.payOngoing&&0===r}}},de=h.ZP.canOperateWalletBillsPay()?o.createElement(p.Z,{type:"primary",disabled:V.length<2,onClick:function(){return q(!0)}},"批量付款"):"";return o.createElement(l.IT,{title:de,isShowIcon:!0},o.createElement(E.Z,{rowKey:function(e,t){return e._id||t},loading:g,columns:oe,dataSource:$,pagination:le,rowSelection:ce,bordered:!0,scroll:{x:2200,y:500}}),o.createElement(B,{data:j,visible:M,onCancel:ne,dispatch:t}),o.createElement(K,{visible:Y,billIds:V,onCancel:re,data:$,dispatch:t}),o.createElement(J.Z,{visible:H,onCancel:function(){return U(!1)},title:Q}))};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T=(0,i.connect)((function(e){return{walletBills:e.wallet.walletBills}}))((function(e){var t=e.dispatch,n=e.walletBills,r=void 0===n?{}:n,i=(0,o.useState)(c.EKV.toBePaid),d=(0,a.Z)(i,2),p=d[0],u=d[1],s=(0,o.useState)(!0),f=(0,a.Z)(s,2),m=f[0],y=f[1],_=(0,o.useRef)({page:1,limit:30,state:c.EKV.toBePaid}),h=function(){y(!1)};(0,o.useEffect)((function(){return t({type:"wallet/getWalletBills",payload:M(M({},_.current),{},{onLoading:h})}),function(){t({type:"wallet/resetWalletBills"})}}),[t]);var b=function(){y(!0),t({type:"wallet/resetWalletBills"}),t({type:"wallet/getWalletBills",payload:M(M({},_.current),{},{onLoading:h})})},g=function(e,t){_.current=M(M({},_.current),{},{page:e,limit:t}),b()},v={onSearch:function(e){_.current=M(M({},_.current),e),b()},onReset:function(e){_.current=M(M(M({},_.current),e),{},{page:1,limit:30}),b()},dispatch:t,tabKey:p,searchVal:_.current},E={walletBills:r,onChangePage:g,onShowSizeChange:g,dispatch:t,getWalletBills:b,loading:m},Z=function(){return o.createElement(o.Fragment,null,o.createElement(w,v),o.createElement(D,E))},x=[{title:c.EKV.description(c.EKV.toBePaid),content:Z(),key:c.EKV.toBePaid},{title:c.EKV.description(c.EKV.payOngoing),content:Z(),key:c.EKV.payOngoing},{title:c.EKV.description(c.EKV.done),content:Z(),key:c.EKV.done},{title:c.EKV.description(c.EKV.void),content:Z(),key:c.EKV.void}];return o.createElement(l.DF,{items:x,onChange:function(e){_.current={page:1,limit:30,state:e},u(e),b()}})}))},24311:function(e,t){t.Z={"wallet-paystate-modal-wrap":"uygbhEiHxnSixoShiVUB","wallet-paystate-modal-icon":"O4Iu1ZwysQlKyIt1_CAe","wallet-paystate-modal-title":"p59fOGZ2y8jHFYe8lMKA","wallet-pay-detail-payee-btn-wrap":"oYpekOaeRU6TlM6DwwKh","wallet-pay-detail-payee-btn":"DSy0fXXQ6ZgzEUn9G2BS","wallet-bill-content-title":"DxpUdgYn6sMAs5DWjX5c","wallet-bill-batch-pay-money":"yogrmmQdqT9gyP61cjLj","wallet-bill-batch-pay-footer":"oPJfMSS0ccU5AVAVxhXm","wallet-bill-batch-pay-footer-title":"rvTQzACdA9WSFUXndfLQ","wallet-bill-batch-pay-footer-money":"A8cVyER9zuSMTmANEgI7"}}}]);