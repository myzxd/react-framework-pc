"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[3744],{23744:function(e,t,r){r.r(t),r.d(t,{default:function(){return ue}});r(52560);var a=r(71577),n=r(55609),o=r(67294),l=r(96036),c=r(34387),i=r(87462),d=(r(438),r(14277)),s=r(29439),m=(r(19597),r(27279)),u=r(80385),p=(r(35668),r(86585)),f=r(93517),_=r.n(f),v=(r(20186),r(75385)),y=function(e){var t=e.detail,r=void 0===t?{}:t,a=e.isShowMoney,n=void 0===a||a,c=e.isShowTitle,i=void 0!==c&&c,s=e.isApproveOrder,m=void 0!==s&&s,p=r.total_money,f=void 0===p?0:p,y=r.paid_state,E=m?_().get(r,"actual_payee_list",[]):_().get(r,"payee_list",[]);if(y!==u.rTI.done&&m)return o.createElement(d.Z,{description:"无付款明细"});var h;return o.createElement(l.IT,{title:i?"收款信息":null},n&&o.createElement("div",{style:{textAlign:"center",margin:"5px 0"}},"金额合计",u.fbc.exchangePriceCentToMathFormat(f),"元"),(h=[{title:"收款人",dataIndex:"card_name",render:function(e,t){return e?"".concat(e," ").concat(t.card_phone?"(".concat(t.card_phone,")"):""):"--"}},{title:"银行卡号",dataIndex:"card_num",render:function(e){return e||"--"}},{title:"开户支行",dataIndex:"bank_details",render:function(e){return e||"--"}},{title:"金额（元）",dataIndex:"money",render:function(e){return e>=0?u.fbc.exchangePriceCentToMathFormat(e):"--"}},{title:"".concat(m?"付款方式":"收款方式"),dataIndex:"payee_type",render:function(e){return e?u.vaC.description(e):"--"}}],o.createElement(v.Z,{bordered:!0,columns:h,pagination:!1,dataSource:E,rowKey:function(e,t){return e._id||t},scroll:{y:400}})))},E=(r(13062),r(71230)),h=(r(36616),r(51368)),b=(r(36037),r(47933)),Z=(r(89032),r(15746)),g=(r(9070),r(20924)),x=(r(21316),r(75443)),I=(r(51838),r(48086)),O=r(4942),C=r(15861),F=(r(29093),r(16317)),w=r(87757),P=r.n(w),D=r(73218),M=r(73171),T=r(15873),k=r(45430);function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){(0,O.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var S=F.Z.Option,z=(0,n.connect)()((function(e){var t,r=e.dispatch,n=e.cost,c=void 0===n?{}:n,d=e.detail,m=void 0===d?{}:d,f=e.examineOrderDetail,_=void 0===f?{}:f,v=e.namespace,y=k.ZP.canOperateModuleCodeOrderDetail(),O=m._id,w=m.total_cost_bill_amount,Y=void 0===w?0:w,z=m.total_tax_amount_amount,A=void 0===z?0:z,U=m.total_tax_deduction_amount,L=void 0===U?0:U,N=m.cost_bill_list,H=void 0===N?[]:N,R=c.is_bill_red_push,V=void 0!==R&&R,B=c.is_add_cost_bill,q=void 0!==B&&B,K=Array.isArray(H)&&H.find((function(e){return e.type===u.R4S.avt})),X=_._id,W=p.Z.useForm(),G=(0,s.Z)(W,1)[0],$=(0,o.useState)(!1),J=(0,s.Z)($,2),Q=J[0],ee=J[1],te=(0,o.useState)(!1),re=(0,s.Z)(te,2),ae=re[0],ne=re[1],oe=(0,o.useState)(!1),le=(0,s.Z)(oe,2),ce=le[0],ie=le[1],de=(0,o.useState)(!0),se=(0,s.Z)(de,2),me=se[0],ue=se[1],pe=(0,o.useState)(0),fe=(0,s.Z)(pe,2),_e=fe[0],ve=fe[1],ye={labelCol:{span:9},wrapperCol:{span:15}},Ee=function(){var e=(0,C.Z)(P().mark((function e(){var t,a;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G.validateFields();case 2:return t=e.sent,e.next=5,r({type:"codeOrder/addCostOrderInvoice",payload:j(j({},t),{},{costOrderId:O,orderId:X})});case 5:(a=e.sent)&&a._id?(r({type:"codeOrder/getCostOrderList",payload:{orderId:X}}),r({type:"codeOrder/fetchOrderCostItem",payload:{id:c._id,orderId:X,namespace:v}}),ee(!1),G.resetFields()):a&&a.zh_message&&I.ZP.error(a.zh_message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(){var e=(0,C.Z)(P().mark((function e(){var t;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({type:"codeOrder/pushRedCostOrder",payload:{costOrderId:O,orderId:X}});case 2:(t=e.sent)&&t._id&&(I.ZP.success("请求成功"),r({type:"codeOrder/getCostOrderList",payload:{orderId:X}}),r({type:"codeOrder/fetchOrderCostItem",payload:{id:c._id,orderId:X,namespace:v}}),r({type:"codeOrder/getApproveOrderDetail",payload:{orderId:X}}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(e){var t=e.target.value,r=G.getFieldValue("taxRate"),a=G.getFieldValue("money");t===u.R4S.ordinary?(a&&G.setFieldsValue({tax:0,noTax:a}),!a&&G.setFieldsValue({tax:void 0,noTax:void 0}),G.setFieldsValue({taxRate:u.vU.zero}),ne(!0),ie(!1),ue(!0)):(void 0!==a&&void 0!==r&&G.setFieldsValue({tax:(a/(1+r)*r).toFixed(2),noTax:(a-a/(1+r)*r).toFixed(2)}),(!a||!r)&&G.setFieldsValue({tax:void 0,noTax:void 0}),r===u.vU.zero&&G.setFieldsValue({taxRate:void 0}),ne(!1),ie(!0),ue(!1))},Ze=function(e){var t=G.getFieldValue("taxRate");if(void 0!==e&&void 0!==t){var r=e/(1+t)*t;G.setFieldsValue({tax:r.toFixed(2)})}if(void 0!==e&&void 0!==t){var a=e-e/(1+t)*t;G.setFieldsValue({noTax:a.toFixed(2)})}ve(e)},ge=function(e){var t=G.getFieldValue("money");if(void 0!==e&&void 0!==t){var r=t/(1+e)*e;G.setFieldsValue({tax:r.toFixed(2)})}if(void 0!==e&&void 0!==t){var a=t-t/(1+e)*e;G.setFieldsValue({noTax:a.toFixed(2)})}},xe=function(e){var t,r=G.getFieldValue("money");void 0!==e&&void 0!==r&&(t=(1e3*r-1e3*e)/1e3),G.setFieldsValue({noTax:t})},Ie=function(){var e=(0,C.Z)(P().mark((function e(t){var a;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({type:"codeOrder/deleteOrderInvoice",payload:{id:t,costOrderId:O,orderId:X}});case 2:(a=e.sent)&&a._id?(r({type:"codeOrder/getCostOrderList",payload:{orderId:X}}),r({type:"codeOrder/fetchOrderCostItem",payload:{id:c._id,orderId:X,namespace:v}})):a&&a.zh_message&&I.ZP.error(a.zh_message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Oe=o.createElement("div",null,q&&y&&o.createElement(a.Z,{type:"primary",style:{marginRight:"5px"},disabled:Q,onClick:function(){return ee(!0)}},"添加发票信息"),V&&K&&y?o.createElement(x.Z,{title:"请确认您是否红冲",onConfirm:function(){return he()}},o.createElement(a.Z,{type:"primary"},"红冲")):null);return o.createElement(l.IT,{title:"发票信息",titleExt:Oe},(t=[{label:"发票总金额",form:"".concat(u.fbc.exchangePriceCentToMathFormat(Y),"元")},{label:"费用总金额",form:"".concat(u.fbc.exchangePriceCentToMathFormat(L),"元")},{label:"总税金",form:"".concat(u.fbc.exchangePriceCentToMathFormat(A),"元")}],o.createElement(l.KP,{items:t,cols:3,layout:ye})),o.createElement("div",null,H.map((function(e,t){var r=e.code,a=void 0===r?void 0:r,n=e.type,c=void 0===n?void 0:n,i=e.money,d=void 0===i?0:i,s=e.tax_rate,m=void 0===s?void 0:s,p=e.tax_amount,f=void 0===p?0:p,_=e.tax_deduction,v=void 0===_?0:_,y=e._id,E=void 0===y?void 0:y,h=[{label:"发票".concat(t+1,"编号"),form:a||"--"},{label:"发票类型",form:c?u.R4S.description(c):"--"},{label:"发票金额",form:"".concat(u.fbc.exchangePriceCentToMathFormat(d),"元")},{label:"税率",form:void 0!==m?u.vU.description(m):"--"},{label:"费用金额",form:"".concat(u.fbc.exchangePriceCentToMathFormat(v),"元")},{label:"税金",form:"".concat(u.fbc.exchangePriceCentToMathFormat(f),"元")}];return q&&(h[h.length]={label:"",layout:{labelCol:{span:0},wrapperCol:{span:24}},form:o.createElement(x.Z,{title:"你确定要删除这行内容吗？",icon:o.createElement(D.Z,{style:{color:"red"}}),onConfirm:function(){return Ie(E)}},o.createElement(M.Z,{style:{color:"red",fontSize:"16px"}}))}),o.createElement(l.KP,{items:h,cols:4,layout:ye,key:t})}))),function(){var e=[{required:!0,message:"请输入"}],t=[{required:!0,message:"请选择"}];if(Q){var r={margin:"10px 0"};return o.createElement(p.Z,(0,i.Z)({layout:"inline",form:G},{labelCol:{span:6},wrapperCol:{span:18}}),o.createElement(E.Z,null,o.createElement(Z.Z,{span:8,style:r},o.createElement(p.Z.Item,{name:"code",label:"发票编号",rules:[{required:!1},{pattern:/^[A-Za-z0-9]+$/,message:"编号只可以为数字或字母"}]},o.createElement(g.Z,null))),o.createElement(Z.Z,{span:8,style:r},o.createElement(p.Z.Item,{name:"type",label:"发票类型",rules:t},o.createElement(b.ZP.Group,{onChange:be},o.createElement(b.ZP,{value:u.R4S.ordinary},u.R4S.description(u.R4S.ordinary)),o.createElement(b.ZP,{value:u.R4S.avt},u.R4S.description(u.R4S.avt))))),o.createElement(Z.Z,{span:8,style:r},o.createElement(p.Z.Item,{name:"money",label:"发票金额",rules:e},o.createElement(h.Z,{min:0,step:.01,formatter:u.fbc.limitDecimals,parser:u.fbc.limitDecimals,onChange:Ze}))),o.createElement(Z.Z,{span:6,style:r},o.createElement(p.Z.Item,{name:"taxRate",label:"税率",rules:t},o.createElement(F.Z,{disabled:ae,style:{width:"100px"},onChange:ge},o.createElement(S,{value:u.vU.zero,disabled:ce},u.vU.description(u.vU.zero)),o.createElement(S,{value:u.vU.three},u.vU.description(u.vU.three)),o.createElement(S,{value:u.vU.five},u.vU.description(u.vU.five)),o.createElement(S,{value:u.vU.six},u.vU.description(u.vU.six)),o.createElement(S,{value:u.vU.nine},u.vU.description(u.vU.nine)),o.createElement(S,{value:u.vU.ten},u.vU.description(u.vU.ten)),o.createElement(S,{value:u.vU.thirteen},u.vU.description(u.vU.thirteen))))),o.createElement(Z.Z,{span:6,style:r},o.createElement(p.Z.Item,{name:"tax",label:"税额",rules:e},o.createElement(h.Z,{min:0,max:_e,step:.01,formatter:u.fbc.limitDecimals,parser:u.fbc.limitDecimals,disabled:me,onChange:xe}))),o.createElement(Z.Z,{span:6,style:r},o.createElement(p.Z.Item,{name:"noTax",label:"去税额",rules:e},o.createElement(h.Z,{min:0,step:.01,formatter:u.fbc.limitDecimals,parser:u.fbc.limitDecimals,disabled:!0}))),o.createElement(Z.Z,{span:6,style:j({display:"flex",alignItems:"center",justifyContent:"flex-start"},r)},o.createElement(p.Z.Item,null,o.createElement(D.Z,{style:{color:"red",fontSize:"16px"},onClick:function(){return G.resetFields(),void ee(!1)}})),o.createElement(p.Z.Item,null,o.createElement(T.Z,{style:{color:"green",fontSize:"16px"},onClick:function(){return Ee()}})))))}}())})),A=l.KT.CoreFinderList,U={labelCol:{span:8},wrapperCol:{span:16}},L={labelCol:{span:2},wrapperCol:{span:22}};var N=(0,n.connect)((function(e){return{orderCostItem:e.codeOrder.orderCostItem}}))((function(e){var t=e.cost,r=void 0===t?{}:t,a=e.orderId,n=e.approveOrderDetail,c=void 0===n?{}:n,d=e.dispatch,s=e.orderCostItem,m=void 0===s?{}:s,f=r._id,v=m[f]||{},E=v.total_money,h=void 0===E?0:E,b=v.total_tax_amount_amount,Z=void 0===b?0:b,g=v.type,x=v.bill_red_push_state,I=v.payment_total_money,O=void 0===I?0:I;(0,o.useEffect)((function(){if(r._id&&a){var e={id:r._id,orderId:a,namespace:f};d({type:"codeOrder/fetchOrderCostItem",payload:e})}return function(){d({type:"codeOrder/reduceOrderCostItem",payload:{namespace:f,result:{}}})}}),[d,r,a,f]);var C=O;g===u.rkq.normal&&x===u.LLt.done&&(C-=Z);var F="--";_().get(v,"cost_center_type")===u.Xr3.code&&(F=_().get(v,"biz_code_info.name","--")),_().get(v,"cost_center_type")===u.Xr3.team&&(F=_().get(v,"biz_team_info.name","--"));var w=[o.createElement(p.Z.Item,(0,i.Z)({label:"科目"},U),_().get(v,"biz_account_info.name","--"),_().get(v,"biz_account_info.ac_code")?"(".concat(_().get(v,"biz_account_info.ac_code"),")"):""),o.createElement(p.Z.Item,(0,i.Z)({label:"核算中心"},U),F),o.createElement(p.Z.Item,(0,i.Z)({label:"提报金额"},U),u.fbc.exchangePriceCentToMathFormat(h),"元"),o.createElement(p.Z.Item,(0,i.Z)({label:"付款金额"},U),u.fbc.exchangePriceCentToMathFormat(O),"元"),o.createElement(p.Z.Item,(0,i.Z)({label:"费用金额"},U),u.fbc.exchangePriceCentToMathFormat(C),"元")],P=[o.createElement(p.Z.Item,(0,i.Z)({label:"发票抬头"},L),_().get(v,"invoice_title","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"事项说明"},L),o.createElement("div",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"}},_().get(v,"note","--"))),o.createElement(p.Z.Item,(0,i.Z)({label:"附件"},L),function(e){if(Array.isArray(e)&&_().get(e,"0.file_url")){var t=e.map((function(e){return{key:e.file_name,url:e.file_url}}));return o.createElement(A,{data:t})}return"--"}(_().get(v,"attachment_private_urls",[])))];return o.createElement(o.Fragment,null,o.createElement(p.Z,{className:"affairs-flow-detail-basic"},o.createElement(l.Fp,{items:w,cols:4}),o.createElement(l.Fp,{items:P,cols:1})),o.createElement(y,{detail:v,isShowMoney:!1,isShowTitle:!0}),function(){if(!(Object.keys(v).length<=0))return o.createElement(z,{detail:v,cost:r,namespace:f,examineOrderDetail:c})}())})),H=r(30381),R=r.n(H),V=l.KT.CoreFinderList,B={labelCol:{span:8},wrapperCol:{span:16}},q={labelCol:{span:2},wrapperCol:{span:22}},K={labelCol:{span:10},wrapperCol:{span:14}},X={labelCol:{span:4},wrapperCol:{span:20}};var W=(0,n.connect)((function(e){return{travelOrder:e.codeOrder.travelOrder}}))((function(e){var t=e.cost,r=void 0===t?{}:t,a=e.orderId,n=e.approveOrderDetail,c=void 0===n?{}:n,d=e.dispatch,s=e.travelOrder,m=r._id,f=s[m]||{};(0,o.useEffect)((function(){if(r._id&&a&&r.type!==u.rkq.invoiceAdjust){var e={id:r._id,orderId:a,namespace:m};d({type:"codeOrder/fetchTravelOrder",payload:e})}return function(){d({type:"codeOrder/reduceTravelOrder",payload:{namespace:m,result:{}}})}}),[d,r,a,m]);var v=c.plugin_extra_meta,E=void 0===v?{}:v;if(r.type===u.rkq.invoiceAdjust){var h={cost:r,orderId:a,approveOrderDetail:c};return o.createElement(N,h)}if(Object.keys(f).length<1)return o.createElement("div",null);var b,Z,g,x,I,O,C,F,w,P,D,M,T,k,Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)return{};var t={province:e.province_name,city:e.city_name,area:e.area_name};return e.detailed_address&&(t.detailed_address=e.detailed_address),t},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e||!Array.isArray(e))return[];var t=e.map((function(e){var t={province:e.province_name,city:e.city_name,area:e.area_name};return e.detailed_address&&(t.detailed_address=e.detailed_address),t}));return t},S=function(e){if(Array.isArray(e)&&_().get(e,"0.file_url")){var t=e.map((function(e){return{key:e.file_name,url:e.file_url}}));return o.createElement(V,{data:t})}return"--"},A=function(){var e=f.travel_fee_extra_data,t=void 0===e?{}:e,r=t.subsidy_fee,a=t.stay_fee,n=t.transport_fee,c=t.urban_transport_fee,d=t.other_fee,s=[o.createElement(p.Z.Item,(0,i.Z)({label:"补助"},K),o.createElement("span",{style:{color:_().get(t,"is_out_subsidy_fee",!1)?"red":""}},u.fbc.exchangePriceCentToMathFormat(r)),"元"),o.createElement(p.Z.Item,(0,i.Z)({label:"住宿"},K),o.createElement("span",{style:{color:_().get(t,"is_out_stay_fee",!1)?"red":""}},u.fbc.exchangePriceCentToMathFormat(a)),"元"),o.createElement(p.Z.Item,(0,i.Z)({label:"市内交通费"},K),u.fbc.exchangePriceCentToMathFormat(c),"元")];return _().get(t,"high_speed_train_fee")&&s.push(o.createElement(p.Z.Item,(0,i.Z)({label:"动车/高铁交通费"},K),u.fbc.exchangePriceCentToMathFormat(_().get(t,"high_speed_train_fee")),"元")),_().get(t,"aircraft_fee")&&s.push(o.createElement(p.Z.Item,(0,i.Z)({label:"飞机交通费"},K),u.fbc.exchangePriceCentToMathFormat(_().get(t,"aircraft_fee")),"元")),_().get(t,"train_ordinary_soft_sleeper_fee")&&s.push(o.createElement(p.Z.Item,(0,i.Z)({label:"普通软卧交通费"},K),u.fbc.exchangePriceCentToMathFormat(_().get(t,"train_ordinary_soft_sleeper_fee")),"元")),_().get(t,"bus_fee")&&s.push(o.createElement(p.Z.Item,(0,i.Z)({label:"客车交通费"},K),u.fbc.exchangePriceCentToMathFormat(_().get(t,"bus_fee")),"元")),_().get(t,"self_driving_fee")&&s.push(o.createElement(p.Z.Item,(0,i.Z)({label:"自驾交通费"},K),u.fbc.exchangePriceCentToMathFormat(_().get(t,"self_driving_fee")),"元")),n&&s.push(o.createElement(p.Z.Item,(0,i.Z)({label:"往返交通费"},K),u.fbc.exchangePriceCentToMathFormat(n),"元")),d&&s.push(o.createElement(p.Z.Item,(0,i.Z)({label:"其他"},K),u.fbc.exchangePriceCentToMathFormat(d),"元")),o.createElement("div",{style:{backgroundColor:"#F6F6F6",borderRadius:"2px"}},o.createElement("div",{style:{color:"#282D36",height:32,lineHeight:"32px",fontWeight:500}},"差旅费用明细",o.createElement("span",{style:{fontWeight:400,marginLeft:10}},"明细超标将会用红色字体显示")),o.createElement(p.Z,{className:"affairs-flow-detail-basic"},o.createElement(l.Fp,{items:s,cols:4})))};return o.createElement(o.Fragment,null,f.travel_order_type===u.coV.oa?(b=f.travel_order_info,g=(Z=void 0===b?{}:b).expect_start_at,x=Z.expect_done_at,I=Z.actual_start_at,O=Z.actual_done_at,C=Z.destination_list,F=void 0===C?[]:C,w=Z.departure,P=void 0===w?{}:w,D=g&&x?"".concat(R()(g).format("YYYY.MM.DD HH:00")," - ").concat(R()(x).format("YYYY.MM.DD HH:00")):"--",M=I&&O?"".concat(R()(I).format("YYYY.MM.DD HH:00")," - ").concat(R()(O).format("YYYY.MM.DD HH:00")):"--",T=_().get(E,"is_plugin_order",!1)?_().get(Z,"_id","--"):o.createElement("a",{href:"/#/Expense/Manage/ExamineOrder/Detail?orderId=".concat(Z.oa_application_order_id),target:"_blank",rel:"noopener noreferrer"},_().get(Z,"_id","--")),k=[o.createElement(p.Z.Item,(0,i.Z)({label:"出差单号"},B),T),o.createElement(p.Z.Item,(0,i.Z)({label:"实际出差人"},B),_().get(Z,"apply_user_name","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"部门"},B),o.createElement("div",null,_().get(Z,"department_info.name","--"))),o.createElement(p.Z.Item,(0,i.Z)({label:"岗位"},B),o.createElement("div",null,_().get(Z,"job_info.name","--"))),o.createElement(p.Z.Item,(0,i.Z)({label:"职级"},B),o.createElement("div",null,_().get(Z,"work_level","--"))),{span:24,render:o.createElement(p.Z.Item,(0,i.Z)({label:"预计出差时间"},q),D)},{span:24,render:o.createElement(p.Z.Item,(0,i.Z)({label:"出发地"},q),Object.values(Y(P)).join("-"))},{span:24,render:o.createElement(p.Z.Item,(0,i.Z)({label:"目的地"},q),j(F).map((function(e){return Object.values(e).join("-")})).join(" 、"))},{span:12,render:o.createElement(p.Z.Item,(0,i.Z)({label:"实际出差时间"},X),M)},{span:12,render:o.createElement(p.Z.Item,(0,i.Z)({label:"出差天数"},X),_().get(Z,"actual_apply_days","--"),"天",_().get(Z,"actual_apply_days")>_().get(Z,"expect_apply_days")?o.createElement("span",null,"（",o.createElement("span",{style:{color:"red"}},"申请出差天数：",_().get(Z,"expect_apply_days"),"天"),"）"):"")}],o.createElement(p.Z,{className:"affairs-flow-detail-basic",style:{backgroundColor:"#F6F6F6",borderRadius:"2px"}},o.createElement(l.Fp,{items:k,cols:4}))):function(){var e=f.travel_order_info,t=void 0===e?{}:e,r=t.expect_start_at,a=t.expect_done_at,n=t.actual_start_at,c=t.actual_done_at,d=t.departure,s=void 0===d?{}:d,m=t.destination,u=void 0===m?{}:m,v=r&&a?"".concat(R()(r).format("YYYY.MM.DD HH:00")," - ").concat(R()(a).format("YYYY.MM.DD HH:00")):"--",y=n&&c?"".concat(R()(n).format("YYYY.MM.DD HH:00")," - ").concat(R()(c).format("YYYY.MM.DD HH:00")):"--",h=_().get(E,"is_plugin_order",!1)?_().get(t,"_id","--"):o.createElement("a",{href:"/#/Expense/TravelApplication/Detail?id=".concat(t._id),target:"_blank",rel:"noopener noreferrer"},_().get(t,"_id","--")),b=[o.createElement(p.Z.Item,(0,i.Z)({label:"出差单号"},B),h),o.createElement(p.Z.Item,(0,i.Z)({label:"实际出差人"},B),_().get(t,"apply_user_name","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"预计出差时间"},B),v),o.createElement(p.Z.Item,(0,i.Z)({label:"实际出差时间"},B),y),o.createElement(p.Z.Item,{label:"出发地"},Object.values(Y(s)).join("-")),o.createElement(p.Z.Item,{label:"目的地"},j([u]).map((function(e){return Object.values(e).join("-")})).join(" 、")),o.createElement(p.Z.Item,(0,i.Z)({label:"出差天数"},B),_().get(t,"actual_apply_days","--"),"天",_().get(t,"actual_apply_days")>_().get(t,"expect_apply_days")?o.createElement("span",null,"（",o.createElement("span",{style:{color:"red"}},"申请出差天数：",_().get(t,"expect_apply_days"),"天"),"）"):"")];return o.createElement(p.Z,{className:"affairs-flow-detail-basic",style:{backgroundColor:"#F6F6F6",borderRadius:"2px"}},o.createElement(l.Fp,{items:b,cols:4}))}(),function(){var e="--";_().get(f,"cost_center_type")===u.Xr3.code&&(e=_().get(f,"biz_code_info.name","--")),_().get(f,"cost_center_type")===u.Xr3.team&&(e=_().get(f,"biz_team_info.name","--"));var t=[o.createElement(p.Z.Item,(0,i.Z)({label:"科目"},B),_().get(f,"biz_account_info.name","--"),_().get(f,"biz_account_info.ac_code")?"(".concat(_().get(f,"biz_account_info.ac_code"),")"):""),o.createElement(p.Z.Item,(0,i.Z)({label:"核算中心"},B),e)],r=[o.createElement(p.Z.Item,{label:"",wrapperCol:{span:22,push:1}},A()),o.createElement(p.Z.Item,(0,i.Z)({label:"提报金额"},q),o.createElement("div",{style:{height:32,lineHeight:"32px"}},u.fbc.exchangePriceCentToMathFormat(_().get(f,"total_money",0)),"元")),o.createElement(p.Z.Item,(0,i.Z)({label:"发票抬头"},q),_().get(f,"invoice_title","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"事项说明"},q),o.createElement("div",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"}},_().get(f,"note","--"))),o.createElement(p.Z.Item,(0,i.Z)({label:"附件"},q),S(_().get(f,"attachment_private_urls",[])))];return o.createElement(p.Z,{className:"affairs-flow-detail-basic"},o.createElement(l.Fp,{items:t,cols:4}),o.createElement(l.Fp,{items:r,cols:1}))}(),o.createElement(y,{detail:f,isShowMoney:!1,isShowTitle:!0}),function(){if(!(Object.keys(f).length<=0))return o.createElement(z,{detail:f,cost:r,examineOrderDetail:c})}())})),G={labelCol:{span:3},wrapperCol:{span:14}},$=function(e){var t=e.detail,r=void 0===t?{}:t,a=_().get(r,"total_money",0)-_().get(r," total_tax_amount_amount",0),n=[o.createElement(p.Z.Item,(0,i.Z)({label:"科目"},G),_().get(r,"subject","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"转出方"},G),_().get(r,"accountCenter","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"发票抬头"},G),_().get(r,"invoice","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"付款金额"},G),u.fbc.exchangePriceCentToMathFormat(_().get(r,"totalMoney",0)),"元"),o.createElement(p.Z.Item,(0,i.Z)({label:"费用金额"},G),u.fbc.exchangePriceCentToMathFormat(a),"元"),o.createElement(p.Z.Item,(0,i.Z)({label:"事由说明"},G),_().get(r,"note","--")),o.createElement(p.Z.Item,(0,i.Z)({label:"附件"},G),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return o.createElement("div",null,e.map((function(e,r){return o.createElement("p",{key:r},o.createElement("a",{rel:"noopener noreferrer",target:"_blank",key:r,href:e},t[r]))})))}(_().get(r,"attachmentPrivateUrls",[]),_().get(r,"attachments",[])))];return o.createElement(o.Fragment,null,o.createElement(p.Z,{className:"affairs-flow-detail-basic"},o.createElement(l.Fp,{items:n,cols:1})))},J=(r(52466),r(10642)),Q=r(93433),ee=r(97116),te=r(45498),re=ee.By.isEnablExpenseCollectionPayeeType(),ae=function(e){var t=e.dispatch,r=e.visible,a=e.onCancel,n=e.detail,l=void 0===n?{}:n,c=e.approveOrderDetail,i=void 0===c?{}:c,d=l.payment_total_money,m=void 0===d?0:d,f=l.payee_list,_=void 0===f?[]:f,y=l.total_money,E=l.cost_update_rule,Z=p.Z.useForm(),g=(0,s.Z)(Z,1)[0],x=(0,o.useState)(!1),O=(0,s.Z)(x,2),F=O[0],w=O[1],D=(0,o.useState)(m),M=(0,s.Z)(D,2),T=M[0],k=M[1];(0,o.useEffect)((function(){l&&Object.keys(l).length>0&&k(l.payment_total_money)}),[l]);var Y,j,S=function(){var e=_.map((function(e){return e._id})),t=g.getFieldsValue((0,Q.Z)(e)),r=Object.values(t).reduce((function(e,t){return e+t.money}),0);k(100*r)},z=function(){var e=(0,C.Z)(P().mark((function e(){var r,a,n,o,c;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.validateFields();case 2:return r=e.sent,e.next=5,w(!0);case 5:if(a=Object.values(r).map((function(e){return e.money})),n=a.reduce((function(e,t){return e+t}),0),o=(100*n).toFixed(6),!(E===u.E_Z.down&&o>y)){e.next=11;break}return w(!1),e.abrupt("return",I.ZP.error("付款金额不能大于提报金额"));case 11:return e.next=13,t({type:"codeOrder/onUpdateOrderMoney",payload:{orderId:i._id,costOrderId:l._id,payeeList:r}});case 13:if(!(c=e.sent)||!c._id){e.next=26;break}return I.ZP.success("请求成功"),t({type:"codeOrder/getCostOrderList",payload:{orderId:i._id}}),e.next=19,t({type:"codeOrder/reduceOrderCostItem",payload:{namespace:l._id,result:{}}});case 19:return t({type:"codeOrder/getApproveOrderDetail",payload:{orderId:i._id}}),e.next=22,t({type:"codeOrder/fetchOrderCostItem",payload:{id:l._id,orderId:i._id,namespace:l._id}});case 22:w(!1),A(),e.next=28;break;case 26:w(!1),c&&c.zh_message&&I.ZP.error(c.zh_message);case 28:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){w(!1),g.resetFields(),a&&a()};return j={},_.forEach((function(e){j[e._id]={payee_type:e.payee_type||void 0,money:e.money?u.fbc.exchangePriceToYuan(e.money):void 0}})),o.createElement(J.Z,{title:"修改金额",visible:r,onOk:z,width:750,onCancel:A,confirmLoading:F},o.createElement("span",{className:te.Z["code-order-cost-header-money-modal"]},o.createElement("span",{className:te.Z["code-order-cost-header-tax"]},o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"提报金额："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(y),"元")),o.createElement("span",{className:te.Z["code-order-cost-header-tax"]},o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"付款金额："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(T),"元"))),o.createElement(p.Z,{form:g,initialValues:j,className:"affairs-flow-basic"},(Y=[{title:"收款人",dataIndex:"card_name",width:150,render:function(e,t){return e?"".concat(e," ").concat(t.card_phone?"(".concat(t.card_phone,")"):""):"--"}},{title:"银行卡号",dataIndex:"card_num",width:150,render:function(e){return e||"--"}},{title:"开户支行",dataIndex:"bank_details",width:150,render:function(e){return e||"--"}},{title:"收款方式",dataIndex:"payee_type",width:100,render:function(e,t){return o.createElement(p.Z.Item,{name:[[t._id],"payee_type"]},o.createElement(b.ZP.Group,null,o.createElement(b.ZP,{value:u.vaC.onlineBanking},u.vaC.description(u.vaC.onlineBanking)),re&&o.createElement(b.ZP,{value:u.vaC.wallet,disabled:!t.payee_employee_id},u.vaC.description(u.vaC.wallet))))}},{title:"金额",dataIndex:"money",width:100,render:function(e,t){return o.createElement(p.Z.Item,{name:[[t._id],"money"],rules:[{required:!0,message:"请输入"},{type:"number",min:.01,message:"金额不能为0"}]},o.createElement(h.Z,{precision:2,min:.01,placeholder:"请填写金额",formatter:u.fbc.limitDecimalsFormatter,parser:u.fbc.limitDecimalsParser,onChange:S}))}}],o.createElement(v.Z,{bordered:!0,columns:Y,pagination:!1,dataSource:_,rowKey:function(e,t){return e._id||t},scroll:{y:400}}))))},ne=m.Z.Panel,oe=(0,n.connect)((function(e){return{costOrderList:e.codeOrder.costOrderList}}))((function(e){var t=e.approveOrderDetail,r=void 0===t?{}:t,a=e.costOrderList,n=void 0===a?{}:a,c=e.dispatch,p=(0,o.useState)([]),f=(0,s.Z)(p,2),_=f[0],v=f[1],y=(0,o.useState)(!1),E=(0,s.Z)(y,2),h=E[0],b=E[1],Z=(0,o.useState)({}),g=(0,s.Z)(Z,2),x=g[0],I=g[1],O=r._id,C=r.biz_order_ids,F=void 0===C?[]:C,w=r.paid_money,P=void 0===w?0:w;(0,o.useEffect)((function(){return c({type:"codeOrder/getCostOrderList",payload:{orderId:O}}),function(){c({type:"codeOrder/resetCostOrderList"})}}),[c,O]);var D=n.data,M=void 0===D?[]:D;if(!Array.isArray(M)||M.length<1)return o.createElement(l.IT,{title:"费用单"},o.createElement(d.Z,null));var T,k=function(){I({}),b(!1)},Y=o.createElement("span",{onClick:function(){_.length===F.length?v([]):v(F)},style:{cursor:"pointer"}},_.length!==F.length?"全部展开":"全部收起");return o.createElement(l.IT,{title:"费用单 （提示：橘色的审批单为提报金额与付款金额不一致的单据！）",titleExt:Y},o.createElement(m.Z,{activeKey:_,onChange:function(e){return v(e)}},M.map((function(e){var t=e.total_money,a=void 0===t?0:t,n=e.total_tax_amount_amount,l=void 0===n?0:n,c=e.type,d=e.bill_red_push_state,s=e.payment_total_money,m=void 0===s?0:s,p=e.allow_update_money,f=void 0!==p&&p,_=m;c===u.rkq.normal&&d===u.LLt.done&&(_=m-l);var v=o.createElement("div",{className:te.Z["code-order-cost-header"]},o.createElement("span",null,o.createElement("span",null,"费用单号："),o.createElement("span",{style:a!==m?{color:"#FF7700"}:null},e._id)),o.createElement("span",null,o.createElement("span",{className:te.Z["code-order-cost-header-tax"]},o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"税金："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(l),"元")),o.createElement("span",{className:te.Z["code-order-cost-header-tax"]},o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"提报金额："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(a),"元")),o.createElement("span",{className:te.Z["code-order-cost-header-tax"]},o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"付款金额："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(m),"元")),o.createElement("span",{className:te.Z["code-order-cost-header-tax"]},o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"费用金额："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(_),"元")),f&&o.createElement("a",{onClick:function(t){return function(e,t){e&&e.stopPropagation(),I(t),b(!0)}(t,e)},style:{color:"#FF7700"}},"修改金额")));return o.createElement(ne,{header:v,key:e._id},function(e){var t=r.template_type,a={cost:e,orderId:O,approveOrderDetail:r};return t===u.fz4.travel?o.createElement(W,(0,i.Z)({key:e._id},a)):t===u.fz4.transfer?o.createElement($,(0,i.Z)({key:e._id},a)):o.createElement(N,(0,i.Z)({key:e._id},a))}(e))}))),function(){if(h)return o.createElement(ae,{visible:h,dispatch:c,onCancel:k,detail:x,approveOrderDetail:r})}(),(T=M.reduce((function(e,t){return e+t.total_tax_amount_amount}),0),o.createElement("div",{className:te.Z["code-order-cost-footer"]},o.createElement("span",null,o.createElement("span",{className:te.Z["code-order-cost-header-tax"]},o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"总税金："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(T),"元")),o.createElement("span",null,o.createElement("span",{className:te.Z["code-order-cost-header-money-text"]},"合计金额："),o.createElement("span",null,u.fbc.exchangePriceCentToMathFormat(P),"元"))))))})),le=(r(55295),r(69713)),ce=r(97418),ie=m.Z.Panel,de=(0,n.connect)((function(e){return{relationOrderList:e.codeOrder.relationOrderList}}))((function(e){var t=e.orderId,r=e.dispatch,a=e.relationOrderList,n=void 0===a?{}:a;(0,o.useEffect)((function(){return r({type:"codeOrder/getRelationOrderList",payload:{page:1,limit:999,orderId:t}}),function(){r({type:"codeOrder/reduceRelationOrderList",payload:{}})}}),[r,t]);var c=n.data,i=void 0===c?[]:c;if(!Array.isArray(i)||i.length<1)return o.createElement(d.Z,null);var s=function(e){var t=k.ZP.canOperateModuleCodeOrderDetail();return o.createElement(o.Fragment,null,t?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.order_type===u.phB.new?o.createElement("a",{href:"/#/Code/PayOrder/Detail?orderId=".concat(e._id,"&isShowOperation=true")},"查看"):e.order_type===u.phB.old?o.createElement("a",{key:"detail",href:"javascript:void(window.open('/#/Expense/Manage/ExamineOrder/Detail?orderId=".concat(e._id,"'));"),rel:"noopener noreferrer"},"查看"):"--"}(e):"--")},p=[{title:"审批单标题",dataIndex:"name",fixed:"left",width:150,render:function(e){return e||"--"}},{title:"审批单号",dataIndex:"_id",width:120,fixed:"left"},{title:"主题标签",dataIndex:"theme_label_list",width:150,render:function(e){return f(e)}},{title:"验票标签",dataIndex:"inspect_bill_label_list",width:150,render:function(e){return f(e,"inspect")}},{title:"归属",dataIndex:"cost_center_type",width:120,render:function(e,t){return t.order_type===u.phB.new?e?u.Xr3.description(e):"--":t.order_type===u.phB.old?e>=100?ce.z0.titleByKey(e):e?u.ZBL.description(e):"--":"--"}},{title:"发票抬头",dataIndex:"invoice_title",width:150,render:function(e){return e||"--"}},{title:"付款金额",dataIndex:"paid_money",width:120,render:function(e){return e?u.fbc.exchangePriceCentToMathFormat(e):"0.00"}},{title:"申请人",dataIndex:["apply_account_info","name"],width:120,render:function(e){return e||"--"}},{title:"提报时间",dataIndex:"submit_at",width:150,render:function(e){return e?R()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"付款时间",dataIndex:"paid_at",width:150,render:function(e){return e?R()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"流程状态",dataIndex:"state",width:120,render:function(e){return e?u.DU5.description(e):"--"}},{title:"操作",dataIndex:"_id",fixed:"right",key:"operate",width:80,render:function(e,t){return s(t)}}],f=function(e,t){if(Array.isArray(e)&&e.length>3){var r="inspect"===t?e.map((function(e){return e.name})).join(" 、 "):e.map((function(e){return e})).join(" 、 ");return o.createElement(le.Z,{title:r},o.createElement("div",null,"inspect"===t?e.slice(0,3).map((function(e){return e.name})).join(" 、 "):e.slice(0,3).map((function(e){return e})).join(" 、 "),"..."))}return Array.isArray(e)&&e.length<=3&&e.length>0?o.createElement("div",null,"inspect"===t?e.map((function(e){return e.name})).join("、"):e.map((function(e){return e})).join("、")):"--"};return o.createElement(l.IT,null,o.createElement(m.Z,null,o.createElement(ie,{header:"关联审批单"},o.createElement(v.Z,{rowKey:function(e,t){return e._id||t},dataSource:i,columns:p,pagination:!1,bordered:!0,scroll:{x:1580}}))))})),se=r(39032),me=r(72438),ue=(0,n.connect)((function(e){return{approveOrderDetail:e.codeOrder.approveOrderDetail}}))((function(e){var t=e.location,r=e.dispatch,n=e.approveOrderDetail,i=void 0===n?{}:n,d=t.query,s=d.orderId,m=d.isShowOperation;if((0,o.useEffect)((function(){return s&&r({type:"codeOrder/getApproveOrderDetail",payload:{orderId:s}}),function(){r({type:"codeOrder/resetApproveOrderDetail"})}}),[r,s]),Object.keys(i).length<1)return o.createElement("div",null);var u,p={approveOrderDetail:i,dispatch:r},f={approveOrderDetail:i},_={orderId:s},v={approveOrderDetail:i,dispatch:r},E={detail:i,isApproveOrder:!0};return o.createElement(o.Fragment,null,o.createElement(c.Z,p),(u=[{title:"关联审批",content:o.createElement(de,_),key:"relateOrder"},{title:"主题标签",content:o.createElement(me.Z,{orderId:s}),key:"themeLabel"},{title:"付款明细",content:o.createElement(y,E),key:"paymentDetail"}],o.createElement(l.DF,{items:u})),o.createElement(oe,f),o.createElement(se.Z,v),function(){if("true"!==m)return o.createElement("div",{style:{textAlign:"center"}},o.createElement(a.Z,{href:"/#/Code/PayOrder"},"返回"))}())}))}}]);