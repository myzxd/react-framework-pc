"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[3318],{73318:function(e,t,a){a.r(t),a.d(t,{default:function(){return ee}});a(20186);var n=a(75385),r=(a(21316),a(75443)),l=a(15671),o=a(43144),i=a(97326),s=a(60136),c=a(82963),p=a(61120),u=a(4942),d=a(45697),f=a.n(d),m=a(67294),y=a(93517),h=a.n(y),Z=a(30381),v=a.n(Z),C=a(55609),g=(a(13062),a(71230)),E=(a(89032),a(15746)),D=(a(52560),a(71577)),b=(a(9070),a(20924)),P=(a(55295),a(69713)),S=(a(36037),a(47933)),k=(a(51838),a(48086)),w=(a(54071),a(14072)),T=(a(29093),a(16317)),I=(a(26574),a(9676)),x=a(1870),N=a(66939),F=(a(98703),"bIkFLIZ6y7ff7Z6XsQXe"),M="uVIlwLhVeHdcsz01SvPs",V="T28baq4rVEDwWtKQOVlF",B="dE3SPsFrREuy_VX2lIJi",G="VQavGjQllrDKDJrJGMPT",Y="HBUbVSe3HRgLsdtoj3iA",Q="xWOog3GEVrLNlb7ICae_",R="U_O3TXv5HheOWhzSoZuD",q="GL8mSEcH8tRajLIiua3s",A="GvwjMgqlyA4qPHvtf6oA",L=a(96036),O=a(80385),z=a(45430),U=a(88144);function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,p.Z)(e);if(t){var r=(0,p.Z)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,c.Z)(this,a)}}var W=I.Z.Group,X=T.Z.Option,j=w.Z.MonthPicker,J=function(e){(0,s.Z)(a,e);var t=H(a);function a(e){var n;return(0,l.Z)(this,a),n=t.call(this,e),(0,u.Z)((0,i.Z)(n),"componentDidMount",(function(){n.onSetDate()})),(0,u.Z)((0,i.Z)(n),"onReset",(function(){n.setState({fields:{platforms:"",suppliers:"",cities:"",districts:"",work:[O.EbQ.first],startDate:"",cycle:O.sBG.month,deductions:O.TVX.taskNo,day:1,date:1}}),n.props.form.resetFields()})),(0,u.Z)((0,i.Z)(n),"onUpdateData",(function(){n.props.dispatch({type:"financeTask/fetchPayrollPlanList"})})),(0,u.Z)((0,i.Z)(n),"onFailureCallback",(function(e){k.ZP.error(e.zh_message)})),(0,u.Z)((0,i.Z)(n),"onCreatePayday",(function(e){var t=n.state.fields;e.preventDefault(),n.props.form.validateFieldsAndScroll((function(e,a){if(!e){var r=a.platforms,l=a.suppliers,o=a.cities,i=a.cycle,s=a.deductions,c=a.day,p={platforms:r,suppliers:l,cities:o,work:t.work,startDate:Number(v()(t.startDate).format("YYYYMMDD")),cycle:i,deductions:s,day:Number(t.day),date:c};n.props.dispatch({type:"financeTask/createPayrollPlan",payload:{params:p,onSuccessCallback:n.onUpdateData,onFailureCallback:n.onFailureCallback}})}}))})),(0,u.Z)((0,i.Z)(n),"onChangePlatforms",(function(e){var t=n.props.form,a=n.state.fields;a.platforms=e,a.suppliers="",a.districts="",a.cities="",n.setState({fields:a}),t.setFieldsValue({suppliers:""}),t.setFieldsValue({cities:""})})),(0,u.Z)((0,i.Z)(n),"onChangeSuppliers",(function(e){var t=n.props.form,a=n.state.fields;a.suppliers=e,a.cities="",a.districts="",n.setState({fields:a}),t.setFieldsValue({cities:""})})),(0,u.Z)((0,i.Z)(n),"onChangeCity",(function(e){var t=n.state.fields;t.cities=e,n.setState({fields:t})})),(0,u.Z)((0,i.Z)(n),"onChangeDistrict",(function(e){var t=n.state.fields;t.districts=e,n.setState({fields:t})})),(0,u.Z)((0,i.Z)(n),"onChangeWork",(function(e){var t=n.state.fields;t.work=e,n.setState({fields:t})})),(0,u.Z)((0,i.Z)(n),"onChangeStartDate",(function(e,t){var a=n.state.fields;a.startDate=t,n.setState({fields:a})})),(0,u.Z)((0,i.Z)(n),"onChangeCycle",(function(e){var t=n.state.fields,a=n.props.form;t.cycle=e,Number(e)===O.sBG.day?n.setState({text:"天",isShowDay:!0,isShowModal:!0}):n.setState({text:"月",isShowDay:!1,isShowModal:!0}),n.setState({fields:t}),a.setFieldsValue({day:"1"})})),(0,u.Z)((0,i.Z)(n),"onChangeDay",(function(e){var t=n.state.fields;t.day=e.target.value,e.target.value>0?t.day=e.target.value:t.day=1,n.setState({fields:t})})),(0,u.Z)((0,i.Z)(n),"onSetDate",(function(){for(var e=(new Date).getFullYear(),t=(new Date).getMonth()+1,a=new Date(e,t,1),r=new Date(a.getTime()-1e3).getDate(),l=[],o=[],i=1;i<=r;i+=1)o.push(i),i<=12&&l.push(i);n.setState({dayItem:l,monthItem:o})})),(0,u.Z)((0,i.Z)(n),"renderCreateForm",(function(){var e=n.props.form.getFieldDecorator,t=n.state.fields,a=t.platforms,r=t.suppliers,l=t.day,o=[],i=n.state,s=i.isShowDay,c=i.dayItem,p=i.monthItem;s?o.push(p.map((function(e,t){return m.createElement(X,{key:t,value:"".concat(e)},e)}))):o.push(c.map((function(e,t){return m.createElement(X,{key:t,value:"".concat(e)},e)})));var u=[{label:O.EbQ.description(O.EbQ.first),value:O.EbQ.first},{label:O.EbQ.description(O.EbQ.second),value:O.EbQ.second}],d=[{label:"平台:",span:8,layout:{labelCol:{span:5},wrapperCol:{span:16}},form:e("platforms",{rules:[{required:!0,message:"请选择平台"}],initialValue:void 0})(m.createElement(U.Yg,{allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"请选择平台",onChange:n.onChangePlatforms}))},{label:"供应商:",span:8,layout:{labelCol:{span:7},wrapperCol:{span:16}},form:e("suppliers",{rules:[{required:!0,message:"请选择供应商"}],initialValue:void 0})(m.createElement(U.o2,{state:O.Acu.enable,allowClear:!0,showSearch:!0,optionFilterProp:"children",platforms:a,placeholder:"请选择供应商",onChange:n.onChangeSuppliers}))},{label:"城市:",span:8,layout:{labelCol:{span:5},wrapperCol:{span:16}},form:e("cities",{rules:[{required:!0,message:"请选择城市"}],initialValue:void 0})(m.createElement(U.Wn,{isExpenseModel:!0,className:"maxHeight",enableSelectAll:!0,allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"请选择城市",platforms:a,suppliers:r,onChange:n.onChangeCity}))},{label:"个户类型:",span:8,layout:{labelCol:{span:5},wrapperCol:{span:15}},form:e("work",{rules:[{required:!0,message:"请选择个户类型"}],initialValue:O.EbQ.first})(m.createElement(S.ZP.Group,null,m.createElement(W,{options:u,defaultValue:[O.EbQ.first],onChange:n.onChangeWork},u.label)))},{label:"首次开始月份:",span:8,layout:{labelCol:{span:7},wrapperCol:{span:15}},form:e("StartDate",{rules:[{required:!0,message:"请选择首次开始日期"}],initialValue:null})(m.createElement(j,{onChange:n.onChangeStartDate,format:"YYYY-MM"}))},{label:"结算周期:",span:5,layout:{labelCol:{span:8},wrapperCol:{span:14}},form:e("cycle",{rules:[{required:!0,message:"请选择结算周期"}],initialValue:"".concat(O.sBG.month)})(m.createElement(T.Z,{placeholder:"请选择结算周期",onChange:n.onChangeCycle,disabled:!0},m.createElement(X,{value:"".concat(O.sBG.day)},O.sBG.description(O.sBG.day)),m.createElement(X,{value:"".concat(O.sBG.month)},O.sBG.description(O.sBG.month))))},{label:"",span:3,layout:{labelCol:{span:0},wrapperCol:{span:15}},form:e("day",{rules:[{required:!0,message:"请选择首次开始日期"}],initialValue:"1"})(m.createElement(T.Z,{onChange:n.onChangeDate,disabled:!0},o))},{label:"计算执行",span:8,layout:{labelCol:{span:5},wrapperCol:{span:17}},form:e("perform",{rules:[{required:!0,message:"计算执行"}],initialValue:1})(m.createElement("div",{className:M},m.createElement("div",{className:V},m.createElement(P.Z,{title:"结算任务的开始时间点"},m.createElement(x.Z,{className:B})),m.createElement("span",{className:Y},m.createElement(P.Z,{title:"结算周期最后一日延"},"结算周期最后一日延"))),m.createElement(b.Z,{addonAfter:"天",value:l,type:"Number",className:Q,onChange:n.onChangeDay})))}];return m.createElement(L.KP,{items:d})})),(0,u.Z)((0,i.Z)(n),"renderForm",(function(){return m.createElement("div",{className:F},m.createElement(L.IT,{title:"创建结算计划设置"},m.createElement(N.Z,null,n.renderCreateForm()),m.createElement(g.Z,{className:"app-global-mgr10"},m.createElement(E.Z,{span:11,className:G},m.createElement(D.Z,{type:"primary",onClick:n.onReset},"清空")),m.createElement(E.Z,{span:11,offset:1},!z.ZP.canOperateFinanceManageTaskCreate()||m.createElement(D.Z,{type:"primary",onClick:n.onCreatePayday},"创建")))))})),n.state={fields:{platforms:"",suppliers:"",cities:"",work:[O.EbQ.first],startDate:void 0,cycle:O.sBG.month,deductions:O.TVX.taskNo,day:1,date:1},text:"月",isShowDay:!1,dayItem:[],monthItem:[]},n}return(0,o.Z)(a,[{key:"render",value:function(){return m.createElement("div",null,this.renderForm())}}]),a}(m.Component);var K=(0,C.connect)((function(e){return{financeTask:e.financeTask}}))(N.Z.create()(J));function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,p.Z)(e);if(t){var r=(0,p.Z)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,c.Z)(this,a)}}var $=function(e){(0,s.Z)(a,e);var t=_(a);function a(e){var o;return(0,l.Z)(this,a),o=t.call(this,e),(0,u.Z)((0,i.Z)(o),"onUpdate",(function(e){o.setState({isShowEditModal:!0,itemInfo:{id:e.id,payrollCycleType:e.payrollCycleType,cycleInterval:e.cycleInterval,workType:e.workType,computeDelayDays:e.pdatedAt,platformName:e.platformCode,cityCode:e.cityCode,supplierId:e.supplierId,initExecuteDate:e.createdAt}})})),(0,u.Z)((0,i.Z)(o),"onHideModal",(function(){o.setState({isShowEditModal:!1})})),(0,u.Z)((0,i.Z)(o),"onUpdateDisableData",(function(){o.props.dispatch({type:"financeTask/fetchPayrollPlanList"})})),(0,u.Z)((0,i.Z)(o),"onDisable",(function(e){var t={id:e.id,state:O.rDf.on};o.props.dispatch({type:"financeTask/updatePayrollPlanState",payload:{params:t,onSuccessCallback:o.onUpdateDisableData}})})),(0,u.Z)((0,i.Z)(o),"onUpdateEnableData",(function(){o.props.dispatch({type:"financeTask/fetchPayrollPlanList"})})),(0,u.Z)((0,i.Z)(o),"onEnable",(function(e){var t={id:e.id,state:O.rDf.off};o.props.dispatch({type:"financeTask/updatePayrollPlanState",payload:{params:t,onSuccessCallback:o.onUpdateEnableData}})})),(0,u.Z)((0,i.Z)(o),"onChangeCount",(function(e){o.private.countParams=e,o.private.countParams.page||(o.private.countParams.page=1),o.private.countParams.limit||(o.private.countParams.limit=30),o.props.dispatch({type:"financeTask/fetchPayrollPlanList",payload:o.private.countParams})})),(0,u.Z)((0,i.Z)(o),"onChangePage",(function(e,t){o.private.countParams.page=e,o.private.countParams.limit=t,o.onChangeCount(o.private.countParams)})),(0,u.Z)((0,i.Z)(o),"onShowSizeChange",(function(e,t){o.private.countParams.page=e,o.private.countParams.limit=t,o.onChangeCount(o.private.countParams)})),(0,u.Z)((0,i.Z)(o),"renderContent",(function(){var e=o.private.countParams.page,t=o.props.payrollPlanData,a=void 0===t?{}:t,l=h().get(a,"data",[]),i=h().get(a,"meta.count",0),s=[{title:"代码",dataIndex:"id",render:function(e){return e||"--"}},{title:"平台",dataIndex:"platformName",render:function(e){return e||"--"}},{title:"供应商",dataIndex:"supplierName",render:function(e){return e||"--"}},{title:"城市",dataIndex:"cityName",render:function(e){return e||"--"}},{title:"个户类型",dataIndex:"workType",render:function(e){return O.EbQ.description(e)}},{title:"结算周期",dataIndex:"cycleInterval",render:function(e,t){return m.createElement("span",null,O.sBG.description(t.payrollCycleType)," / ",e)}},{title:"计算执行日",dataIndex:"computeDelayDays",render:function(e,t){return m.createElement("span",null,O.sBG.description(t.payrollCycleType)," + ",e)}},{title:"首次开始月份",dataIndex:"initExecuteDate",render:function(e){return e||"--"}},{title:"创建日期",dataIndex:"createdAt",render:function(e){return e?v()(e).format("YYYY-MM-DD"):"--"}},{title:"最后操作日期",dataIndex:"updatedAt",render:function(e){return e?v()(e).format("YYYY-MM-DD"):"--"}},{title:"创建者",dataIndex:["creatorInfo","name"]},{title:"最后操作者",dataIndex:["operatorInfo","name"],render:function(e){return e||"--"}},{title:"操作",dataIndex:"state",render:function(e,t){var a=[],n=m.createElement("div",{className:R},m.createElement("h4",null,"你确定要禁用该结算任务?"),m.createElement("p",{className:q},"备注：禁用后请及时创建新的结算任务,否则影响结算单生成!"));return t.state===O.rDf.on?a.push(m.createElement(r.Z,{placement:"top",title:n,okText:"确认",key:"1",onConfirm:function(){o.onEnable(t)},cancelText:"取消"},!z.ZP.canOperateFinanceManageTaskDisable()||m.createElement("a",{className:A},"禁用"))):a.push(m.createElement(r.Z,{placement:"top",title:"你确定要启用该结算任务?",okText:"确认",key:"2",onConfirm:function(){o.onDisable(t)},cancelText:"取消"},!z.ZP.canOperateFinanceManageTaskEnable()||m.createElement("a",{className:A},"启用"))),m.createElement("span",null,a)}}],c={showSizeChanger:!0,showQuickJumper:!0,defaultPageSize:30,onShowSizeChange:o.onShowSizeChange,total:i,showTotal:function(e){return"总共".concat(e,"条")},pageSizeOptions:["10","20","30","40"],onChange:o.onChangePage};return e&&(c.current=e),m.createElement("div",null,m.createElement(n.Z,{columns:s,pagination:c,rowKey:function(e,t){return e.id||t},scroll:{x:1e3},dataSource:l,bordered:!0}))})),(0,u.Z)((0,i.Z)(o),"renderCreatePaydayTask",(function(){var e=(0,i.Z)(o).onSearch;return m.createElement(K,{onSearch:e})})),o.state={isShowEditModal:!1,itemInfo:{id:void 0,payrollCycleType:void 0,cycleInterval:void 0,workType:void 0,computeDelayDays:void 0,platformName:void 0,cityCode:void 0,supplierId:void 0,initExecuteDate:void 0}},o.private={countParams:{}},o}return(0,o.Z)(a,[{key:"componentDidMount",value:function(){this.props.dispatch({type:"financeTask/fetchPayrollPlanList"})}},{key:"render",value:function(){return m.createElement("div",null,this.renderCreatePaydayTask(),this.renderContent())}}]),a}(m.Component);(0,u.Z)($,"propTypes",{payrollPlanData:f().object}),(0,u.Z)($,"defaultProps",{payrollPlanData:{}});var ee=(0,C.connect)((function(e){return{payrollPlanData:e.financeTask.payrollPlanData}}))($)}}]);