"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[9257],{78877:function(e,t,r){r(51838);var n=r(48086),o=r(94315),a=r.n(o),i=r(96486),c=r.n(i),l=r(80385);t.Z=function(e,t){var r=!0;if(t)r=!1;else{if(e.money<=0)return r=!1,void n.ZP.error("费用金额必须大于0");var o=e.expense,i=o.costItems,s=o.costBelong,d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(a().empty(e))return n.ZP.error("分摊数据为空"),!0;if(a().not.array(e))return n.ZP.error("分摊数据格式错误"),!0;var r={vendor:"分摊信息供应商未选择",platform:"分摊信息平台未选择",city:"分摊信息城市未选择",district:"分摊信息商圈未选择",costCount:"分摊金额不能为空"},o=!1,i=!1;return e.forEach((function(e,c){!0!==o&&(a().empty(e)&&(i=!0),Number(t)!==l.eL2.custom||!a().not.existy(e.costCount)&&0!==e.costCount||(o=!0,n.ZP.error("第".concat(c+1,"条分摊明细 : ").concat(r.costCount))),Object.keys(e).forEach((function(t){a().not.existy(r[t])||!0===o||(a().not.existy(e[t])||a().empty(e[t]))&&(o=!0,n.ZP.error("第".concat(c+1,"条分摊明细 : ").concat(r[t])))})))})),!0===i?n.ZP.error("分摊数据为空"):!0===o}(e.expense.costItems,s);if(!d){var u=i.map((function(e){return c().omit(e,["cityName","platformName","vendorName","districtName","costCountFlag"])}));Number(s)===l.eL2.custom&&(u=i.map((function(e){return c().omit(e,["cityName","platformName","vendorName","districtName","costCount","costCountFlag"])})));var p=c().uniqWith(u,c().isEqual);if(u.length!==p.length)return r=!1,n.ZP.error("成本分摊不能设置相同的成本归属");if(s===l.eL2.custom){if(l.fbc.exchangePriceToCent(e.money)!==i.reduce((function(e,t){return e+l.fbc.exchangePriceToCent(t.costCount)}),0))return n.ZP.error("费用金额与分摊金额总和不一致")}return r}r=!1}}},74443:function(e,t,r){r(9070);var n=r(20924),o=r(93433),a=r(15671),i=r(43144),c=r(97326),l=r(60136),s=r(82963),d=r(61120),u=r(4942),p=r(45697),m=r.n(p),f=r(67294),y=r(97860),v=r(96036),O=r(38108);function Z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,s.Z)(this,r)}}var C=function(e){(0,l.Z)(r,e);var t=Z(r);function r(e){var i;return(0,a.Z)(this,r),i=t.call(this,e),(0,u.Z)((0,c.Z)(i),"onUploadSuccess",(function(e){var t=i.state.fileList,r=i.props.form.setFieldsValue,n=[].concat((0,o.Z)(t),[e]);i.setState({fileList:n}),r({fileList:n})})),(0,u.Z)((0,c.Z)(i),"onDeleteFile",(function(e){var t=i.state.fileList,r=i.props.form.setFieldsValue,n=(0,o.Z)(t);n.splice(e,1),i.setState({fileList:n}),r({fileList:n})})),(0,u.Z)((0,c.Z)(i),"renderForm",(function(){var e=i.state,t=e.fileList,r=e.fileListUrl,n=e.domain,o=[{label:"上传附件",form:f.createElement("div",null,f.createElement(y.Z,{namespace:i.private.namespace,isVerifyFileType:!0,onSuccess:i.onUploadSuccess,onFailure:i.onUploadFailure,domain:n}),t.map((function(e,t){return r[t]?f.createElement("p",null,f.createElement("a",{className:O.Z["app-comp-expense-manage-template-refund-upload"],rel:"noopener noreferrer",target:"_blank",key:t,href:r[t]},e),f.createElement("span",{onClick:function(){i.onDeleteFile(t)},className:O.Z["app-comp-expense-manage-form-upload"]},"删除")):f.createElement("p",{key:t},e,f.createElement("span",{onClick:function(){i.onDeleteFile(t)},className:O.Z["app-comp-expense-manage-form-upload"]},"删除"))})))}];return f.createElement(v.KP,{cols:1,items:o,layout:{labelCol:{span:3},wrapperCol:{span:21}}})})),(0,u.Z)((0,c.Z)(i),"renderHiddenForm",(function(){var e=i.state.fileList,t=[{label:"",form:i.props.form.getFieldDecorator("fileList",{initialValue:e})(f.createElement(n.Z,{hidden:!0}))}];return f.createElement(v.KP,{items:t,cols:1,layout:{labelCol:{span:3},wrapperCol:{span:21}}})})),(0,u.Z)((0,c.Z)(i),"renderContent",(function(){return f.createElement("div",null,i.renderForm(),i.renderHiddenForm())})),i.state={fileList:e.fileList,fileListUrl:e.fileListUrl,domain:e.domain},i.private={namespace:"namespace".concat(Math.floor(1e5*Math.random()))},i}return(0,i.Z)(r,[{key:"render",value:function(){return this.renderContent()}}]),r}(f.Component);(0,u.Z)(C,"propTypes",{form:m().object,fileList:m().array,fileListUrl:m().array,domain:m().string}),(0,u.Z)(C,"defaultProps",{form:{},fileList:[],fileListUrl:[],isDown:!1,domain:"deflateDomain"}),t.Z=C},59257:function(e,t,r){r.r(t),r.d(t,{default:function(){return j}});var n=r(15671),o=r(43144),a=r(97326),i=r(60136),c=r(82963),l=r(61120),s=r(4942),d=r(55609),u=r(45697),p=r.n(u),m=r(67294),f=r(66939),y=(r(98703),r(96036)),v=r(54971),O=(r(52560),r(71577)),Z=(r(9070),r(20924)),C=(r(36616),r(51368)),h=(r(51838),r(48086)),x=r(80385),b=r(74443),g=r(80957),D=r(78877),E=r(28501),I=r(38109);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var N=(0,d.connect)()(f.Z.create()((function(e){var t,r,n,o,a,i,c,l,s=!0,d=e.form,u=e.detail,p=void 0===u?{}:u,f=e.orderId,v=e.dispatch,P=e.refundId,N=e.originalId,F=e.costOrderId,L=e.examineDetail,j=void 0===L?{}:L,w=e.invoiceCostOrder,R=void 0===w?{}:w,S=d.getFieldDecorator,T=d.validateFields,U=d.resetFields,q=p.totalMoney,M=void 0===q?void 0:q,B=p.costGroupName,V=p.costAccountingInfo,z=(V=void 0===V?{name:""}:V).name,A=V.costCenterType,K=p.costAccountingId,_=R.totalMoney,Y=R.note,H=R.attachmentPrivateUrls,W=R.attachments,G=function(){T((function(e,t){if(!e){var r=(0,D.Z)(t,e),n=k(k(k({},p),t),{},{totalMoney:-100*t.money});!0===r&&!N&&s&&v({type:"expenseCostOrder/createRefundOrder",payload:{orderId:P,costOrderId:F,action:x.rkq.refund,records:[n],onSuccessCallback:J,onFailureCallback:Q}}),!0===r&&N&&s&&v({type:"expenseCostOrder/updateRefundOrder",payload:{refundCostId:N,costOrderId:F,action:x.rkq.refund,record:n,onSuccessCallback:J,onFailureCallback:Q}})}}))},J=function(){s=!1,U(),window.location.href="/#/Expense/Manage/RefundForm?orderId=".concat(f,"&refundId=").concat(P)},Q=function(e){if(e&&e.zh_message)return s=!0,h.ZP.error(e.zh_message)};return N&&0===Object.keys(R).length?null:m.createElement("div",{className:I.Z["app-comp-expense-manage-refund-cost-wrap"]},m.createElement("h2",{className:I.Z["app-comp-expense-manage-refund-cost-title"]},"退款申请单"),(l=[{label:"退款金额",form:S("money",{initialValue:_?x.fbc.exchangePriceToYuan(-_):"",rules:[{required:!0,message:"请填写内容"}]})(m.createElement(C.Z,{min:0,max:x.fbc.exchangePriceToYuan(M),step:.01,formatter:x.fbc.limitDecimals,parser:x.fbc.limitDecimals}))},{label:"费用分组",form:B||"--"},{label:"科目",form:z||"--"}],m.createElement(y.KP,{items:l,layout:{labelCol:{span:9},wrapperCol:{span:15}},cols:3})),(r=j.platformCodes,n=R.allocationMode,o=void 0===n?void 0:n,a=R.costAllocationList,i=void 0===a?[]:a,c=0===Object.keys(R).length?{}:{costBelong:o,costItems:i.map((function(e){var t;e.money&&(t=-x.fbc.exchangePriceToYuan(e.money));var r={};return e.platformCode&&(r.platform=e.platformCode,r.platformName=e.platformName),e.supplierId&&(r.vendor=e.supplierId,r.vendorName=e.supplierName),e.cityCode&&(r.city=e.cityCode,r.cityName=e.cityName,r.citySpelling=e.citySpelling),e.bizDistrictId&&(r.district=e.bizDistrictId,r.districtName=e.bizDistrictName),t&&(r.costCount=t),r}))},S("expense",{initialValue:c})(m.createElement(g.Z,{CostAccountingId:K,form:d,selectedCostCenterType:A,platformParam:r}))),(t=[{label:"退款说明",form:S("description",{initialValue:Y,rules:[{required:!0,message:"请填写内容"}]})(m.createElement(Z.Z,null))}],m.createElement(y.KP,{items:t,cols:1,layout:{labelCol:{span:3},wrapperCol:{span:21}}})),m.createElement(b.Z,{form:d,fileList:W,fileListUrl:H}),m.createElement(E.Z,{form:d,totalMoney:d.getFieldValue("money"),detail:R,isClassName:!0}),m.createElement("div",{className:I.Z["app-comp-expense-refund-operate-wrap"]},m.createElement(O.Z,{type:"primary",onClick:J},"取消"),m.createElement(O.Z,{type:"primary",onClick:G,className:I.Z["app-comp-expense-refund-save"]},"保存")))})));function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.Z)(e);if(t){var o=(0,l.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.Z)(this,r)}}var L=function(e){(0,i.Z)(r,e);var t=F(r);function r(){var e;(0,n.Z)(this,r);for(var o=arguments.length,i=new Array(o),c=0;c<o;c++)i[c]=arguments[c];return e=t.call.apply(t,[this].concat(i)),(0,s.Z)((0,a.Z)(e),"onSuccessCallbackExamineOrderDetail",(function(t){var r=t.flow_id,n=void 0===r?"":r,o=e.props.dispatch;n&&o({type:"expenseExamineFlow/fetchExamineDetail",payload:{id:n}})})),(0,s.Z)((0,a.Z)(e),"renderOriginalCostOrder",(function(){var t=e.props,r=t.location,n=t.examineOrderDetail,o=t.examineDetail,a=t.costOrderDetail,i=r.query.costOrderId;return m.createElement(v.Z,{location:r,recordId:i,costOrderDetail:a,examineOrderDetail:n,examineDetail:o})})),(0,s.Z)((0,a.Z)(e),"renderRefundOrder",(function(){var t=e.props,r=t.examineOrderDetail,n=t.costOrderDetail,o=t.location,a=t.invoiceCostOrder,i=t.examineDetail,c=o.query,l=c.orderId,s=c.costOrderId,d=c.refundId,u=c.originalId;return m.createElement(N,{orderId:l,refundId:d,originalId:u,costOrderId:s,detail:n,invoiceCostOrder:a,examineDetail:i,examineOrderDetail:r})})),(0,s.Z)((0,a.Z)(e),"renderContent",(function(){var t=e.props,r=t.examineOrderDetail,n=t.examineDetail,o=t.costOrderDetail;return 0===Object.keys(n).length||0===Object.keys(r).length||0===Object.keys(o).length?null:m.createElement("div",null,m.createElement(y.IT,{title:"原费用单"},e.renderOriginalCostOrder()),e.renderRefundOrder())})),e}return(0,o.Z)(r,[{key:"componentDidMount",value:function(){var e=this.props,t=e.dispatch,r=e.location.query,n=r.orderId,o=r.costOrderId,a=r.originalId;o&&t({type:"expenseCostOrder/fetchCostOrderDetail",payload:{recordId:o}}),a&&"undefined"!==a&&t({type:"expenseCostOrder/fetchInvoiceCostOrderDetail",payload:{recordId:a}}),void 0!==n&&t({type:"expenseExamineOrder/fetchExamineOrderDetail",payload:{id:n,flag:!0,onSuccessCallback:this.onSuccessCallbackExamineOrderDetail}})}},{key:"componentWillUnmount",value:function(){(0,this.props.dispatch)({type:"expenseCostOrder/resetInvoiceCostOrderDetail",payload:{}})}},{key:"render",value:function(){return this.renderContent()}}]),r}(m.Component);(0,s.Z)(L,"propTypes",{examineOrderDetail:p().object,examineDetail:p().object,costOrderDetail:p().object,invoiceCostOrder:p().object}),(0,s.Z)(L,"defaultProps",{examineOrderDetail:{},examineDetail:{},costOrderDetail:{},invoiceCostOrder:{}});var j=(0,d.connect)((function(e){var t=e.expenseExamineOrder.examineOrderDetail,r=e.expenseExamineFlow.examineDetail,n=e.expenseCostOrder;return{examineOrderDetail:t,examineDetail:r,costOrderDetail:n.costOrderDetail,invoiceCostOrder:n.invoiceCostOrder}}))(f.Z.create()(L))}}]);