"use strict";(self.webpackChunkaoaoBoss=self.webpackChunkaoaoBoss||[]).push([[1199],{71199:function(e,t,n){n.r(t);n(13062);var r=n(71230),o=(n(89032),n(15746)),a=(n(52560),n(71577)),c=(n(51838),n(48086)),i=n(15671),s=n(43144),u=n(97326),l=n(60136),p=n(82963),d=n(61120),f=n(4942),g=n(94315),m=n.n(g),Z=n(67294),y=n(55609),C=n(93517),v=n.n(C),h=n(66939),b=(n(98703),n(97116)),E=n(80385),I=n(62504),F=n(55965),j=n(8926),O=n(35833),x=n(90963),A=n(2203),P=n(8583),w=n(67955);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){(0,f.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,p.Z)(this,n)}}var M=b.Iq.platform(),T=function(e){(0,l.Z)(n,e);var t=D(n);function n(e){var s;return(0,i.Z)(this,n),s=t.call(this,e),(0,f.Z)((0,u.Z)(s),"onVerifyExpenseCostItems",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(m().empty(e))return c.ZP.error("分摊数据为空"),!1;if(m().not.array(e))return c.ZP.error("分摊数据格式错误"),!1;var n={vendor:"分摊信息供应商未选择",city:"分摊信息城市未选择",district:"分摊信息商圈未选择",costCount:"分摊金额不能为空"},r=!1;if(e.forEach((function(e,t){!0!==r&&Object.keys(e).forEach((function(o){m().not.existy(n[o])||!0===r||(m().not.existy(e[o])||m().empty(e[o]))&&(r=!0,c.ZP.error("第".concat(t+1,"条分摊明细 : ").concat(n[o])))}))})),Number(t)===E.F$Y.city){var o={};e.forEach((function(e){if(o[e.city])return c.ZP.error("成本分摊对象不能重复"),r=!0,!1;o[e.city]=!0}))}if(Number(t)===E.F$Y.district){var a={};e.forEach((function(e){if(a[e.district])return c.ZP.error("成本分摊对象不能重复"),r=!0,!1;a[e.district]=!0}))}return!0!==r})),(0,f.Z)((0,u.Z)(s),"onSave",(function(){var e=s.props,t=e.form,n=e.dispatch,r=function(e){s.setState({id:e._id,isDisable:!1,isSaveDisable:!0,isUpdateContract:!0})},o=function(e){e.zh_message&&c.ZP.error(e.zh_message)},a={};t.validateFields((function(e,t){!1!==s.onVerifyExpenseCostItems(v().get(t,"expense.costItems"),v().get(t,"costCenterType"))&&(e||(""===t.monthMoney||""===t.pledgeMoney||""===t.agentMoney||t.monthMoney+t.pledgeMoney+t.agentMoney!==0?(t.invoiceTitle&&(a.rentInvoiceTitle=t.invoiceTitle,a.pledgeInvoiceTitle=t.invoiceTitle,a.agentInvoiceTitle=t.invoiceTitle),n({type:"expenseHouseContract/createHouseContract",payload:{param:k(k({},t),a),onSuccessCallback:r,onFailureCallback:o}})):c.ZP.error("月租金和押金金额和费用金额不能都为0！！！")))}))})),(0,f.Z)((0,u.Z)(s),"onSaveAndExecute",(function(){(0,s.props.dispatch)({type:"expenseHouseContract/createInitApplicationOrder",payload:{params:{id:s.state.id},onSuccessCallback:function(){window.location.href="/#/Expense/Manage/House"},onFailureCallback:function(e){c.ZP.error(e.zh_message)}}})})),(0,f.Z)((0,u.Z)(s),"onSaveAndCreateOrder",(function(){var e=s.state.id;void 0!==e&&(window.location.href="/#/Expense/Manage/House/Apply?id=".concat(e))})),(0,f.Z)((0,u.Z)(s),"onChangeMigrateFlag",(function(e){s.setState({migrateFlag:e,isDisable:!0})})),(0,f.Z)((0,u.Z)(s),"onChangeCostCenterType",(function(e){s.selected.costCenterType=e,s.changeSubject()})),(0,f.Z)((0,u.Z)(s),"onChangePlatform",(function(e){s.selected.platform=e,s.changeSubject()})),(0,f.Z)((0,u.Z)(s),"changeSubject",(function(){var e=s.props.form.setFieldsValue,t=s.selected,n=t.platform,r=t.costCenterType,o=v().get(s.props,"examineFlowConfig",{});if(n&&r){var a=v().get(o,"".concat(n,".accountings"),{}),c=v().get(a,"rent_accounting_id.".concat(r),""),i=v().get(a,"pledge_accounting_id.".concat(r),""),u=v().get(a,"agent_accounting_id.".concat(r),"");s.setState({subject:{rentAccountingId:c,pledgeAccountingId:i,agentAccountingId:u}}),e({rentAccountingId:c,pledgeAccountingId:i,agentAccountingId:u})}})),(0,f.Z)((0,u.Z)(s),"renderHouseInfo",(function(){var e=s.props.form,t=s.state.isUpdateContract;return Z.createElement(I.Z,{form:e,disabled:t,onChangeMigrateFlag:s.onChangeMigrateFlag})})),(0,f.Z)((0,u.Z)(s),"renderRenew",(function(){var e=s.props.form;return Z.createElement(A.Z,{form:e,isCreate:!0})})),(0,f.Z)((0,u.Z)(s),"renderContract",(function(){var e=s.props.form,t=s.state.isUpdateContract;return Z.createElement(P.Z,{form:e,isCreate:!0,disabled:t,onChangeMigrateFlag:s.onChangeMigrateFlag})})),(0,f.Z)((0,u.Z)(s),"renderAscriptionInfo",(function(){var e=s.props.form,t=s.state.isUpdateContract;return Z.createElement(x.Z,{form:e,isUpdateContract:t,onChangeCostCenterType:s.onChangeCostCenterType,onChangePlatform:s.onChangePlatform,disabled:t})})),(0,f.Z)((0,u.Z)(s),"renderRentInfo",(function(){var e=s.props.form,t=s.state,n=t.subject.rentAccountingId,r=t.migrateFlag,o=t.isUpdateContract;return Z.createElement(O.Z,{migrateFlag:r,form:e,subjectId:n,isCreate:!0,isUpdateContract:o,disabled:o})})),(0,f.Z)((0,u.Z)(s),"renderDeposit",(function(){var e=s.props.form,t=s.state,n=t.subject.pledgeAccountingId,r=t.migrateFlag,o=t.isUpdateContract;return Z.createElement(F.Z,{form:e,migrateFlag:r,disabled:o,subjectId:n})})),(0,f.Z)((0,u.Z)(s),"renderAgencyFees",(function(){var e=s.props.form,t=s.state,n=t.subject.agentAccountingId,r=t.isUpdateContract;return Z.createElement(j.Z,{form:e,disabled:r,subjectId:n})})),(0,f.Z)((0,u.Z)(s),"renderOprations",(function(){var e=s.state,t=e.isDisable,n=e.isSaveDisable,c=s.state.migrateFlag,i=[Z.createElement(o.Z,{key:"save"},Z.createElement(a.Z,{type:"primary",size:"large",disabled:n,onClick:s.onSave},"保存房屋合同"))];return c?i.push(Z.createElement(o.Z,{key:"save&excute"},Z.createElement(a.Z,{type:"primary",size:"large",disabled:t,onClick:s.onSaveAndExecute},"执行合同"))):i.push(Z.createElement(o.Z,{key:"save&generate"},Z.createElement(a.Z,{type:"primary",size:"large",disabled:t,onClick:s.onSaveAndCreateOrder},"预览生成费用申请单"))),Z.createElement(r.Z,{type:"flex",align:"middle",justify:"space-around",className:w.Z["app-comp-expense-house-contract-create"]},i)})),(0,f.Z)((0,u.Z)(s),"render",(function(){return Z.createElement(h.Z,{layout:"horizontal"},s.renderHouseInfo(),s.renderAscriptionInfo(),s.renderContract(),s.renderRentInfo(),s.renderDeposit(),s.renderAgencyFees(),s.renderOprations())})),s.state={migrateFlag:0,subject:{rentAccountingId:"",pledgeAccountingId:"",agentAccountingId:""},id:void 0,isDisable:!0,isSaveDisable:!1,isUpdateContract:!1},s.selected={costCenterType:void 0,platform:void 0},s}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)({type:"expenseExamineFlow/fetchExamineFlowConfig",payload:{feature:"house_contract",platforms:M.map((function(e){return e.id}))}})}}]),n}(Z.Component);t.default=(0,y.connect)((function(e){return{examineFlowConfig:e.expenseExamineFlow.examineFlowConfig}}))(h.Z.create()(T))}}]);